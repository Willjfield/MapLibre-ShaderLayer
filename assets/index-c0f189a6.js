var Tg=(a,c)=>()=>(c||a((c={exports:{}}).exports,c),c.exports);var h1=Tg(Ii=>{(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))y(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const I of T.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&y(I)}).observe(document,{childList:!0,subtree:!0});function p(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function y(x){if(x.ep)return;x.ep=!0;const T=p(x);fetch(x.href,T)}})();var Eg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vp(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var $p={exports:{}};(function(a,c){(function(p,y){a.exports=y()})(Eg,function(){var p,y,x;function T(o,L){if(!p)p=L;else if(!y)y=L;else{var k="var sharedChunk = {}; ("+p+")(sharedChunk); ("+y+")(sharedChunk);",Y={};p(Y),x=L(Y),typeof window<"u"&&(x.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}T(["exports"],function(o){function L(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var k=Y;function Y(i,t){this.x=i,this.y=t}Y.prototype={clone:function(){return new Y(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,t){var r=Math.cos(i),n=Math.sin(i),h=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Y.convert=function(i){return i instanceof Y?i:Array.isArray(i)?new Y(i[0],i[1]):i};var N=L(k),ot=mt;function mt(i,t,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=n}mt.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,n=0;n<8;n++){var h=this.sampleCurveX(r)-i;if(Math.abs(h)<t)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=h/f}var g=0,_=1;for(r=i,n=0;n<20&&(h=this.sampleCurveX(r),!(Math.abs(h-i)<t));n++)i>h?g=r:_=r,r=.5*(_-g)+g;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ft=L(ot);function Mt(i,t,r,n){const h=new ft(i,t,r,n);return function(f){return h.solve(f)}}const Tt=Mt(.25,.1,.25,1);function Dt(i,t,r){return Math.min(r,Math.max(t,i))}function $t(i,t,r){const n=r-t,h=((i-t)%n+n)%n+t;return h===t?r:h}function Pt(i,...t){for(const r of t)for(const n in r)i[n]=r[n];return i}let Wt=1;function de(i,t,r){const n={};for(const h in i)n[h]=t.call(r||this,i[h],h,i);return n}function ve(i,t,r){const n={};for(const h in i)t.call(r||this,i[h],h,i)&&(n[h]=i[h]);return n}function Se(i){return Array.isArray(i)?i.map(Se):typeof i=="object"&&i?de(i,Se):i}const xe={};function Ce(i){xe[i]||(typeof console<"u"&&console.warn(i),xe[i]=!0)}function oe(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function zi(i){let t=0;for(let r,n,h=0,f=i.length,g=f-1;h<f;g=h++)r=i[h],n=i[g],t+=(n.x-r.x)*(r.y+n.y);return t}function mi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let nr=null;function Yr(i){if(nr==null){const t=i.navigator?i.navigator.userAgent:null;nr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return nr}function Ui(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ni="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Jr,gi;const xs={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){return this.getImageCanvasContext(i).getImageData(-t,-t,i.width+2*t,i.height+2*t)},getImageCanvasContext(i){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=i.width,t.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(Jr||(Jr=document.createElement("a")),Jr.href=i,Jr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(gi==null&&(gi=matchMedia("(prefers-reduced-motion: reduce)")),gi.matches)}},ha={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Cr extends Error{constructor(t,r,n,h){super(`AJAXError: ${r} (${t}): ${n}`),this.status=t,this.statusText=r,this.url=n,this.body=h}}const Ai=mi()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Vi=i=>ha.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function ke(i,t){const r=new AbortController,n=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Ai(),signal:r.signal});let h=!1,f=!1;return i.type==="json"&&n.headers.set("Accept","application/json"),f||fetch(n).then(g=>g.ok?(_=>{(i.type==="arrayBuffer"||i.type==="image"?_.arrayBuffer():i.type==="json"?_.json():_.text()).then(w=>{f||(h=!0,t(null,w,_.headers.get("Cache-Control"),_.headers.get("Expires")))}).catch(w=>{f||t(new Error(w.message))})})(g):g.blob().then(_=>t(new Cr(g.status,g.statusText,i.url,_)))).catch(g=>{g.code!==20&&t(new Error(g.message))}),{cancel:()=>{f=!0,h||r.abort()}}}const Pr=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(mi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!mi())return(Vi(i.url)||ke)(i,t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Ai())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ke(i,t);if(mi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var r;return function(n,h){const f=new XMLHttpRequest;f.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(f.responseType="arraybuffer");for(const g in n.headers)f.setRequestHeader(g,n.headers[g]);return n.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=n.credentials==="include",f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let g=f.response;if(n.type==="json")try{g=JSON.parse(f.response)}catch(_){return h(_)}h(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else{const g=new Blob([f.response],{type:f.getResponseHeader("Content-Type")});h(new Cr(f.status,f.statusText,n.url,g))}},f.send(n.body),{cancel:()=>f.abort()}}(i,t)},Qr=function(i,t){return Pr(Pt(i,{type:"arrayBuffer"}),t)};function zr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function ts(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function kr(i,t,r){if(r&&r[i]){const n=r[i].indexOf(t);n!==-1&&r[i].splice(n,1)}}class $i{constructor(t,r={}){Pt(this,r),this.type=t}}class or extends $i{constructor(t,r={}){super("error",Pt({error:t},r))}}class Dr{on(t,r){return this._listeners=this._listeners||{},ts(t,r,this._listeners),this}off(t,r){return kr(t,r,this._listeners),kr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ts(t,r,this._oneTimeListeners),this):new Promise(n=>this.once(t,n))}fire(t,r){typeof t=="string"&&(t=new $i(t,r||{}));const n=t.type;if(this.listens(n)){t.target=this;const h=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const _ of h)_.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const _ of f)kr(n,_,this._oneTimeListeners),_.call(this,t);const g=this._eventedParent;g&&(Pt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof or&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var gt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const es=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ca(i,t){const r={};for(const n in i)n!=="ref"&&(r[n]=i[n]);return es.forEach(n=>{n in t&&(r[n]=t[n])}),r}function De(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!De(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!De(i[r],t[r]))return!1;return!0}return i===t}const Ie={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ns(i,t,r){r.push({command:Ie.addSource,args:[i,t[i]]})}function Vs(i,t,r){t.push({command:Ie.removeSource,args:[i]}),r[i]=!0}function fn(i,t,r,n){Vs(i,r,n),Ns(i,t,r)}function mn(i,t,r){let n;for(n in i[r])if(Object.prototype.hasOwnProperty.call(i[r],n)&&n!=="data"&&!De(i[r][n],t[r][n]))return!1;for(n in t[r])if(Object.prototype.hasOwnProperty.call(t[r],n)&&n!=="data"&&!De(i[r][n],t[r][n]))return!1;return!0}function Xe(i,t,r,n,h,f){let g;for(g in t=t||{},i=i||{})Object.prototype.hasOwnProperty.call(i,g)&&(De(i[g],t[g])||r.push({command:f,args:[n,g,t[g],h]}));for(g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(De(i[g],t[g])||r.push({command:f,args:[n,g,t[g],h]}))}function Fa(i){return i.id}function ua(i,t){return i[t.id]=t,i}class Lt{constructor(t,r,n,h){this.message=(t?`${t}: `:"")+n,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function qi(i,...t){for(const r of t)for(const n in r)i[n]=r[n];return i}class Wi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class is{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[n,h]of r)this.bindings[n]=h}concat(t){return new is(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const bs={kind:"null"},Rt={kind:"number"},he={kind:"string"},ce={kind:"boolean"},ki={kind:"color"},rs={kind:"object"},se={kind:"value"},qr={kind:"collator"},Gr={kind:"formatted"},ws={kind:"padding"},xr={kind:"resolvedImage"},Ms={kind:"variableAnchorOffsetCollection"};function Ci(i,t){return{kind:"array",itemType:i,N:t}}function Ue(i){if(i.kind==="array"){const t=Ue(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Oa=[bs,Rt,he,ce,ki,Gr,rs,Ci(se),ws,xr,Ms];function Zr(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Zr(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of Oa)if(!Zr(r,t))return null}}return`Expected ${Ue(i)} but found ${Ue(t)} instead.`}function X(i,t){return t.some(r=>r.kind===i.kind)}function D(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function B(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const V=.96422,H=.82521,Q=4/29,at=6/29,et=3*at*at,tt=at*at*at,lt=Math.PI/180,vt=180/Math.PI;function bt(i){return(i%=360)<0&&(i+=360),i}function wt([i,t,r,n]){let h,f;const g=le((.2225045*(i=te(i))+.7168786*(t=te(t))+.0606169*(r=te(r)))/1);i===t&&t===r?h=f=g:(h=le((.4360747*i+.3850649*t+.1430804*r)/V),f=le((.0139322*i+.0971045*t+.7141733*r)/H));const _=116*g-16;return[_<0?0:_,500*(h-g),200*(g-f),n]}function te(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function le(i){return i>tt?Math.pow(i,1/3):i/et+Q}function Zt([i,t,r,n]){let h=(i+16)/116,f=isNaN(t)?h:h+t/500,g=isNaN(r)?h:h-r/200;return h=1*ne(h),f=V*ne(f),g=H*ne(g),[Jt(3.1338561*f-1.6168667*h-.4906146*g),Jt(-.9787684*f+1.9161415*h+.033454*g),Jt(.0719453*f-.2289914*h+1.4052427*g),n]}function Jt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ne(i){return i>at?i*i*i:et*(i-Q)}function Me(i){return parseInt(i.padEnd(2,i),16)/255}function Le(i,t){return ge(t?i/100:i,0,1)}function ge(i,t,r){return Math.min(Math.max(t,i),r)}function we(i){return!i.some(Number.isNaN)}const Hi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ae{constructor(t,r,n,h=1,f=!0){this.r=t,this.g=r,this.b=n,this.a=h,f||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,r,n,h]))}static parse(t){if(t instanceof ae)return t;if(typeof t!="string")return;const r=function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Hi[n];if(h){const[g,_,w]=h;return[g/255,_/255,w/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const g=n.length<6?1:2;let _=1;return[Me(n.slice(_,_+=g)),Me(n.slice(_,_+=g)),Me(n.slice(_,_+=g)),Me(n.slice(_,_+g)||"ff")]}if(n.startsWith("rgb")){const g=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,w,E,C,z,R,O,U,Z,W,J,nt]=g,it=[C||" ",O||" ",W].join("");if(it==="  "||it==="  /"||it===",,"||it===",,,"){const ht=[E,R,Z].join(""),ut=ht==="%%%"?100:ht===""?255:0;if(ut){const yt=[ge(+w/ut,0,1),ge(+z/ut,0,1),ge(+U/ut,0,1),J?Le(+J,nt):1];if(we(yt))return yt}}return}}const f=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,_,w,E,C,z,R,O,U]=f,Z=[w||" ",C||" ",R].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const W=[+_,ge(+E,0,100),ge(+z,0,100),O?Le(+O,U):1];if(we(W))return function([J,nt,it,ht]){function ut(yt){const Ut=(yt+J/30)%12,Xt=nt*Math.min(it,1-it);return it-Xt*Math.max(-1,Math.min(Ut-3,9-Ut,1))}return J=bt(J),nt/=100,it/=100,[ut(0),ut(8),ut(4),ht]}(W)}}}(t);return r?new ae(...r,!1):void 0}get rgb(){const{r:t,g:r,b:n,a:h}=this,f=h||1/0;return this.overwriteGetter("rgb",[t/f,r/f,n/f,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,n,h,f]=wt(t),g=Math.sqrt(n*n+h*h);return[Math.round(1e4*g)?bt(Math.atan2(h,n)*vt):NaN,g,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wt(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,n,h]=this.rgb;return`rgba(${[t,r,n].map(f=>Math.round(255*f)).join(",")},${h})`}}ae.black=new ae(0,0,0,1),ae.white=new ae(1,1,1,1),ae.transparent=new ae(0,0,0,0),ae.red=new ae(1,0,0,1);class ui{constructor(t,r,n){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pi{constructor(t,r,n,h,f){this.text=t,this.image=r,this.scale=n,this.fontStack=h,this.textColor=f}}class ei{constructor(t){this.sections=t}static fromString(t){return new ei([new Pi(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ei?t:ei.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class lr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof lr)return t;if(typeof t=="number")return new lr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new lr(t)}}toString(){return JSON.stringify(this.values)}}const uc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Di{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Di)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const n=t[r],h=t[r+1];if(typeof n!="string"||!uc.has(n)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Di(t)}}toString(){return JSON.stringify(this.values)}}class br{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new br({name:t,available:!1}):null}}function Ul(i,t,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,t,r,n]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gn(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ae||i instanceof ui||i instanceof ei||i instanceof lr||i instanceof Di||i instanceof br)return!0;if(Array.isArray(i)){for(const t of i)if(!gn(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!gn(i[t]))return!1;return!0}return!1}function ii(i){if(i===null)return bs;if(typeof i=="string")return he;if(typeof i=="boolean")return ce;if(typeof i=="number")return Rt;if(i instanceof ae)return ki;if(i instanceof ui)return qr;if(i instanceof ei)return Gr;if(i instanceof lr)return ws;if(i instanceof Di)return Ms;if(i instanceof br)return xr;if(Array.isArray(i)){const t=i.length;let r;for(const n of i){const h=ii(n);if(r){if(r===h)continue;r=se;break}r=h}return Ci(r||se,t)}return rs}function Ts(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof ae||i instanceof ei||i instanceof lr||i instanceof Di||i instanceof br?i.toString():JSON.stringify(i)}class $s{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!gn(t[1]))return r.error("invalid value");const n=t[1];let h=ii(n);const f=r.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new $s(h,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ri{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const _n={string:he,number:Rt,boolean:ce,object:rs};class Li{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let n,h=1;const f=t[0];if(f==="array"){let _,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in _n)||E==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=_n[E],h++}else _=se;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}n=Ci(_,w)}else{if(!_n[f])throw new Error(`Types doesn't contain name = ${f}`);n=_n[f]}const g=[];for(;h<t.length;h++){const _=r.parse(t[h],h,se);if(!_)return null;g.push(_)}return new Li(n,g)}evaluate(t){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(t);if(!Zr(this.type,ii(n)))return n;if(r===this.args.length-1)throw new ri(`Expected value to be of type ${Ue(this.type)}, but found ${Ue(ii(n))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const yn={"to-boolean":ce,"to-color":ki,"to-number":Rt,"to-string":he};class jr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const n=t[0];if(!yn[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&t.length!==2)return r.error("Expected one argument.");const h=yn[n],f=[];for(let g=1;g<t.length;g++){const _=r.parse(t[g],g,se);if(!_)return null;f.push(_)}return new jr(h,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,n;for(const h of this.args){if(r=h.evaluate(t),n=null,r instanceof ae)return r;if(typeof r=="string"){const f=t.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ul(r[0],r[1],r[2],r[3]),!n))return new ae(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ri(n||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const n of this.args){r=n.evaluate(t);const h=lr.parse(r);if(h)return h}throw new ri(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const n of this.args){r=n.evaluate(t);const h=Di.parse(r);if(h)return h}throw new ri(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const n of this.args){if(r=n.evaluate(t),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new ri(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return ei.fromString(Ts(this.args[0].evaluate(t)));case"resolvedImage":return br.fromString(Ts(this.args[0].evaluate(t)));default:return Ts(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ua=["Unknown","Point","LineString","Polygon"];class Pe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=ae.parse(t)),r}}class vn{constructor(t,r,n=[],h,f=new is,g=[]){this.registry=t,this.path=n,this.key=n.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=g,this.expectedType=h,this._isConstant=r}parse(t,r,n,h,f={}){return r?this.concat(r,n,h)._parse(t,f):this._parse(t,f)}_parse(t,r){function n(h,f,g){return g==="assert"?new Li(f,[h]):g==="coerce"?new jr(f,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let g=f.parse(t,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,w=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else g=n(g,_,r.typeAnnotation||"coerce");else g=n(g,_,r.typeAnnotation||"coerce");else g=n(g,_,r.typeAnnotation||"coerce");else g=n(g,_,r.typeAnnotation||"assert")}if(!(g instanceof $s)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new Pe;try{g=new $s(g.type,g.evaluate(_))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,n){const h=typeof t=="number"?this.path.concat(t):this.path,f=n?this.scope.concat(n):this.scope;return new vn(this.registry,this._isConstant,h,r||null,f,this.errors)}error(t,...r){const n=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new Wi(n,t))}checkSubtype(t,r){const n=Zr(t,r);return n&&this.error(n),n}}class da{constructor(t,r,n){this.type=qr,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const n=t[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const h=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,ce);if(!h)return null;const f=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,ce);if(!f)return null;let g=null;return n.locale&&(g=r.parse(n.locale,1,he),!g)?null:new da(h,f,g)}evaluate(t){return new ui(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const Es=8192;function xn(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Na(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function dc(i,t){const r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(r*h*Es),Math.round(n*h*Es)]}function Nl(i,t,r){const n=i[0]-t[0],h=i[1]-t[1],f=i[0]-r[0],g=i[1]-r[1];return n*g-f*h==0&&n*f<=0&&h*g<=0}function bn(i,t){let r=!1;for(let g=0,_=t.length;g<_;g++){const w=t[g];for(let E=0,C=w.length;E<C-1;E++){if(Nl(i,w[E],w[E+1]))return!1;(h=w[E])[1]>(n=i)[1]!=(f=w[E+1])[1]>n[1]&&n[0]<(f[0]-h[0])*(n[1]-h[1])/(f[1]-h[1])+h[0]&&(r=!r)}}var n,h,f;return r}function pc(i,t){for(let r=0;r<t.length;r++)if(bn(i,t[r]))return!0;return!1}function Vl(i,t,r,n){const h=n[0]-r[0],f=n[1]-r[1],g=(i[0]-r[0])*f-h*(i[1]-r[1]),_=(t[0]-r[0])*f-h*(t[1]-r[1]);return g>0&&_<0||g<0&&_>0}function fc(i,t,r){for(const E of r)for(let C=0;C<E.length-1;++C)if((_=[(g=E[C+1])[0]-(f=E[C])[0],g[1]-f[1]])[0]*(w=[(h=t)[0]-(n=i)[0],h[1]-n[1]])[1]-_[1]*w[0]!=0&&Vl(n,h,f,g)&&Vl(f,g,n,h))return!0;var n,h,f,g,_,w;return!1}function $l(i,t){for(let r=0;r<i.length;++r)if(!bn(i[r],t))return!1;for(let r=0;r<i.length-1;++r)if(fc(i[r],i[r+1],t))return!1;return!0}function ql(i,t){for(let r=0;r<t.length;r++)if($l(i,t[r]))return!0;return!1}function wn(i,t,r){const n=[];for(let h=0;h<i.length;h++){const f=[];for(let g=0;g<i[h].length;g++){const _=dc(i[h][g],r);xn(t,_),f.push(_)}n.push(f)}return n}function Gl(i,t,r){const n=[];for(let h=0;h<i.length;h++){const f=wn(i[h],t,r);n.push(f)}return n}function Zl(i,t,r,n){if(i[0]<r[0]||i[0]>r[2]){const h=.5*n;let f=i[0]-r[0]>h?-n:r[0]-i[0]>h?n:0;f===0&&(f=i[0]-r[2]>h?-n:r[2]-i[0]>h?n:0),i[0]+=f}xn(t,i)}function Mn(i,t,r,n){const h=Math.pow(2,n.z)*Es,f=[n.x*Es,n.y*Es],g=[];for(const _ of i)for(const w of _){const E=[w.x+f[0],w.y+f[1]];Zl(E,t,r,h),g.push(E)}return g}function jl(i,t,r,n){const h=Math.pow(2,n.z)*Es,f=[n.x*Es,n.y*Es],g=[];for(const w of i){const E=[];for(const C of w){const z=[C.x+f[0],C.y+f[1]];xn(t,z),E.push(z)}g.push(E)}if(t[2]-t[0]<=h/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of g)for(const E of w)Zl(E,t,r,h)}var _;return g}class qs{constructor(t,r){this.type=ce,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(gn(t[1])){const n=t[1];if(n.type==="FeatureCollection")for(let h=0;h<n.features.length;++h){const f=n.features[h].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new qs(n,n.features[h].geometry)}else if(n.type==="Feature"){const h=n.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new qs(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new qs(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,n){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(n.type==="Polygon"){const _=wn(n.coordinates,f,g),w=Mn(r.geometry(),h,f,g);if(!Na(h,f))return!1;for(const E of w)if(!bn(E,_))return!1}if(n.type==="MultiPolygon"){const _=Gl(n.coordinates,f,g),w=Mn(r.geometry(),h,f,g);if(!Na(h,f))return!1;for(const E of w)if(!pc(E,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,n){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(n.type==="Polygon"){const _=wn(n.coordinates,f,g),w=jl(r.geometry(),h,f,g);if(!Na(h,f))return!1;for(const E of w)if(!$l(E,_))return!1}if(n.type==="MultiPolygon"){const _=Gl(n.coordinates,f,g),w=jl(r.geometry(),h,f,g);if(!Na(h,f))return!1;for(const E of w)if(!ql(E,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Tn{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=t[1];return r.scope.has(n)?new Tn(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class hr{constructor(t,r,n,h){this.name=t,this.type=r,this._evaluate=n,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const n=t[0],h=hr.definitions[n];if(!h)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,_=g.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,C]of _){w=new vn(r.registry,Va,r.path,null,r.scope);const z=[];let R=!1;for(let O=1;O<t.length;O++){const U=t[O],Z=Array.isArray(E)?E[O-1]:E.type,W=w.parse(U,1+z.length,Z);if(!W){R=!0;break}z.push(W)}if(!R)if(Array.isArray(E)&&E.length!==z.length)w.error(`Expected ${E.length} arguments, but found ${z.length} instead.`);else{for(let O=0;O<z.length;O++){const U=Array.isArray(E)?E[O]:E.type,Z=z[O];w.concat(O+1).checkSubtype(U,Z.type)}if(w.errors.length===0)return new hr(n,f,C,z)}}if(_.length===1)r.errors.push(...w.errors);else{const E=(_.length?_:g).map(([z])=>{return R=z,Array.isArray(R)?`(${R.map(Ue).join(", ")})`:`(${Ue(R.type)}...)`;var R}).join(" | "),C=[];for(let z=1;z<t.length;z++){const R=r.parse(t[z],1+C.length);if(!R)return null;C.push(Ue(R.type))}r.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(t,r){hr.definitions=r;for(const n in r)t[n]=hr}}function Va(i){if(i instanceof Tn)return Va(i.boundExpression);if(i instanceof hr&&i.name==="error"||i instanceof da||i instanceof qs)return!1;const t=i instanceof jr||i instanceof Li;let r=!0;return i.eachChild(n=>{r=t?r&&Va(n):r&&n instanceof $s}),!!r&&En(i)&&qa(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function En(i){if(i instanceof hr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof qs)return!1;let t=!0;return i.eachChild(r=>{t&&!En(r)&&(t=!1)}),t}function $a(i){if(i instanceof hr&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!$a(r)&&(t=!1)}),t}function qa(i,t){if(i instanceof hr&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!qa(n,t)&&(r=!1)}),r}function Ga(i,t){const r=i.length-1;let n,h,f=0,g=r,_=0;for(;f<=g;)if(_=Math.floor((f+g)/2),n=i[_],h=i[_+1],n<=t){if(_===r||t<h)return _;f=_+1}else{if(!(n>t))throw new ri("Input is not a number.");g=_-1}return 0}class Za{constructor(t,r,n){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[h,f]of n)this.labels.push(h),this.outputs.push(f)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(t[1],1,Rt);if(!n)return null;const h=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let g=1;g<t.length;g+=2){const _=g===1?-1/0:t[g],w=t[g+1],E=g,C=g+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const z=r.parse(w,C,f);if(!z)return null;f=f||z.type,h.push([_,z])}return new Za(f,n,h)}evaluate(t){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return n[0].evaluate(t);const f=r.length;return h>=r[f-1]?n[f-1].evaluate(t):n[Ga(r,h)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Gs(i,t,r){return i+r*(t-i)}function Sn(i,t,r){return i.map((n,h)=>Gs(n,t[h],r))}const cr={number:Gs,color:function(i,t,r,n="rgb"){switch(n){case"rgb":{const[h,f,g,_]=Sn(i.rgb,t.rgb,r);return new ae(h,f,g,_,!1)}case"hcl":{const[h,f,g,_]=i.hcl,[w,E,C,z]=t.hcl;let R,O;if(isNaN(h)||isNaN(w))isNaN(h)?isNaN(w)?R=NaN:(R=w,g!==1&&g!==0||(O=E)):(R=h,C!==1&&C!==0||(O=f));else{let nt=w-h;w>h&&nt>180?nt-=360:w<h&&h-w>180&&(nt+=360),R=h+r*nt}const[U,Z,W,J]=function([nt,it,ht,ut]){return nt=isNaN(nt)?0:nt*lt,Zt([ht,Math.cos(nt)*it,Math.sin(nt)*it,ut])}([R,O??Gs(f,E,r),Gs(g,C,r),Gs(_,z,r)]);return new ae(U,Z,W,J,!1)}case"lab":{const[h,f,g,_]=Zt(Sn(i.lab,t.lab,r));return new ae(h,f,g,_,!1)}}},array:Sn,padding:function(i,t,r){return new lr(Sn(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const n=i.values,h=t.values;if(n.length!==h.length)throw new ri(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const f=[];for(let g=0;g<n.length;g+=2){if(n[g]!==h[g])throw new ri(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${n[g]}, to[${g}]: ${h[g]}`);f.push(n[g]);const[_,w]=n[g+1],[E,C]=h[g+1];f.push([Gs(_,E,r),Gs(w,C,r)])}return new Di(f)}};class ur{constructor(t,r,n,h,f){this.type=t,this.operator=r,this.interpolation=n,this.input=h,this.labels=[],this.outputs=[];for(const[g,_]of f)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(t,r,n,h){let f=0;if(t.name==="exponential")f=Mo(r,t.base,n,h);else if(t.name==="linear")f=Mo(r,1,n,h);else if(t.name==="cubic-bezier"){const g=t.controlPoints;f=new ft(g[0],g[1],g[2],g[3]).solve(Mo(r,1,n,h))}return f}static parse(t,r){let[n,h,f,...g]=t;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Rt),!f)return null;const _=[];let w=null;n==="interpolate-hcl"||n==="interpolate-lab"?w=ki:r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType);for(let E=0;E<g.length;E+=2){const C=g[E],z=g[E+1],R=E+3,O=E+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const U=r.parse(z,O,w);if(!U)return null;w=w||U.type,_.push([C,U])}return B(w,Rt)||B(w,ki)||B(w,ws)||B(w,Ms)||B(w,Ci(Rt))?new ur(w,n,h,f,_):r.error(`Type ${Ue(w)} is not interpolatable.`)}evaluate(t){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return n[0].evaluate(t);const f=r.length;if(h>=r[f-1])return n[f-1].evaluate(t);const g=Ga(r,h),_=ur.interpolationFactor(this.interpolation,h,r[g],r[g+1]),w=n[g].evaluate(t),E=n[g+1].evaluate(t);switch(this.operator){case"interpolate":return cr[this.type.kind](w,E,_);case"interpolate-hcl":return cr.color(w,E,_,"hcl");case"interpolate-lab":return cr.color(w,E,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Mo(i,t,r,n){const h=n-r,f=i-r;return h===0?0:t===1?f/h:(Math.pow(t,f)-1)/(Math.pow(t,h)-1)}class In{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let n=null;const h=r.expectedType;h&&h.kind!=="value"&&(n=h);const f=[];for(const _ of t.slice(1)){const w=r.parse(_,1+f.length,n,void 0,{typeAnnotation:"omit"});if(!w)return null;n=n||w.type,f.push(w)}if(!n)throw new Error("No output type");const g=h&&f.some(_=>Zr(h,_.type));return new In(g?se:n,f)}evaluate(t){let r,n=null,h=0;for(const f of this.args)if(h++,n=f.evaluate(t),n&&n instanceof br&&!n.available&&(r||(r=n.name),n=null,h===this.args.length&&(n=r)),n!==null)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class pa{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let f=1;f<t.length-1;f+=2){const g=t[f];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=r.parse(t[f+1],f+1);if(!_)return null;n.push([g,_])}const h=r.parse(t[t.length-1],t.length-1,r.expectedType,n);return h?new pa(n,h):null}outputDefined(){return this.result.outputDefined()}}class fa{constructor(t,r,n){this.type=t,this.index=r,this.input=n}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=r.parse(t[1],1,Rt),h=r.parse(t[2],2,Ci(r.expectedType||se));return n&&h?new fa(h.type.itemType,n,h):null}evaluate(t){const r=this.index.evaluate(t),n=this.input.evaluate(t);if(r<0)throw new ri(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new ri(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new ri(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Te{constructor(t,r){this.type=ce,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=r.parse(t[1],1,se),h=r.parse(t[2],2,se);return n&&h?X(n.type,[ce,he,Rt,bs,se])?new Te(n,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(n.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!D(r,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(ii(r))} instead.`);if(!D(n,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${Ue(ii(n))} instead.`);return n.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class An{constructor(t,r,n){this.type=Rt,this.needle=t,this.haystack=r,this.fromIndex=n}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=r.parse(t[1],1,se),h=r.parse(t[2],2,se);if(!n||!h)return null;if(!X(n.type,[ce,he,Rt,bs,se]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(n.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Rt);return f?new An(n,h,f):null}return new An(n,h)}evaluate(t){const r=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!D(r,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(ii(r))} instead.`);if(!D(n,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${Ue(ii(n))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return n.indexOf(r,h)}return n.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class To{constructor(t,r,n,h,f,g){this.inputType=t,this.type=r,this.input=n,this.cases=h,this.outputs=f,this.otherwise=g}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let n,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const f={},g=[];for(let E=2;E<t.length-1;E+=2){let C=t[E];const z=t[E+1];Array.isArray(C)||(C=[C]);const R=r.concat(E);if(C.length===0)return R.error("Expected at least one branch label.");for(const U of C){if(typeof U!="number"&&typeof U!="string")return R.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return R.error("Numeric branch labels must be integer values.");if(n){if(R.checkSubtype(n,ii(U)))return null}else n=ii(U);if(f[String(U)]!==void 0)return R.error("Branch labels must be unique.");f[String(U)]=g.length}const O=r.parse(z,E,h);if(!O)return null;h=h||O.type,g.push(O)}const _=r.parse(t[1],1,se);if(!_)return null;const w=r.parse(t[t.length-1],t.length-1,h);return w?_.type.kind!=="value"&&r.concat(1).checkSubtype(n,_.type)?null:new To(n,h,_,f,g,w):null}evaluate(t){const r=this.input.evaluate(t);return(ii(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Eo{constructor(t,r,n){this.type=t,this.branches=r,this.otherwise=n}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const _=r.parse(t[g],g,ce);if(!_)return null;const w=r.parse(t[g+1],g+1,n);if(!w)return null;h.push([_,w]),n=n||w.type}const f=r.parse(t[t.length-1],t.length-1,n);if(!f)return null;if(!n)throw new Error("Can't infer output type");return new Eo(n,h,f)}evaluate(t){for(const[r,n]of this.branches)if(r.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,n]of this.branches)t(r),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Cn{constructor(t,r,n,h){this.type=t,this.input=r,this.beginIndex=n,this.endIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=r.parse(t[1],1,se),h=r.parse(t[2],2,Rt);if(!n||!h)return null;if(!X(n.type,[Ci(se),he,se]))return r.error(`Expected first argument to be of type array or string, but found ${Ue(n.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Rt);return f?new Cn(n.type,n,h,f):null}return new Cn(n.type,n,h)}evaluate(t){const r=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!D(r,["string","array"]))throw new ri(`Expected first argument to be of type array or string, but found ${Ue(ii(r))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return r.slice(n,h)}return r.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Xl(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Wl(i,t,r,n){return n.compare(t,r)===0}function ma(i,t,r){const n=i!=="=="&&i!=="!=";return class qp{constructor(f,g,_){this.type=ce,this.lhs=f,this.rhs=g,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||g.type.kind==="value"}static parse(f,g){if(f.length!==3&&f.length!==4)return g.error("Expected two or three arguments.");const _=f[0];let w=g.parse(f[1],1,se);if(!w)return null;if(!Xl(_,w.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${Ue(w.type)}'.`);let E=g.parse(f[2],2,se);if(!E)return null;if(!Xl(_,E.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${Ue(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${Ue(w.type)}' and '${Ue(E.type)}'.`);n&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new Li(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new Li(w.type,[E])));let C=null;if(f.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(f[3],3,qr),!C)return null}return new qp(w,E,C)}evaluate(f){const g=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(n&&this.hasUntypedArgument){const w=ii(g),E=ii(_);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new ri(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const w=ii(g),E=ii(_);if(w.kind!=="string"||E.kind!=="string")return t(f,g,_)}return this.collator?r(f,g,_,this.collator.evaluate(f)):t(f,g,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const mc=ma("==",function(i,t,r){return t===r},Wl),gc=ma("!=",function(i,t,r){return t!==r},function(i,t,r,n){return!Wl(0,t,r,n)}),_c=ma("<",function(i,t,r){return t<r},function(i,t,r,n){return n.compare(t,r)<0}),yc=ma(">",function(i,t,r){return t>r},function(i,t,r,n){return n.compare(t,r)>0}),vc=ma("<=",function(i,t,r){return t<=r},function(i,t,r,n){return n.compare(t,r)<=0}),xc=ma(">=",function(i,t,r){return t>=r},function(i,t,r,n){return n.compare(t,r)>=0});class So{constructor(t,r,n,h,f){this.type=he,this.number=t,this.locale=r,this.currency=n,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const n=r.parse(t[1],1,Rt);if(!n)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=r.parse(h.locale,1,he),!f))return null;let g=null;if(h.currency&&(g=r.parse(h.currency,1,he),!g))return null;let _=null;if(h["min-fraction-digits"]&&(_=r.parse(h["min-fraction-digits"],1,Rt),!_))return null;let w=null;return h["max-fraction-digits"]&&(w=r.parse(h["max-fraction-digits"],1,Rt),!w)?null:new So(n,f,g,_,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Pn{constructor(t){this.type=Gr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const h=[];let f=!1;for(let g=1;g<=t.length-1;++g){const _=t[g];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let w=null;if(_["font-scale"]&&(w=r.parse(_["font-scale"],1,Rt),!w))return null;let E=null;if(_["text-font"]&&(E=r.parse(_["text-font"],1,Ci(he)),!E))return null;let C=null;if(_["text-color"]&&(C=r.parse(_["text-color"],1,ki),!C))return null;const z=h[h.length-1];z.scale=w,z.font=E,z.textColor=C}else{const w=r.parse(t[g],1,se);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Pn(h)}evaluate(t){return new ei(this.sections.map(r=>{const n=r.content.evaluate(t);return ii(n)===xr?new Pi("",n,null,null,null):new Pi(Ts(n),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Io{constructor(t){this.type=xr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const n=r.parse(t[1],1,he);return n?new Io(n):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),n=br.fromString(r);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(r)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ao{constructor(t){this.type=Rt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=r.parse(t[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ue(n.type)} instead.`):new Ao(n):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new ri(`Expected value to be of type string or array, but found ${Ue(ii(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ga={"==":mc,"!=":gc,">":yc,"<":_c,">=":xc,"<=":vc,array:Li,at:fa,boolean:Li,case:Eo,coalesce:In,collator:da,format:Pn,image:Io,in:Te,"index-of":An,interpolate:ur,"interpolate-hcl":ur,"interpolate-lab":ur,length:Ao,let:pa,literal:$s,match:To,number:Li,"number-format":So,object:Li,slice:Cn,step:Za,string:Li,"to-boolean":jr,"to-color":jr,"to-number":jr,"to-string":jr,var:Tn,within:qs};function Hl(i,[t,r,n,h]){t=t.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);const f=h?h.evaluate(i):1,g=Ul(t,r,n,f);if(g)throw new ri(g);return new ae(t/255,r/255,n/255,f,!1)}function Kl(i,t){return i in t}function Co(i,t){const r=t[i];return r===void 0?null:r}function Zs(i){return{type:i}}function Yl(i){return{result:"success",value:i}}function _a(i){return{result:"error",value:i}}function ya(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Jl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Po(i){return!!i.expression&&i.expression.interpolated}function Ae(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function zn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function bc(i){return i}function Ql(i,t){const r=t.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",h=n||!(n||i.property!==void 0),f=i.type||(Po(t)?"exponential":"interval");if(r||t.type==="padding"){const C=r?ae.parse:lr.parse;(i=qi({},i)).stops&&(i.stops=i.stops.map(z=>[z[0],C(z[1])])),i.default=C(i.default?i.default:t.default)}if(i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;let _,w,E;if(f==="exponential")_=th;else if(f==="interval")_=Mc;else if(f==="categorical"){_=wc,w=Object.create(null);for(const C of i.stops)w[C[0]]=C[1];E=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=Tc}if(n){const C={},z=[];for(let U=0;U<i.stops.length;U++){const Z=i.stops[U],W=Z[0].zoom;C[W]===void 0&&(C[W]={zoom:W,type:i.type,property:i.property,default:i.default,stops:[]},z.push(W)),C[W].stops.push([Z[0].value,Z[1]])}const R=[];for(const U of z)R.push([C[U].zoom,Ql(C[U],t)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:ur.interpolationFactor.bind(void 0,O),zoomStops:R.map(U=>U[0]),evaluate:({zoom:U},Z)=>th({stops:R,base:i.base},t,U).evaluate(U,Z)}}if(h){const C=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:ur.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(z=>z[0]),evaluate:({zoom:z})=>_(i,t,z,w,E)}}return{kind:"source",evaluate(C,z){const R=z&&z.properties?z.properties[i.property]:void 0;return R===void 0?js(i.default,t.default):_(i,t,R,w,E)}}}function js(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function wc(i,t,r,n,h){return js(typeof r===h?n[r]:void 0,i.default,t.default)}function Mc(i,t,r){if(Ae(r)!=="number")return js(i.default,t.default);const n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];const h=Ga(i.stops.map(f=>f[0]),r);return i.stops[h][1]}function th(i,t,r){const n=i.base!==void 0?i.base:1;if(Ae(r)!=="number")return js(i.default,t.default);const h=i.stops.length;if(h===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[h-1][0])return i.stops[h-1][1];const f=Ga(i.stops.map(C=>C[0]),r),g=function(C,z,R,O){const U=O-R,Z=C-R;return U===0?0:z===1?Z/U:(Math.pow(z,Z)-1)/(Math.pow(z,U)-1)}(r,n,i.stops[f][0],i.stops[f+1][0]),_=i.stops[f][1],w=i.stops[f+1][1],E=cr[t.type]||bc;return typeof _.evaluate=="function"?{evaluate(...C){const z=_.evaluate.apply(void 0,C),R=w.evaluate.apply(void 0,C);if(z!==void 0&&R!==void 0)return E(z,R,g,i.colorSpace)}}:E(_,w,g,i.colorSpace)}function Tc(i,t,r){switch(t.type){case"color":r=ae.parse(r);break;case"formatted":r=ei.fromString(r.toString());break;case"resolvedImage":r=br.fromString(r.toString());break;case"padding":r=lr.parse(r);break;default:Ae(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return js(r,i.default,t.default)}hr.register(ga,{error:[{kind:"error"},[he],(i,[t])=>{throw new ri(t.evaluate(i))}],typeof:[he,[se],(i,[t])=>Ue(ii(t.evaluate(i)))],"to-rgba":[Ci(Rt,4),[ki],(i,[t])=>{const[r,n,h,f]=t.evaluate(i).rgb;return[255*r,255*n,255*h,f]}],rgb:[ki,[Rt,Rt,Rt],Hl],rgba:[ki,[Rt,Rt,Rt,Rt],Hl],has:{type:ce,overloads:[[[he],(i,[t])=>Kl(t.evaluate(i),i.properties())],[[he,rs],(i,[t,r])=>Kl(t.evaluate(i),r.evaluate(i))]]},get:{type:se,overloads:[[[he],(i,[t])=>Co(t.evaluate(i),i.properties())],[[he,rs],(i,[t,r])=>Co(t.evaluate(i),r.evaluate(i))]]},"feature-state":[se,[he],(i,[t])=>Co(t.evaluate(i),i.featureState||{})],properties:[rs,[],i=>i.properties()],"geometry-type":[he,[],i=>i.geometryType()],id:[se,[],i=>i.id()],zoom:[Rt,[],i=>i.globals.zoom],"heatmap-density":[Rt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Rt,[],i=>i.globals.lineProgress||0],accumulated:[se,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Rt,Zs(Rt),(i,t)=>{let r=0;for(const n of t)r+=n.evaluate(i);return r}],"*":[Rt,Zs(Rt),(i,t)=>{let r=1;for(const n of t)r*=n.evaluate(i);return r}],"-":{type:Rt,overloads:[[[Rt,Rt],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[Rt],(i,[t])=>-t.evaluate(i)]]},"/":[Rt,[Rt,Rt],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[Rt,[Rt,Rt],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[Rt,[Rt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Rt,[Rt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Rt,[Rt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Rt,[Rt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Rt,[Rt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Rt,[Rt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Rt,[Rt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Rt,[Rt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Rt,[Rt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Rt,[Rt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Rt,Zs(Rt),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[Rt,Zs(Rt),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[Rt,[Rt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Rt,[Rt],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Rt,[Rt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Rt,[Rt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[ce,[he,se],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[ce,[se],(i,[t])=>i.id()===t.value],"filter-type-==":[ce,[he],(i,[t])=>i.geometryType()===t.value],"filter-<":[ce,[he,se],(i,[t,r])=>{const n=i.properties()[t.value],h=r.value;return typeof n==typeof h&&n<h}],"filter-id-<":[ce,[se],(i,[t])=>{const r=i.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[ce,[he,se],(i,[t,r])=>{const n=i.properties()[t.value],h=r.value;return typeof n==typeof h&&n>h}],"filter-id->":[ce,[se],(i,[t])=>{const r=i.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[ce,[he,se],(i,[t,r])=>{const n=i.properties()[t.value],h=r.value;return typeof n==typeof h&&n<=h}],"filter-id-<=":[ce,[se],(i,[t])=>{const r=i.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[ce,[he,se],(i,[t,r])=>{const n=i.properties()[t.value],h=r.value;return typeof n==typeof h&&n>=h}],"filter-id->=":[ce,[se],(i,[t])=>{const r=i.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[ce,[se],(i,[t])=>t.value in i.properties()],"filter-has-id":[ce,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ce,[Ci(he)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[ce,[Ci(se)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[ce,[he,Ci(se)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[ce,[he,Ci(se)],(i,[t,r])=>function(n,h,f,g){for(;f<=g;){const _=f+g>>1;if(h[_]===n)return!0;h[_]>n?g=_-1:f=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:ce,overloads:[[[ce,ce],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Zs(ce),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ce,overloads:[[[ce,ce],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Zs(ce),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[ce,[ce],(i,[t])=>!t.evaluate(i)],"is-supported-script":[ce,[he],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[he,[he],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[he,[he],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[he,Zs(se),(i,t)=>t.map(r=>Ts(r.evaluate(i))).join("")],"resolved-locale":[he,[qr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class We{constructor(t,r){var n;this.expression=t,this._warningHistory={},this._evaluator=new Pe,this._defaultValue=r?(n=r).type==="color"&&zn(n.default)?new ae(0,0,0,0):n.type==="color"?ae.parse(n.default)||null:n.type==="padding"?lr.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?Di.parse(n.default)||null:n.default===void 0?null:n.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,n,h,f,g){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,r,n,h,f,g){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new ri(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function kn(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ga}function _e(i,t){const r=new vn(ga,Va,[],t?function(h){const f={color:ki,string:he,number:Rt,enum:he,boolean:ce,formatted:Gr,padding:ws,resolvedImage:xr,variableAnchorOffsetCollection:Ms};return h.type==="array"?Ci(f[h.value]||se,h.length):f[h.type]}(t):void 0),n=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Yl(new We(n,t)):_a(r.errors)}class ja{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!$a(r.expression)}evaluateWithoutErrorHandling(t,r,n,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,r,n,h,f,g)}evaluate(t,r,n,h,f,g){return this._styleExpression.evaluate(t,r,n,h,f,g)}}class Ve{constructor(t,r,n,h){this.kind=t,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!$a(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,r,n,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,r,n,h,f,g)}evaluate(t,r,n,h,f,g){return this._styleExpression.evaluate(t,r,n,h,f,g)}interpolationFactor(t,r,n){return this.interpolationType?ur.interpolationFactor(this.interpolationType,t,r,n):0}}function $e(i,t){const r=_e(i,t);if(r.result==="error")return r;const n=r.value.expression,h=En(n);if(!h&&!ya(t))return _a([new Wi("","data expressions not supported")]);const f=qa(n,["zoom"]);if(!f&&!Jl(t))return _a([new Wi("","zoom expressions not supported")]);const g=Xa(n);return g||f?g instanceof Wi?_a([g]):g instanceof ur&&!Po(t)?_a([new Wi("",'"interpolate" expressions cannot be used with this property')]):Yl(g?new Ve(h?"camera":"composite",r.value,g.labels,g instanceof ur?g.interpolation:void 0):new ja(h?"constant":"source",r.value)):_a([new Wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xs{constructor(t,r){this._parameters=t,this._specification=r,qi(this,Ql(this._parameters,this._specification))}static deserialize(t){return new Xs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Xa(i){let t=null;if(i instanceof pa)t=Xa(i.result);else if(i instanceof In){for(const r of i.args)if(t=Xa(r),t)break}else(i instanceof Za||i instanceof ur)&&i.input instanceof hr&&i.input.name==="zoom"&&(t=i);return t instanceof Wi||i.eachChild(r=>{const n=Xa(r);n instanceof Wi?t=n:!t&&n?t=new Wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new Wi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function zo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!zo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ec={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ko(i){if(i==null)return{filter:()=>!0,needGeometry:!1};zo(i)||(i=Wa(i));const t=_e(i,Ec);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,n,h)=>t.value.evaluate(r,n,{},h),needGeometry:Do(i)}}function Sc(i,t){return i<t?-1:i>t?1:0}function Do(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(Do(i[t]))return!0;return!1}function Wa(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Dn(i[1],i[2],"=="):t==="!="?Rn(Dn(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Dn(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Wa))):t==="all"?["all"].concat(i.slice(1).map(Wa)):t==="none"?["all"].concat(i.slice(1).map(Wa).map(Rn)):t==="in"?Lo(i[1],i.slice(2)):t==="!in"?Rn(Lo(i[1],i.slice(2))):t==="has"?Ln(i[1]):t==="!has"?Rn(Ln(i[1])):t!=="within"||i;var r}function Dn(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Lo(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Sc)]]:["filter-in-small",i,["literal",t]]}}function Ln(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Rn(i){return["!",i]}function Ro(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const f of i)h+=`${Ro(f)},`;return`${h}]`}const r=Object.keys(i).sort();let n="{";for(let h=0;h<r.length;h++)n+=`${JSON.stringify(r[h])}:${Ro(i[r[h]])},`;return`${n}}`}function Ic(i){let t="";for(const r of es)t+=`/${Ro(i[r])}`;return t}function eh(i){const t=i.value;return t?[new Lt(i.key,t,"constants have been deprecated as of v8")]:[]}function si(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ws(i){if(Array.isArray(i))return i.map(Ws);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=Ws(i[r]);return t}return si(i)}function wr(i){const t=i.key,r=i.value,n=i.valueSpec||{},h=i.objectElementValidators||{},f=i.style,g=i.styleSpec,_=i.validateSpec;let w=[];const E=Ae(r);if(E!=="object")return[new Lt(t,r,`object expected, ${E} found`)];for(const C in r){const z=C.split(".")[0],R=n[z]||n["*"];let O;if(h[z])O=h[z];else if(n[z])O=_;else if(h["*"])O=h["*"];else{if(!n["*"]){w.push(new Lt(t,r[C],`unknown property "${C}"`));continue}O=_}w=w.concat(O({key:(t&&`${t}.`)+C,value:r[C],valueSpec:R,style:f,styleSpec:g,object:r,objectKey:C,validateSpec:_},r))}for(const C in n)h[C]||n[C].required&&n[C].default===void 0&&r[C]===void 0&&w.push(new Lt(t,r,`missing required property "${C}"`));return w}function Bo(i){const t=i.value,r=i.valueSpec,n=i.style,h=i.styleSpec,f=i.key,g=i.arrayElementValidator||i.validateSpec;if(Ae(t)!=="array")return[new Lt(f,t,`array expected, ${Ae(t)} found`)];if(r.length&&t.length!==r.length)return[new Lt(f,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Lt(f,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};h.$version<7&&(_.function=r.function),Ae(r.value)==="object"&&(_=r.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(g({array:t,arrayIndex:E,value:t[E],valueSpec:_,validateSpec:i.validateSpec,style:n,styleSpec:h,key:`${f}[${E}]`}));return w}function Bn(i){const t=i.key,r=i.value,n=i.valueSpec;let h=Ae(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new Lt(t,r,`number expected, ${h} found`)]:"minimum"in n&&r<n.minimum?[new Lt(t,r,`${r} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&r>n.maximum?[new Lt(t,r,`${r} is greater than the maximum value ${n.maximum}`)]:[]}function Fo(i){const t=i.valueSpec,r=si(i.value.type);let n,h,f,g={};const _=r!=="categorical"&&i.value.property===void 0,w=!_,E=Ae(i.value.stops)==="array"&&Ae(i.value.stops[0])==="array"&&Ae(i.value.stops[0][0])==="object",C=wr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new Lt(O.key,O.value,'identity function may not have a "stops" property')];let U=[];const Z=O.value;return U=U.concat(Bo({key:O.key,value:Z,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:z})),Ae(Z)==="array"&&Z.length===0&&U.push(new Lt(O.key,Z,"array must have at least one stop")),U},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&_&&C.push(new Lt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||C.push(new Lt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Po(i.valueSpec)&&C.push(new Lt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!ya(i.valueSpec)?C.push(new Lt(i.key,i.value,"property functions not supported")):_&&!Jl(i.valueSpec)&&C.push(new Lt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!E||i.value.property!==void 0||C.push(new Lt(i.key,i.value,'"property" property is required')),C;function z(O){let U=[];const Z=O.value,W=O.key;if(Ae(Z)!=="array")return[new Lt(W,Z,`array expected, ${Ae(Z)} found`)];if(Z.length!==2)return[new Lt(W,Z,`array length 2 expected, length ${Z.length} found`)];if(E){if(Ae(Z[0])!=="object")return[new Lt(W,Z,`object expected, ${Ae(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Lt(W,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Lt(W,Z,"object stop key must have value")];if(f&&f>si(Z[0].zoom))return[new Lt(W,Z[0].zoom,"stop zoom values must appear in ascending order")];si(Z[0].zoom)!==f&&(f=si(Z[0].zoom),h=void 0,g={}),U=U.concat(wr({key:`${W}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Bn,value:R}}))}else U=U.concat(R({key:`${W}[0]`,value:Z[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},Z));return kn(Ws(Z[1]))?U.concat([new Lt(`${W}[1]`,Z[1],"expressions are not allowed in function stops.")]):U.concat(O.validateSpec({key:`${W}[1]`,value:Z[1],valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function R(O,U){const Z=Ae(O.value),W=si(O.value),J=O.value!==null?O.value:U;if(n){if(Z!==n)return[new Lt(O.key,J,`${Z} stop domain type must match previous stop domain type ${n}`)]}else n=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Lt(O.key,J,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&r!=="categorical"){let nt=`number expected, ${Z} found`;return ya(t)&&r===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Lt(O.key,J,nt)]}return r!=="categorical"||Z!=="number"||isFinite(W)&&Math.floor(W)===W?r!=="categorical"&&Z==="number"&&h!==void 0&&W<h?[new Lt(O.key,J,"stop domain values must appear in ascending order")]:(h=W,r==="categorical"&&W in g?[new Lt(O.key,J,"stop domain values must be unique")]:(g[W]=!0,[])):[new Lt(O.key,J,`integer expected, found ${W}`)]}}function ss(i){const t=(i.expressionContext==="property"?$e:_e)(Ws(i.value),i.valueSpec);if(t.result==="error")return t.value.map(n=>new Lt(`${i.key}${n.key}`,i.value,n.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Lt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!$a(r))return[new Lt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!$a(r))return[new Lt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!qa(r,["zoom","feature-state"]))return[new Lt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!En(r))return[new Lt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ha(i){const t=i.key,r=i.value,n=i.valueSpec,h=[];return Array.isArray(n.values)?n.values.indexOf(si(r))===-1&&h.push(new Lt(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(si(r))===-1&&h.push(new Lt(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Fn(i){return zo(Ws(i.value))?ss(qi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ih(i)}function ih(i){const t=i.value,r=i.key;if(Ae(t)!=="array")return[new Lt(r,t,`array expected, ${Ae(t)} found`)];const n=i.styleSpec;let h,f=[];if(t.length<1)return[new Lt(r,t,"filter array must have at least 1 element")];switch(f=f.concat(Ha({key:`${r}[0]`,value:t[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),si(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&si(t[1])==="$type"&&f.push(new Lt(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Lt(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Ae(t[1]),h!=="string"&&f.push(new Lt(`${r}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Ae(t[g]),si(t[1])==="$type"?f=f.concat(Ha({key:`${r}[${g}]`,value:t[g],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&f.push(new Lt(`${r}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)f=f.concat(ih({key:`${r}[${g}]`,value:t[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Ae(t[1]),t.length!==2?f.push(new Lt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&f.push(new Lt(`${r}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Ae(t[1]),t.length!==2?f.push(new Lt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&f.push(new Lt(`${r}[1]`,t[1],`object expected, ${h} found`))}return f}function On(i,t){const r=i.key,n=i.validateSpec,h=i.style,f=i.styleSpec,g=i.value,_=i.objectKey,w=f[`${t}_${i.layerType}`];if(!w)return[];const E=_.match(/^(.*)-transition$/);if(t==="paint"&&E&&w[E[1]]&&w[E[1]].transition)return n({key:r,value:g,valueSpec:f.transition,style:h,styleSpec:f});const C=i.valueSpec||w[_];if(!C)return[new Lt(r,g,`unknown property "${_}"`)];let z;if(Ae(g)==="string"&&ya(C)&&!C.tokens&&(z=/^{([^}]+)}$/.exec(g)))return[new Lt(r,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const R=[];return i.layerType==="symbol"&&(_==="text-field"&&h&&!h.glyphs&&R.push(new Lt(r,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&zn(Ws(g))&&si(g.type)==="identity"&&R.push(new Lt(r,g,'"text-font" does not support identity functions'))),R.concat(n({key:i.key,value:g,valueSpec:C,style:h,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:_}))}function Ka(i){return On(i,"paint")}function Un(i){return On(i,"layout")}function Nn(i){let t=[];const r=i.value,n=i.key,h=i.style,f=i.styleSpec;r.type||r.ref||t.push(new Lt(n,r,'either "type" or "ref" is required'));let g=si(r.type);const _=si(r.ref);if(r.id){const w=si(r.id);for(let E=0;E<i.arrayIndex;E++){const C=h.layers[E];si(C.id)===w&&t.push(new Lt(n,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in r&&t.push(new Lt(n,r[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{si(E.id)===_&&(w=E)}),w?w.ref?t.push(new Lt(n,r.ref,"ref cannot reference another ref layer")):g=si(w.type):t.push(new Lt(n,r.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(r.source){const w=h.sources&&h.sources[r.source],E=w&&si(w.type);w?E==="vector"&&g==="raster"?t.push(new Lt(n,r.source,`layer "${r.id}" requires a raster source`)):E==="raster"&&g!=="raster"?t.push(new Lt(n,r.source,`layer "${r.id}" requires a vector source`)):E!=="vector"||r["source-layer"]?E==="raster-dem"&&g!=="hillshade"?t.push(new Lt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||E==="geojson"&&w.lineMetrics||t.push(new Lt(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Lt(n,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Lt(n,r.source,`source "${r.source}" not found`))}else t.push(new Lt(n,r,'missing required property "source"'));return t=t.concat(wr({key:n,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${n}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Fn,layout:w=>wr({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":E=>Un(qi({layerType:g},E))}}),paint:w=>wr({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":E=>Ka(qi({layerType:g},E))}})}})),t}function Hs(i){const t=i.value,r=i.key,n=Ae(t);return n!=="string"?[new Lt(r,t,`string expected, ${n} found`)]:[]}const Ya={promoteId:function({key:i,value:t}){if(Ae(t)==="string")return Hs({key:i,value:t});{const r=[];for(const n in t)r.push(...Hs({key:`${i}.${n}`,value:t[n]}));return r}}};function rh(i){const t=i.value,r=i.key,n=i.styleSpec,h=i.style,f=i.validateSpec;if(!t.type)return[new Lt(r,t,'"type" is required')];const g=si(t.type);let _;switch(g){case"vector":case"raster":case"raster-dem":return _=wr({key:r,value:t,valueSpec:n[`source_${g.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:Ya,validateSpec:f}),_;case"geojson":if(_=wr({key:r,value:t,valueSpec:n.source_geojson,style:h,styleSpec:n,validateSpec:f,objectElementValidators:Ya}),t.cluster)for(const w in t.clusterProperties){const[E,C]=t.clusterProperties[w],z=typeof E=="string"?[E,["accumulated"],["get",w]]:E;_.push(...ss({key:`${r}.${w}.map`,value:C,validateSpec:f,expressionContext:"cluster-map"})),_.push(...ss({key:`${r}.${w}.reduce`,value:z,validateSpec:f,expressionContext:"cluster-reduce"}))}return _;case"video":return wr({key:r,value:t,valueSpec:n.source_video,style:h,validateSpec:f,styleSpec:n});case"image":return wr({key:r,value:t,valueSpec:n.source_image,style:h,validateSpec:f,styleSpec:n});case"canvas":return[new Lt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ha({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:f,styleSpec:n})}}function sh(i){const t=i.value,r=i.styleSpec,n=r.light,h=i.style;let f=[];const g=Ae(t);if(t===void 0)return f;if(g!=="object")return f=f.concat([new Lt("light",t,`object expected, ${g} found`)]),f;for(const _ in t){const w=_.match(/^(.*)-transition$/);f=f.concat(w&&n[w[1]]&&n[w[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:h,styleSpec:r}):n[_]?i.validateSpec({key:_,value:t[_],valueSpec:n[_],validateSpec:i.validateSpec,style:h,styleSpec:r}):[new Lt(_,t[_],`unknown property "${_}"`)])}return f}function ah(i){const t=i.value,r=i.styleSpec,n=r.terrain,h=i.style;let f=[];const g=Ae(t);if(t===void 0)return f;if(g!=="object")return f=f.concat([new Lt("terrain",t,`object expected, ${g} found`)]),f;for(const _ in t)f=f.concat(n[_]?i.validateSpec({key:_,value:t[_],valueSpec:n[_],validateSpec:i.validateSpec,style:h,styleSpec:r}):[new Lt(_,t[_],`unknown property "${_}"`)]);return f}function nh(i){let t=[];const r=i.value,n=i.key;if(Array.isArray(r)){const h=[],f=[];for(const g in r)r[g].id&&h.includes(r[g].id)&&t.push(new Lt(n,r,`all the sprites' ids must be unique, but ${r[g].id} is duplicated`)),h.push(r[g].id),r[g].url&&f.includes(r[g].url)&&t.push(new Lt(n,r,`all the sprites' URLs must be unique, but ${r[g].url} is duplicated`)),f.push(r[g].url),t=t.concat(wr({key:`${n}[${g}]`,value:r[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Hs({key:n,value:r})}const oh={"*":()=>[],array:Bo,boolean:function(i){const t=i.value,r=i.key,n=Ae(t);return n!=="boolean"?[new Lt(r,t,`boolean expected, ${n} found`)]:[]},number:Bn,color:function(i){const t=i.key,r=i.value,n=Ae(r);return n!=="string"?[new Lt(t,r,`color expected, ${n} found`)]:ae.parse(String(r))?[]:[new Lt(t,r,`color expected, "${r}" found`)]},constants:eh,enum:Ha,filter:Fn,function:Fo,layer:Nn,object:wr,source:rh,light:sh,terrain:ah,string:Hs,formatted:function(i){return Hs(i).length===0?[]:ss(i)},resolvedImage:function(i){return Hs(i).length===0?[]:ss(i)},padding:function(i){const t=i.key,r=i.value;if(Ae(r)==="array"){if(r.length<1||r.length>4)return[new Lt(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const n={type:"number"};let h=[];for(let f=0;f<r.length;f++)h=h.concat(i.validateSpec({key:`${t}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:n}));return h}return Bn({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,n=Ae(r),h=i.styleSpec;if(n!=="array"||r.length<1||r.length%2!=0)return[new Lt(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let g=0;g<r.length;g+=2)f=f.concat(Ha({key:`${t}[${g}]`,value:r[g],valueSpec:h.layout_symbol["text-anchor"]})),f=f.concat(Bo({key:`${t}[${g+1}]`,value:r[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return f},sprite:nh};function Ss(i){const t=i.value,r=i.valueSpec,n=i.styleSpec;return i.validateSpec=Ss,r.expression&&zn(si(t))?Fo(i):r.expression&&kn(Ws(t))?ss(i):r.type&&oh[r.type]?oh[r.type](i):wr(qi({},i,{valueSpec:r.type?n[r.type]:r}))}function Ja(i){const t=i.value,r=i.key,n=Hs(i);return n.length||(t.indexOf("{fontstack}")===-1&&n.push(new Lt(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&n.push(new Lt(r,t,'"glyphs" url must include a "{range}" token'))),n}function ai(i,t=gt){let r=[];return r=r.concat(Ss({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Ss,objectElementValidators:{glyphs:Ja,"*":()=>[]}})),i.constants&&(r=r.concat(eh({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:Ss}))),lh(r)}function Mr(i){return function(t){return i({...t,validateSpec:Ss})}}function lh(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function as(i){return function(...t){return lh(i.apply(this,t))}}ai.source=as(Mr(rh)),ai.sprite=as(Mr(nh)),ai.glyphs=as(Mr(Ja)),ai.light=as(Mr(sh)),ai.terrain=as(Mr(ah)),ai.layer=as(Mr(Nn)),ai.filter=as(Mr(Fn)),ai.paintProperty=as(Mr(Ka)),ai.layoutProperty=as(Mr(Un));const Qa=ai,tn=Qa.light,Ac=Qa.paintProperty,Oo=Qa.layoutProperty;function hh(i,t){let r=!1;if(t&&t.length)for(const n of t)i.fire(new or(new Error(n.message))),r=!0;return r}class Ks{constructor(t,r,n){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(r=g[1])+2*(n=g[2]);for(let w=0;w<this.d*this.d;w++){const E=g[3+w],C=g[3+w+1];h.push(E===C?null:g.subarray(E,C))}const _=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*n;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=n,this.scale=r/t,this.uid=0;const f=n/r*t;this.min=-f,this.max=t+f}insert(t,r,n,h,f){this._forEachCell(r,n,h,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(h),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,n,h,f,g){this.cells[f].push(g)}query(t,r,n,h,f){const g=this.min,_=this.max;if(t<=g&&r<=g&&_<=n&&_<=h&&!f)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,r,n,h,this._queryCell,w,{},f),w}}_queryCell(t,r,n,h,f,g,_,w){const E=this.cells[f];if(E!==null){const C=this.keys,z=this.bboxes;for(let R=0;R<E.length;R++){const O=E[R];if(_[O]===void 0){const U=4*O;(w?w(z[U+0],z[U+1],z[U+2],z[U+3]):t<=z[U+2]&&r<=z[U+3]&&n>=z[U+0]&&h>=z[U+1])?(_[O]=!0,g.push(C[O])):_[O]=!1}}}}_forEachCell(t,r,n,h,f,g,_,w){const E=this._convertToCellCoord(t),C=this._convertToCellCoord(r),z=this._convertToCellCoord(n),R=this._convertToCellCoord(h);for(let O=E;O<=z;O++)for(let U=C;U<=R;U++){const Z=this.d*U+O;if((!w||w(this._convertFromCellCoord(O),this._convertFromCellCoord(U),this._convertFromCellCoord(O+1),this._convertFromCellCoord(U+1)))&&f.call(this,t,r,n,h,Z,g,_,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let n=0;for(let g=0;g<this.cells.length;g++)n+=this.cells[g].length;const h=new Int32Array(r+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let f=r;for(let g=0;g<t.length;g++){const _=t[g];h[3+g]=f,h.set(_,f),f+=_.length}return h[3+t.length]=f,h.set(this.keys,f),f+=this.keys.length,h[3+t.length+1]=f,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer}static serialize(t,r){const n=t.toArrayBuffer();return r&&r.push(n),{buffer:n}}static deserialize(t){return new Ks(t.buffer)}}const Is={};function Nt(i,t,r={}){if(Is[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Is[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Nt("Object",Object),Nt("TransferableGridIndex",Ks),Nt("Color",ae),Nt("Error",Error),Nt("AJAXError",Cr),Nt("ResolvedImage",br),Nt("StylePropertyFunction",Xs),Nt("StyleExpression",We,{omit:["_evaluator"]}),Nt("ZoomDependentExpression",Ve),Nt("ZoomConstantExpression",ja),Nt("CompoundExpression",hr,{omit:["_evaluate"]});for(const i in ga)ga[i]._classRegistryKey||Nt(`Expression_${i}`,ga[i]);function ch(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ys(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(ch(i)||Ui(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return t&&t.push(r.buffer),r}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const n of i)r.push(Ys(n,t));return r}if(typeof i=="object"){const r=i.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");if(!Is[n])throw new Error(`${n} is not registered.`);const h=r.serialize?r.serialize(i,t):{};if(r.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||Is[n].omit.indexOf(f)>=0)continue;const g=i[f];h[f]=Is[n].shallow.indexOf(f)>=0?g:Ys(g,t)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}throw new Error("can't serialize object of type "+typeof i)}function va(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||ch(i)||Ui(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(va);if(typeof i=="object"){const t=i.$name||"Object";if(!Is[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Is[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const n=Object.create(r.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const f=i[h];n[h]=Is[t].shallow.indexOf(h)>=0?f:va(f)}return n}throw new Error("can't deserialize object of type "+typeof i)}class Vn{constructor(){this.first=!0}update(t,r){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const Ot={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function $n(i){for(const t of i)if(xa(t.charCodeAt(0)))return!0;return!1}function Cc(i){for(const t of i)if(!Uo(t.charCodeAt(0)))return!1;return!0}function Uo(i){return!(Ot.Arabic(i)||Ot["Arabic Supplement"](i)||Ot["Arabic Extended-A"](i)||Ot["Arabic Presentation Forms-A"](i)||Ot["Arabic Presentation Forms-B"](i))}function xa(i){return!(i!==746&&i!==747&&(i<4352||!(Ot["Bopomofo Extended"](i)||Ot.Bopomofo(i)||Ot["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ot["CJK Compatibility Ideographs"](i)||Ot["CJK Compatibility"](i)||Ot["CJK Radicals Supplement"](i)||Ot["CJK Strokes"](i)||!(!Ot["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ot["CJK Unified Ideographs Extension A"](i)||Ot["CJK Unified Ideographs"](i)||Ot["Enclosed CJK Letters and Months"](i)||Ot["Hangul Compatibility Jamo"](i)||Ot["Hangul Jamo Extended-A"](i)||Ot["Hangul Jamo Extended-B"](i)||Ot["Hangul Jamo"](i)||Ot["Hangul Syllables"](i)||Ot.Hiragana(i)||Ot["Ideographic Description Characters"](i)||Ot.Kanbun(i)||Ot["Kangxi Radicals"](i)||Ot["Katakana Phonetic Extensions"](i)||Ot.Katakana(i)&&i!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ot["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ot["Unified Canadian Aboriginal Syllabics"](i)||Ot["Unified Canadian Aboriginal Syllabics Extended"](i)||Ot["Vertical Forms"](i)||Ot["Yijing Hexagram Symbols"](i)||Ot["Yi Syllables"](i)||Ot["Yi Radicals"](i))))}function No(i){return!(xa(i)||function(t){return!!(Ot["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ot["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ot["Letterlike Symbols"](t)||Ot["Number Forms"](t)||Ot["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ot["Control Pictures"](t)&&t!==9251||Ot["Optical Character Recognition"](t)||Ot["Enclosed Alphanumerics"](t)||Ot["Geometric Shapes"](t)||Ot["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ot["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ot["CJK Symbols and Punctuation"](t)||Ot.Katakana(t)||Ot["Private Use Area"](t)||Ot["CJK Compatibility Forms"](t)||Ot["Small Form Variants"](t)||Ot["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function uh(i){return i>=1424&&i<=2303||Ot["Arabic Presentation Forms-A"](i)||Ot["Arabic Presentation Forms-B"](i)}function dh(i,t){return!(!t&&uh(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ot.Khmer(i))}function Pc(i){for(const t of i)if(uh(t.charCodeAt(0)))return!0;return!1}const en="deferred",Vo="loading",$o="loaded";let qo=null,Ki="unavailable",ns=null;const ph=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Ki="error"),qo&&qo(i)};function Go(){Zo.fire(new $i("pluginStateChange",{pluginStatus:Ki,pluginURL:ns}))}const Zo=new Dr,jo=function(){return Ki},fh=function(){if(Ki!==en||!ns)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ki=Vo,Go(),ns&&Qr({url:ns},i=>{i?ph(i):(Ki=$o,Go())})},Tr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ki===$o||Tr.applyArabicShaping!=null,isLoading:()=>Ki===Vo,setState(i){if(!mi())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Ki=i.pluginStatus,ns=i.pluginURL},isParsed(){if(!mi())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Tr.applyArabicShaping!=null&&Tr.processBidirectionalText!=null&&Tr.processStyledBidirectionalText!=null},getPluginURL(){if(!mi())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ns}};class Ge{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vn,this.transition={})}isSupportedScript(t){return function(r,n){for(const h of r)if(!dh(h.charCodeAt(0),n))return!1;return!0}(t,Tr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class Js{constructor(t,r){this.property=t,this.value=r,this.expression=function(n,h){if(zn(n))return new Xs(n,h);if(kn(n)){const f=$e(n,h);if(f.result==="error")throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=n;return h.type==="color"&&typeof n=="string"?f=ae.parse(n):h.type!=="padding"||typeof n!="number"&&!Array.isArray(n)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(n)&&(f=Di.parse(n)):f=lr.parse(n),{kind:"constant",evaluate:()=>f}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,n){return this.property.possiblyEvaluate(this,t,r,n)}}class Xo{constructor(t){this.property=t,this.value=new Js(t,void 0)}transitioned(t,r){return new mh(this.property,this.value,r,Pt({},t.transition,this.transition),t.now)}untransitioned(){return new mh(this.property,this.value,null,{},0)}}class qn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Se(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Xo(this._values[t].property)),this._values[t].value=new Js(this._values[t].property,r===null?void 0:Se(r))}getTransition(t){return Se(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Xo(this._values[t].property)),this._values[t].transition=Se(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(t[r]=n);const h=this.getTransition(r);h!==void 0&&(t[`${r}-transition`]=h)}return t}transitioned(t,r){const n=new gh(this._properties);for(const h of Object.keys(this._values))n._values[h]=this._values[h].transitioned(t,r._values[h]);return n}untransitioned(){const t=new gh(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class mh{constructor(t,r,n,h,f){this.property=t,this.value=r,this.begin=f+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=n)}possiblyEvaluate(t,r,n){const h=t.now||0,f=this.value.possiblyEvaluate(t,r,n),g=this.prior;if(g){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return g.possiblyEvaluate(t,r,n);{const _=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,r,n),f,function(w){if(w<=0)return 0;if(w>=1)return 1;const E=w*w,C=E*w;return 4*(w<.5?C:3*(w-E)+C-.75)}(_))}}return f}}class gh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,n){const h=new Gn(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,r,n);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class _h{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Se(this._values[t].value)}setValue(t,r){this._values[t]=new Js(this._values[t].property,r===null?void 0:Se(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(t[r]=n)}return t}possiblyEvaluate(t,r,n){const h=new Gn(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,r,n);return h}}class Lr{constructor(t,r,n){this.property=t,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,n,h){return this.property.evaluate(this.value,this.parameters,t,r,n,h)}}class Gn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Kt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,n){const h=cr[this.specification.type];return h?h(t,r,n):t}}class ee{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,n,h){return new Lr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},n,h)}:t.expression,r)}interpolate(t,r,n){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Lr(this,{kind:"constant",value:void 0},t.parameters);const h=cr[this.specification.type];if(h){const f=h(t.value.value,r.value.value,n);return new Lr(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,r,n,h,f,g){return t.kind==="constant"?t.value:t.evaluate(r,n,h,f,g)}}class Zn extends ee{possiblyEvaluate(t,r,n,h){if(t.value===void 0)return new Lr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},n,h),g=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,_=this._calculate(g,g,g,r);return new Lr(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Lr(this,{kind:"constant",value:f},r)}return new Lr(this,t.expression,r)}evaluate(t,r,n,h,f,g){if(t.kind==="source"){const _=t.evaluate(r,n,h,f,g);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},n,h),t.evaluate({zoom:Math.floor(r.zoom)},n,h),t.evaluate({zoom:Math.floor(r.zoom)+1},n,h),r):t.value}_calculate(t,r,n,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:n,to:r}}interpolate(t){return t}}class Wo{constructor(t){this.specification=t}possiblyEvaluate(t,r,n,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},n,h);return this._calculate(f,f,f,r)}return this._calculate(t.expression.evaluate(new Ge(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ge(Math.floor(r.zoom),r)),t.expression.evaluate(new Ge(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,n,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:n,to:r}}interpolate(t){return t}}class Ho{constructor(t){this.specification=t}possiblyEvaluate(t,r,n,h){return!!t.expression.evaluate(r,null,{},n,h)}interpolate(){return!1}}class _i{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const n=t[r];n.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new Js(n,void 0),f=this.defaultTransitionablePropertyValues[r]=new Xo(n);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}Nt("DataDrivenProperty",ee),Nt("DataConstantProperty",Kt),Nt("CrossFadedDataDrivenProperty",Zn),Nt("CrossFadedProperty",Wo),Nt("ColorRampProperty",Ho);const yh="-transition";class Xr extends Dr{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new _h(r.layout)),r.paint)){this._transitionablePaint=new qn(r.paint);for(const n in t.paint)this.setPaintProperty(n,t.paint[n],{validate:!1});for(const n in t.layout)this.setLayoutProperty(n,t.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gn(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,n={}){r!=null&&this._validate(Oo,`layers.${this.id}.layout.${t}`,t,r,n)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(yh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,n={}){if(r!=null&&this._validate(Ac,`layers.${this.id}.paint.${t}`,t,r,n))return!1;if(t.endsWith(yh))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[t],f=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(t,_,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ve(t,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(t,r,n,h,f={}){return(!f||f.validate!==!1)&&hh(this,t.call(Qa,{key:r,layerType:this.type,objectKey:n,value:h,styleSpec:gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Lr&&ya(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const zc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ba{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class He{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ni(i,t=1){let r=0,n=0;return{members:i.map(h=>{const f=zc[h.type].BYTES_PER_ELEMENT,g=r=os(r,Math.max(t,f)),_=h.components||1;return n=Math.max(n,f),r+=f*_,{name:h.name,type:h.type,components:_,offset:g}}),size:os(r,Math.max(n,t)),alignment:t}}function os(i,t){return Math.ceil(i/t)*t}class wa extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,r)}emplace(t,r,n){const h=2*t;return this.int16[h+0]=r,this.int16[h+1]=n,t}}wa.prototype.bytesPerElement=4,Nt("StructArrayLayout2i4",wa);class Ma extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,n)}emplace(t,r,n,h){const f=3*t;return this.int16[f+0]=r,this.int16[f+1]=n,this.int16[f+2]=h,t}}Ma.prototype.bytesPerElement=6,Nt("StructArrayLayout3i6",Ma);class jn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,h)}emplace(t,r,n,h,f){const g=4*t;return this.int16[g+0]=r,this.int16[g+1]=n,this.int16[g+2]=h,this.int16[g+3]=f,t}}jn.prototype.bytesPerElement=8,Nt("StructArrayLayout4i8",jn);class rn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,n,h,f,g)}emplace(t,r,n,h,f,g,_){const w=6*t;return this.int16[w+0]=r,this.int16[w+1]=n,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=g,this.int16[w+5]=_,t}}rn.prototype.bytesPerElement=12,Nt("StructArrayLayout2i4i12",rn);class Ko extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,n,h,f,g)}emplace(t,r,n,h,f,g,_){const w=4*t,E=8*t;return this.int16[w+0]=r,this.int16[w+1]=n,this.uint8[E+4]=h,this.uint8[E+5]=f,this.uint8[E+6]=g,this.uint8[E+7]=_,t}}Ko.prototype.bytesPerElement=8,Nt("StructArrayLayout2i4ub8",Ko);class As extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,r)}emplace(t,r,n){const h=2*t;return this.float32[h+0]=r,this.float32[h+1]=n,t}}As.prototype.bytesPerElement=8,Nt("StructArrayLayout2f8",As);class Qs extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g,_,w,E,C){const z=this.length;return this.resize(z+1),this.emplace(z,t,r,n,h,f,g,_,w,E,C)}emplace(t,r,n,h,f,g,_,w,E,C,z){const R=10*t;return this.uint16[R+0]=r,this.uint16[R+1]=n,this.uint16[R+2]=h,this.uint16[R+3]=f,this.uint16[R+4]=g,this.uint16[R+5]=_,this.uint16[R+6]=w,this.uint16[R+7]=E,this.uint16[R+8]=C,this.uint16[R+9]=z,t}}Qs.prototype.bytesPerElement=20,Nt("StructArrayLayout10ui20",Qs);class Yo extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g,_,w,E,C,z,R){const O=this.length;return this.resize(O+1),this.emplace(O,t,r,n,h,f,g,_,w,E,C,z,R)}emplace(t,r,n,h,f,g,_,w,E,C,z,R,O){const U=12*t;return this.int16[U+0]=r,this.int16[U+1]=n,this.int16[U+2]=h,this.int16[U+3]=f,this.uint16[U+4]=g,this.uint16[U+5]=_,this.uint16[U+6]=w,this.uint16[U+7]=E,this.int16[U+8]=C,this.int16[U+9]=z,this.int16[U+10]=R,this.int16[U+11]=O,t}}Yo.prototype.bytesPerElement=24,Nt("StructArrayLayout4i4ui4i24",Yo);class Xn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,n)}emplace(t,r,n,h){const f=3*t;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=h,t}}Xn.prototype.bytesPerElement=12,Nt("StructArrayLayout3f12",Xn);class ta extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}ta.prototype.bytesPerElement=4,Nt("StructArrayLayout1ul4",ta);class Jo extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g,_,w,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,n,h,f,g,_,w,E)}emplace(t,r,n,h,f,g,_,w,E,C){const z=10*t,R=5*t;return this.int16[z+0]=r,this.int16[z+1]=n,this.int16[z+2]=h,this.int16[z+3]=f,this.int16[z+4]=g,this.int16[z+5]=_,this.uint32[R+3]=w,this.uint16[z+8]=E,this.uint16[z+9]=C,t}}Jo.prototype.bytesPerElement=20,Nt("StructArrayLayout6i1ul2ui20",Jo);class Qo extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,n,h,f,g)}emplace(t,r,n,h,f,g,_){const w=6*t;return this.int16[w+0]=r,this.int16[w+1]=n,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=g,this.int16[w+5]=_,t}}Qo.prototype.bytesPerElement=12,Nt("StructArrayLayout2i2i2i12",Qo);class Wn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,n,h,f)}emplace(t,r,n,h,f,g){const _=4*t,w=8*t;return this.float32[_+0]=r,this.float32[_+1]=n,this.float32[_+2]=h,this.int16[w+6]=f,this.int16[w+7]=g,t}}Wn.prototype.bytesPerElement=16,Nt("StructArrayLayout2f1f2i16",Wn);class tl extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,h)}emplace(t,r,n,h,f){const g=12*t,_=3*t;return this.uint8[g+0]=r,this.uint8[g+1]=n,this.float32[_+1]=h,this.float32[_+2]=f,t}}tl.prototype.bytesPerElement=12,Nt("StructArrayLayout2ub2f12",tl);class Hn extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,n)}emplace(t,r,n,h){const f=3*t;return this.uint16[f+0]=r,this.uint16[f+1]=n,this.uint16[f+2]=h,t}}Hn.prototype.bytesPerElement=6,Nt("StructArrayLayout3ui6",Hn);class Ee extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z,W,J){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z,W,J)}emplace(t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z,W,J,nt){const it=24*t,ht=12*t,ut=48*t;return this.int16[it+0]=r,this.int16[it+1]=n,this.uint16[it+2]=h,this.uint16[it+3]=f,this.uint32[ht+2]=g,this.uint32[ht+3]=_,this.uint32[ht+4]=w,this.uint16[it+10]=E,this.uint16[it+11]=C,this.uint16[it+12]=z,this.float32[ht+7]=R,this.float32[ht+8]=O,this.uint8[ut+36]=U,this.uint8[ut+37]=Z,this.uint8[ut+38]=W,this.uint32[ht+10]=J,this.int16[it+22]=nt,t}}Ee.prototype.bytesPerElement=48,Nt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ee);class d extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z,W,J,nt,it,ht,ut,yt,Ut,Xt,Ft,Bt,At,Vt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z,W,J,nt,it,ht,ut,yt,Ut,Xt,Ft,Bt,At,Vt)}emplace(t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z,W,J,nt,it,ht,ut,yt,Ut,Xt,Ft,Bt,At,Vt,zt){const St=32*t,Qt=16*t;return this.int16[St+0]=r,this.int16[St+1]=n,this.int16[St+2]=h,this.int16[St+3]=f,this.int16[St+4]=g,this.int16[St+5]=_,this.int16[St+6]=w,this.int16[St+7]=E,this.uint16[St+8]=C,this.uint16[St+9]=z,this.uint16[St+10]=R,this.uint16[St+11]=O,this.uint16[St+12]=U,this.uint16[St+13]=Z,this.uint16[St+14]=W,this.uint16[St+15]=J,this.uint16[St+16]=nt,this.uint16[St+17]=it,this.uint16[St+18]=ht,this.uint16[St+19]=ut,this.uint16[St+20]=yt,this.uint16[St+21]=Ut,this.uint16[St+22]=Xt,this.uint32[Qt+12]=Ft,this.float32[Qt+13]=Bt,this.float32[Qt+14]=At,this.uint16[St+30]=Vt,this.uint16[St+31]=zt,t}}d.prototype.bytesPerElement=64,Nt("StructArrayLayout8i15ui1ul2f2ui64",d);class e extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}e.prototype.bytesPerElement=4,Nt("StructArrayLayout1f4",e);class s extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,n)}emplace(t,r,n,h){const f=3*t;return this.uint16[6*t+0]=r,this.float32[f+1]=n,this.float32[f+2]=h,t}}s.prototype.bytesPerElement=12,Nt("StructArrayLayout1ui2f12",s);class l extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,n)}emplace(t,r,n,h){const f=4*t;return this.uint32[2*t+0]=r,this.uint16[f+2]=n,this.uint16[f+3]=h,t}}l.prototype.bytesPerElement=8,Nt("StructArrayLayout1ul2ui8",l);class u extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,r)}emplace(t,r,n){const h=2*t;return this.uint16[h+0]=r,this.uint16[h+1]=n,t}}u.prototype.bytesPerElement=4,Nt("StructArrayLayout2ui4",u);class m extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}m.prototype.bytesPerElement=2,Nt("StructArrayLayout1ui2",m);class v extends He{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,h)}emplace(t,r,n,h,f){const g=4*t;return this.float32[g+0]=r,this.float32[g+1]=n,this.float32[g+2]=h,this.float32[g+3]=f,t}}v.prototype.bytesPerElement=16,Nt("StructArrayLayout4f16",v);class b extends ba{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}b.prototype.size=20;class M extends Jo{get(t){return new b(this,t)}}Nt("CollisionBoxArray",M);class S extends ba{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}S.prototype.size=48;class A extends Ee{get(t){return new S(this,t)}}Nt("PlacedSymbolArray",A);class P extends ba{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}P.prototype.size=64;class F extends d{get(t){return new P(this,t)}}Nt("SymbolInstanceArray",F);class G extends e{getoffsetX(t){return this.float32[1*t+0]}}Nt("GlyphOffsetArray",G);class q extends Ma{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Nt("SymbolLineVertexArray",q);class j extends ba{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class $ extends s{get(t){return new j(this,t)}}Nt("TextAnchorOffsetArray",$);class rt extends ba{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}rt.prototype.size=8;class ct extends l{get(t){return new rt(this,t)}}Nt("FeatureIndexArray",ct);class K extends wa{}class st extends wa{}class dt extends wa{}class pt extends rn{}class _t extends Ko{}class Et extends As{}class xt extends Qs{}class It extends Yo{}class jt extends Xn{}class ye extends ta{}class kt extends Qo{}class ie extends tl{}class qt extends Hn{}class Ne extends u{}const me=ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:ue}=me;class re{constructor(t=[]){this.segments=t}prepareSegment(t,r,n,h){let f=this.segments[this.segments.length-1];return t>re.MAX_VERTEX_ARRAY_LENGTH&&Ce(`Max vertices per segment is ${re.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>re.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},h!==void 0&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,n,h){return new re([{vertexOffset:t,primitiveOffset:r,vertexLength:n,primitiveLength:h,vaos:{},sortKey:0}])}}function Je(i,t){return 256*(i=Dt(Math.floor(i),0,255))+Dt(Math.floor(t),0,255)}re.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Nt("SegmentVector",re);const ze=ni([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Gi={exports:{}},wi={exports:{}};wi.exports=function(i,t){var r,n,h,f,g,_,w,E;for(n=i.length-(r=3&i.length),h=t,g=3432918353,_=461845907,E=0;E<n;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(f=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,r){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var oi=wi.exports,Yi={exports:{}};Yi.exports=function(i,t){for(var r,n=i.length,h=t^n,f=0;n>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++f;switch(n){case 3:h^=(255&i.charCodeAt(f+2))<<16;case 2:h^=(255&i.charCodeAt(f+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(f)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Rr=oi,ls=Yi.exports;Gi.exports=Rr,Gi.exports.murmur3=Rr,Gi.exports.murmur2=ls;var hs=L(Gi.exports);class Cs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,n,h){this.ids.push(ea(t)),this.positions.push(r,n,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=ea(t);let n=0,h=this.ids.length-1;for(;n<h;){const g=n+h>>1;this.ids[g]>=r?h=g:n=g+1}const f=[];for(;this.ids[n]===r;)f.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return f}static serialize(t,r){const n=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Ps(n,h,0,n.length-1),r&&r.push(n.buffer,h.buffer),{ids:n,positions:h}}static deserialize(t){const r=new Cs;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function ea(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:hs(String(i))}function Ps(i,t,r,n){for(;r<n;){const h=i[r+n>>1];let f=r-1,g=n+1;for(;;){do f++;while(i[f]<h);do g--;while(i[g]>h);if(f>=g)break;Mi(i,f,g),Mi(t,3*f,3*g),Mi(t,3*f+1,3*g+1),Mi(t,3*f+2,3*g+2)}g-r<n-g?(Ps(i,t,r,g),r=g+1):(Ps(i,t,g+1,n),n=g)}}function Mi(i,t,r){const n=i[t];i[t]=i[r],i[r]=n}Nt("FeaturePositionMap",Cs);class Qe{constructor(t,r){this.gl=t.gl,this.location=r}}class Ti extends Qe{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ta extends Qe{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class di extends Qe{constructor(t,r){super(t,r),this.current=ae.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ei=new Float32Array(16);function Ji(i){return[Je(255*i.r,255*i.g),Je(255*i.b,255*i.a)]}class Ke{constructor(t,r,n){this.value=t,this.uniformNames=r.map(h=>`u_${h}`),this.type=n}setUniform(t,r,n){t.set(n.constantOr(this.value))}getBinding(t,r,n){return this.type==="color"?new di(t,r):new Ti(t,r)}}class Ea{constructor(t,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,n,h){const f=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,r,n){return n.substr(0,9)==="u_pattern"?new Ta(t,r):new Ti(t,r)}}class cs{constructor(t,r,n,h){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,r,n,h,f){const g=this.paintVertexArray.length,_=this.expression.evaluate(new Ge(0),r,{},h,[],f);this.paintVertexArray.resize(t),this._setPaintValue(g,t,_)}updatePaintArray(t,r,n,h){const f=this.expression.evaluate({zoom:0},n,h);this._setPaintValue(t,r,f)}_setPaintValue(t,r,n){if(this.type==="color"){const h=Ji(n);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Br{constructor(t,r,n,h,f,g){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=n,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,r,n,h,f){const g=this.expression.evaluate(new Ge(this.zoom),r,{},h,[],f),_=this.expression.evaluate(new Ge(this.zoom+1),r,{},h,[],f),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,g,_)}updatePaintArray(t,r,n,h){const f=this.expression.evaluate({zoom:this.zoom},n,h),g=this.expression.evaluate({zoom:this.zoom+1},n,h);this._setPaintValue(t,r,f,g)}_setPaintValue(t,r,n,h){if(this.type==="color"){const f=Ji(n),g=Ji(h);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,f[0],f[1],g[0],g[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,n,h);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Dt(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,r,n){return new Ti(t,r)}}class zs{constructor(t,r,n,h,f,g){this.expression=t,this.type=r,this.useIntegerZoom=n,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,r,n){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(t,r,n,h,f){this._setPaintValues(t,r,n.patterns&&n.patterns[this.layerId],f)}_setPaintValues(t,r,n,h){if(!h||!n)return;const{min:f,mid:g,max:_}=n,w=h[f],E=h[g],C=h[_];if(w&&E&&C)for(let z=t;z<r;z++)this.zoomInPaintVertexArray.emplace(z,E.tl[0],E.tl[1],E.br[0],E.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],E.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,E.tl[0],E.tl[1],E.br[0],E.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],E.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ze.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ze.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class vh{constructor(t,r,n){this.binders={},this._buffers=[];const h=[];for(const f in t.paint._values){if(!n(f))continue;const g=t.paint.get(f);if(!(g instanceof Lr&&ya(g.property.specification)))continue;const _=Sa(f,t.type),w=g.value,E=g.property.specification.type,C=g.property.useIntegerZoom,z=g.property.specification["property-type"],R=z==="cross-faded"||z==="cross-faded-data-driven";if(w.kind==="constant")this.binders[f]=R?new Ea(w.value,_):new Ke(w.value,_,E),h.push(`/u_${f}`);else if(w.kind==="source"||R){const O=el(f,E,"source");this.binders[f]=R?new zs(w,E,C,r,O,t.id):new cs(w,_,E,O),h.push(`/a_${f}`)}else{const O=el(f,E,"composite");this.binders[f]=new Br(w,_,E,C,r,O),h.push(`/z_${f}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof cs||r instanceof Br?r.maxValue:0}populatePaintArrays(t,r,n,h,f){for(const g in this.binders){const _=this.binders[g];(_ instanceof cs||_ instanceof Br||_ instanceof zs)&&_.populatePaintArray(t,r,n,h,f)}}setConstantPatternPositions(t,r){for(const n in this.binders){const h=this.binders[n];h instanceof Ea&&h.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,n,h,f){let g=!1;for(const _ in t){const w=r.getPositions(_);for(const E of w){const C=n.feature(E.index);for(const z in this.binders){const R=this.binders[z];if((R instanceof cs||R instanceof Br||R instanceof zs)&&R.expression.isStateDependent===!0){const O=h.paint.get(z);R.expression=O.value,R.updatePaintArray(E.start,E.end,C,t[_],f),g=!0}}}}return g}defines(){const t=[];for(const r in this.binders){const n=this.binders[r];(n instanceof Ke||n instanceof Ea)&&t.push(...n.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof cs||n instanceof Br)for(let h=0;h<n.paintVertexAttributes.length;h++)t.push(n.paintVertexAttributes[h].name);else if(n instanceof zs)for(let h=0;h<ze.members.length;h++)t.push(ze.members[h].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Ke||n instanceof Ea||n instanceof Br)for(const h of n.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const n=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Ke||f instanceof Ea||f instanceof Br){for(const g of f.uniformNames)if(r[g]){const _=f.getBinding(t,r[g],g);n.push({name:g,property:h,binding:_})}}}return n}setUniforms(t,r,n,h){for(const{name:f,property:g,binding:_}of r)this.binders[g].setUniform(_,h,n.get(g),f)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(t&&n instanceof zs){const h=t.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(n instanceof cs||n instanceof Br)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const r in this.binders){const n=this.binders[r];(n instanceof cs||n instanceof Br||n instanceof zs)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof cs||r instanceof Br||r instanceof zs)&&r.destroy()}}}class ia{constructor(t,r,n=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new vh(h,r,n);this.needsUpload=!1,this._featureMap=new Cs,this._bufferOffset=0}populatePaintArrays(t,r,n,h,f,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,h,f,g);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,n,h){for(const f of n)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,r,f,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Sa(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function el(i,t,r){const n={color:{source:As,composite:v},number:{source:e,composite:As}},h=function(f){return{"line-pattern":{source:xt,composite:xt},"fill-pattern":{source:xt,composite:xt},"fill-extrusion-pattern":{source:xt,composite:xt}}[f]}(i);return h&&h[r]||n[t][r]}Nt("ConstantBinder",Ke),Nt("CrossFadedConstantBinder",Ea),Nt("SourceExpressionBinder",cs),Nt("CrossFadedCompositeBinder",zs),Nt("CompositeExpressionBinder",Br),Nt("ProgramConfiguration",vh,{omit:["_buffers"]}),Nt("ProgramConfigurationSet",ia);const Ye=8192,Kn=Math.pow(2,14)-1,Yn=-Kn-1;function ks(i){const t=Ye/i.extent,r=i.loadGeometry();for(let n=0;n<r.length;n++){const h=r[n];for(let f=0;f<h.length;f++){const g=h[f],_=Math.round(g.x*t),w=Math.round(g.y*t);g.x=Dt(_,Yn,Kn),g.y=Dt(w,Yn,Kn),(_<g.x||_>g.x+1||w<g.y||w>g.y+1)&&Ce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function us(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?ks(i):[]}}function xh(i,t,r,n,h){i.emplaceBack(2*t+(n+1)/2,2*r+(h+1)/2)}class kc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new st,this.indexArray=new qt,this.segments=new re,this.programConfigurations=new ia(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){const h=this.layers[0],f=[];let g=null,_=!1;h.type==="circle"&&(g=h.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:w,id:E,index:C,sourceLayerIndex:z}of t){const R=this.layers[0]._featureFilter.needGeometry,O=us(w,R);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),O,n))continue;const U=_?g.evaluate(O,{},n):void 0,Z={id:E,properties:w.properties,type:w.type,sourceLayerIndex:z,index:C,geometry:R?O.geometry:ks(w),patterns:{},sortKey:U};f.push(Z)}_&&f.sort((w,E)=>w.sortKey-E.sortKey);for(const w of f){const{geometry:E,index:C,sourceLayerIndex:z}=w,R=t[C].feature;this.addFeature(w,E,C,n),r.featureIndex.insert(R,E,C,z,this.index)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ue),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,n,h){for(const f of r)for(const g of f){const _=g.x,w=g.y;if(_<0||_>=Ye||w<0||w>=Ye)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),C=E.vertexLength;xh(this.layoutVertexArray,_,w,-1,-1),xh(this.layoutVertexArray,_,w,1,-1),xh(this.layoutVertexArray,_,w,1,1),xh(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},h)}}function Vu(i,t){for(let r=0;r<i.length;r++)if(Jn(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Jn(i,t[r]))return!0;return!!Dc(i,t)}function zf(i,t,r){return!!Jn(i,t)||!!Lc(t,i,r)}function $u(i,t){if(i.length===1)return Gu(t,i[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let h=0;h<n.length;h++)if(Jn(i,n[h]))return!0}for(let r=0;r<i.length;r++)if(Gu(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Dc(i,t[r]))return!0;return!1}function kf(i,t,r){if(i.length>1){if(Dc(i,t))return!0;for(let n=0;n<t.length;n++)if(Lc(t[n],i,r))return!0}for(let n=0;n<i.length;n++)if(Lc(i[n],t,r))return!0;return!1}function Dc(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const n=i[r],h=i[r+1];for(let f=0;f<t.length-1;f++)if(Df(n,h,t[f],t[f+1]))return!0}return!1}function Df(i,t,r,n){return oe(i,r,n)!==oe(t,r,n)&&oe(i,t,r)!==oe(i,t,n)}function Lc(i,t,r){const n=r*r;if(t.length===1)return i.distSqr(t[0])<n;for(let h=1;h<t.length;h++)if(qu(i,t[h-1],t[h])<n)return!0;return!1}function qu(i,t,r){const n=t.distSqr(r);if(n===0)return i.distSqr(t);const h=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/n;return i.distSqr(h<0?t:h>1?r:r.sub(t)._mult(h)._add(t))}function Gu(i,t){let r,n,h,f=!1;for(let g=0;g<i.length;g++){r=i[g];for(let _=0,w=r.length-1;_<r.length;w=_++)n=r[_],h=r[w],n.y>t.y!=h.y>t.y&&t.x<(h.x-n.x)*(t.y-n.y)/(h.y-n.y)+n.x&&(f=!f)}return f}function Jn(i,t){let r=!1;for(let n=0,h=i.length-1;n<i.length;h=n++){const f=i[n],g=i[h];f.y>t.y!=g.y>t.y&&t.x<(g.x-f.x)*(t.y-f.y)/(g.y-f.y)+f.x&&(r=!r)}return r}function Lf(i,t,r){const n=r[0],h=r[2];if(i.x<n.x&&t.x<n.x||i.x>h.x&&t.x>h.x||i.y<n.y&&t.y<n.y||i.y>h.y&&t.y>h.y)return!1;const f=oe(i,t,r[0]);return f!==oe(i,t,r[1])||f!==oe(i,t,r[2])||f!==oe(i,t,r[3])}function il(i,t,r){const n=t.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(t.id).getMaxValue(i)}function bh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function wh(i,t,r,n,h){if(!t[0]&&!t[1])return i;const f=N.convert(t)._mult(h);r==="viewport"&&f._rotate(-n);const g=[];for(let _=0;_<i.length;_++)g.push(i[_].sub(f));return g}let Zu,ju;Nt("CircleBucket",kc,{omit:["layers"]});var Rf={get paint(){return ju=ju||new _i({"circle-radius":new ee(gt.paint_circle["circle-radius"]),"circle-color":new ee(gt.paint_circle["circle-color"]),"circle-blur":new ee(gt.paint_circle["circle-blur"]),"circle-opacity":new ee(gt.paint_circle["circle-opacity"]),"circle-translate":new Kt(gt.paint_circle["circle-translate"]),"circle-translate-anchor":new Kt(gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kt(gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kt(gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(gt.paint_circle["circle-stroke-opacity"])})},get layout(){return Zu=Zu||new _i({"circle-sort-key":new ee(gt.layout_circle["circle-sort-key"])})}},Qi=1e-6,Qn=typeof Float32Array<"u"?Float32Array:Array;function Rc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Xu(i,t,r){var n=t[0],h=t[1],f=t[2],g=t[3],_=t[4],w=t[5],E=t[6],C=t[7],z=t[8],R=t[9],O=t[10],U=t[11],Z=t[12],W=t[13],J=t[14],nt=t[15],it=r[0],ht=r[1],ut=r[2],yt=r[3];return i[0]=it*n+ht*_+ut*z+yt*Z,i[1]=it*h+ht*w+ut*R+yt*W,i[2]=it*f+ht*E+ut*O+yt*J,i[3]=it*g+ht*C+ut*U+yt*nt,i[4]=(it=r[4])*n+(ht=r[5])*_+(ut=r[6])*z+(yt=r[7])*Z,i[5]=it*h+ht*w+ut*R+yt*W,i[6]=it*f+ht*E+ut*O+yt*J,i[7]=it*g+ht*C+ut*U+yt*nt,i[8]=(it=r[8])*n+(ht=r[9])*_+(ut=r[10])*z+(yt=r[11])*Z,i[9]=it*h+ht*w+ut*R+yt*W,i[10]=it*f+ht*E+ut*O+yt*J,i[11]=it*g+ht*C+ut*U+yt*nt,i[12]=(it=r[12])*n+(ht=r[13])*_+(ut=r[14])*z+(yt=r[15])*Z,i[13]=it*h+ht*w+ut*R+yt*W,i[14]=it*f+ht*E+ut*O+yt*J,i[15]=it*g+ht*C+ut*U+yt*nt,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var rl,Bf=Xu;function Mh(i,t,r){var n=t[0],h=t[1],f=t[2],g=t[3];return i[0]=r[0]*n+r[4]*h+r[8]*f+r[12]*g,i[1]=r[1]*n+r[5]*h+r[9]*f+r[13]*g,i[2]=r[2]*n+r[6]*h+r[10]*f+r[14]*g,i[3]=r[3]*n+r[7]*h+r[11]*f+r[15]*g,i}rl=new Qn(4),Qn!=Float32Array&&(rl[0]=0,rl[1]=0,rl[2]=0,rl[3]=0);class Ff extends Xr{constructor(t){super(t,Rf)}createBucket(t){return new kc(t)}queryRadius(t){const r=t;return il("circle-radius",this,r)+il("circle-stroke-width",this,r)+bh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,n,h,f,g,_,w){const E=wh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),C=this.paint.get("circle-radius").evaluate(r,n)+this.paint.get("circle-stroke-width").evaluate(r,n),z=this.paint.get("circle-pitch-alignment")==="map",R=z?E:function(U,Z){return U.map(W=>Wu(W,Z))}(E,w),O=z?C*_:C;for(const U of h)for(const Z of U){const W=z?Z:Wu(Z,w);let J=O;const nt=Mh([],[Z.x,Z.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=nt[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=g.cameraToCenterDistance/nt[3]),zf(R,W,J))return!0}return!1}}function Wu(i,t){const r=Mh([],[i.x,i.y,0,1],t);return new N(r[0]/r[3],r[1]/r[3])}class Hu extends kc{}let Ku;Nt("HeatmapBucket",Hu,{omit:["layers"]});var Of={get paint(){return Ku=Ku||new _i({"heatmap-radius":new ee(gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kt(gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ho(gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kt(gt.paint_heatmap["heatmap-opacity"])})}};function Bc(i,{width:t,height:r},n,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*r*n)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*r*n}`)}else h=new Uint8Array(t*r*n);return i.width=t,i.height=r,i.data=h,i}function Yu(i,{width:t,height:r},n){if(t===i.width&&r===i.height)return;const h=Bc({},{width:t,height:r},n);Fc(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},n),i.width=t,i.height=r,i.data=h.data}function Fc(i,t,r,n,h,f){if(h.width===0||h.height===0)return t;if(h.width>i.width||h.height>i.height||r.x>i.width-h.width||r.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||n.x>t.width-h.width||n.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,_=t.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){const E=((r.y+w)*i.width+r.x)*f,C=((n.y+w)*t.width+n.x)*f;for(let z=0;z<h.width*f;z++)_[C+z]=g[E+z]}return t}class sl{constructor(t,r){Bc(this,t,1,r)}resize(t){Yu(this,t,1)}clone(){return new sl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,n,h,f){Fc(t,r,n,h,f,1)}}class Fr{constructor(t,r){Bc(this,t,4,r)}resize(t){Yu(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Fr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,n,h,f){Fc(t,r,n,h,f,4)}}function Ju(i){const t={},r=i.resolution||256,n=i.clips?i.clips.length:1,h=i.image||new Fr({width:r,height:n});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(g,_,w)=>{t[i.evaluationKey]=w;const E=i.expression.evaluate(t);h.data[g+_+0]=Math.floor(255*E.r/E.a),h.data[g+_+1]=Math.floor(255*E.g/E.a),h.data[g+_+2]=Math.floor(255*E.b/E.a),h.data[g+_+3]=Math.floor(255*E.a)};if(i.clips)for(let g=0,_=0;g<n;++g,_+=4*r)for(let w=0,E=0;w<r;w++,E+=4){const C=w/(r-1),{start:z,end:R}=i.clips[g];f(_,E,z*(1-C)+R*C)}else for(let g=0,_=0;g<r;g++,_+=4)f(0,_,g/(r-1));return h}Nt("AlphaImage",sl),Nt("RGBAImage",Fr);class Uf extends Xr{createBucket(t){return new Hu(t)}constructor(t){super(t,Of),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ju({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Qu;var Nf={get paint(){return Qu=Qu||new _i({"hillshade-illumination-direction":new Kt(gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kt(gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kt(gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kt(gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kt(gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kt(gt.paint_hillshade["hillshade-accent-color"])})}};class Vf extends Xr{constructor(t){super(t,Nf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const $f=ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:qf}=$f;var Oc={exports:{}};function Th(i,t,r){r=r||2;var n,h,f,g,_,w,E,C=t&&t.length,z=C?t[0]*r:i.length,R=td(i,0,z,r,!0),O=[];if(!R||R.next===R.prev)return O;if(C&&(R=function(Z,W,J,nt){var it,ht,ut,yt=[];for(it=0,ht=W.length;it<ht;it++)(ut=td(Z,W[it]*nt,it<ht-1?W[it+1]*nt:Z.length,nt,!1))===ut.next&&(ut.steiner=!0),yt.push(Yf(ut));for(yt.sort(Wf),it=0;it<yt.length;it++)J=Hf(yt[it],J);return J}(i,t,R,r)),i.length>80*r){n=f=i[0],h=g=i[1];for(var U=r;U<z;U+=r)(_=i[U])<n&&(n=_),(w=i[U+1])<h&&(h=w),_>f&&(f=_),w>g&&(g=w);E=(E=Math.max(f-n,g-h))!==0?32767/E:0}return al(R,O,r,n,h,E,0),O}function td(i,t,r,n,h){var f,g;if(h===Vc(i,t,r,n)>0)for(f=t;f<r;f+=n)g=rd(f,i[f],i[f+1],g);else for(f=r-n;f>=t;f-=n)g=rd(f,i[f],i[f+1],g);return g&&Eh(g,g.next)&&(ol(g),g=g.next),g}function sn(i,t){if(!i)return i;t||(t=i);var r,n=i;do if(r=!1,n.steiner||!Eh(n,n.next)&&li(n.prev,n,n.next)!==0)n=n.next;else{if(ol(n),(n=t=n.prev)===n.next)break;r=!0}while(r||n!==t);return t}function al(i,t,r,n,h,f,g){if(i){!g&&f&&function(C,z,R,O){var U=C;do U.z===0&&(U.z=Uc(U.x,U.y,z,R,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function(Z){var W,J,nt,it,ht,ut,yt,Ut,Xt=1;do{for(J=Z,Z=null,ht=null,ut=0;J;){for(ut++,nt=J,yt=0,W=0;W<Xt&&(yt++,nt=nt.nextZ);W++);for(Ut=Xt;yt>0||Ut>0&&nt;)yt!==0&&(Ut===0||!nt||J.z<=nt.z)?(it=J,J=J.nextZ,yt--):(it=nt,nt=nt.nextZ,Ut--),ht?ht.nextZ=it:Z=it,it.prevZ=ht,ht=it;J=nt}ht.nextZ=null,Xt*=2}while(ut>1)}(U)}(i,n,h,f);for(var _,w,E=i;i.prev!==i.next;)if(_=i.prev,w=i.next,f?Zf(i,n,h,f):Gf(i))t.push(_.i/r|0),t.push(i.i/r|0),t.push(w.i/r|0),ol(i),i=w.next,E=w.next;else if((i=w)===E){g?g===1?al(i=jf(sn(i),t,r),t,r,n,h,f,2):g===2&&Xf(i,t,r,n,h,f):al(sn(i),t,r,n,h,f,1);break}}}function Gf(i){var t=i.prev,r=i,n=i.next;if(li(t,r,n)>=0)return!1;for(var h=t.x,f=r.x,g=n.x,_=t.y,w=r.y,E=n.y,C=h<f?h<g?h:g:f<g?f:g,z=_<w?_<E?_:E:w<E?w:E,R=h>f?h>g?h:g:f>g?f:g,O=_>w?_>E?_:E:w>E?w:E,U=n.next;U!==t;){if(U.x>=C&&U.x<=R&&U.y>=z&&U.y<=O&&to(h,_,f,w,g,E,U.x,U.y)&&li(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Zf(i,t,r,n){var h=i.prev,f=i,g=i.next;if(li(h,f,g)>=0)return!1;for(var _=h.x,w=f.x,E=g.x,C=h.y,z=f.y,R=g.y,O=_<w?_<E?_:E:w<E?w:E,U=C<z?C<R?C:R:z<R?z:R,Z=_>w?_>E?_:E:w>E?w:E,W=C>z?C>R?C:R:z>R?z:R,J=Uc(O,U,t,r,n),nt=Uc(Z,W,t,r,n),it=i.prevZ,ht=i.nextZ;it&&it.z>=J&&ht&&ht.z<=nt;){if(it.x>=O&&it.x<=Z&&it.y>=U&&it.y<=W&&it!==h&&it!==g&&to(_,C,w,z,E,R,it.x,it.y)&&li(it.prev,it,it.next)>=0||(it=it.prevZ,ht.x>=O&&ht.x<=Z&&ht.y>=U&&ht.y<=W&&ht!==h&&ht!==g&&to(_,C,w,z,E,R,ht.x,ht.y)&&li(ht.prev,ht,ht.next)>=0))return!1;ht=ht.nextZ}for(;it&&it.z>=J;){if(it.x>=O&&it.x<=Z&&it.y>=U&&it.y<=W&&it!==h&&it!==g&&to(_,C,w,z,E,R,it.x,it.y)&&li(it.prev,it,it.next)>=0)return!1;it=it.prevZ}for(;ht&&ht.z<=nt;){if(ht.x>=O&&ht.x<=Z&&ht.y>=U&&ht.y<=W&&ht!==h&&ht!==g&&to(_,C,w,z,E,R,ht.x,ht.y)&&li(ht.prev,ht,ht.next)>=0)return!1;ht=ht.nextZ}return!0}function jf(i,t,r){var n=i;do{var h=n.prev,f=n.next.next;!Eh(h,f)&&ed(h,n,n.next,f)&&nl(h,f)&&nl(f,h)&&(t.push(h.i/r|0),t.push(n.i/r|0),t.push(f.i/r|0),ol(n),ol(n.next),n=i=f),n=n.next}while(n!==i);return sn(n)}function Xf(i,t,r,n,h,f){var g=i;do{for(var _=g.next.next;_!==g.prev;){if(g.i!==_.i&&Jf(g,_)){var w=id(g,_);return g=sn(g,g.next),w=sn(w,w.next),al(g,t,r,n,h,f,0),void al(w,t,r,n,h,f,0)}_=_.next}g=g.next}while(g!==i)}function Wf(i,t){return i.x-t.x}function Hf(i,t){var r=function(h,f){var g,_=f,w=h.x,E=h.y,C=-1/0;do{if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){var z=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(z<=w&&z>C&&(C=z,g=_.x<_.next.x?_:_.next,z===w))return g}_=_.next}while(_!==f);if(!g)return null;var R,O=g,U=g.x,Z=g.y,W=1/0;_=g;do w>=_.x&&_.x>=U&&w!==_.x&&to(E<Z?w:C,E,U,Z,E<Z?C:w,E,_.x,_.y)&&(R=Math.abs(E-_.y)/(w-_.x),nl(_,h)&&(R<W||R===W&&(_.x>g.x||_.x===g.x&&Kf(g,_)))&&(g=_,W=R)),_=_.next;while(_!==O);return g}(i,t);if(!r)return t;var n=id(r,i);return sn(n,n.next),sn(r,r.next)}function Kf(i,t){return li(i.prev,i,t.prev)<0&&li(t.next,i,i.next)<0}function Uc(i,t,r,n,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Yf(i){var t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function to(i,t,r,n,h,f,g,_){return(h-g)*(t-_)>=(i-g)*(f-_)&&(i-g)*(n-_)>=(r-g)*(t-_)&&(r-g)*(f-_)>=(h-g)*(n-_)}function Jf(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,n){var h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==n.i&&h.next.i!==n.i&&ed(h,h.next,r,n))return!0;h=h.next}while(h!==r);return!1}(i,t)&&(nl(i,t)&&nl(t,i)&&function(r,n){var h=r,f=!1,g=(r.x+n.x)/2,_=(r.y+n.y)/2;do h.y>_!=h.next.y>_&&h.next.y!==h.y&&g<(h.next.x-h.x)*(_-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==r);return f}(i,t)&&(li(i.prev,i,t.prev)||li(i,t.prev,t))||Eh(i,t)&&li(i.prev,i,i.next)>0&&li(t.prev,t,t.next)>0)}function li(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Eh(i,t){return i.x===t.x&&i.y===t.y}function ed(i,t,r,n){var h=Ih(li(i,t,r)),f=Ih(li(i,t,n)),g=Ih(li(r,n,i)),_=Ih(li(r,n,t));return h!==f&&g!==_||!(h!==0||!Sh(i,r,t))||!(f!==0||!Sh(i,n,t))||!(g!==0||!Sh(r,i,n))||!(_!==0||!Sh(r,t,n))}function Sh(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Ih(i){return i>0?1:i<0?-1:0}function nl(i,t){return li(i.prev,i,i.next)<0?li(i,t,i.next)>=0&&li(i,i.prev,t)>=0:li(i,t,i.prev)<0||li(i,i.next,t)<0}function id(i,t){var r=new Nc(i.i,i.x,i.y),n=new Nc(t.i,t.x,t.y),h=i.next,f=t.prev;return i.next=t,t.prev=i,r.next=h,h.prev=r,n.next=r,r.prev=n,f.next=n,n.prev=f,n}function rd(i,t,r,n){var h=new Nc(i,t,r);return n?(h.next=n.next,h.prev=n,n.next.prev=h,n.next=h):(h.prev=h,h.next=h),h}function ol(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Nc(i,t,r){this.i=i,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Vc(i,t,r,n){for(var h=0,f=t,g=r-n;f<r;f+=n)h+=(i[g]-i[f])*(i[f+1]+i[g+1]),g=f;return h}Oc.exports=Th,Oc.exports.default=Th,Th.deviation=function(i,t,r,n){var h=t&&t.length,f=Math.abs(Vc(i,0,h?t[0]*r:i.length,r));if(h)for(var g=0,_=t.length;g<_;g++)f-=Math.abs(Vc(i,t[g]*r,g<_-1?t[g+1]*r:i.length,r));var w=0;for(g=0;g<n.length;g+=3){var E=n[g]*r,C=n[g+1]*r,z=n[g+2]*r;w+=Math.abs((i[E]-i[z])*(i[C+1]-i[E+1])-(i[E]-i[C])*(i[z+1]-i[E+1]))}return f===0&&w===0?0:Math.abs((w-f)/f)},Th.flatten=function(i){for(var t=i[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,h=0;h<i.length;h++){for(var f=0;f<i[h].length;f++)for(var g=0;g<t;g++)r.vertices.push(i[h][f][g]);h>0&&r.holes.push(n+=i[h-1].length)}return r};var sd=L(Oc.exports);function Qf(i,t,r,n,h){ad(i,t,r||0,n||i.length-1,h||tm)}function ad(i,t,r,n,h){for(;n>r;){if(n-r>600){var f=n-r+1,g=t-r+1,_=Math.log(f),w=.5*Math.exp(2*_/3),E=.5*Math.sqrt(_*w*(f-w)/f)*(g-f/2<0?-1:1);ad(i,t,Math.max(r,Math.floor(t-g*w/f+E)),Math.min(n,Math.floor(t+(f-g)*w/f+E)),h)}var C=i[t],z=r,R=n;for(ll(i,r,t),h(i[n],C)>0&&ll(i,r,n);z<R;){for(ll(i,z,R),z++,R--;h(i[z],C)<0;)z++;for(;h(i[R],C)>0;)R--}h(i[r],C)===0?ll(i,r,R):ll(i,++R,n),R<=t&&(r=R+1),t<=R&&(n=R-1)}}function ll(i,t,r){var n=i[t];i[t]=i[r],i[r]=n}function tm(i,t){return i<t?-1:i>t?1:0}function $c(i,t){const r=i.length;if(r<=1)return[i];const n=[];let h,f;for(let g=0;g<r;g++){const _=zi(i[g]);_!==0&&(i[g].area=Math.abs(_),f===void 0&&(f=_<0),f===_<0?(h&&n.push(h),h=[i[g]]):h.push(i[g]))}if(h&&n.push(h),t>1)for(let g=0;g<n.length;g++)n[g].length<=t||(Qf(n[g],t,1,n[g].length-1,em),n[g]=n[g].slice(0,t));return n}function em(i,t){return t.area-i.area}function qc(i,t,r){const n=r.patternDependencies;let h=!1;for(const f of t){const g=f.paint.get(`${i}-pattern`);g.isConstant()||(h=!0);const _=g.constantOr(null);_&&(h=!0,n[_.to]=!0,n[_.from]=!0)}return h}function Gc(i,t,r,n,h){const f=h.patternDependencies;for(const g of t){const _=g.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:n-1},r,{},h.availableImages),E=_.evaluate({zoom:n},r,{},h.availableImages),C=_.evaluate({zoom:n+1},r,{},h.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,f[w]=!0,f[E]=!0,f[C]=!0,r.patterns[g.id]={min:w,mid:E,max:C}}}return r}class Zc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new dt,this.indexArray=new qt,this.indexArray2=new Ne,this.programConfigurations=new ia(t.layers,t.zoom),this.segments=new re,this.segments2=new re,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){this.hasPattern=qc("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),f=!h.isConstant(),g=[];for(const{feature:_,id:w,index:E,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,R=us(_,z);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),R,n))continue;const O=f?h.evaluate(R,{},n,r.availableImages):void 0,U={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:z?R.geometry:ks(_),patterns:{},sortKey:O};g.push(U)}f&&g.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of g){const{geometry:w,index:E,sourceLayerIndex:C}=_;if(this.hasPattern){const z=Gc("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(_,w,E,n,{});r.featureIndex.insert(t[E].feature,w,E,C,this.index)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}addFeatures(t,r,n){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,n,h,f){for(const g of $c(r,500)){let _=0;for(const O of g)_+=O.length;const w=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),E=w.vertexLength,C=[],z=[];for(const O of g){if(O.length===0)continue;O!==g[0]&&z.push(C.length/2);const U=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),Z=U.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(Z+O.length-1,Z),C.push(O[0].x),C.push(O[0].y);for(let W=1;W<O.length;W++)this.layoutVertexArray.emplaceBack(O[W].x,O[W].y),this.indexArray2.emplaceBack(Z+W-1,Z+W),C.push(O[W].x),C.push(O[W].y);U.vertexLength+=O.length,U.primitiveLength+=O.length}const R=sd(C,z);for(let O=0;O<R.length;O+=3)this.indexArray.emplaceBack(E+R[O],E+R[O+1],E+R[O+2]);w.vertexLength+=_,w.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,f,h)}}let nd,od;Nt("FillBucket",Zc,{omit:["layers","patternFeatures"]});var im={get paint(){return od=od||new _i({"fill-antialias":new Kt(gt.paint_fill["fill-antialias"]),"fill-opacity":new ee(gt.paint_fill["fill-opacity"]),"fill-color":new ee(gt.paint_fill["fill-color"]),"fill-outline-color":new ee(gt.paint_fill["fill-outline-color"]),"fill-translate":new Kt(gt.paint_fill["fill-translate"]),"fill-translate-anchor":new Kt(gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zn(gt.paint_fill["fill-pattern"])})},get layout(){return nd=nd||new _i({"fill-sort-key":new ee(gt.layout_fill["fill-sort-key"])})}};class rm extends Xr{constructor(t){super(t,im)}recalculate(t,r){super.recalculate(t,r);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Zc(t)}queryRadius(){return bh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,n,h,f,g,_){return $u(wh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),h)}isTileClipped(){return!0}}const sm=ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),am=ni([{name:"a_centroid",components:2,type:"Int16"}],4),{members:nm}=sm;var Ia={},om=k,ld=eo;function eo(i,t,r,n,h){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=h,i.readFields(lm,this,t)}function lm(i,t,r){i==1?t.id=r.readVarint():i==2?function(n,h){for(var f=n.readVarint()+n.pos;n.pos<f;){var g=h._keys[n.readVarint()],_=h._values[n.readVarint()];h.properties[g]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function hm(i){for(var t,r,n=0,h=0,f=i.length,g=f-1;h<f;g=h++)n+=((r=i[g]).x-(t=i[h]).x)*(t.y+r.y);return n}eo.types=["Unknown","Point","LineString","Polygon"],eo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,n=1,h=0,f=0,g=0,_=[];i.pos<r;){if(h<=0){var w=i.readVarint();n=7&w,h=w>>3}if(h--,n===1||n===2)f+=i.readSVarint(),g+=i.readSVarint(),n===1&&(t&&_.push(t),t=[]),t.push(new om(f,g));else{if(n!==7)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&_.push(t),_},eo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,n=0,h=0,f=0,g=1/0,_=-1/0,w=1/0,E=-1/0;i.pos<t;){if(n<=0){var C=i.readVarint();r=7&C,n=C>>3}if(n--,r===1||r===2)(h+=i.readSVarint())<g&&(g=h),h>_&&(_=h),(f+=i.readSVarint())<w&&(w=f),f>E&&(E=f);else if(r!==7)throw new Error("unknown command "+r)}return[g,w,_,E]},eo.prototype.toGeoJSON=function(i,t,r){var n,h,f=this.extent*Math.pow(2,r),g=this.extent*i,_=this.extent*t,w=this.loadGeometry(),E=eo.types[this.type];function C(O){for(var U=0;U<O.length;U++){var Z=O[U];O[U]=[360*(Z.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+_)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(n=0;n<w.length;n++)z[n]=w[n][0];C(w=z);break;case 2:for(n=0;n<w.length;n++)C(w[n]);break;case 3:for(w=function(O){var U=O.length;if(U<=1)return[O];for(var Z,W,J=[],nt=0;nt<U;nt++){var it=hm(O[nt]);it!==0&&(W===void 0&&(W=it<0),W===it<0?(Z&&J.push(Z),Z=[O[nt]]):Z.push(O[nt]))}return Z&&J.push(Z),J}(w),n=0;n<w.length;n++)for(h=0;h<w[n].length;h++)C(w[n][h])}w.length===1?w=w[0]:E="Multi"+E;var R={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(R.id=this.id),R};var cm=ld,hd=cd;function cd(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(um,this,t),this.length=this._features.length}function um(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(n){for(var h=null,f=n.readVarint()+n.pos;n.pos<f;){var g=n.readVarint()>>3;h=g===1?n.readString():g===2?n.readFloat():g===3?n.readDouble():g===4?n.readVarint64():g===5?n.readVarint():g===6?n.readSVarint():g===7?n.readBoolean():null}return h}(r))}cd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new cm(this._pbf,t,this.extent,this._keys,this._values)};var dm=hd;function pm(i,t,r){if(i===3){var n=new dm(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}Ia.VectorTile=function(i,t){this.layers=i.readFields(pm,{},t)},Ia.VectorTileFeature=ld,Ia.VectorTileLayer=hd;const fm=Ia.VectorTileFeature.types,jc=Math.pow(2,13);function hl(i,t,r,n,h,f,g,_){i.emplaceBack(t,r,2*Math.floor(n*jc)+g,h*jc*2,f*jc*2,Math.round(_))}class Xc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new pt,this.centroidVertexArray=new K,this.indexArray=new qt,this.programConfigurations=new ia(t.layers,t.zoom),this.segments=new re,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){this.features=[],this.hasPattern=qc("fill-extrusion",this.layers,r);for(const{feature:h,id:f,index:g,sourceLayerIndex:_}of t){const w=this.layers[0]._featureFilter.needGeometry,E=us(h,w);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),E,n))continue;const C={id:f,sourceLayerIndex:_,index:g,geometry:w?E.geometry:ks(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Gc("fill-extrusion",this.layers,C,this.zoom,r)):this.addFeature(C,C.geometry,g,n,{}),r.featureIndex.insert(h,C.geometry,g,_,this.index,!0)}}addFeatures(t,r,n){for(const h of this.features){const{geometry:f}=h;this.addFeature(h,f,h.index,r,n)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nm),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,am.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,n,h,f){const g={x:0,y:0,vertexCount:0};for(const _ of $c(r,500)){let w=0;for(const U of _)w+=U.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of _){if(U.length===0||gm(U))continue;let Z=0;for(let W=0;W<U.length;W++){const J=U[W];if(W>=1){const nt=U[W-1];if(!mm(J,nt)){E.vertexLength+4>re.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const it=J.sub(nt)._perp()._unit(),ht=nt.dist(J);Z+ht>32768&&(Z=0),hl(this.layoutVertexArray,J.x,J.y,it.x,it.y,0,0,Z),hl(this.layoutVertexArray,J.x,J.y,it.x,it.y,0,1,Z),g.x+=2*J.x,g.y+=2*J.y,g.vertexCount+=2,Z+=ht,hl(this.layoutVertexArray,nt.x,nt.y,it.x,it.y,0,0,Z),hl(this.layoutVertexArray,nt.x,nt.y,it.x,it.y,0,1,Z),g.x+=2*nt.x,g.y+=2*nt.y,g.vertexCount+=2;const ut=E.vertexLength;this.indexArray.emplaceBack(ut,ut+2,ut+1),this.indexArray.emplaceBack(ut+1,ut+2,ut+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+w>re.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),fm[t.type]!=="Polygon")continue;const C=[],z=[],R=E.vertexLength;for(const U of _)if(U.length!==0){U!==_[0]&&z.push(C.length/2);for(let Z=0;Z<U.length;Z++){const W=U[Z];hl(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),g.x+=W.x,g.y+=W.y,g.vertexCount+=1,C.push(W.x),C.push(W.y)}}const O=sd(C,z);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(R+O[U],R+O[U+2],R+O[U+1]);E.primitiveLength+=O.length/3,E.vertexLength+=w}for(let _=0;_<g.vertexCount;_++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,f,h)}}function mm(i,t){return i.x===t.x&&(i.x<0||i.x>Ye)||i.y===t.y&&(i.y<0||i.y>Ye)}function gm(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Ye)||i.every(t=>t.y<0)||i.every(t=>t.y>Ye)}let ud;Nt("FillExtrusionBucket",Xc,{omit:["layers","features"]});var _m={get paint(){return ud=ud||new _i({"fill-extrusion-opacity":new Kt(gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kt(gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kt(gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zn(gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kt(gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ym extends Xr{constructor(t){super(t,_m)}createBucket(t){return new Xc(t)}queryRadius(){return bh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,n,h,f,g,_,w){const E=wh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),C=this.paint.get("fill-extrusion-height").evaluate(r,n),z=this.paint.get("fill-extrusion-base").evaluate(r,n),R=function(U,Z,W,J){const nt=[];for(const it of U){const ht=[it.x,it.y,0,1];Mh(ht,ht,Z),nt.push(new N(ht[0]/ht[3],ht[1]/ht[3]))}return nt}(E,w),O=function(U,Z,W,J){const nt=[],it=[],ht=J[8]*Z,ut=J[9]*Z,yt=J[10]*Z,Ut=J[11]*Z,Xt=J[8]*W,Ft=J[9]*W,Bt=J[10]*W,At=J[11]*W;for(const Vt of U){const zt=[],St=[];for(const Qt of Vt){const Ht=Qt.x,fe=Qt.y,qe=J[0]*Ht+J[4]*fe+J[12],Ze=J[1]*Ht+J[5]*fe+J[13],vi=J[2]*Ht+J[6]*fe+J[14],Er=J[3]*Ht+J[7]*fe+J[15],tr=vi+yt,pi=Er+Ut,Si=qe+Xt,Bi=Ze+Ft,pr=vi+Bt,er=Er+At,fi=new N((qe+ht)/pi,(Ze+ut)/pi);fi.z=tr/pi,zt.push(fi);const xi=new N(Si/er,Bi/er);xi.z=pr/er,St.push(xi)}nt.push(zt),it.push(St)}return[nt,it]}(h,z,C,w);return function(U,Z,W){let J=1/0;$u(W,Z)&&(J=dd(W,Z[0]));for(let nt=0;nt<Z.length;nt++){const it=Z[nt],ht=U[nt];for(let ut=0;ut<it.length-1;ut++){const yt=it[ut],Ut=[yt,it[ut+1],ht[ut+1],ht[ut],yt];Vu(W,Ut)&&(J=Math.min(J,dd(W,Ut)))}}return J!==1/0&&J}(O[0],O[1],R)}}function cl(i,t){return i.x*t.x+i.y*t.y}function dd(i,t){if(i.length===1){let r=0;const n=t[r++];let h;for(;!h||n.equals(h);)if(h=t[r++],!h)return 1/0;for(;r<t.length;r++){const f=t[r],g=i[0],_=h.sub(n),w=f.sub(n),E=g.sub(n),C=cl(_,_),z=cl(_,w),R=cl(w,w),O=cl(E,_),U=cl(E,w),Z=C*R-z*z,W=(R*O-z*U)/Z,J=(C*U-z*O)/Z,nt=n.z*(1-W-J)+h.z*W+f.z*J;if(isFinite(nt))return nt}return 1/0}{let r=1/0;for(const n of t)r=Math.min(r,n.z);return r}}const vm=ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xm}=vm,bm=ni([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:wm}=bm,Mm=Ia.VectorTileFeature.types,Tm=Math.cos(Math.PI/180*37.5),pd=Math.pow(2,14)/.5;class Wc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new _t,this.layoutVertexArray2=new Et,this.indexArray=new qt,this.programConfigurations=new ia(t.layers,t.zoom),this.segments=new re,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){this.hasPattern=qc("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),f=!h.isConstant(),g=[];for(const{feature:_,id:w,index:E,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,R=us(_,z);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),R,n))continue;const O=f?h.evaluate(R,{},n):void 0,U={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:z?R.geometry:ks(_),patterns:{},sortKey:O};g.push(U)}f&&g.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of g){const{geometry:w,index:E,sourceLayerIndex:C}=_;if(this.hasPattern){const z=Gc("line",this.layers,_,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(_,w,E,n,{});r.featureIndex.insert(t[E].feature,w,E,C,this.index)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}addFeatures(t,r,n){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,wm)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,n,h,f){const g=this.layers[0].layout,_=g.get("line-join").evaluate(t,{}),w=g.get("line-cap"),E=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of r)this.addLine(z,t,_,w,E,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,f,h)}addLine(t,r,n,h,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<t.length-1;J++)this.totalDistance+=t[J].dist(t[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=Mm[r.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(_?3:2))return;n==="bevel"&&(f=1.05);const C=this.overscaling<=16?15*Ye/(512*this.overscaling):0,z=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let R,O,U,Z,W;this.e1=this.e2=-1,_&&(R=t[w-2],W=t[E].sub(R)._unit()._perp());for(let J=E;J<w;J++){if(U=J===w-1?_?t[E+1]:void 0:t[J+1],U&&t[J].equals(U))continue;W&&(Z=W),R&&(O=R),R=t[J],W=U?U.sub(R)._unit()._perp():Z,Z=Z||W;let nt=Z.add(W);nt.x===0&&nt.y===0||nt._unit();const it=Z.x*W.x+Z.y*W.y,ht=nt.x*W.x+nt.y*W.y,ut=ht!==0?1/ht:1/0,yt=2*Math.sqrt(2-2*ht),Ut=ht<Tm&&O&&U,Xt=Z.x*W.y-Z.y*W.x>0;if(Ut&&J>E){const At=R.dist(O);if(At>2*C){const Vt=R.sub(R.sub(O)._mult(C/At)._round());this.updateDistance(O,Vt),this.addCurrentVertex(Vt,Z,0,0,z),O=Vt}}const Ft=O&&U;let Bt=Ft?n:_?"butt":h;if(Ft&&Bt==="round"&&(ut<g?Bt="miter":ut<=2&&(Bt="fakeround")),Bt==="miter"&&ut>f&&(Bt="bevel"),Bt==="bevel"&&(ut>2&&(Bt="flipbevel"),ut<f&&(Bt="miter")),O&&this.updateDistance(O,R),Bt==="miter")nt._mult(ut),this.addCurrentVertex(R,nt,0,0,z);else if(Bt==="flipbevel"){if(ut>100)nt=W.mult(-1);else{const At=ut*Z.add(W).mag()/Z.sub(W).mag();nt._perp()._mult(At*(Xt?-1:1))}this.addCurrentVertex(R,nt,0,0,z),this.addCurrentVertex(R,nt.mult(-1),0,0,z)}else if(Bt==="bevel"||Bt==="fakeround"){const At=-Math.sqrt(ut*ut-1),Vt=Xt?At:0,zt=Xt?0:At;if(O&&this.addCurrentVertex(R,Z,Vt,zt,z),Bt==="fakeround"){const St=Math.round(180*yt/Math.PI/20);for(let Qt=1;Qt<St;Qt++){let Ht=Qt/St;if(Ht!==.5){const qe=Ht-.5;Ht+=Ht*qe*(Ht-1)*((1.0904+it*(it*(3.55645-1.43519*it)-3.2452))*qe*qe+(.848013+it*(.215638*it-1.06021)))}const fe=W.sub(Z)._mult(Ht)._add(Z)._unit()._mult(Xt?-1:1);this.addHalfVertex(R,fe.x,fe.y,!1,Xt,0,z)}}U&&this.addCurrentVertex(R,W,-Vt,-zt,z)}else if(Bt==="butt")this.addCurrentVertex(R,nt,0,0,z);else if(Bt==="square"){const At=O?1:-1;this.addCurrentVertex(R,nt,At,At,z)}else Bt==="round"&&(O&&(this.addCurrentVertex(R,Z,0,0,z),this.addCurrentVertex(R,Z,1,1,z,!0)),U&&(this.addCurrentVertex(R,W,-1,-1,z,!0),this.addCurrentVertex(R,W,0,0,z)));if(Ut&&J<w-1){const At=R.dist(U);if(At>2*C){const Vt=R.add(U.sub(R)._mult(C/At)._round());this.updateDistance(R,Vt),this.addCurrentVertex(Vt,W,0,0,z),R=Vt}}}}addCurrentVertex(t,r,n,h,f,g=!1){const _=r.y*h-r.x,w=-r.y-r.x*h;this.addHalfVertex(t,r.x+r.y*n,r.y-r.x*n,g,!1,n,f),this.addHalfVertex(t,_,w,g,!0,-h,f),this.distance>pd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,n,h,f,g))}addHalfVertex({x:t,y:r},n,h,f,g,_,w){const E=.5*(this.lineClips?this.scaledDistance*(pd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(r<<1)+(g?1:0),Math.round(63*n)+128,Math.round(63*h)+128,1+(_===0?0:_<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),g?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let fd,md;Nt("LineBucket",Wc,{omit:["layers","patternFeatures"]});var gd={get paint(){return md=md||new _i({"line-opacity":new ee(gt.paint_line["line-opacity"]),"line-color":new ee(gt.paint_line["line-color"]),"line-translate":new Kt(gt.paint_line["line-translate"]),"line-translate-anchor":new Kt(gt.paint_line["line-translate-anchor"]),"line-width":new ee(gt.paint_line["line-width"]),"line-gap-width":new ee(gt.paint_line["line-gap-width"]),"line-offset":new ee(gt.paint_line["line-offset"]),"line-blur":new ee(gt.paint_line["line-blur"]),"line-dasharray":new Wo(gt.paint_line["line-dasharray"]),"line-pattern":new Zn(gt.paint_line["line-pattern"]),"line-gradient":new Ho(gt.paint_line["line-gradient"])})},get layout(){return fd=fd||new _i({"line-cap":new Kt(gt.layout_line["line-cap"]),"line-join":new ee(gt.layout_line["line-join"]),"line-miter-limit":new Kt(gt.layout_line["line-miter-limit"]),"line-round-limit":new Kt(gt.layout_line["line-round-limit"]),"line-sort-key":new ee(gt.layout_line["line-sort-key"])})}};class Em extends ee{possiblyEvaluate(t,r){return r=new Ge(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,n,h){return r=Pt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,n,h)}}let Ah;class Sm extends Xr{constructor(t){super(t,gd),this.gradientVersion=0,Ah||(Ah=new Em(gd.paint.properties["line-width"].specification),Ah.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){t==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ah.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Wc(t)}queryRadius(t){const r=t,n=_d(il("line-width",this,r),il("line-gap-width",this,r)),h=il("line-offset",this,r);return n/2+Math.abs(h)+bh(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,n,h,f,g,_){const w=wh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),E=_/2*_d(this.paint.get("line-width").evaluate(r,n),this.paint.get("line-gap-width").evaluate(r,n)),C=this.paint.get("line-offset").evaluate(r,n);return C&&(h=function(z,R){const O=[];for(let U=0;U<z.length;U++){const Z=z[U],W=[];for(let J=0;J<Z.length;J++){const nt=Z[J-1],it=Z[J],ht=Z[J+1],ut=J===0?new N(0,0):it.sub(nt)._unit()._perp(),yt=J===Z.length-1?new N(0,0):ht.sub(it)._unit()._perp(),Ut=ut._add(yt)._unit(),Xt=Ut.x*yt.x+Ut.y*yt.y;Xt!==0&&Ut._mult(1/Xt),W.push(Ut._mult(R)._add(it))}O.push(W)}return O}(h,C*_)),function(z,R,O){for(let U=0;U<R.length;U++){const Z=R[U];if(z.length>=3){for(let W=0;W<Z.length;W++)if(Jn(z,Z[W]))return!0}if(kf(z,Z,O))return!0}return!1}(w,h,E)}isTileClipped(){return!0}}function _d(i,t){return t>0?t+2*i:i}const Im=ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Am=ni([{name:"a_projected_pos",components:3,type:"Float32"}],4);ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cm=ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ni([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yd=ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pm=ni([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zm(i,t,r){return i.sections.forEach(n=>{n.text=function(h,f,g){const _=f.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?h=h.toLocaleUpperCase():_==="lowercase"&&(h=h.toLocaleLowerCase()),Tr.applyArabicShaping&&(h=Tr.applyArabicShaping(h)),h}(n.text,t,r)}),i}ni([{name:"triangle",components:3,type:"Uint16"}]),ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ni([{type:"Float32",name:"offsetX"}]),ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ni([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ul={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var yi=24,vd=Re,xd=function(i,t,r,n,h){var f,g,_=8*h-n-1,w=(1<<_)-1,E=w>>1,C=-7,z=r?h-1:0,R=r?-1:1,O=i[t+z];for(z+=R,f=O&(1<<-C)-1,O>>=-C,C+=_;C>0;f=256*f+i[t+z],z+=R,C-=8);for(g=f&(1<<-C)-1,f>>=-C,C+=n;C>0;g=256*g+i[t+z],z+=R,C-=8);if(f===0)f=1-E;else{if(f===w)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,n),f-=E}return(O?-1:1)*g*Math.pow(2,f-n)},bd=function(i,t,r,n,h,f){var g,_,w,E=8*f-h-1,C=(1<<E)-1,z=C>>1,R=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=n?0:f-1,U=n?1:-1,Z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,g=C):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+z>=1?R/w:R*Math.pow(2,1-z))*w>=2&&(g++,w/=2),g+z>=C?(_=0,g=C):g+z>=1?(_=(t*w-1)*Math.pow(2,h),g+=z):(_=t*Math.pow(2,z-1)*Math.pow(2,h),g=0));h>=8;i[r+O]=255&_,O+=U,_/=256,h-=8);for(g=g<<h|_,E+=h;E>0;i[r+O]=255&g,O+=U,g/=256,E-=8);i[r+O-U]|=128*Z};function Re(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Re.Varint=0,Re.Fixed64=1,Re.Bytes=2,Re.Fixed32=5;var Hc=4294967296,wd=1/Hc,Md=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ra(i){return i.type===Re.Bytes?i.readVarint()+i.pos:i.pos+1}function io(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Td(i,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var h=r.pos-1;h>=i;h--)r.buf[h+n]=r.buf[h]}function km(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Dm(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function Lm(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function Rm(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function Bm(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function Fm(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function Om(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function Um(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function Nm(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Ch(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function ro(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function Ed(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Re.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),h=n>>3,f=this.pos;this.type=7&n,i(h,t,this),this.pos===f&&this.skip(n)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Ch(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Ed(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ch(this.buf,this.pos)+Ch(this.buf,this.pos+4)*Hc;return this.pos+=8,i},readSFixed64:function(){var i=Ch(this.buf,this.pos)+Ed(this.buf,this.pos+4)*Hc;return this.pos+=8,i},readFloat:function(){var i=xd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=xd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(h,f,g){var _,w,E=g.buf;if(_=(112&(w=E[g.pos++]))>>4,w<128||(_|=(127&(w=E[g.pos++]))<<3,w<128)||(_|=(127&(w=E[g.pos++]))<<10,w<128)||(_|=(127&(w=E[g.pos++]))<<17,w<128)||(_|=(127&(w=E[g.pos++]))<<24,w<128)||(_|=(1&(w=E[g.pos++]))<<31,w<128))return io(h,_,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Md?function(r,n,h){return Md.decode(r.subarray(n,h))}(this.buf,t,i):function(r,n,h){for(var f="",g=n;g<h;){var _,w,E,C=r[g],z=null,R=C>239?4:C>223?3:C>191?2:1;if(g+R>h)break;R===1?C<128&&(z=C):R===2?(192&(_=r[g+1]))==128&&(z=(31&C)<<6|63&_)<=127&&(z=null):R===3?(w=r[g+2],(192&(_=r[g+1]))==128&&(192&w)==128&&((z=(15&C)<<12|(63&_)<<6|63&w)<=2047||z>=55296&&z<=57343)&&(z=null)):R===4&&(w=r[g+2],E=r[g+3],(192&(_=r[g+1]))==128&&(192&w)==128&&(192&E)==128&&((z=(15&C)<<18|(63&_)<<12|(63&w)<<6|63&E)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,R=1):z>65535&&(z-=65536,f+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),f+=String.fromCharCode(z),g+=R}return f}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Re.Bytes)return i.push(this.readVarint(t));var r=ra(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Re.Bytes)return i.push(this.readSVarint());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Re.Bytes)return i.push(this.readBoolean());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Re.Bytes)return i.push(this.readFloat());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Re.Bytes)return i.push(this.readDouble());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Re.Bytes)return i.push(this.readFixed32());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Re.Bytes)return i.push(this.readSFixed32());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Re.Bytes)return i.push(this.readFixed64());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Re.Bytes)return i.push(this.readSFixed64());var t=ra(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Re.Varint)for(;this.buf[this.pos++]>127;);else if(t===Re.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Re.Fixed32)this.pos+=4;else{if(t!==Re.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ro(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ro(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ro(this.buf,-1&i,this.pos),ro(this.buf,Math.floor(i*wd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ro(this.buf,-1&i,this.pos),ro(this.buf,Math.floor(i*wd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var n,h;if(t>=0?(n=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,g,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(n,0,r),function(f,g){var _=(7&f)<<4;g.buf[g.pos++]|=_|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(h,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(n,h,f){for(var g,_,w=0;w<h.length;w++){if((g=h.charCodeAt(w))>55295&&g<57344){if(!_){g>56319||w+1===h.length?(n[f++]=239,n[f++]=191,n[f++]=189):_=g;continue}if(g<56320){n[f++]=239,n[f++]=191,n[f++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(n[f++]=239,n[f++]=191,n[f++]=189,_=null);g<128?n[f++]=g:(g<2048?n[f++]=g>>6|192:(g<65536?n[f++]=g>>12|224:(n[f++]=g>>18|240,n[f++]=g>>12&63|128),n[f++]=g>>6&63|128),n[f++]=63&g|128)}return f}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Td(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),bd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),bd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var n=this.pos-r;n>=128&&Td(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,t,r){this.writeTag(i,Re.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,km,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Dm,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Bm,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Lm,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Rm,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Fm,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Om,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Um,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Nm,t)},writeBytesField:function(i,t){this.writeTag(i,Re.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Re.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Re.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Re.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Re.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Re.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Re.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Re.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Re.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Re.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var Kc=L(vd);const Yc=3;function Vm(i,t,r){i===1&&r.readMessage($m,t)}function $m(i,t,r){if(i===3){const{id:n,bitmap:h,width:f,height:g,left:_,top:w,advance:E}=r.readMessage(qm,{});t.push({id:n,bitmap:new sl({width:f+2*Yc,height:g+2*Yc},h),metrics:{width:f,height:g,left:_,top:w,advance:E}})}}function qm(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const Sd=Yc;function Id(i){let t=0,r=0;for(const g of i)t+=g.w*g.h,r=Math.max(r,g.w);i.sort((g,_)=>_.h-g.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let h=0,f=0;for(const g of i)for(let _=n.length-1;_>=0;_--){const w=n[_];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,f=Math.max(f,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const E=n.pop();_<n.length&&(n[_]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(n.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:f,fill:t/(h*f)||0}}const dr=1;class Jc{constructor(t,{pixelRatio:r,version:n,stretchX:h,stretchY:f,content:g}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=h,this.stretchY=f,this.content=g,this.version=n}get tl(){return[this.paddedRect.x+dr,this.paddedRect.y+dr]}get br(){return[this.paddedRect.x+this.paddedRect.w-dr,this.paddedRect.y+this.paddedRect.h-dr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*dr)/this.pixelRatio,(this.paddedRect.h-2*dr)/this.pixelRatio]}}class Ad{constructor(t,r){const n={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,n,f),this.addImages(r,h,f);const{w:g,h:_}=Id(f),w=new Fr({width:g||1,height:_||1});for(const E in t){const C=t[E],z=n[E].paddedRect;Fr.copy(C.data,w,{x:0,y:0},{x:z.x+dr,y:z.y+dr},C.data)}for(const E in r){const C=r[E],z=h[E].paddedRect,R=z.x+dr,O=z.y+dr,U=C.data.width,Z=C.data.height;Fr.copy(C.data,w,{x:0,y:0},{x:R,y:O},C.data),Fr.copy(C.data,w,{x:0,y:Z-1},{x:R,y:O-1},{width:U,height:1}),Fr.copy(C.data,w,{x:0,y:0},{x:R,y:O+Z},{width:U,height:1}),Fr.copy(C.data,w,{x:U-1,y:0},{x:R-1,y:O},{width:1,height:Z}),Fr.copy(C.data,w,{x:0,y:0},{x:R+U,y:O},{width:1,height:Z})}this.image=w,this.iconPositions=n,this.patternPositions=h}addImages(t,r,n){for(const h in t){const f=t[h],g={x:0,y:0,w:f.data.width+2*dr,h:f.data.height+2*dr};n.push(g),r[h]=new Jc(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),r)}patchUpdatedImage(t,r,n){if(!t||!r||t.version===r.version)return;t.version=r.version;const[h,f]=t.tl;n.update(r.data,void 0,{x:h,y:f})}}var Aa;Nt("ImagePosition",Jc),Nt("ImageAtlas",Ad),o.WritingMode=void 0,(Aa=o.WritingMode||(o.WritingMode={}))[Aa.none=0]="none",Aa[Aa.horizontal=1]="horizontal",Aa[Aa.vertical=2]="vertical",Aa[Aa.horizontalOnly=3]="horizontalOnly";const dl=-17;class pl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const n=new pl;return n.scale=t||1,n.fontStack=r,n}static forImage(t){const r=new pl;return r.imageName=t,r}}class so{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const n=new so;for(let h=0;h<t.sections.length;h++){const f=t.sections[h];f.image?n.addImageSection(f):n.addTextSection(f,r)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let n=0;n<t.length;n++){const h=t.charCodeAt(n+1)||null,f=t.charCodeAt(n-1)||null;r+=h&&No(h)&&!ul[t[n+1]]||f&&No(f)&&!ul[t[n-1]]||!ul[t[n]]?t[n]:ul[t[n]]}return r}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&zh[this.text.charCodeAt(n)];n++)t++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&zh[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const n=new so;return n.text=this.text.substring(t,r),n.sectionIndex=this.sectionIndex.slice(t,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(pl.forText(t.scale,t.fontStack||r));const n=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(n)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Ce("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(pl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ce("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ph(i,t,r,n,h,f,g,_,w,E,C,z,R,O,U,Z){const W=so.fromFeature(i,h);let J;z===o.WritingMode.vertical&&W.verticalizePunctuation();const{processBidirectionalText:nt,processStyledBidirectionalText:it}=Tr;if(nt&&W.sections.length===1){J=[];const yt=nt(W.toString(),Qc(W,E,f,t,n,O,U));for(const Ut of yt){const Xt=new so;Xt.text=Ut,Xt.sections=W.sections;for(let Ft=0;Ft<Ut.length;Ft++)Xt.sectionIndex.push(0);J.push(Xt)}}else if(it){J=[];const yt=it(W.text,W.sectionIndex,Qc(W,E,f,t,n,O,U));for(const Ut of yt){const Xt=new so;Xt.text=Ut[0],Xt.sectionIndex=Ut[1],Xt.sections=W.sections,J.push(Xt)}}else J=function(yt,Ut){const Xt=[],Ft=yt.text;let Bt=0;for(const At of Ut)Xt.push(yt.substring(Bt,At)),Bt=At;return Bt<Ft.length&&Xt.push(yt.substring(Bt,Ft.length)),Xt}(W,Qc(W,E,f,t,n,O,U));const ht=[],ut={positionedLines:ht,text:W.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(yt,Ut,Xt,Ft,Bt,At,Vt,zt,St,Qt,Ht,fe){let qe=0,Ze=dl,vi=0,Er=0;const tr=zt==="right"?1:zt==="left"?0:.5;let pi=0;for(const fi of Bt){fi.trim();const xi=fi.getMaxScale(),Zi=(xi-1)*yi,ir={positionedGlyphs:[],lineOffset:0};yt.positionedLines[pi]=ir;const fr=ir.positionedGlyphs;let mr=0;if(!fi.length()){Ze+=At,++pi;continue}for(let Fi=0;Fi<fi.length();Fi++){const be=fi.getSection(Fi),Sr=fi.getSectionIndex(Fi),Oi=fi.getCharCode(Fi);let rr=0,Wr=null,ds=null,ps=null,sa=yi;const Hr=!(St===o.WritingMode.horizontal||!Ht&&!xa(Oi)||Ht&&(zh[Oi]||(Si=Oi,Ot.Arabic(Si)||Ot["Arabic Supplement"](Si)||Ot["Arabic Extended-A"](Si)||Ot["Arabic Presentation Forms-A"](Si)||Ot["Arabic Presentation Forms-B"](Si))));if(be.imageName){const Ur=Ft[be.imageName];if(!Ur)continue;ps=be.imageName,yt.iconsInText=yt.iconsInText||!0,ds=Ur.paddedRect;const gr=Ur.displaySize;be.scale=be.scale*yi/fe,Wr={width:gr[0],height:gr[1],left:dr,top:-Sd,advance:Hr?gr[1]:gr[0]},rr=Zi+(yi-gr[1]*be.scale),sa=Wr.advance;const aa=Hr?gr[0]*be.scale-yi*xi:gr[1]*be.scale-yi*xi;aa>0&&aa>mr&&(mr=aa)}else{const Ur=Xt[be.fontStack],gr=Ur&&Ur[Oi];if(gr&&gr.rect)ds=gr.rect,Wr=gr.metrics;else{const aa=Ut[be.fontStack],yl=aa&&aa[Oi];if(!yl)continue;Wr=yl.metrics}rr=(xi-be.scale)*yi}Hr?(yt.verticalizable=!0,fr.push({glyph:Oi,imageName:ps,x:qe,y:Ze+rr,vertical:Hr,scale:be.scale,fontStack:be.fontStack,sectionIndex:Sr,metrics:Wr,rect:ds}),qe+=sa*be.scale+Qt):(fr.push({glyph:Oi,imageName:ps,x:qe,y:Ze+rr,vertical:Hr,scale:be.scale,fontStack:be.fontStack,sectionIndex:Sr,metrics:Wr,rect:ds}),qe+=Wr.advance*be.scale+Qt)}fr.length!==0&&(vi=Math.max(qe-Qt,vi),jm(fr,0,fr.length-1,tr,mr)),qe=0;const ti=At*xi+mr;ir.lineOffset=Math.max(mr,Zi),Ze+=ti,Er=Math.max(ti,Er),++pi}var Si;const Bi=Ze-dl,{horizontalAlign:pr,verticalAlign:er}=tu(Vt);(function(fi,xi,Zi,ir,fr,mr,ti,Fi,be){const Sr=(xi-Zi)*fr;let Oi=0;Oi=mr!==ti?-Fi*ir-dl:(-ir*be+.5)*ti;for(const rr of fi)for(const Wr of rr.positionedGlyphs)Wr.x+=Sr,Wr.y+=Oi})(yt.positionedLines,tr,pr,er,vi,Er,At,Bi,Bt.length),yt.top+=-er*Bi,yt.bottom=yt.top+Bi,yt.left+=-pr*vi,yt.right=yt.left+vi}(ut,t,r,n,J,g,_,w,z,E,R,Z),!function(yt){for(const Ut of yt)if(Ut.positionedGlyphs.length!==0)return!1;return!0}(ht)&&ut}const zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Cd(i,t,r,n,h,f){if(t.imageName){const g=n[t.imageName];return g?g.displaySize[0]*t.scale*yi/f+h:0}{const g=r[t.fontStack],_=g&&g[i];return _?_.metrics.advance*t.scale+h:0}}function Pd(i,t,r,n){const h=Math.pow(i-t,2);return n?i<t?h/2:2*h:h+Math.abs(r)*r}function Zm(i,t,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),t!==41&&t!==65289||(n+=50),n}function zd(i,t,r,n,h,f){let g=null,_=Pd(t,r,h,f);for(const w of n){const E=Pd(t-w.x,r,h,f)+w.badness;E<=_&&(g=w,_=E)}return{index:i,x:t,priorBreak:g,badness:_}}function kd(i){return i?kd(i.priorBreak).concat(i.index):[]}function Qc(i,t,r,n,h,f,g){if(f!=="point")return[];if(!i)return[];const _=[],w=function(R,O,U,Z,W,J){let nt=0;for(let it=0;it<R.length();it++){const ht=R.getSection(it);nt+=Cd(R.getCharCode(it),ht,Z,W,O,J)}return nt/Math.max(1,Math.ceil(nt/U))}(i,t,r,n,h,g),E=i.text.indexOf("​")>=0;let C=0;for(let R=0;R<i.length();R++){const O=i.getSection(R),U=i.getCharCode(R);if(zh[U]||(C+=Cd(U,O,n,h,t,g)),R<i.length()-1){const Z=!((z=U)<11904||!(Ot["Bopomofo Extended"](z)||Ot.Bopomofo(z)||Ot["CJK Compatibility Forms"](z)||Ot["CJK Compatibility Ideographs"](z)||Ot["CJK Compatibility"](z)||Ot["CJK Radicals Supplement"](z)||Ot["CJK Strokes"](z)||Ot["CJK Symbols and Punctuation"](z)||Ot["CJK Unified Ideographs Extension A"](z)||Ot["CJK Unified Ideographs"](z)||Ot["Enclosed CJK Letters and Months"](z)||Ot["Halfwidth and Fullwidth Forms"](z)||Ot.Hiragana(z)||Ot["Ideographic Description Characters"](z)||Ot["Kangxi Radicals"](z)||Ot["Katakana Phonetic Extensions"](z)||Ot.Katakana(z)||Ot["Vertical Forms"](z)||Ot["Yi Radicals"](z)||Ot["Yi Syllables"](z)));(Gm[U]||Z||O.imageName)&&_.push(zd(R+1,C,w,_,Zm(U,i.getCharCode(R+1),Z&&E),!1))}}var z;return kd(zd(i.length(),C,w,_,0,!0))}function tu(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function jm(i,t,r,n,h){if(!n&&!h)return;const f=i[r],g=(i[r].x+f.metrics.advance*f.scale)*n;for(let _=t;_<=r;_++)i[_].x-=g,i[_].y+=h}function Xm(i,t,r){const{horizontalAlign:n,verticalAlign:h}=tu(r),f=t[0]-i.displaySize[0]*n,g=t[1]-i.displaySize[1]*h;return{image:i,top:g,bottom:g+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function Dd(i,t,r,n,h,f){const g=i.image;let _;if(g.content){const W=g.content,J=g.pixelRatio||1;_=[W[0]/J,W[1]/J,g.displaySize[0]-W[2]/J,g.displaySize[1]-W[3]/J]}const w=t.left*f,E=t.right*f;let C,z,R,O;r==="width"||r==="both"?(O=h[0]+w-n[3],z=h[0]+E+n[1]):(O=h[0]+(w+E-g.displaySize[0])/2,z=O+g.displaySize[0]);const U=t.top*f,Z=t.bottom*f;return r==="height"||r==="both"?(C=h[1]+U-n[0],R=h[1]+Z+n[2]):(C=h[1]+(U+Z-g.displaySize[1])/2,R=C+g.displaySize[1]),{image:g,top:C,right:z,bottom:R,left:O,collisionPadding:_}}const fl=255,Ds=128,Ca=fl*Ds;function Ld(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ge(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:h}=r;let f=0;for(;f<n.length&&n[f]<=i;)f++;f=Math.max(0,f-1);let g=f;for(;g<n.length&&n[g]<i+1;)g++;g=Math.min(n.length-1,g);const _=n[f],w=n[g];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:_,maxZoom:w,minSize:r.evaluate(new Ge(_)),maxSize:r.evaluate(new Ge(w)),interpolationType:h}}}function eu(i,t,r){let n="never";const h=i.get(t);return h?n=h:i.get(r)&&(n="always"),n}const Wm=Ia.VectorTileFeature.types,Hm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kh(i,t,r,n,h,f,g,_,w,E,C,z,R){const O=_?Math.min(Ca,Math.round(_[0])):0,U=_?Math.min(Ca,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*n),Math.round(32*h),f,g,(O<<1)+(w?1:0),U,16*E,16*C,256*z,256*R)}function iu(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function Km(i){for(const t of i.sections)if(Pc(t.text))return!0;return!1}class ru{constructor(t){this.layoutVertexArray=new It,this.indexArray=new qt,this.programConfigurations=t,this.segments=new re,this.dynamicLayoutVertexArray=new jt,this.opacityVertexArray=new ye,this.hasVisibleVertices=!1,this.placedSymbolArray=new A}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,n,h){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Im.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Am.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Hm,!0),this.opacityVertexBuffer.itemSize=1),(n||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Nt("SymbolBuffers",ru);class su{constructor(t,r,n){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new n,this.segments=new re,this.collisionVertexArray=new ie}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Cm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Nt("CollisionBuffers",su);class ao{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rc([]),this.placementViewportMatrix=Rc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ld(this.zoom,r["text-size"]),this.iconSizeData=Ld(this.zoom,r["icon-size"]);const n=this.layers[0].layout,h=n.get("symbol-sort-key"),f=n.get("symbol-z-order");this.canOverlap=eu(n,"text-overlap","text-allow-overlap")!=="never"||eu(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map(g=>o.WritingMode[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new ru(new ia(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new ru(new ia(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new G,this.lineVertexArray=new q,this.symbolInstances=new F,this.textAnchorOffsets=new $}calculateGlyphDependencies(t,r,n,h,f){for(let g=0;g<t.length;g++)if(r[t.charCodeAt(g)]=!0,(n||h)&&f){const _=ul[t.charAt(g)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,n){const h=this.layers[0],f=h.layout,g=f.get("text-font"),_=f.get("text-field"),w=f.get("icon-image"),E=(_.value.kind!=="constant"||_.value.value instanceof ei&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,z=f.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const R=r.iconDependencies,O=r.glyphDependencies,U=r.availableImages,Z=new Ge(this.zoom);for(const{feature:W,id:J,index:nt,sourceLayerIndex:it}of t){const ht=h._featureFilter.needGeometry,ut=us(W,ht);if(!h._featureFilter.filter(Z,ut,n))continue;let yt,Ut;if(ht||(ut.geometry=ks(W)),E){const Ft=h.getValueAndResolveTokens("text-field",ut,n,U),Bt=ei.factory(Ft);Km(Bt)&&(this.hasRTLText=!0),(!this.hasRTLText||jo()==="unavailable"||this.hasRTLText&&Tr.isParsed())&&(yt=zm(Bt,h,ut))}if(C){const Ft=h.getValueAndResolveTokens("icon-image",ut,n,U);Ut=Ft instanceof br?Ft:br.fromString(Ft)}if(!yt&&!Ut)continue;const Xt=this.sortFeaturesByKey?z.evaluate(ut,{},n):void 0;if(this.features.push({id:J,text:yt,icon:Ut,index:nt,sourceLayerIndex:it,geometry:ut.geometry,properties:W.properties,type:Wm[W.type],sortKey:Xt}),Ut&&(R[Ut.name]=!0),yt){const Ft=g.evaluate(ut,{},n).join(","),Bt=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const At of yt.sections)if(At.image)R[At.image.name]=!0;else{const Vt=$n(yt.toString()),zt=At.fontStack||Ft,St=O[zt]=O[zt]||{};this.calculateGlyphDependencies(At.text,St,Bt,this.allowVerticalPlacement,Vt)}}}f.get("symbol-placement")==="line"&&(this.features=function(W){const J={},nt={},it=[];let ht=0;function ut(Ft){it.push(W[Ft]),ht++}function yt(Ft,Bt,At){const Vt=nt[Ft];return delete nt[Ft],nt[Bt]=Vt,it[Vt].geometry[0].pop(),it[Vt].geometry[0]=it[Vt].geometry[0].concat(At[0]),Vt}function Ut(Ft,Bt,At){const Vt=J[Bt];return delete J[Bt],J[Ft]=Vt,it[Vt].geometry[0].shift(),it[Vt].geometry[0]=At[0].concat(it[Vt].geometry[0]),Vt}function Xt(Ft,Bt,At){const Vt=At?Bt[0][Bt[0].length-1]:Bt[0][0];return`${Ft}:${Vt.x}:${Vt.y}`}for(let Ft=0;Ft<W.length;Ft++){const Bt=W[Ft],At=Bt.geometry,Vt=Bt.text?Bt.text.toString():null;if(!Vt){ut(Ft);continue}const zt=Xt(Vt,At),St=Xt(Vt,At,!0);if(zt in nt&&St in J&&nt[zt]!==J[St]){const Qt=Ut(zt,St,At),Ht=yt(zt,St,it[Qt].geometry);delete J[zt],delete nt[St],nt[Xt(Vt,it[Ht].geometry,!0)]=Ht,it[Qt].geometry=null}else zt in nt?yt(zt,St,At):St in J?Ut(zt,St,At):(ut(Ft),J[zt]=ht-1,nt[St]=ht-1)}return it.filter(Ft=>Ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,J)=>W.sortKey-J.sortKey)}update(t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const n=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(r[t.segment+1]),f=t.dist(r[t.segment]);const g={};for(let _=t.segment+1;_<r.length;_++)g[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:h},_<r.length-1&&(h+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)g[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:f},_>0&&(f+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const w=g[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,r,n,h,f,g,_,w,E,C,z,R){const O=t.indexArray,U=t.layoutVertexArray,Z=t.segments.prepareSegment(4*r.length,U,O,this.canOverlap?g.sortKey:void 0),W=this.glyphOffsetArray.length,J=Z.vertexLength,nt=this.allowVerticalPlacement&&_===o.WritingMode.vertical?Math.PI/2:0,it=g.text&&g.text.sections;for(let ht=0;ht<r.length;ht++){const{tl:ut,tr:yt,bl:Ut,br:Xt,tex:Ft,pixelOffsetTL:Bt,pixelOffsetBR:At,minFontScaleX:Vt,minFontScaleY:zt,glyphOffset:St,isSDF:Qt,sectionIndex:Ht}=r[ht],fe=Z.vertexLength,qe=St[1];kh(U,w.x,w.y,ut.x,qe+ut.y,Ft.x,Ft.y,n,Qt,Bt.x,Bt.y,Vt,zt),kh(U,w.x,w.y,yt.x,qe+yt.y,Ft.x+Ft.w,Ft.y,n,Qt,At.x,Bt.y,Vt,zt),kh(U,w.x,w.y,Ut.x,qe+Ut.y,Ft.x,Ft.y+Ft.h,n,Qt,Bt.x,At.y,Vt,zt),kh(U,w.x,w.y,Xt.x,qe+Xt.y,Ft.x+Ft.w,Ft.y+Ft.h,n,Qt,At.x,At.y,Vt,zt),iu(t.dynamicLayoutVertexArray,w,nt),O.emplaceBack(fe,fe+1,fe+2),O.emplaceBack(fe+1,fe+2,fe+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),ht!==r.length-1&&Ht===r[ht+1].sectionIndex||t.programConfigurations.populatePaintArrays(U.length,g,g.index,{},R,it&&it[Ht])}t.placedSymbolArray.emplaceBack(w.x,w.y,W,this.glyphOffsetArray.length-W,J,E,C,w.segment,n?n[0]:0,n?n[1]:0,h[0],h[1],_,0,!1,0,z)}_addCollisionDebugVertex(t,r,n,h,f,g){return r.emplaceBack(0,0),t.emplaceBack(n.x,n.y,h,f,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,r,n,h,f,g,_){const w=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),E=w.vertexLength,C=f.layoutVertexArray,z=f.collisionVertexArray,R=_.anchorX,O=_.anchorY;this._addCollisionDebugVertex(C,z,g,R,O,new N(t,r)),this._addCollisionDebugVertex(C,z,g,R,O,new N(n,r)),this._addCollisionDebugVertex(C,z,g,R,O,new N(n,h)),this._addCollisionDebugVertex(C,z,g,R,O,new N(t,h)),w.vertexLength+=4;const U=f.indexArray;U.emplaceBack(E,E+1),U.emplaceBack(E+1,E+2),U.emplaceBack(E+2,E+3),U.emplaceBack(E+3,E),w.primitiveLength+=4}addDebugCollisionBoxes(t,r,n,h){for(let f=t;f<r;f++){const g=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new su(kt,yd.members,Ne),this.iconCollisionBox=new su(kt,yd.members,Ne);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,n,h,f,g,_,w,E){const C={};for(let z=r;z<n;z++){const R=t.get(z);C.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.textFeatureIndex=R.featureIndex;break}for(let z=h;z<f;z++){const R=t.get(z);C.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalTextFeatureIndex=R.featureIndex;break}for(let z=g;z<_;z++){const R=t.get(z);C.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.iconFeatureIndex=R.featureIndex;break}for(let z=w;z<E;z++){const R=t.get(z);C.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalIconFeatureIndex=R.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const n=t.placedSymbolArray.get(r),h=n.vertexStartIndex+4*n.numGlyphs;for(let f=n.vertexStartIndex;f<h;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),n=Math.cos(t),h=[],f=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const w=this.symbolInstances.get(_);h.push(0|Math.round(r*w.anchorX+n*w.anchorY)),f.push(w.featureIndex)}return g.sort((_,w)=>h[_]-h[w]||f[w]-f[_]),g}addToSortKeyRanges(t,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((h,f,g)=>{h>=0&&g.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rd,Bd;Nt("SymbolBucket",ao,{omit:["layers","collisionBoxArray","features","compareText"]}),ao.MAX_GLYPHS=65535,ao.addDynamicAttributes=iu;var au={get paint(){return Bd=Bd||new _i({"icon-opacity":new ee(gt.paint_symbol["icon-opacity"]),"icon-color":new ee(gt.paint_symbol["icon-color"]),"icon-halo-color":new ee(gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(gt.paint_symbol["icon-halo-blur"]),"icon-translate":new Kt(gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kt(gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(gt.paint_symbol["text-opacity"]),"text-color":new ee(gt.paint_symbol["text-color"],{runtimeType:ki,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ee(gt.paint_symbol["text-halo-color"]),"text-halo-width":new ee(gt.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(gt.paint_symbol["text-halo-blur"]),"text-translate":new Kt(gt.paint_symbol["text-translate"]),"text-translate-anchor":new Kt(gt.paint_symbol["text-translate-anchor"])})},get layout(){return Rd=Rd||new _i({"symbol-placement":new Kt(gt.layout_symbol["symbol-placement"]),"symbol-spacing":new Kt(gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kt(gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kt(gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kt(gt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Kt(gt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Kt(gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kt(gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kt(gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(gt.layout_symbol["icon-size"]),"icon-text-fit":new Kt(gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt(gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(gt.layout_symbol["icon-image"]),"icon-rotate":new ee(gt.layout_symbol["icon-rotate"]),"icon-padding":new ee(gt.layout_symbol["icon-padding"]),"icon-keep-upright":new Kt(gt.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(gt.layout_symbol["icon-offset"]),"icon-anchor":new ee(gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kt(gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kt(gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kt(gt.layout_symbol["text-rotation-alignment"]),"text-field":new ee(gt.layout_symbol["text-field"]),"text-font":new ee(gt.layout_symbol["text-font"]),"text-size":new ee(gt.layout_symbol["text-size"]),"text-max-width":new ee(gt.layout_symbol["text-max-width"]),"text-line-height":new Kt(gt.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(gt.layout_symbol["text-letter-spacing"]),"text-justify":new ee(gt.layout_symbol["text-justify"]),"text-radial-offset":new ee(gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kt(gt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ee(gt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ee(gt.layout_symbol["text-anchor"]),"text-max-angle":new Kt(gt.layout_symbol["text-max-angle"]),"text-writing-mode":new Kt(gt.layout_symbol["text-writing-mode"]),"text-rotate":new ee(gt.layout_symbol["text-rotate"]),"text-padding":new Kt(gt.layout_symbol["text-padding"]),"text-keep-upright":new Kt(gt.layout_symbol["text-keep-upright"]),"text-transform":new ee(gt.layout_symbol["text-transform"]),"text-offset":new ee(gt.layout_symbol["text-offset"]),"text-allow-overlap":new Kt(gt.layout_symbol["text-allow-overlap"]),"text-overlap":new Kt(gt.layout_symbol["text-overlap"]),"text-ignore-placement":new Kt(gt.layout_symbol["text-ignore-placement"]),"text-optional":new Kt(gt.layout_symbol["text-optional"])})}};class Fd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:bs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Nt("FormatSectionOverride",Fd,{omit:["defaultValue"]});class Dh extends Xr{constructor(t){super(t,au)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const n=this.layout.get("text-writing-mode");if(n){const h=[];for(const f of n)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,n,h){const f=this.layout.get(t).evaluate(r,{},n,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||kn(g.value)||!f?f:function(_,w){return w.replace(/{([^{}]+)}/g,(E,C)=>C in _?String(_[C]):"")}(r.properties,f)}createBucket(t){return new ao(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of au.paint.overridableProperties){if(!Dh.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),n=new Fd(r),h=new We(n,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new ja("source",h):new Ve("composite",h,r.value.zoomStops),this.paint._values[t]=new Lr(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Dh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const n=t.get("text-field"),h=au.paint.properties[r];let f=!1;const g=_=>{for(const w of _)if(h.overrides&&h.overrides.hasOverride(w))return void(f=!0)};if(n.value.kind==="constant"&&n.value.value instanceof ei)g(n.value.value.sections);else if(n.value.kind==="source"){const _=E=>{f||(E instanceof $s&&ii(E.value)===Gr?g(E.value.sections):E instanceof Pn?g(E.sections):E.eachChild(_))},w=n.value;w._styleExpression&&_(w._styleExpression.expression)}return f}}let Od;var Ym={get paint(){return Od=Od||new _i({"background-color":new Kt(gt.paint_background["background-color"]),"background-pattern":new Wo(gt.paint_background["background-pattern"]),"background-opacity":new Kt(gt.paint_background["background-opacity"])})}};class Jm extends Xr{constructor(t){super(t,Ym)}}let Ud;var Qm={get paint(){return Ud=Ud||new _i({"raster-opacity":new Kt(gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kt(gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kt(gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kt(gt.paint_raster["raster-brightness-max"]),"raster-saturation":new Kt(gt.paint_raster["raster-saturation"]),"raster-contrast":new Kt(gt.paint_raster["raster-contrast"]),"raster-resampling":new Kt(gt.paint_raster["raster-resampling"]),"raster-fade-duration":new Kt(gt.paint_raster["raster-fade-duration"])})}};class tg extends Xr{constructor(t){super(t,Qm)}}class eg extends Xr{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ig{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const nu=63710088e-1;class Pa{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pa($t(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,n=this.lat*r,h=t.lat*r,f=Math.sin(n)*Math.sin(h)+Math.cos(n)*Math.cos(h)*Math.cos((t.lng-this.lng)*r);return nu*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Pa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Pa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Pa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Nd=2*Math.PI*nu;function Vd(i){return Nd*Math.cos(i*Math.PI/180)}function $d(i){return(180+i)/360}function qd(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Gd(i,t){return i/Vd(t)}function ou(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Lh{constructor(t,r,n=0){this.x=+t,this.y=+r,this.z=+n}static fromLngLat(t,r=0){const n=Pa.convert(t);return new Lh($d(n.lng),qd(n.lat),Gd(r,n.lat))}toLngLat(){return new Pa(360*this.x-180,ou(this.y))}toAltitude(){return this.z*Vd(ou(this.y))}meterInMercatorCoordinateUnits(){return 1/Nd*(t=ou(this.y),1/Math.cos(t*Math.PI/180));var t}}function Zd(i,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class lu{constructor(t,r,n){if(t<0||t>25||n<0||n>=Math.pow(2,t)||r<0||r>=Math.pow(2,t))throw new Error(`x=${r}, y=${n}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=n,this.key=ml(0,t,t,r,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,n){const h=(g=this.y,_=this.z,w=Zd(256*(f=this.x),256*(g=Math.pow(2,_)-g-1),_),E=Zd(256*(f+1),256*(g+1),_),w[0]+","+w[1]+","+E[0]+","+E[1]);var f,g,_,w,E;const C=function(z,R,O){let U,Z="";for(let W=z;W>0;W--)U=1<<W-1,Z+=(R&U?1:0)+(O&U?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new N((t.x*r-this.x)*Ye,(t.y*r-this.y)*Ye)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jd{constructor(t,r){this.wrap=t,this.canonical=r,this.key=ml(t,r.z,r.z,r.x,r.y)}}class Or{constructor(t,r,n,h,f){if(t<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${n}`);this.overscaledZ=t,this.wrap=r,this.canonical=new lu(n,+h,+f),this.key=ml(r,t,n,h,f)}clone(){return new Or(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Or(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Or(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?ml(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):ml(this.wrap*+r,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Or(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,h=2*this.canonical.y;return[new Or(r,this.wrap,r,n,h),new Or(r,this.wrap,r,n+1,h),new Or(r,this.wrap,r,n,h+1),new Or(r,this.wrap,r,n+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Or(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Or(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Lh(t.x-this.wrap,t.y))}}function ml(i,t,r,n,h){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*h+n).toString(36)+r.toString(36)+t.toString(36)}Nt("CanonicalTileID",lu),Nt("OverscaledTileID",Or,{omit:["posMatrix"]});class Xd{constructor(t,r,n){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return void Ce(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const h=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=n||"mapbox";for(let f=0;f<h;f++)this.data[this._idx(-1,f)]=this.data[this._idx(0,f)],this.data[this._idx(h,f)]=this.data[this._idx(h-1,f)],this.data[this._idx(f,-1)]=this.data[this._idx(f,0)],this.data[this._idx(f,h)]=this.data[this._idx(f,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let f=0;f<h;f++)for(let g=0;g<h;g++){const _=this.get(f,g);_>this.max&&(this.max=_),_<this.min&&(this.min=_)}}get(t,r){const n=new Uint8Array(this.data.buffer),h=4*this._idx(t,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(n[h],n[h+1],n[h+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}_unpackMapbox(t,r,n){return(256*t*256+256*r+n)/10-1e4}_unpackTerrarium(t,r,n){return 256*t+r+n/256-32768}getPixels(){return new Fr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,f=r*this.dim+this.dim,g=n*this.dim,_=n*this.dim+this.dim;switch(r){case-1:h=f-1;break;case 1:f=h+1}switch(n){case-1:g=_-1;break;case 1:_=g+1}const w=-r*this.dim,E=-n*this.dim;for(let C=g;C<_;C++)for(let z=h;z<f;z++)this.data[this._idx(z,C)]=t.data[this._idx(z+w,C+E)]}}Nt("DEMData",Xd);class Wd{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const n=t[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Hd{constructor(t,r,n,h,f){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=n,t._y=h,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Kd{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ks(Ye,16,0),this.grid3D=new Ks(Ye,16,0),this.featureIndexArray=new ct,this.promoteId=r}insert(t,r,n,h,f,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,h,f);const w=g?this.grid3D:this.grid;for(let E=0;E<r.length;E++){const C=r[E],z=[1/0,1/0,-1/0,-1/0];for(let R=0;R<C.length;R++){const O=C[R];z[0]=Math.min(z[0],O.x),z[1]=Math.min(z[1],O.y),z[2]=Math.max(z[2],O.x),z[3]=Math.max(z[3],O.y)}z[0]<Ye&&z[1]<Ye&&z[2]>=0&&z[3]>=0&&w.insert(_,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ia.VectorTile(new Kc(this.rawTileData)).layers,this.sourceLayerCoder=new Wd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,n,h){this.loadVTLayers();const f=t.params||{},g=Ye/t.tileSize/t.scale,_=ko(f.filter),w=t.queryGeometry,E=t.queryPadding*g,C=Jd(w),z=this.grid.query(C.minX-E,C.minY-E,C.maxX+E,C.maxY+E),R=Jd(t.cameraQueryGeometry),O=this.grid3D.query(R.minX-E,R.minY-E,R.maxX+E,R.maxY+E,(W,J,nt,it)=>function(ht,ut,yt,Ut,Xt){for(const Bt of ht)if(ut<=Bt.x&&yt<=Bt.y&&Ut>=Bt.x&&Xt>=Bt.y)return!0;const Ft=[new N(ut,yt),new N(ut,Xt),new N(Ut,Xt),new N(Ut,yt)];if(ht.length>2){for(const Bt of Ft)if(Jn(ht,Bt))return!0}for(let Bt=0;Bt<ht.length-1;Bt++)if(Lf(ht[Bt],ht[Bt+1],Ft))return!0;return!1}(t.cameraQueryGeometry,W-E,J-E,nt+E,it+E));for(const W of O)z.push(W);z.sort(rg);const U={};let Z;for(let W=0;W<z.length;W++){const J=z[W];if(J===Z)continue;Z=J;const nt=this.featureIndexArray.get(J);let it=null;this.loadMatchingFeature(U,nt.bucketIndex,nt.sourceLayerIndex,nt.featureIndex,_,f.layers,f.availableImages,r,n,h,(ht,ut,yt)=>(it||(it=ks(ht)),ut.queryIntersectsFeature(w,ht,yt,it,this.z,t.transform,g,t.pixelPosMatrix)))}return U}loadMatchingFeature(t,r,n,h,f,g,_,w,E,C,z){const R=this.bucketLayerIDs[r];if(g&&!function(W,J){for(let nt=0;nt<W.length;nt++)if(J.indexOf(W[nt])>=0)return!0;return!1}(g,R))return;const O=this.sourceLayerCoder.decode(n),U=this.vtLayers[O].feature(h);if(f.needGeometry){const W=us(U,!0);if(!f.filter(new Ge(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!f.filter(new Ge(this.tileID.overscaledZ),U))return;const Z=this.getId(U,O);for(let W=0;W<R.length;W++){const J=R[W];if(g&&g.indexOf(J)<0)continue;const nt=w[J];if(!nt)continue;let it={};Z&&C&&(it=C.getState(nt.sourceLayer||"_geojsonTileLayer",Z));const ht=Pt({},E[J]);ht.paint=Yd(ht.paint,nt.paint,U,it,_),ht.layout=Yd(ht.layout,nt.layout,U,it,_);const ut=!z||z(U,nt,it);if(!ut)continue;const yt=new Hd(U,this.z,this.x,this.y,Z);yt.layer=ht;let Ut=t[J];Ut===void 0&&(Ut=t[J]=[]),Ut.push({featureIndex:h,feature:yt,intersectionZ:ut})}}lookupSymbolFeatures(t,r,n,h,f,g,_,w){const E={};this.loadVTLayers();const C=ko(f);for(const z of t)this.loadMatchingFeature(E,n,h,z,C,g,_,w,r);return E}hasLayer(t){for(const r of this.bucketLayerIDs)for(const n of r)if(t===n)return!0;return!1}getId(t,r){let n=t.id;return this.promoteId&&(n=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function Yd(i,t,r,n,h){return de(i,(f,g)=>{const _=t instanceof Gn?t.get(g):null;return _&&_.evaluate?_.evaluate(r,n,h):_})}function Jd(i){let t=1/0,r=1/0,n=-1/0,h=-1/0;for(const f of i)t=Math.min(t,f.x),r=Math.min(r,f.y),n=Math.max(n,f.x),h=Math.max(h,f.y);return{minX:t,minY:r,maxX:n,maxY:h}}function rg(i,t){return t-i}function Qd(i,t,r,n,h){const f=[];for(let g=0;g<i.length;g++){const _=i[g];let w;for(let E=0;E<_.length-1;E++){let C=_[E],z=_[E+1];C.x<t&&z.x<t||(C.x<t?C=new N(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x<t&&(z=new N(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y<r&&z.y<r||(C.y<r?C=new N(C.x+(r-C.y)/(z.y-C.y)*(z.x-C.x),r)._round():z.y<r&&(z=new N(C.x+(r-C.y)/(z.y-C.y)*(z.x-C.x),r)._round()),C.x>=n&&z.x>=n||(C.x>=n?C=new N(n,C.y+(n-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x>=n&&(z=new N(n,C.y+(n-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y>=h&&z.y>=h||(C.y>=h?C=new N(C.x+(h-C.y)/(z.y-C.y)*(z.x-C.x),h)._round():z.y>=h&&(z=new N(C.x+(h-C.y)/(z.y-C.y)*(z.x-C.x),h)._round()),w&&C.equals(w[w.length-1])||(w=[C],f.push(w)),w.push(z)))))}}return f}Nt("FeatureIndex",Kd,{omit:["rawTileData","sourceLayerCoder"]});class za extends N{constructor(t,r,n,h){super(t,r),this.angle=n,h!==void 0&&(this.segment=h)}clone(){return new za(this.x,this.y,this.angle,this.segment)}}function tp(i,t,r,n,h){if(t.segment===void 0||r===0)return!0;let f=t,g=t.segment+1,_=0;for(;_>-r/2;){if(g--,g<0)return!1;_-=i[g].dist(f),f=i[g]}_+=i[g].dist(i[g+1]),g++;const w=[];let E=0;for(;_<r/2;){const C=i[g],z=i[g+1];if(!z)return!1;let R=i[g-1].angleTo(C)-C.angleTo(z);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:R}),E+=R;_-w[0].distance>n;)E-=w.shift().angleDelta;if(E>h)return!1;g++,_+=C.dist(z)}return!0}function ep(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function ip(i,t,r){return i?.6*t*r:0}function rp(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function sg(i,t,r,n,h,f){const g=ip(r,h,f),_=rp(r,n)*f;let w=0;const E=ep(i)/2;for(let C=0;C<i.length-1;C++){const z=i[C],R=i[C+1],O=z.dist(R);if(w+O>E){const U=(E-w)/O,Z=cr.number(z.x,R.x,U),W=cr.number(z.y,R.y,U),J=new za(Z,W,R.angleTo(z),C);return J._round(),!g||tp(i,J,_,g,t)?J:void 0}w+=O}}function ag(i,t,r,n,h,f,g,_,w){const E=ip(n,f,g),C=rp(n,h),z=C*g,R=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return t-z<t/4&&(t=z+t/4),sp(i,R?t/2*_%t:(C/2+2*f)*g*_%t,t,E,r,z,R,!1,w)}function sp(i,t,r,n,h,f,g,_,w){const E=f/2,C=ep(i);let z=0,R=t-r,O=[];for(let U=0;U<i.length-1;U++){const Z=i[U],W=i[U+1],J=Z.dist(W),nt=W.angleTo(Z);for(;R+r<z+J;){R+=r;const it=(R-z)/J,ht=cr.number(Z.x,W.x,it),ut=cr.number(Z.y,W.y,it);if(ht>=0&&ht<w&&ut>=0&&ut<w&&R-E>=0&&R+E<=C){const yt=new za(ht,ut,nt,U);yt._round(),n&&!tp(i,yt,f,n,h)||O.push(yt)}}z+=J}return _||O.length||g||(O=sp(i,z/2,r,n,h,f,g,!0,w)),O}Nt("Anchor",za);const no=dr;function ap(i,t,r,n){const h=[],f=i.image,g=f.pixelRatio,_=f.paddedRect.w-2*no,w=f.paddedRect.h-2*no,E=i.right-i.left,C=i.bottom-i.top,z=f.stretchX||[[0,_]],R=f.stretchY||[[0,w]],O=(At,Vt)=>At+Vt[1]-Vt[0],U=z.reduce(O,0),Z=R.reduce(O,0),W=_-U,J=w-Z;let nt=0,it=U,ht=0,ut=Z,yt=0,Ut=W,Xt=0,Ft=J;if(f.content&&n){const At=f.content;nt=Rh(z,0,At[0]),ht=Rh(R,0,At[1]),it=Rh(z,At[0],At[2]),ut=Rh(R,At[1],At[3]),yt=At[0]-nt,Xt=At[1]-ht,Ut=At[2]-At[0]-it,Ft=At[3]-At[1]-ut}const Bt=(At,Vt,zt,St)=>{const Qt=Bh(At.stretch-nt,it,E,i.left),Ht=Fh(At.fixed-yt,Ut,At.stretch,U),fe=Bh(Vt.stretch-ht,ut,C,i.top),qe=Fh(Vt.fixed-Xt,Ft,Vt.stretch,Z),Ze=Bh(zt.stretch-nt,it,E,i.left),vi=Fh(zt.fixed-yt,Ut,zt.stretch,U),Er=Bh(St.stretch-ht,ut,C,i.top),tr=Fh(St.fixed-Xt,Ft,St.stretch,Z),pi=new N(Qt,fe),Si=new N(Ze,fe),Bi=new N(Ze,Er),pr=new N(Qt,Er),er=new N(Ht/g,qe/g),fi=new N(vi/g,tr/g),xi=t*Math.PI/180;if(xi){const fr=Math.sin(xi),mr=Math.cos(xi),ti=[mr,-fr,fr,mr];pi._matMult(ti),Si._matMult(ti),pr._matMult(ti),Bi._matMult(ti)}const Zi=At.stretch+At.fixed,ir=Vt.stretch+Vt.fixed;return{tl:pi,tr:Si,bl:pr,br:Bi,tex:{x:f.paddedRect.x+no+Zi,y:f.paddedRect.y+no+ir,w:zt.stretch+zt.fixed-Zi,h:St.stretch+St.fixed-ir},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:fi,minFontScaleX:Ut/g/E,minFontScaleY:Ft/g/C,isSDF:r}};if(n&&(f.stretchX||f.stretchY)){const At=np(z,W,U),Vt=np(R,J,Z);for(let zt=0;zt<At.length-1;zt++){const St=At[zt],Qt=At[zt+1];for(let Ht=0;Ht<Vt.length-1;Ht++)h.push(Bt(St,Vt[Ht],Qt,Vt[Ht+1]))}}else h.push(Bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return h}function Rh(i,t,r){let n=0;for(const h of i)n+=Math.max(t,Math.min(r,h[1]))-Math.max(t,Math.min(r,h[0]));return n}function np(i,t,r){const n=[{fixed:-no,stretch:0}];for(const[h,f]of i){const g=n[n.length-1];n.push({fixed:h-g.stretch,stretch:g.stretch}),n.push({fixed:h-g.stretch,stretch:g.stretch+(f-h)})}return n.push({fixed:t+no,stretch:r}),n}function Bh(i,t,r,n){return i/t*r+n}function Fh(i,t,r,n){return i-t*r/n}class Oh{constructor(t,r,n,h,f,g,_,w,E,C){if(this.boxStartIndex=t.length,E){let z=g.top,R=g.bottom;const O=g.collisionPadding;O&&(z-=O[1],R+=O[3]);let U=R-z;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let z=g.top*_-w[0],R=g.bottom*_+w[2],O=g.left*_-w[3],U=g.right*_+w[1];const Z=g.collisionPadding;if(Z&&(O-=Z[0]*_,z-=Z[1]*_,U+=Z[2]*_,R+=Z[3]*_),C){const W=new N(O,z),J=new N(U,z),nt=new N(O,R),it=new N(U,R),ht=C*Math.PI/180;W._rotate(ht),J._rotate(ht),nt._rotate(ht),it._rotate(ht),O=Math.min(W.x,J.x,nt.x,it.x),U=Math.max(W.x,J.x,nt.x,it.x),z=Math.min(W.y,J.y,nt.y,it.y),R=Math.max(W.y,J.y,nt.y,it.y)}t.emplaceBack(r.x,r.y,O,z,U,R,n,h,f)}this.boxEndIndex=t.length}}class ng{constructor(t=[],r=og){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:n}=this,h=r[t];for(;t>0;){const f=t-1>>1,g=r[f];if(n(h,g)>=0)break;r[t]=g,t=f}r[t]=h}_down(t){const{data:r,compare:n}=this,h=this.length>>1,f=r[t];for(;t<h;){let g=1+(t<<1),_=r[g];const w=g+1;if(w<this.length&&n(r[w],_)<0&&(g=w,_=r[w]),n(_,f)>=0)break;r[t]=_,t=g}r[t]=f}}function og(i,t){return i<t?-1:i>t?1:0}function lg(i,t=1,r=!1){let n=1/0,h=1/0,f=-1/0,g=-1/0;const _=i[0];for(let O=0;O<_.length;O++){const U=_[O];(!O||U.x<n)&&(n=U.x),(!O||U.y<h)&&(h=U.y),(!O||U.x>f)&&(f=U.x),(!O||U.y>g)&&(g=U.y)}const w=Math.min(f-n,g-h);let E=w/2;const C=new ng([],hg);if(w===0)return new N(n,h);for(let O=n;O<f;O+=w)for(let U=h;U<g;U+=w)C.push(new oo(O+E,U+E,E,i));let z=function(O){let U=0,Z=0,W=0;const J=O[0];for(let nt=0,it=J.length,ht=it-1;nt<it;ht=nt++){const ut=J[nt],yt=J[ht],Ut=ut.x*yt.y-yt.x*ut.y;Z+=(ut.x+yt.x)*Ut,W+=(ut.y+yt.y)*Ut,U+=3*Ut}return new oo(Z/U,W/U,0,O)}(i),R=C.length;for(;C.length;){const O=C.pop();(O.d>z.d||!z.d)&&(z=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,R)),O.max-z.d<=t||(E=O.h/2,C.push(new oo(O.p.x-E,O.p.y-E,E,i)),C.push(new oo(O.p.x+E,O.p.y-E,E,i)),C.push(new oo(O.p.x-E,O.p.y+E,E,i)),C.push(new oo(O.p.x+E,O.p.y+E,E,i)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${z.d}`)),z.p}function hg(i,t){return t.max-i.max}function oo(i,t,r,n){this.p=new N(i,t),this.h=r,this.d=function(h,f){let g=!1,_=1/0;for(let w=0;w<f.length;w++){const E=f[w];for(let C=0,z=E.length,R=z-1;C<z;R=C++){const O=E[C],U=E[R];O.y>h.y!=U.y>h.y&&h.x<(U.x-O.x)*(h.y-O.y)/(U.y-O.y)+O.x&&(g=!g),_=Math.min(_,qu(h,O,U))}}return(g?1:-1)*Math.sqrt(_)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var Ri;o.TextAnchorEnum=void 0,(Ri=o.TextAnchorEnum||(o.TextAnchorEnum={}))[Ri.center=1]="center",Ri[Ri.left=2]="left",Ri[Ri.right=3]="right",Ri[Ri.top=4]="top",Ri[Ri.bottom=5]="bottom",Ri[Ri["top-left"]=6]="top-left",Ri[Ri["top-right"]=7]="top-right",Ri[Ri["bottom-left"]=8]="bottom-left",Ri[Ri["bottom-right"]=9]="bottom-right";const ka=7,hu=Number.POSITIVE_INFINITY;function op(i,t){return t[1]!==hu?function(r,n,h){let f=0,g=0;switch(n=Math.abs(n),h=Math.abs(h),r){case"top-right":case"top-left":case"top":g=h-ka;break;case"bottom-right":case"bottom-left":case"bottom":g=-h+ka}switch(r){case"top-right":case"bottom-right":case"right":f=-n;break;case"top-left":case"bottom-left":case"left":f=n}return[f,g]}(i,t[0],t[1]):function(r,n){let h=0,f=0;n<0&&(n=0);const g=n/Math.sqrt(2);switch(r){case"top-right":case"top-left":f=g-ka;break;case"bottom-right":case"bottom-left":f=-g+ka;break;case"bottom":f=-n+ka;break;case"top":f=n-ka}switch(r){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=n;break;case"right":h=-n}return[h,f]}(i,t[0])}function lp(i,t,r){var n;const h=i.layout,f=(n=h.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(t,{},r);if(f){const _=f.values,w=[];for(let E=0;E<_.length;E+=2){const C=w[E]=_[E],z=_[E+1].map(R=>R*yi);C.startsWith("top")?z[1]-=ka:C.startsWith("bottom")&&(z[1]+=ka),w[E+1]=z}return new Di(w)}const g=h.get("text-variable-anchor");if(g){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},r)*yi,hu]:h.get("text-offset").evaluate(t,{},r).map(E=>E*yi);const w=[];for(const E of g)w.push(E,op(E,_));return new Di(w)}return null}function cu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cg(i,t,r,n,h,f,g,_,w,E,C){let z=f.textMaxSize.evaluate(t,{});z===void 0&&(z=g);const R=i.layers[0].layout,O=R.get("icon-offset").evaluate(t,{},C),U=cp(r.horizontal),Z=g/24,W=i.tilePixelRatio*Z,J=i.tilePixelRatio*z/24,nt=i.tilePixelRatio*_,it=i.tilePixelRatio*R.get("symbol-spacing"),ht=R.get("text-padding")*i.tilePixelRatio,ut=function(St,Qt,Ht,fe=1){const qe=St.get("icon-padding").evaluate(Qt,{},Ht),Ze=qe&&qe.values;return[Ze[0]*fe,Ze[1]*fe,Ze[2]*fe,Ze[3]*fe]}(R,t,C,i.tilePixelRatio),yt=R.get("text-max-angle")/180*Math.PI,Ut=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",Xt=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Ft=R.get("symbol-placement"),Bt=it/2,At=R.get("icon-text-fit");let Vt;n&&At!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Vt=Dd(n,r.vertical,At,R.get("icon-text-fit-padding"),O,Z)),U&&(n=Dd(n,U,At,R.get("icon-text-fit-padding"),O,Z)));const zt=(St,Qt)=>{Qt.x<0||Qt.x>=Ye||Qt.y<0||Qt.y>=Ye||function(Ht,fe,qe,Ze,vi,Er,tr,pi,Si,Bi,pr,er,fi,xi,Zi,ir,fr,mr,ti,Fi,be,Sr,Oi,rr,Wr){const ds=Ht.addToLineVertexArray(fe,qe);let ps,sa,Hr,Ur,gr=0,aa=0,yl=0,fp=0,yu=-1,vu=-1;const na={};let mp=hs("");if(Ht.allowVerticalPlacement&&Ze.vertical){const ji=pi.layout.get("text-rotate").evaluate(be,{},rr)+90;Hr=new Oh(Si,fe,Bi,pr,er,Ze.vertical,fi,xi,Zi,ji),tr&&(Ur=new Oh(Si,fe,Bi,pr,er,tr,fr,mr,Zi,ji))}if(vi){const ji=pi.layout.get("icon-rotate").evaluate(be,{}),Nr=pi.layout.get("icon-text-fit")!=="none",an=ap(vi,ji,Oi,Nr),ms=tr?ap(tr,ji,Oi,Nr):void 0;sa=new Oh(Si,fe,Bi,pr,er,vi,fr,mr,!1,ji),gr=4*an.length;const nn=Ht.iconSizeData;let Ls=null;nn.kind==="source"?(Ls=[Ds*pi.layout.get("icon-size").evaluate(be,{})],Ls[0]>Ca&&Ce(`${Ht.layerIds[0]}: Value for "icon-size" is >= ${fl}. Reduce your "icon-size".`)):nn.kind==="composite"&&(Ls=[Ds*Sr.compositeIconSizes[0].evaluate(be,{},rr),Ds*Sr.compositeIconSizes[1].evaluate(be,{},rr)],(Ls[0]>Ca||Ls[1]>Ca)&&Ce(`${Ht.layerIds[0]}: Value for "icon-size" is >= ${fl}. Reduce your "icon-size".`)),Ht.addSymbols(Ht.icon,an,Ls,Fi,ti,be,o.WritingMode.none,fe,ds.lineStartIndex,ds.lineLength,-1,rr),yu=Ht.icon.placedSymbolArray.length-1,ms&&(aa=4*ms.length,Ht.addSymbols(Ht.icon,ms,Ls,Fi,ti,be,o.WritingMode.vertical,fe,ds.lineStartIndex,ds.lineLength,-1,rr),vu=Ht.icon.placedSymbolArray.length-1)}const gp=Object.keys(Ze.horizontal);for(const ji of gp){const Nr=Ze.horizontal[ji];if(!ps){mp=hs(Nr.text);const ms=pi.layout.get("text-rotate").evaluate(be,{},rr);ps=new Oh(Si,fe,Bi,pr,er,Nr,fi,xi,Zi,ms)}const an=Nr.positionedLines.length===1;if(yl+=hp(Ht,fe,Nr,Er,pi,Zi,be,ir,ds,Ze.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,an?gp:[ji],na,yu,Sr,rr),an)break}Ze.vertical&&(fp+=hp(Ht,fe,Ze.vertical,Er,pi,Zi,be,ir,ds,o.WritingMode.vertical,["vertical"],na,vu,Sr,rr));const pg=ps?ps.boxStartIndex:Ht.collisionBoxArray.length,fg=ps?ps.boxEndIndex:Ht.collisionBoxArray.length,mg=Hr?Hr.boxStartIndex:Ht.collisionBoxArray.length,gg=Hr?Hr.boxEndIndex:Ht.collisionBoxArray.length,_g=sa?sa.boxStartIndex:Ht.collisionBoxArray.length,yg=sa?sa.boxEndIndex:Ht.collisionBoxArray.length,vg=Ur?Ur.boxStartIndex:Ht.collisionBoxArray.length,xg=Ur?Ur.boxEndIndex:Ht.collisionBoxArray.length;let fs=-1;const Nh=(ji,Nr)=>ji&&ji.circleDiameter?Math.max(ji.circleDiameter,Nr):Nr;fs=Nh(ps,fs),fs=Nh(Hr,fs),fs=Nh(sa,fs),fs=Nh(Ur,fs);const _p=fs>-1?1:0;_p&&(fs*=Wr/yi),Ht.glyphOffsetArray.length>=ao.MAX_GLYPHS&&Ce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),be.sortKey!==void 0&&Ht.addToSortKeyRanges(Ht.symbolInstances.length,be.sortKey);const bg=lp(pi,be,rr),[wg,Mg]=function(ji,Nr){const an=ji.length,ms=Nr==null?void 0:Nr.values;if((ms==null?void 0:ms.length)>0)for(let nn=0;nn<ms.length;nn+=2){const Ls=ms[nn+1];ji.emplaceBack(o.TextAnchorEnum[ms[nn]],Ls[0],Ls[1])}return[an,ji.length]}(Ht.textAnchorOffsets,bg);Ht.symbolInstances.emplaceBack(fe.x,fe.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical||-1,yu,vu,mp,pg,fg,mg,gg,_g,yg,vg,xg,Bi,yl,fp,gr,aa,_p,0,fi,fs,wg,Mg)}(i,Qt,St,r,n,h,Vt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,W,[ht,ht,ht,ht],Ut,w,nt,ut,Xt,O,t,f,E,C,g)};if(Ft==="line")for(const St of Qd(t.geometry,0,0,Ye,Ye)){const Qt=ag(St,it,yt,r.vertical||U,n,24,J,i.overscaling,Ye);for(const Ht of Qt)U&&ug(i,U.text,Bt,Ht)||zt(St,Ht)}else if(Ft==="line-center"){for(const St of t.geometry)if(St.length>1){const Qt=sg(St,yt,r.vertical||U,n,24,J);Qt&&zt(St,Qt)}}else if(t.type==="Polygon")for(const St of $c(t.geometry,0)){const Qt=lg(St,16);zt(St[0],new za(Qt.x,Qt.y,0))}else if(t.type==="LineString")for(const St of t.geometry)zt(St,new za(St[0].x,St[0].y,0));else if(t.type==="Point")for(const St of t.geometry)for(const Qt of St)zt([Qt],new za(Qt.x,Qt.y,0))}function hp(i,t,r,n,h,f,g,_,w,E,C,z,R,O,U){const Z=function(nt,it,ht,ut,yt,Ut,Xt,Ft){const Bt=ut.layout.get("text-rotate").evaluate(Ut,{})*Math.PI/180,At=[];for(const Vt of it.positionedLines)for(const zt of Vt.positionedGlyphs){if(!zt.rect)continue;const St=zt.rect||{};let Qt=Sd+1,Ht=!0,fe=1,qe=0;const Ze=(yt||Ft)&&zt.vertical,vi=zt.metrics.advance*zt.scale/2;if(Ft&&it.verticalizable&&(qe=Vt.lineOffset/2-(zt.imageName?-(yi-zt.metrics.width*zt.scale)/2:(zt.scale-1)*yi)),zt.imageName){const ti=Xt[zt.imageName];Ht=ti.sdf,fe=ti.pixelRatio,Qt=dr/fe}const Er=yt?[zt.x+vi,zt.y]:[0,0];let tr=yt?[0,0]:[zt.x+vi+ht[0],zt.y+ht[1]-qe],pi=[0,0];Ze&&(pi=tr,tr=[0,0]);const Si=(zt.metrics.left-Qt)*zt.scale-vi+tr[0],Bi=(-zt.metrics.top-Qt)*zt.scale+tr[1],pr=Si+St.w*zt.scale/fe,er=Bi+St.h*zt.scale/fe,fi=new N(Si,Bi),xi=new N(pr,Bi),Zi=new N(Si,er),ir=new N(pr,er);if(Ze){const ti=new N(-vi,vi-dl),Fi=-Math.PI/2,be=yi/2-vi,Sr=new N(5-dl-be,-(zt.imageName?be:0)),Oi=new N(...pi);fi._rotateAround(Fi,ti)._add(Sr)._add(Oi),xi._rotateAround(Fi,ti)._add(Sr)._add(Oi),Zi._rotateAround(Fi,ti)._add(Sr)._add(Oi),ir._rotateAround(Fi,ti)._add(Sr)._add(Oi)}if(Bt){const ti=Math.sin(Bt),Fi=Math.cos(Bt),be=[Fi,-ti,ti,Fi];fi._matMult(be),xi._matMult(be),Zi._matMult(be),ir._matMult(be)}const fr=new N(0,0),mr=new N(0,0);At.push({tl:fi,tr:xi,bl:Zi,br:ir,tex:St,writingMode:it.writingMode,glyphOffset:Er,sectionIndex:zt.sectionIndex,isSDF:Ht,pixelOffsetTL:fr,pixelOffsetBR:mr,minFontScaleX:0,minFontScaleY:0})}return At}(0,r,_,h,f,g,n,i.allowVerticalPlacement),W=i.textSizeData;let J=null;W.kind==="source"?(J=[Ds*h.layout.get("text-size").evaluate(g,{})],J[0]>Ca&&Ce(`${i.layerIds[0]}: Value for "text-size" is >= ${fl}. Reduce your "text-size".`)):W.kind==="composite"&&(J=[Ds*O.compositeTextSizes[0].evaluate(g,{},U),Ds*O.compositeTextSizes[1].evaluate(g,{},U)],(J[0]>Ca||J[1]>Ca)&&Ce(`${i.layerIds[0]}: Value for "text-size" is >= ${fl}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,J,_,f,g,E,t,w.lineStartIndex,w.lineLength,R,U);for(const nt of C)z[nt]=i.text.placedSymbolArray.length-1;return 4*Z.length}function cp(i){for(const t in i)return i[t];return null}function ug(i,t,r,n){const h=i.compareText;if(t in h){const f=h[t];for(let g=f.length-1;g>=0;g--)if(n.dist(f[g])<r)return!0}else h[t]=[];return h[t].push(n),!1}const up=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=n>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=up[15&n];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new uu(_,g,f,t)}constructor(t,r=64,n=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=up.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${n}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=r,n}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return du(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,n,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:_}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,z=w.pop()||0,R=w.pop()||0;if(z-R<=_){for(let W=R;W<=z;W++){const J=g[2*W],nt=g[2*W+1];J>=t&&J<=n&&nt>=r&&nt<=h&&E.push(f[W])}continue}const O=R+z>>1,U=g[2*O],Z=g[2*O+1];U>=t&&U<=n&&Z>=r&&Z<=h&&E.push(f[O]),(C===0?t<=U:r<=Z)&&(w.push(R),w.push(O-1),w.push(1-C)),(C===0?n>=U:h>=Z)&&(w.push(O+1),w.push(z),w.push(1-C))}return E}within(t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:g}=this,_=[0,h.length-1,0],w=[],E=n*n;for(;_.length;){const C=_.pop()||0,z=_.pop()||0,R=_.pop()||0;if(z-R<=g){for(let W=R;W<=z;W++)pp(f[2*W],f[2*W+1],t,r)<=E&&w.push(h[W]);continue}const O=R+z>>1,U=f[2*O],Z=f[2*O+1];pp(U,Z,t,r)<=E&&w.push(h[O]),(C===0?t-n<=U:r-n<=Z)&&(_.push(R),_.push(O-1),_.push(1-C)),(C===0?t+n>=U:r+n>=Z)&&(_.push(O+1),_.push(z),_.push(1-C))}return w}}function du(i,t,r,n,h,f){if(h-n<=r)return;const g=n+h>>1;dp(i,t,g,n,h,f),du(i,t,r,n,g-1,1-f),du(i,t,r,g+1,h,1-f)}function dp(i,t,r,n,h,f){for(;h>n;){if(h-n>600){const E=h-n+1,C=r-n+1,z=Math.log(E),R=.5*Math.exp(2*z/3),O=.5*Math.sqrt(z*R*(E-R)/E)*(C-E/2<0?-1:1);dp(i,t,r,Math.max(n,Math.floor(r-C*R/E+O)),Math.min(h,Math.floor(r+(E-C)*R/E+O)),f)}const g=t[2*r+f];let _=n,w=h;for(gl(i,t,n,r),t[2*h+f]>g&&gl(i,t,n,h);_<w;){for(gl(i,t,_,w),_++,w--;t[2*_+f]<g;)_++;for(;t[2*w+f]>g;)w--}t[2*n+f]===g?gl(i,t,n,w):(w++,gl(i,t,w,h)),w<=r&&(n=w+1),r<=w&&(h=w-1)}}function gl(i,t,r,n){pu(i,r,n),pu(t,2*r,2*n),pu(t,2*r+1,2*n+1)}function pu(i,t,r){const n=i[t];i[t]=i[r],i[r]=n}function pp(i,t,r,n){const h=i-r,f=t-n;return h*h+f*f}var fu;o.PerformanceMarkers=void 0,(fu=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",fu.load="load",fu.fullLoad="fullLoad";let Uh=null,_l=[];const mu=1e3/60,gu="loadTime",_u="fullLoadTime",dg={mark(i){performance.mark(i)},frame(i){const t=i;Uh!=null&&_l.push(t-Uh),Uh=t},clearMetrics(){Uh=null,_l=[],performance.clearMeasures(gu),performance.clearMeasures(_u);for(const i in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(gu,o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure(_u,o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(gu)[0].duration,t=performance.getEntriesByName(_u)[0].duration,r=_l.length,n=1/(_l.reduce((f,g)=>f+g,0)/r/1e3),h=_l.filter(f=>f>mu).reduce((f,g)=>f+(g-mu)/mu,0);return{loadTime:i,fullLoadTime:t,fps:n,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};o.AJAXError=Cr,o.ARRAY_TYPE=Qn,o.Actor=class{constructor(i,t,r){this.receive=n=>{const h=n.data,f=h.id;if(f&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[f];const g=this.cancelCallbacks[f];delete this.cancelCallbacks[f],g&&g()}else mi()||h.mustQueue?(this.tasks[f]=h,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,h)},this.process=()=>{if(!this.taskQueue.length)return;const n=this.taskQueue.shift(),h=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(n,h)},this.target=i,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new ig(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=mi()?i:window}send(i,t,r,n,h=!1){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[f]=r);const g=Yr(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:i,hasCallback:!!r,targetMapId:n,mustQueue:h,sourceMapId:this.mapId,data:Ys(t,g)},g),{cancel:()=>{r&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}processTask(i,t){if(t.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(t.error?r(va(t.error)):r(null,va(t.data)))}else{let r=!1;const n=Yr(this.globalScope)?void 0:[],h=t.hasCallback?(_,w)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?Ys(_):null,data:Ys(w,n)},n)}:_=>{r=!0};let f=null;const g=va(t.data);if(this.parent[t.type])f=this.parent[t.type](t.sourceMapId,g,h);else if(this.parent.getWorkerSource){const _=t.type.split(".");f=this.parent.getWorkerSource(t.sourceMapId,_[0],g.source)[_[1]](g,h)}else h(new Error(`Could not find function ${t.type}`));!r&&f&&f.cancel&&(this.cancelCallbacks[i]=f.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=sl,o.CanonicalTileID=lu,o.CollisionBoxArray=M,o.CollisionCircleLayoutArray=class extends Wn{},o.Color=ae,o.DEMData=Xd,o.DataConstantProperty=Kt,o.DictionaryCoder=Wd,o.EXTENT=Ye,o.ErrorEvent=or,o.EvaluationParameters=Ge,o.Event=$i,o.Evented=Dr,o.FeatureIndex=Kd,o.FillBucket=Zc,o.FillExtrusionBucket=Xc,o.GeoJSONFeature=Hd,o.ImageAtlas=Ad,o.ImagePosition=Jc,o.KDBush=uu,o.LineBucket=Wc,o.LineStripIndexArray=class extends m{},o.LngLat=Pa,o.MercatorCoordinate=Lh,o.ONE_EM=yi,o.OverscaledTileID=Or,o.PerformanceUtils=dg,o.Point=N,o.Pos3dArray=class extends Ma{},o.PosArray=K,o.Properties=_i,o.Protobuf=Kc,o.QuadTriangleArray=class extends Hn{},o.RGBAImage=Fr,o.RasterBoundsArray=class extends jn{},o.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.SegmentVector=re,o.SymbolBucket=ao,o.Transitionable=qn,o.TriangleIndexArray=qt,o.Uniform1f=Ti,o.Uniform1i=class extends Qe{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends Qe{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends Qe{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=Ta,o.UniformColor=di,o.UniformMatrix4f=class extends Qe{constructor(i,t){super(i,t),this.current=Ei}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=jd,o.ValidationError=Lt,o.ZoomHistory=Vn,o.addDynamicAttributes=iu,o.arrayBufferToImage=function(i,t){const r=new Image;r.onload=()=>{t(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Ni})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(n):Ni},o.arrayBufferToImageBitmap=function(i,t){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(n=>{t(null,n)}).catch(n=>{t(new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(i,t,r){if(!i.length)return r(null,[]);let n=i.length;const h=new Array(i.length);let f=null;i.forEach((g,_)=>{t(g,(w,E)=>{w&&(f=w),h[_]=E,--n==0&&r(f,h)})})},o.bezier=Mt,o.browser=xs,o.clamp=Dt,o.clipLine=Qd,o.clone=function(i){var t=new Qn(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},o.clone$1=Se,o.collisionCircleLayout=Pm,o.config=ha,o.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},o.create=function(){var i=new Qn(16);return Qn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.createExpression=_e,o.createFilter=ko,o.createLayout=ni,o.createStyleLayer=function(i){if(i.type==="custom")return new eg(i);switch(i.type){case"background":return new Jm(i);case"circle":return new Ff(i);case"fill":return new rm(i);case"fill-extrusion":return new ym(i);case"heatmap":return new Uf(i);case"hillshade":return new Vf(i);case"line":return new Sm(i);case"raster":return new tg(i);case"symbol":return new Dh(i)}},o.deepEqual=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!i(t[n],r[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(!i(t[n],r[n]))return!1;return!0}return t===r},o.defaultEasing=Tt,o.derefLayers=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=ca(i[r],t[i[r].ref]));return i},o.diffStyles=function(i,t){if(!i)return[{command:Ie.setStyle,args:[t]}];let r=[];try{if(!De(i.version,t.version))return[{command:Ie.setStyle,args:[t]}];De(i.center,t.center)||r.push({command:Ie.setCenter,args:[t.center]}),De(i.zoom,t.zoom)||r.push({command:Ie.setZoom,args:[t.zoom]}),De(i.bearing,t.bearing)||r.push({command:Ie.setBearing,args:[t.bearing]}),De(i.pitch,t.pitch)||r.push({command:Ie.setPitch,args:[t.pitch]}),De(i.sprite,t.sprite)||r.push({command:Ie.setSprite,args:[t.sprite]}),De(i.glyphs,t.glyphs)||r.push({command:Ie.setGlyphs,args:[t.glyphs]}),De(i.transition,t.transition)||r.push({command:Ie.setTransition,args:[t.transition]}),De(i.light,t.light)||r.push({command:Ie.setLight,args:[t.light]});const n={},h=[];(function(g,_,w,E){let C;for(C in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,C)&&(Object.prototype.hasOwnProperty.call(_,C)||Vs(C,w,E));for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(g,C)?De(g[C],_[C])||(g[C].type==="geojson"&&_[C].type==="geojson"&&mn(g,_,C)?w.push({command:Ie.setGeoJSONSourceData,args:[C,_[C].data]}):fn(C,_,w,E)):Ns(C,_,w))})(i.sources,t.sources,h,n);const f=[];i.layers&&i.layers.forEach(g=>{n[g.source]?r.push({command:Ie.removeLayer,args:[g.id]}):f.push(g)}),r=r.concat(h),function(g,_,w){_=_||[];const E=(g=g||[]).map(Fa),C=_.map(Fa),z=g.reduce(ua,{}),R=_.reduce(ua,{}),O=E.slice(),U=Object.create(null);let Z,W,J,nt,it,ht,ut;for(Z=0,W=0;Z<E.length;Z++)J=E[Z],Object.prototype.hasOwnProperty.call(R,J)?W++:(w.push({command:Ie.removeLayer,args:[J]}),O.splice(O.indexOf(J,W),1));for(Z=0,W=0;Z<C.length;Z++)J=C[C.length-1-Z],O[O.length-1-Z]!==J&&(Object.prototype.hasOwnProperty.call(z,J)?(w.push({command:Ie.removeLayer,args:[J]}),O.splice(O.lastIndexOf(J,O.length-W),1)):W++,ht=O[O.length-Z],w.push({command:Ie.addLayer,args:[R[J],ht]}),O.splice(O.length-Z,0,J),U[J]=!0);for(Z=0;Z<C.length;Z++)if(J=C[Z],nt=z[J],it=R[J],!U[J]&&!De(nt,it))if(De(nt.source,it.source)&&De(nt["source-layer"],it["source-layer"])&&De(nt.type,it.type)){for(ut in Xe(nt.layout,it.layout,w,J,null,Ie.setLayoutProperty),Xe(nt.paint,it.paint,w,J,null,Ie.setPaintProperty),De(nt.filter,it.filter)||w.push({command:Ie.setFilter,args:[J,it.filter]}),De(nt.minzoom,it.minzoom)&&De(nt.maxzoom,it.maxzoom)||w.push({command:Ie.setLayerZoomRange,args:[J,it.minzoom,it.maxzoom]}),nt)Object.prototype.hasOwnProperty.call(nt,ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&(ut.indexOf("paint.")===0?Xe(nt[ut],it[ut],w,J,ut.slice(6),Ie.setPaintProperty):De(nt[ut],it[ut])||w.push({command:Ie.setLayerProperty,args:[J,ut,it[ut]]}));for(ut in it)Object.prototype.hasOwnProperty.call(it,ut)&&!Object.prototype.hasOwnProperty.call(nt,ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&(ut.indexOf("paint.")===0?Xe(nt[ut],it[ut],w,J,ut.slice(6),Ie.setPaintProperty):De(nt[ut],it[ut])||w.push({command:Ie.setLayerProperty,args:[J,ut,it[ut]]}))}else w.push({command:Ie.removeLayer,args:[J]}),ht=O[O.lastIndexOf(J)+1],w.push({command:Ie.addLayer,args:[it,ht]})}(f,t.layers,r)}catch(n){console.warn("Unable to compute style diff:",n),r=[{command:Ie.setStyle,args:[t]}]}return r},o.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},o.earthRadius=nu,o.emitValidationErrors=hh,o.emptyStyle=function(){const i={},t=gt.$version;for(const r in gt.$root){const n=gt.$root[r];if(n.required){let h=null;h=r==="version"?t:n.type==="array"?[]:{},h!=null&&(i[r]=h)}}return i},o.equals=function(i,t){var r=i[0],n=i[1],h=i[2],f=i[3],g=i[4],_=i[5],w=i[6],E=i[7],C=i[8],z=i[9],R=i[10],O=i[11],U=i[12],Z=i[13],W=i[14],J=i[15],nt=t[0],it=t[1],ht=t[2],ut=t[3],yt=t[4],Ut=t[5],Xt=t[6],Ft=t[7],Bt=t[8],At=t[9],Vt=t[10],zt=t[11],St=t[12],Qt=t[13],Ht=t[14],fe=t[15];return Math.abs(r-nt)<=Qi*Math.max(1,Math.abs(r),Math.abs(nt))&&Math.abs(n-it)<=Qi*Math.max(1,Math.abs(n),Math.abs(it))&&Math.abs(h-ht)<=Qi*Math.max(1,Math.abs(h),Math.abs(ht))&&Math.abs(f-ut)<=Qi*Math.max(1,Math.abs(f),Math.abs(ut))&&Math.abs(g-yt)<=Qi*Math.max(1,Math.abs(g),Math.abs(yt))&&Math.abs(_-Ut)<=Qi*Math.max(1,Math.abs(_),Math.abs(Ut))&&Math.abs(w-Xt)<=Qi*Math.max(1,Math.abs(w),Math.abs(Xt))&&Math.abs(E-Ft)<=Qi*Math.max(1,Math.abs(E),Math.abs(Ft))&&Math.abs(C-Bt)<=Qi*Math.max(1,Math.abs(C),Math.abs(Bt))&&Math.abs(z-At)<=Qi*Math.max(1,Math.abs(z),Math.abs(At))&&Math.abs(R-Vt)<=Qi*Math.max(1,Math.abs(R),Math.abs(Vt))&&Math.abs(O-zt)<=Qi*Math.max(1,Math.abs(O),Math.abs(zt))&&Math.abs(U-St)<=Qi*Math.max(1,Math.abs(U),Math.abs(St))&&Math.abs(Z-Qt)<=Qi*Math.max(1,Math.abs(Z),Math.abs(Qt))&&Math.abs(W-Ht)<=Qi*Math.max(1,Math.abs(W),Math.abs(Ht))&&Math.abs(J-fe)<=Qi*Math.max(1,Math.abs(J),Math.abs(fe))},o.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:h}){return i.kind==="source"?n/Ds:i.kind==="composite"?cr.number(n/Ds,h/Ds,r):t},o.evaluateSizeForZoom=function(i,t){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:g}=i,_=h?Dt(ur.interpolationFactor(h,t,f,g),0,1):0;i.kind==="camera"?n=cr.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:n}},o.evented=Zo,o.extend=Pt,o.filterObject=ve,o.findLineIntersection=function(i,t,r,n){const h=t.y-i.y,f=t.x-i.x,g=n.y-r.y,_=n.x-r.x,w=g*f-_*h;if(w===0)return null;const E=(_*(i.y-r.y)-g*(i.x-r.x))/w;return new N(i.x+E*f,i.y+E*h)},o.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.getAnchorAlignment=tu,o.getAnchorJustification=cu,o.getArrayBuffer=Qr,o.getDefaultExportFromCjs=L,o.getJSON=function(i,t){return Pr(Pt(i,{type:"json"}),t)},o.getOverlapMode=eu,o.getProtocolAction=Vi,o.getRTLTextPluginStatus=jo,o.getReferrer=Ai,o.getVideo=function(i,t){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let n=0;n<i.length;n++){const h=window.document.createElement("source");zr(i[n])||(r.crossOrigin="Anonymous"),h.src=i[n],r.appendChild(h)}return{cancel:()=>{}}},o.groupByLayout=function(i,t){const r={};for(let h=0;h<i.length;h++){const f=t&&t[i[h].id]||Ic(i[h]);t&&(t[i[h].id]=f);let g=r[f];g||(g=r[f]=[]),g.push(i[h])}const n=[];for(const h in r)n.push(r[h]);return n},o.identity=Rc,o.interpolate=cr,o.invert=function(i,t){var r=t[0],n=t[1],h=t[2],f=t[3],g=t[4],_=t[5],w=t[6],E=t[7],C=t[8],z=t[9],R=t[10],O=t[11],U=t[12],Z=t[13],W=t[14],J=t[15],nt=r*_-n*g,it=r*w-h*g,ht=r*E-f*g,ut=n*w-h*_,yt=n*E-f*_,Ut=h*E-f*w,Xt=C*Z-z*U,Ft=C*W-R*U,Bt=C*J-O*U,At=z*W-R*Z,Vt=z*J-O*Z,zt=R*J-O*W,St=nt*zt-it*Vt+ht*At+ut*Bt-yt*Ft+Ut*Xt;return St?(i[0]=(_*zt-w*Vt+E*At)*(St=1/St),i[1]=(h*Vt-n*zt-f*At)*St,i[2]=(Z*Ut-W*yt+J*ut)*St,i[3]=(R*yt-z*Ut-O*ut)*St,i[4]=(w*Bt-g*zt-E*Ft)*St,i[5]=(r*zt-h*Bt+f*Ft)*St,i[6]=(W*ht-U*Ut-J*it)*St,i[7]=(C*Ut-R*ht+O*it)*St,i[8]=(g*Vt-_*Bt+E*Xt)*St,i[9]=(n*Bt-r*Vt-f*Xt)*St,i[10]=(U*yt-Z*ht+J*nt)*St,i[11]=(z*ht-C*yt-O*nt)*St,i[12]=(_*Ft-g*At-w*Xt)*St,i[13]=(r*At-n*Ft+h*Xt)*St,i[14]=(Z*it-U*ut-W*nt)*St,i[15]=(C*ut-z*it+R*nt)*St,i):null},o.isImageBitmap=Ui,o.isSafari=Yr,o.isWorker=mi,o.keysDifference=function(i,t){const r=[];for(const n in i)n in t||r.push(n);return r},o.lazyLoadRTLTextPlugin=function(){Tr.isLoading()||Tr.isLoaded()||jo()!=="deferred"||fh()},o.makeRequest=Pr,o.mapObject=de,o.mercatorXfromLng=$d,o.mercatorYfromLat=qd,o.mercatorZfromAltitude=Gd,o.mul=Bf,o.mul$1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},o.multiply=Xu,o.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.operations=Ie,o.ortho=function(i,t,r,n,h,f,g){var _=1/(t-r),w=1/(n-h),E=1/(f-g);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(t+r)*_,i[13]=(h+n)*w,i[14]=(g+f)*E,i[15]=1,i},o.parseCacheControl=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,h,f)=>{const g=h||f;return t[n]=!g||g.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},o.parseGlyphPbf=function(i){return new Kc(i).readFields(Vm,[])},o.pbf=vd,o.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Ye/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,n=t._unevaluatedLayout._values,h={layoutIconSize:n["icon-size"].possiblyEvaluate(new Ge(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Ge(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Ge(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=i.bucket.textSizeData;h.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Ge(E),i.canonical),n["text-size"].possiblyEvaluate(new Ge(C),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=i.bucket.iconSizeData;h.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Ge(E),i.canonical),n["icon-size"].possiblyEvaluate(new Ge(C),i.canonical)]}const f=r.get("text-line-height")*yi,g=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),w=r.get("text-size");for(const E of i.bucket.features){const C=r.get("text-font").evaluate(E,{},i.canonical).join(","),z=w.evaluate(E,{},i.canonical),R=h.layoutTextSize.evaluate(E,{},i.canonical),O=h.layoutIconSize.evaluate(E,{},i.canonical),U={horizontal:{},vertical:void 0},Z=E.text;let W,J=[0,0];if(Z){const ht=Z.toString(),ut=r.get("text-letter-spacing").evaluate(E,{},i.canonical)*yi,yt=Cc(ht)?ut:0,Ut=r.get("text-anchor").evaluate(E,{},i.canonical),Xt=lp(t,E,i.canonical);if(!Xt){const zt=r.get("text-radial-offset").evaluate(E,{},i.canonical);J=zt?op(Ut,[zt*yi,hu]):r.get("text-offset").evaluate(E,{},i.canonical).map(St=>St*yi)}let Ft=g?"center":r.get("text-justify").evaluate(E,{},i.canonical);const Bt=r.get("symbol-placement"),At=Bt==="point"?r.get("text-max-width").evaluate(E,{},i.canonical)*yi:0,Vt=()=>{i.bucket.allowVerticalPlacement&&$n(ht)&&(U.vertical=Ph(Z,i.glyphMap,i.glyphPositions,i.imagePositions,C,At,f,Ut,"left",yt,J,o.WritingMode.vertical,!0,Bt,R,z))};if(!g&&Xt){const zt=new Set;if(Ft==="auto")for(let Qt=0;Qt<Xt.values.length;Qt+=2)zt.add(cu(Xt.values[Qt]));else zt.add(Ft);let St=!1;for(const Qt of zt)if(!U.horizontal[Qt])if(St)U.horizontal[Qt]=U.horizontal[0];else{const Ht=Ph(Z,i.glyphMap,i.glyphPositions,i.imagePositions,C,At,f,"center",Qt,yt,J,o.WritingMode.horizontal,!1,Bt,R,z);Ht&&(U.horizontal[Qt]=Ht,St=Ht.positionedLines.length===1)}Vt()}else{Ft==="auto"&&(Ft=cu(Ut));const zt=Ph(Z,i.glyphMap,i.glyphPositions,i.imagePositions,C,At,f,Ut,Ft,yt,J,o.WritingMode.horizontal,!1,Bt,R,z);zt&&(U.horizontal[Ft]=zt),Vt(),$n(ht)&&g&&_&&(U.vertical=Ph(Z,i.glyphMap,i.glyphPositions,i.imagePositions,C,At,f,Ut,Ft,yt,J,o.WritingMode.vertical,!1,Bt,R,z))}}let nt=!1;if(E.icon&&E.icon.name){const ht=i.imageMap[E.icon.name];ht&&(W=Xm(i.imagePositions[E.icon.name],r.get("icon-offset").evaluate(E,{},i.canonical),r.get("icon-anchor").evaluate(E,{},i.canonical)),nt=!!ht.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=nt:i.bucket.sdfIcons!==nt&&Ce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ht.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const it=cp(U.horizontal)||U.vertical;i.bucket.iconsInText=!!it&&it.iconsInText,(it||W)&&cg(i.bucket,E,U,W,i.imageMap,h,R,O,J,nt,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.perspective=function(i,t,r,n,h){var f,g=1/Math.tan(t/2);return i[0]=g/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+n)*(f=1/(n-h)),i[14]=2*h*n*f):(i[10]=-1,i[14]=-2*n),i},o.pick=function(i,t){const r={};for(let n=0;n<t.length;n++){const h=t[n];h in i&&(r[h]=i[h])}return r},o.plugin=Tr,o.pointGeometry=k,o.polygonIntersectsPolygon=Vu,o.potpack=Id,o.register=Nt,o.registerForPluginStateChange=function(i){return i({pluginStatus:Ki,pluginURL:ns}),Zo.on("pluginStateChange",i),i},o.renderColorRamp=Ju,o.rotateX=function(i,t,r){var n=Math.sin(r),h=Math.cos(r),f=t[4],g=t[5],_=t[6],w=t[7],E=t[8],C=t[9],z=t[10],R=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*h+E*n,i[5]=g*h+C*n,i[6]=_*h+z*n,i[7]=w*h+R*n,i[8]=E*h-f*n,i[9]=C*h-g*n,i[10]=z*h-_*n,i[11]=R*h-w*n,i},o.rotateZ=function(i,t,r){var n=Math.sin(r),h=Math.cos(r),f=t[0],g=t[1],_=t[2],w=t[3],E=t[4],C=t[5],z=t[6],R=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*h+E*n,i[1]=g*h+C*n,i[2]=_*h+z*n,i[3]=w*h+R*n,i[4]=E*h-f*n,i[5]=C*h-g*n,i[6]=z*h-_*n,i[7]=R*h-w*n,i},o.sameOrigin=zr,o.scale=function(i,t,r){var n=r[0],h=r[1],f=r[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*h,i[5]=t[5]*h,i[6]=t[6]*h,i[7]=t[7]*h,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},o.setRTLTextPlugin=function(i,t,r=!1){if(Ki===en||Ki===Vo||Ki===$o)throw new Error("setRTLTextPlugin cannot be called multiple times.");ns=xs.resolveURL(i),Ki=en,qo=t,Go(),r||fh()},o.sphericalToCartesian=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},o.toEvaluationFeature=us,o.transformMat4=Mh,o.translate=function(i,t,r){var n,h,f,g,_,w,E,C,z,R,O,U,Z=r[0],W=r[1],J=r[2];return t===i?(i[12]=t[0]*Z+t[4]*W+t[8]*J+t[12],i[13]=t[1]*Z+t[5]*W+t[9]*J+t[13],i[14]=t[2]*Z+t[6]*W+t[10]*J+t[14],i[15]=t[3]*Z+t[7]*W+t[11]*J+t[15]):(h=t[1],f=t[2],g=t[3],_=t[4],w=t[5],E=t[6],C=t[7],z=t[8],R=t[9],O=t[10],U=t[11],i[0]=n=t[0],i[1]=h,i[2]=f,i[3]=g,i[4]=_,i[5]=w,i[6]=E,i[7]=C,i[8]=z,i[9]=R,i[10]=O,i[11]=U,i[12]=n*Z+_*W+z*J+t[12],i[13]=h*Z+w*W+R*J+t[13],i[14]=f*Z+E*W+O*J+t[14],i[15]=g*Z+C*W+U*J+t[15]),i},o.triggerPluginCompletionEvent=ph,o.unicodeBlockLookup=Ot,o.uniqueId=function(){return Wt++},o.v8Spec=gt,o.validateCustomStyleLayer=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},o.validateLight=tn,o.validateStyle=Qa,o.vectorTile=Ia,o.warnOnce=Ce,o.wrap=$t}),T(["./shared"],function(o){class L{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,B){for(const H of D){this._layerConfigs[H.id]=H;const Q=this._layers[H.id]=o.createStyleLayer(H);Q._featureFilter=o.createFilter(Q.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of B)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const V=o.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const H of V){const Q=H.map(bt=>this._layers[bt.id]),at=Q[0];if(at.visibility==="none")continue;const et=at.source||"";let tt=this.familiesBySource[et];tt||(tt=this.familiesBySource[et]={});const lt=at.sourceLayer||"_geojsonTileLayer";let vt=tt[lt];vt||(vt=tt[lt]=[]),vt.push(Q)}}}class k{constructor(D){const B={},V=[];for(const et in D){const tt=D[et],lt=B[et]={};for(const vt in tt){const bt=tt[+vt];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const wt={x:0,y:0,w:bt.bitmap.width+2,h:bt.bitmap.height+2};V.push(wt),lt[vt]={rect:wt,metrics:bt.metrics}}}const{w:H,h:Q}=o.potpack(V),at=new o.AlphaImage({width:H||1,height:Q||1});for(const et in D){const tt=D[et];for(const lt in tt){const vt=tt[+lt];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const bt=B[et][lt].rect;o.AlphaImage.copy(vt.bitmap,at,{x:0,y:0},{x:bt.x+1,y:bt.y+1},vt.bitmap)}}this.image=at,this.positions=B}}o.register("GlyphAtlas",k);class Y{constructor(D){this.tileID=new o.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(D,B,V,H,Q){this.status="parsing",this.data=D,this.collisionBoxArray=new o.CollisionBoxArray;const at=new o.DictionaryCoder(Object.keys(D.layers).sort()),et=new o.FeatureIndex(this.tileID,this.promoteId);et.bucketLayerIDs=[];const tt={},lt={featureIndex:et,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},vt=B.familiesBySource[this.source];for(const ge in vt){const we=D.layers[ge];if(!we)continue;we.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Hi=at.encode(ge),ae=[];for(let ui=0;ui<we.length;ui++){const Pi=we.feature(ui),ei=et.getId(Pi,ge);ae.push({feature:Pi,id:ei,index:ui,sourceLayerIndex:Hi})}for(const ui of vt[ge]){const Pi=ui[0];Pi.source!==this.source&&o.warnOnce(`layer.source = ${Pi.source} does not equal this.source = ${this.source}`),Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(N(ui,this.zoom,V),(tt[Pi.id]=Pi.createBucket({index:et.bucketLayerIDs.length,layers:ui,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Hi,sourceID:this.source})).populate(ae,lt,this.tileID.canonical),et.bucketLayerIDs.push(ui.map(ei=>ei.id)))}}let bt,wt,te,le;const Zt=o.mapObject(lt.glyphDependencies,ge=>Object.keys(ge).map(Number));this.inFlightDependencies.forEach(ge=>ge==null?void 0:ge.cancel()),this.inFlightDependencies=[];const Jt=++this.dependencySentinel;Object.keys(Zt).length?this.inFlightDependencies.push(H.send("getGlyphs",{uid:this.uid,stacks:Zt,source:this.source,tileID:this.tileID,type:"glyphs"},(ge,we)=>{Jt===this.dependencySentinel&&(bt||(bt=ge,wt=we,Le.call(this)))})):wt={};const ne=Object.keys(lt.iconDependencies);ne.length?this.inFlightDependencies.push(H.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(ge,we)=>{Jt===this.dependencySentinel&&(bt||(bt=ge,te=we,Le.call(this)))})):te={};const Me=Object.keys(lt.patternDependencies);function Le(){if(bt)return Q(bt);if(wt&&te&&le){const ge=new k(wt),we=new o.ImageAtlas(te,le);for(const Hi in tt){const ae=tt[Hi];ae instanceof o.SymbolBucket?(N(ae.layers,this.zoom,V),o.performSymbolLayout({bucket:ae,glyphMap:wt,glyphPositions:ge.positions,imageMap:te,imagePositions:we.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ae.hasPattern&&(ae instanceof o.LineBucket||ae instanceof o.FillBucket||ae instanceof o.FillExtrusionBucket)&&(N(ae.layers,this.zoom,V),ae.addFeatures(lt,this.tileID.canonical,we.patternPositions))}this.status="done",Q(null,{buckets:Object.values(tt).filter(Hi=>!Hi.isEmpty()),featureIndex:et,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,imageAtlas:we,glyphMap:this.returnDependencies?wt:null,iconMap:this.returnDependencies?te:null,glyphPositions:this.returnDependencies?ge.positions:null})}}Me.length?this.inFlightDependencies.push(H.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"patterns"},(ge,we)=>{Jt===this.dependencySentinel&&(bt||(bt=ge,le=we,Le.call(this)))})):le={},Le.call(this)}}function N(X,D,B){const V=new o.EvaluationParameters(D);for(const H of X)H.recalculate(V,B)}function ot(X,D){const B=o.getArrayBuffer(X.request,(V,H,Q,at)=>{V?D(V):H&&D(null,{vectorTile:new o.vectorTile.VectorTile(new o.Protobuf(H)),rawData:H,cacheControl:Q,expires:at})});return()=>{B.cancel(),D()}}class mt{constructor(D,B,V,H){this.actor=D,this.layerIndex=B,this.availableImages=V,this.loadVectorData=H||ot,this.fetching={},this.loading={},this.loaded={}}loadTile(D,B){const V=D.uid;this.loading||(this.loading={});const H=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request),Q=this.loading[V]=new Y(D);Q.abort=this.loadVectorData(D,(at,et)=>{if(delete this.loading[V],at||!et)return Q.status="done",this.loaded[V]=Q,B(at);const tt=et.rawData,lt={};et.expires&&(lt.expires=et.expires),et.cacheControl&&(lt.cacheControl=et.cacheControl);const vt={};if(H){const bt=H.finish();bt&&(vt.resourceTiming=JSON.parse(JSON.stringify(bt)))}Q.vectorTile=et.vectorTile,Q.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,(bt,wt)=>{if(delete this.fetching[V],bt||!wt)return B(bt);B(null,o.extend({rawTileData:tt.slice(0)},wt,lt,vt))}),this.loaded=this.loaded||{},this.loaded[V]=Q,this.fetching[V]={rawTileData:tt,cacheControl:lt,resourceTiming:vt}})}reloadTile(D,B){const V=this.loaded,H=D.uid;if(V&&V[H]){const Q=V[H];Q.showCollisionBoxes=D.showCollisionBoxes,Q.status==="parsing"?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,(at,et)=>{if(at||!et)return B(at,et);let tt;if(this.fetching[H]){const{rawTileData:lt,cacheControl:vt,resourceTiming:bt}=this.fetching[H];delete this.fetching[H],tt=o.extend({rawTileData:lt.slice(0)},et,vt,bt)}else tt=et;B(null,tt)}):Q.status==="done"&&(Q.vectorTile?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,B):B())}}abortTile(D,B){const V=this.loading,H=D.uid;V&&V[H]&&V[H].abort&&(V[H].abort(),delete V[H]),B()}removeTile(D,B){const V=this.loaded,H=D.uid;V&&V[H]&&delete V[H],B()}}class ft{constructor(){this.loaded={}}loadTile(D,B){const{uid:V,encoding:H,rawImageData:Q}=D,at=o.isImageBitmap(Q)?this.getImageData(Q):Q,et=new o.DEMData(V,at,H);this.loaded=this.loaded||{},this.loaded[V]=et,B(null,et)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(D){const B=this.loaded,V=D.uid;B&&B[V]&&delete B[V]}}function Mt(X,D){if(X.length!==0){Tt(X[0],D);for(var B=1;B<X.length;B++)Tt(X[B],!D)}}function Tt(X,D){for(var B=0,V=0,H=0,Q=X.length,at=Q-1;H<Q;at=H++){var et=(X[H][0]-X[at][0])*(X[at][1]+X[H][1]),tt=B+et;V+=Math.abs(B)>=Math.abs(et)?B-tt+et:et-tt+B,B=tt}B+V>=0!=!!D&&X.reverse()}var Dt=o.getDefaultExportFromCjs(function X(D,B){var V,H=D&&D.type;if(H==="FeatureCollection")for(V=0;V<D.features.length;V++)X(D.features[V],B);else if(H==="GeometryCollection")for(V=0;V<D.geometries.length;V++)X(D.geometries[V],B);else if(H==="Feature")X(D.geometry,B);else if(H==="Polygon")Mt(D.coordinates,B);else if(H==="MultiPolygon")for(V=0;V<D.coordinates.length;V++)Mt(D.coordinates[V],B);return D});const $t=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var Pt={exports:{}},Wt=o.pointGeometry,de=o.vectorTile.VectorTileFeature,ve=Se;function Se(X,D){this.options=D||{},this.features=X,this.length=X.length}function xe(X,D){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=D||4096}Se.prototype.feature=function(X){return new xe(this.features[X],this.options.extent)},xe.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var D=0;D<X.length;D++){for(var B=X[D],V=[],H=0;H<B.length;H++)V.push(new Wt(B[H][0],B[H][1]));this.geometry.push(V)}return this.geometry},xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,D=1/0,B=-1/0,V=1/0,H=-1/0,Q=0;Q<X.length;Q++)for(var at=X[Q],et=0;et<at.length;et++){var tt=at[et];D=Math.min(D,tt.x),B=Math.max(B,tt.x),V=Math.min(V,tt.y),H=Math.max(H,tt.y)}return[D,V,B,H]},xe.prototype.toGeoJSON=de.prototype.toGeoJSON;var Ce=o.pbf,oe=ve;function zi(X){var D=new Ce;return function(B,V){for(var H in B.layers)V.writeMessage(3,mi,B.layers[H])}(X,D),D.finish()}function mi(X,D){var B;D.writeVarintField(15,X.version||1),D.writeStringField(1,X.name||""),D.writeVarintField(5,X.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<X.length;B++)V.feature=X.feature(B),D.writeMessage(2,nr,V);var H=V.keys;for(B=0;B<H.length;B++)D.writeStringField(3,H[B]);var Q=V.values;for(B=0;B<Q.length;B++)D.writeMessage(4,gi,Q[B])}function nr(X,D){var B=X.feature;B.id!==void 0&&D.writeVarintField(1,B.id),D.writeMessage(2,Yr,X),D.writeVarintField(3,B.type),D.writeMessage(4,Jr,B)}function Yr(X,D){var B=X.feature,V=X.keys,H=X.values,Q=X.keycache,at=X.valuecache;for(var et in B.properties){var tt=B.properties[et],lt=Q[et];if(tt!==null){lt===void 0&&(V.push(et),Q[et]=lt=V.length-1),D.writeVarint(lt);var vt=typeof tt;vt!=="string"&&vt!=="boolean"&&vt!=="number"&&(tt=JSON.stringify(tt));var bt=vt+":"+tt,wt=at[bt];wt===void 0&&(H.push(tt),at[bt]=wt=H.length-1),D.writeVarint(wt)}}}function Ui(X,D){return(D<<3)+(7&X)}function Ni(X){return X<<1^X>>31}function Jr(X,D){for(var B=X.loadGeometry(),V=X.type,H=0,Q=0,at=B.length,et=0;et<at;et++){var tt=B[et],lt=1;V===1&&(lt=tt.length),D.writeVarint(Ui(1,lt));for(var vt=V===3?tt.length-1:tt.length,bt=0;bt<vt;bt++){bt===1&&V!==1&&D.writeVarint(Ui(2,vt-1));var wt=tt[bt].x-H,te=tt[bt].y-Q;D.writeVarint(Ni(wt)),D.writeVarint(Ni(te)),H+=wt,Q+=te}V===3&&D.writeVarint(Ui(7,1))}}function gi(X,D){var B=typeof X;B==="string"?D.writeStringField(1,X):B==="boolean"?D.writeBooleanField(7,X):B==="number"&&(X%1!=0?D.writeDoubleField(3,X):X<0?D.writeSVarintField(6,X):D.writeVarintField(5,X))}Pt.exports=zi,Pt.exports.fromVectorTileJs=zi,Pt.exports.fromGeojsonVt=function(X,D){D=D||{};var B={};for(var V in X)B[V]=new oe(X[V].features,D),B[V].name=V,B[V].version=D.version,B[V].extent=D.extent;return zi({layers:B})},Pt.exports.GeoJSONWrapper=oe;var xs=o.getDefaultExportFromCjs(Pt.exports);const ha={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},Cr=Math.fround||(Ai=new Float32Array(1),X=>(Ai[0]=+X,Ai[0]));var Ai;const Vi=3,ke=5,Pr=6;class Qr{constructor(D){this.options=Object.assign(Object.create(ha),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:B,minZoom:V,maxZoom:H}=this.options;B&&console.time("total time");const Q=`prepare ${D.length} points`;B&&console.time(Q),this.points=D;const at=[];for(let tt=0;tt<D.length;tt++){const lt=D[tt];if(!lt.geometry)continue;const[vt,bt]=lt.geometry.coordinates,wt=Cr(kr(vt)),te=Cr($i(bt));at.push(wt,te,1/0,tt,-1,1),this.options.reduce&&at.push(0)}let et=this.trees[H+1]=this._createTree(at);B&&console.timeEnd(Q);for(let tt=H;tt>=V;tt--){const lt=+Date.now();et=this.trees[tt]=this._createTree(this._cluster(et,tt)),B&&console.log("z%d: %d clusters in %dms",tt,et.numItems,+Date.now()-lt)}return B&&console.timeEnd("total time"),this}getClusters(D,B){let V=((D[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,D[1]));let Q=D[2]===180?180:((D[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)V=-180,Q=180;else if(V>Q){const bt=this.getClusters([V,H,180,at],B),wt=this.getClusters([-180,H,Q,at],B);return bt.concat(wt)}const et=this.trees[this._limitZoom(B)],tt=et.range(kr(V),$i(at),kr(Q),$i(H)),lt=et.data,vt=[];for(const bt of tt){const wt=this.stride*bt;vt.push(lt[wt+ke]>1?zr(lt,wt,this.clusterProps):this.points[lt[wt+Vi]])}return vt}getChildren(D){const B=this._getOriginId(D),V=this._getOriginZoom(D),H="No cluster with the specified id.",Q=this.trees[V];if(!Q)throw new Error(H);const at=Q.data;if(B*this.stride>=at.length)throw new Error(H);const et=this.options.radius/(this.options.extent*Math.pow(2,V-1)),tt=Q.within(at[B*this.stride],at[B*this.stride+1],et),lt=[];for(const vt of tt){const bt=vt*this.stride;at[bt+4]===D&&lt.push(at[bt+ke]>1?zr(at,bt,this.clusterProps):this.points[at[bt+Vi]])}if(lt.length===0)throw new Error(H);return lt}getLeaves(D,B,V){const H=[];return this._appendLeaves(H,D,B=B||10,V=V||0,0),H}getTile(D,B,V){const H=this.trees[this._limitZoom(D)],Q=Math.pow(2,D),{extent:at,radius:et}=this.options,tt=et/at,lt=(V-tt)/Q,vt=(V+1+tt)/Q,bt={features:[]};return this._addTileFeatures(H.range((B-tt)/Q,lt,(B+1+tt)/Q,vt),H.data,B,V,Q,bt),B===0&&this._addTileFeatures(H.range(1-tt/Q,lt,1,vt),H.data,Q,V,Q,bt),B===Q-1&&this._addTileFeatures(H.range(0,lt,tt/Q,vt),H.data,-1,V,Q,bt),bt.features.length?bt:null}getClusterExpansionZoom(D){let B=this._getOriginZoom(D)-1;for(;B<=this.options.maxZoom;){const V=this.getChildren(D);if(B++,V.length!==1)break;D=V[0].properties.cluster_id}return B}_appendLeaves(D,B,V,H,Q){const at=this.getChildren(B);for(const et of at){const tt=et.properties;if(tt&&tt.cluster?Q+tt.point_count<=H?Q+=tt.point_count:Q=this._appendLeaves(D,tt.cluster_id,V,H,Q):Q<H?Q++:D.push(et),D.length===V)break}return Q}_createTree(D){const B=new o.KDBush(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<D.length;V+=this.stride)B.add(D[V],D[V+1]);return B.finish(),B.data=D,B}_addTileFeatures(D,B,V,H,Q,at){for(const et of D){const tt=et*this.stride,lt=B[tt+ke]>1;let vt,bt,wt;if(lt)vt=ts(B,tt,this.clusterProps),bt=B[tt],wt=B[tt+1];else{const Zt=this.points[B[tt+Vi]];vt=Zt.properties;const[Jt,ne]=Zt.geometry.coordinates;bt=kr(Jt),wt=$i(ne)}const te={type:1,geometry:[[Math.round(this.options.extent*(bt*Q-V)),Math.round(this.options.extent*(wt*Q-H))]],tags:vt};let le;le=lt||this.options.generateId?B[tt+Vi]:this.points[B[tt+Vi]].id,le!==void 0&&(te.id=le),at.features.push(te)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,B){const{radius:V,extent:H,reduce:Q,minPoints:at}=this.options,et=V/(H*Math.pow(2,B)),tt=D.data,lt=[],vt=this.stride;for(let bt=0;bt<tt.length;bt+=vt){if(tt[bt+2]<=B)continue;tt[bt+2]=B;const wt=tt[bt],te=tt[bt+1],le=D.within(tt[bt],tt[bt+1],et),Zt=tt[bt+ke];let Jt=Zt;for(const ne of le){const Me=ne*vt;tt[Me+2]>B&&(Jt+=tt[Me+ke])}if(Jt>Zt&&Jt>=at){let ne,Me=wt*Zt,Le=te*Zt,ge=-1;const we=((bt/vt|0)<<5)+(B+1)+this.points.length;for(const Hi of le){const ae=Hi*vt;if(tt[ae+2]<=B)continue;tt[ae+2]=B;const ui=tt[ae+ke];Me+=tt[ae]*ui,Le+=tt[ae+1]*ui,tt[ae+4]=we,Q&&(ne||(ne=this._map(tt,bt,!0),ge=this.clusterProps.length,this.clusterProps.push(ne)),Q(ne,this._map(tt,ae)))}tt[bt+4]=we,lt.push(Me/Jt,Le/Jt,1/0,we,-1,Jt),Q&&lt.push(ge)}else{for(let ne=0;ne<vt;ne++)lt.push(tt[bt+ne]);if(Jt>1)for(const ne of le){const Me=ne*vt;if(!(tt[Me+2]<=B)){tt[Me+2]=B;for(let Le=0;Le<vt;Le++)lt.push(tt[Me+Le])}}}}return lt}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,B,V){if(D[B+ke]>1){const at=this.clusterProps[D[B+Pr]];return V?Object.assign({},at):at}const H=this.points[D[B+Vi]].properties,Q=this.options.map(H);return V&&Q===H?Object.assign({},Q):Q}}function zr(X,D,B){return{type:"Feature",id:X[D+Vi],properties:ts(X,D,B),geometry:{type:"Point",coordinates:[(V=X[D],360*(V-.5)),or(X[D+1])]}};var V}function ts(X,D,B){const V=X[D+ke],H=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,Q=X[D+Pr],at=Q===-1?{}:Object.assign({},B[Q]);return Object.assign(at,{cluster:!0,cluster_id:X[D+Vi],point_count:V,point_count_abbreviated:H})}function kr(X){return X/360+.5}function $i(X){const D=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function or(X){const D=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Dr(X,D,B,V){for(var H,Q=V,at=B-D>>1,et=B-D,tt=X[D],lt=X[D+1],vt=X[B],bt=X[B+1],wt=D+3;wt<B;wt+=3){var te=gt(X[wt],X[wt+1],tt,lt,vt,bt);if(te>Q)H=wt,Q=te;else if(te===Q){var le=Math.abs(wt-at);le<et&&(H=wt,et=le)}}Q>V&&(H-D>3&&Dr(X,D,H,V),X[H+2]=Q,B-H>3&&Dr(X,H,B,V))}function gt(X,D,B,V,H,Q){var at=H-B,et=Q-V;if(at!==0||et!==0){var tt=((X-B)*at+(D-V)*et)/(at*at+et*et);tt>1?(B=H,V=Q):tt>0&&(B+=at*tt,V+=et*tt)}return(at=X-B)*at+(et=D-V)*et}function es(X,D,B,V){var H={id:X===void 0?null:X,type:D,geometry:B,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var at=Q.geometry,et=Q.type;if(et==="Point"||et==="MultiPoint"||et==="LineString")ca(Q,at);else if(et==="Polygon"||et==="MultiLineString")for(var tt=0;tt<at.length;tt++)ca(Q,at[tt]);else if(et==="MultiPolygon")for(tt=0;tt<at.length;tt++)for(var lt=0;lt<at[tt].length;lt++)ca(Q,at[tt][lt])}(H),H}function ca(X,D){for(var B=0;B<D.length;B+=3)X.minX=Math.min(X.minX,D[B]),X.minY=Math.min(X.minY,D[B+1]),X.maxX=Math.max(X.maxX,D[B]),X.maxY=Math.max(X.maxY,D[B+1])}function De(X,D,B,V){if(D.geometry){var H=D.geometry.coordinates,Q=D.geometry.type,at=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),et=[],tt=D.id;if(B.promoteId?tt=D.properties[B.promoteId]:B.generateId&&(tt=V||0),Q==="Point")Ie(H,et);else if(Q==="MultiPoint")for(var lt=0;lt<H.length;lt++)Ie(H[lt],et);else if(Q==="LineString")Ns(H,et,at,!1);else if(Q==="MultiLineString"){if(B.lineMetrics){for(lt=0;lt<H.length;lt++)Ns(H[lt],et=[],at,!1),X.push(es(tt,"LineString",et,D.properties));return}Vs(H,et,at,!1)}else if(Q==="Polygon")Vs(H,et,at,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(lt=0;lt<D.geometry.geometries.length;lt++)De(X,{id:tt,geometry:D.geometry.geometries[lt],properties:D.properties},B,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(lt=0;lt<H.length;lt++){var vt=[];Vs(H[lt],vt,at,!0),et.push(vt)}}X.push(es(tt,Q,et,D.properties))}}function Ie(X,D){D.push(fn(X[0])),D.push(mn(X[1])),D.push(0)}function Ns(X,D,B,V){for(var H,Q,at=0,et=0;et<X.length;et++){var tt=fn(X[et][0]),lt=mn(X[et][1]);D.push(tt),D.push(lt),D.push(0),et>0&&(at+=V?(H*lt-tt*Q)/2:Math.sqrt(Math.pow(tt-H,2)+Math.pow(lt-Q,2))),H=tt,Q=lt}var vt=D.length-3;D[2]=1,Dr(D,0,vt,B),D[vt+2]=1,D.size=Math.abs(at),D.start=0,D.end=D.size}function Vs(X,D,B,V){for(var H=0;H<X.length;H++){var Q=[];Ns(X[H],Q,B,V),D.push(Q)}}function fn(X){return X/360+.5}function mn(X){var D=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function Xe(X,D,B,V,H,Q,at,et){if(V/=D,Q>=(B/=D)&&at<V)return X;if(at<B||Q>=V)return null;for(var tt=[],lt=0;lt<X.length;lt++){var vt=X[lt],bt=vt.geometry,wt=vt.type,te=H===0?vt.minX:vt.minY,le=H===0?vt.maxX:vt.maxY;if(te>=B&&le<V)tt.push(vt);else if(!(le<B||te>=V)){var Zt=[];if(wt==="Point"||wt==="MultiPoint")Fa(bt,Zt,B,V,H);else if(wt==="LineString")ua(bt,Zt,B,V,H,!1,et.lineMetrics);else if(wt==="MultiLineString")qi(bt,Zt,B,V,H,!1);else if(wt==="Polygon")qi(bt,Zt,B,V,H,!0);else if(wt==="MultiPolygon")for(var Jt=0;Jt<bt.length;Jt++){var ne=[];qi(bt[Jt],ne,B,V,H,!0),ne.length&&Zt.push(ne)}if(Zt.length){if(et.lineMetrics&&wt==="LineString"){for(Jt=0;Jt<Zt.length;Jt++)tt.push(es(vt.id,wt,Zt[Jt],vt.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(Zt.length===1?(wt="LineString",Zt=Zt[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=Zt.length===3?"Point":"MultiPoint"),tt.push(es(vt.id,wt,Zt,vt.tags))}}}return tt.length?tt:null}function Fa(X,D,B,V,H){for(var Q=0;Q<X.length;Q+=3){var at=X[Q+H];at>=B&&at<=V&&(D.push(X[Q]),D.push(X[Q+1]),D.push(X[Q+2]))}}function ua(X,D,B,V,H,Q,at){for(var et,tt,lt=Lt(X),vt=H===0?is:bs,bt=X.start,wt=0;wt<X.length-3;wt+=3){var te=X[wt],le=X[wt+1],Zt=X[wt+2],Jt=X[wt+3],ne=X[wt+4],Me=H===0?te:le,Le=H===0?Jt:ne,ge=!1;at&&(et=Math.sqrt(Math.pow(te-Jt,2)+Math.pow(le-ne,2))),Me<B?Le>B&&(tt=vt(lt,te,le,Jt,ne,B),at&&(lt.start=bt+et*tt)):Me>V?Le<V&&(tt=vt(lt,te,le,Jt,ne,V),at&&(lt.start=bt+et*tt)):Wi(lt,te,le,Zt),Le<B&&Me>=B&&(tt=vt(lt,te,le,Jt,ne,B),ge=!0),Le>V&&Me<=V&&(tt=vt(lt,te,le,Jt,ne,V),ge=!0),!Q&&ge&&(at&&(lt.end=bt+et*tt),D.push(lt),lt=Lt(X)),at&&(bt+=et)}var we=X.length-3;te=X[we],le=X[we+1],Zt=X[we+2],(Me=H===0?te:le)>=B&&Me<=V&&Wi(lt,te,le,Zt),we=lt.length-3,Q&&we>=3&&(lt[we]!==lt[0]||lt[we+1]!==lt[1])&&Wi(lt,lt[0],lt[1],lt[2]),lt.length&&D.push(lt)}function Lt(X){var D=[];return D.size=X.size,D.start=X.start,D.end=X.end,D}function qi(X,D,B,V,H,Q){for(var at=0;at<X.length;at++)ua(X[at],D,B,V,H,Q,!1)}function Wi(X,D,B,V){X.push(D),X.push(B),X.push(V)}function is(X,D,B,V,H,Q){var at=(Q-D)/(V-D);return X.push(Q),X.push(B+(H-B)*at),X.push(1),at}function bs(X,D,B,V,H,Q){var at=(Q-B)/(H-B);return X.push(D+(V-D)*at),X.push(Q),X.push(1),at}function Rt(X,D){for(var B=[],V=0;V<X.length;V++){var H,Q=X[V],at=Q.type;if(at==="Point"||at==="MultiPoint"||at==="LineString")H=he(Q.geometry,D);else if(at==="MultiLineString"||at==="Polygon"){H=[];for(var et=0;et<Q.geometry.length;et++)H.push(he(Q.geometry[et],D))}else if(at==="MultiPolygon")for(H=[],et=0;et<Q.geometry.length;et++){for(var tt=[],lt=0;lt<Q.geometry[et].length;lt++)tt.push(he(Q.geometry[et][lt],D));H.push(tt)}B.push(es(Q.id,at,H,Q.tags))}return B}function he(X,D){var B=[];B.size=X.size,X.start!==void 0&&(B.start=X.start,B.end=X.end);for(var V=0;V<X.length;V+=3)B.push(X[V]+D,X[V+1],X[V+2]);return B}function ce(X,D){if(X.transformed)return X;var B,V,H,Q=1<<X.z,at=X.x,et=X.y;for(B=0;B<X.features.length;B++){var tt=X.features[B],lt=tt.geometry,vt=tt.type;if(tt.geometry=[],vt===1)for(V=0;V<lt.length;V+=2)tt.geometry.push(ki(lt[V],lt[V+1],D,Q,at,et));else for(V=0;V<lt.length;V++){var bt=[];for(H=0;H<lt[V].length;H+=2)bt.push(ki(lt[V][H],lt[V][H+1],D,Q,at,et));tt.geometry.push(bt)}}return X.transformed=!0,X}function ki(X,D,B,V,H,Q){return[Math.round(B*(X*V-H)),Math.round(B*(D*V-Q))]}function rs(X,D,B,V,H){for(var Q=D===H.maxZoom?0:H.tolerance/((1<<D)*H.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:V,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},et=0;et<X.length;et++){at.numFeatures++,se(at,X[et],Q,H);var tt=X[et].minX,lt=X[et].minY,vt=X[et].maxX,bt=X[et].maxY;tt<at.minX&&(at.minX=tt),lt<at.minY&&(at.minY=lt),vt>at.maxX&&(at.maxX=vt),bt>at.maxY&&(at.maxY=bt)}return at}function se(X,D,B,V){var H=D.geometry,Q=D.type,at=[];if(Q==="Point"||Q==="MultiPoint")for(var et=0;et<H.length;et+=3)at.push(H[et]),at.push(H[et+1]),X.numPoints++,X.numSimplified++;else if(Q==="LineString")qr(at,H,X,B,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(et=0;et<H.length;et++)qr(at,H[et],X,B,Q==="Polygon",et===0);else if(Q==="MultiPolygon")for(var tt=0;tt<H.length;tt++){var lt=H[tt];for(et=0;et<lt.length;et++)qr(at,lt[et],X,B,!0,et===0)}if(at.length){var vt=D.tags||null;if(Q==="LineString"&&V.lineMetrics){for(var bt in vt={},D.tags)vt[bt]=D.tags[bt];vt.mapbox_clip_start=H.start/H.size,vt.mapbox_clip_end=H.end/H.size}var wt={geometry:at,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:vt};D.id!==null&&(wt.id=D.id),X.features.push(wt)}}function qr(X,D,B,V,H,Q){var at=V*V;if(V>0&&D.size<(H?at:V))B.numPoints+=D.length/3;else{for(var et=[],tt=0;tt<D.length;tt+=3)(V===0||D[tt+2]>at)&&(B.numSimplified++,et.push(D[tt]),et.push(D[tt+1])),B.numPoints++;H&&function(lt,vt){for(var bt=0,wt=0,te=lt.length,le=te-2;wt<te;le=wt,wt+=2)bt+=(lt[wt]-lt[le])*(lt[wt+1]+lt[le+1]);if(bt>0===vt)for(wt=0,te=lt.length;wt<te/2;wt+=2){var Zt=lt[wt],Jt=lt[wt+1];lt[wt]=lt[te-2-wt],lt[wt+1]=lt[te-1-wt],lt[te-2-wt]=Zt,lt[te-1-wt]=Jt}}(et,Q),X.push(et)}}function Gr(X,D){var B=(D=this.options=function(H,Q){for(var at in Q)H[at]=Q[at];return H}(Object.create(this.options),D)).debug;if(B&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(H,Q){var at=[];if(H.type==="FeatureCollection")for(var et=0;et<H.features.length;et++)De(at,H.features[et],Q,et);else De(at,H.type==="Feature"?H:{geometry:H},Q);return at}(X,D);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(H,Q){var at=Q.buffer/Q.extent,et=H,tt=Xe(H,1,-1-at,at,0,-1,2,Q),lt=Xe(H,1,1-at,2+at,0,-1,2,Q);return(tt||lt)&&(et=Xe(H,1,-at,1+at,0,-1,2,Q)||[],tt&&(et=Rt(tt,1).concat(et)),lt&&(et=et.concat(Rt(lt,-1)))),et}(V,D),V.length&&this.splitTile(V,0,0,0),B&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ws(X,D,B){return 32*((1<<X)*B+D)+X}function xr(X,D){return D?X.properties[D]:X.id}function Ms(X,D){if(X==null)return!0;if(X.type==="Feature")return xr(X,D)!=null;if(X.type==="FeatureCollection"){const B=new Set;for(const V of X.features){const H=xr(V,D);if(H==null||B.has(H))return!1;B.add(H)}return!0}return!1}function Ci(X,D){const B=new Map;if(X!=null)if(X.type==="Feature")B.set(xr(X,D),X);else for(const V of X.features)B.set(xr(V,D),V);return B}function Ue(X,D){const B=X.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const V=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!V)return D(null,null);const H=new class{constructor(at){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=at.length,this._features=at}feature(at){return new class{constructor(et){this._feature=et,this.extent=o.EXTENT,this.type=et.type,this.properties=et.tags,"id"in et&&!isNaN(et.id)&&(this.id=parseInt(et.id,10))}loadGeometry(){if(this._feature.type===1){const et=[];for(const tt of this._feature.geometry)et.push([new o.Point(tt[0],tt[1])]);return et}{const et=[];for(const tt of this._feature.geometry){const lt=[];for(const vt of tt)lt.push(new o.Point(vt[0],vt[1]));et.push(lt)}return et}}toGeoJSON(et,tt,lt){return $t.call(this,et,tt,lt)}}(this._features[at])}}(V.features);let Q=xs(H);Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),D(null,{vectorTile:H,rawData:Q.buffer})}Gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Gr.prototype.splitTile=function(X,D,B,V,H,Q,at){for(var et=[X,D,B,V],tt=this.options,lt=tt.debug;et.length;){V=et.pop(),B=et.pop(),D=et.pop(),X=et.pop();var vt=1<<D,bt=ws(D,B,V),wt=this.tiles[bt];if(!wt&&(lt>1&&console.time("creation"),wt=this.tiles[bt]=rs(X,D,B,V,tt),this.tileCoords.push({z:D,x:B,y:V}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,B,V,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));var te="z"+D;this.stats[te]=(this.stats[te]||0)+1,this.total++}if(wt.source=X,H){if(D===tt.maxZoom||D===H)continue;var le=1<<H-D;if(B!==Math.floor(Q/le)||V!==Math.floor(at/le))continue}else if(D===tt.indexMaxZoom||wt.numPoints<=tt.indexMaxPoints)continue;if(wt.source=null,X.length!==0){lt>1&&console.time("clipping");var Zt,Jt,ne,Me,Le,ge,we=.5*tt.buffer/tt.extent,Hi=.5-we,ae=.5+we,ui=1+we;Zt=Jt=ne=Me=null,Le=Xe(X,vt,B-we,B+ae,0,wt.minX,wt.maxX,tt),ge=Xe(X,vt,B+Hi,B+ui,0,wt.minX,wt.maxX,tt),X=null,Le&&(Zt=Xe(Le,vt,V-we,V+ae,1,wt.minY,wt.maxY,tt),Jt=Xe(Le,vt,V+Hi,V+ui,1,wt.minY,wt.maxY,tt),Le=null),ge&&(ne=Xe(ge,vt,V-we,V+ae,1,wt.minY,wt.maxY,tt),Me=Xe(ge,vt,V+Hi,V+ui,1,wt.minY,wt.maxY,tt),ge=null),lt>1&&console.timeEnd("clipping"),et.push(Zt||[],D+1,2*B,2*V),et.push(Jt||[],D+1,2*B,2*V+1),et.push(ne||[],D+1,2*B+1,2*V),et.push(Me||[],D+1,2*B+1,2*V+1)}}},Gr.prototype.getTile=function(X,D,B){var V=this.options,H=V.extent,Q=V.debug;if(X<0||X>24)return null;var at=1<<X,et=ws(X,D=(D%at+at)%at,B);if(this.tiles[et])return ce(this.tiles[et],H);Q>1&&console.log("drilling down to z%d-%d-%d",X,D,B);for(var tt,lt=X,vt=D,bt=B;!tt&&lt>0;)lt--,vt=Math.floor(vt/2),bt=Math.floor(bt/2),tt=this.tiles[ws(lt,vt,bt)];return tt&&tt.source?(Q>1&&console.log("found parent tile z%d-%d-%d",lt,vt,bt),Q>1&&console.time("drilling down"),this.splitTile(tt.source,lt,vt,bt,X,D,B),Q>1&&console.timeEnd("drilling down"),this.tiles[et]?ce(this.tiles[et],H):null):null};class Oa extends mt{constructor(D,B,V,H){super(D,B,V,Ue),this._dataUpdateable=new Map,this.loadGeoJSON=(Q,at)=>{const{promoteId:et}=Q;if(Q.request)return o.getJSON(Q.request,(tt,lt,vt,bt)=>{this._dataUpdateable=Ms(lt,et)?Ci(lt,et):void 0,at(tt,lt,vt,bt)});if(typeof Q.data=="string")try{const tt=JSON.parse(Q.data);this._dataUpdateable=Ms(tt,et)?Ci(tt,et):void 0,at(null,tt)}catch{at(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}else Q.dataDiff?this._dataUpdateable?(function(tt,lt,vt){var bt,wt,te,le;if(lt.removeAll&&tt.clear(),lt.remove)for(const Zt of lt.remove)tt.delete(Zt);if(lt.add)for(const Zt of lt.add){const Jt=xr(Zt,vt);Jt!=null&&tt.set(Jt,Zt)}if(lt.update)for(const Zt of lt.update){let Jt=tt.get(Zt.id);if(Jt==null)continue;const ne=!Zt.removeAllProperties&&(((bt=Zt.removeProperties)===null||bt===void 0?void 0:bt.length)>0||((wt=Zt.addOrUpdateProperties)===null||wt===void 0?void 0:wt.length)>0);if((Zt.newGeometry||Zt.removeAllProperties||ne)&&(Jt={...Jt},tt.set(Zt.id,Jt),ne&&(Jt.properties={...Jt.properties})),Zt.newGeometry&&(Jt.geometry=Zt.newGeometry),Zt.removeAllProperties)Jt.properties={};else if(((te=Zt.removeProperties)===null||te===void 0?void 0:te.length)>0)for(const Me of Zt.removeProperties)Object.prototype.hasOwnProperty.call(Jt.properties,Me)&&delete Jt.properties[Me];if(((le=Zt.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0)for(const{key:Me,value:Le}of Zt.addOrUpdateProperties)Jt.properties[Me]=Le}}(this._dataUpdateable,Q.dataDiff,et),at(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):at(new Error(`Cannot update existing geojson data in ${Q.source}`)):at(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},H&&(this.loadGeoJSON=H)}loadData(D,B){var V;(V=this._pendingRequest)===null||V===void 0||V.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const H=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(D,(Q,at)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!at)return B(Q);if(typeof at!="object")return B(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{Dt(at,!0);try{if(D.filter){const tt=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(tt.result==="error")throw new Error(tt.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));at={type:"FeatureCollection",features:at.features.filter(vt=>tt.value.evaluate({zoom:0},vt))}}this._geoJSONIndex=D.cluster?new Qr(function({superclusterOptions:tt,clusterProperties:lt}){if(!lt||!tt)return tt;const vt={},bt={},wt={accumulated:null,zoom:0},te={properties:null},le=Object.keys(lt);for(const Zt of le){const[Jt,ne]=lt[Zt],Me=o.createExpression(ne),Le=o.createExpression(typeof Jt=="string"?[Jt,["accumulated"],["get",Zt]]:Jt);vt[Zt]=Me.value,bt[Zt]=Le.value}return tt.map=Zt=>{te.properties=Zt;const Jt={};for(const ne of le)Jt[ne]=vt[ne].evaluate(wt,te);return Jt},tt.reduce=(Zt,Jt)=>{te.properties=Jt;for(const ne of le)wt.accumulated=Zt[ne],Zt[ne]=bt[ne].evaluate(wt,te)},tt}(D)).load(at.features):function(tt,lt){return new Gr(tt,lt)}(at,D.geojsonVtOptions)}catch(tt){return B(tt)}this.loaded={};const et={};if(H){const tt=H.finish();tt&&(et.resourceTiming={},et.resourceTiming[D.source]=JSON.parse(JSON.stringify(tt)))}B(null,et)}})}reloadTile(D,B){const V=this.loaded;return V&&V[D.uid]?super.reloadTile(D,B):this.loadTile(D,B)}removeSource(D,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(D,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(V){B(V)}}getClusterChildren(D,B){try{B(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(V){B(V)}}getClusterLeaves(D,B){try{B(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(V){B(V)}}}class Zr{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:mt,geojson:Oa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,V)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=V},this.self.registerRTLTextPlugin=B=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=B.applyArabicShaping,o.plugin.processBidirectionalText=B.processBidirectionalText,o.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(D,B){this.referrer=B}setImages(D,B,V){this.availableImages[D]=B;for(const H in this.workerSources[D]){const Q=this.workerSources[D][H];for(const at in Q)Q[at].availableImages=B}V()}setLayers(D,B,V){this.getLayerIndex(D).replace(B),V()}updateLayers(D,B,V){this.getLayerIndex(D).update(B.layers,B.removedIds),V()}loadTile(D,B,V){this.getWorkerSource(D,B.type,B.source).loadTile(B,V)}loadDEMTile(D,B,V){this.getDEMWorkerSource(D,B.source).loadTile(B,V)}reloadTile(D,B,V){this.getWorkerSource(D,B.type,B.source).reloadTile(B,V)}abortTile(D,B,V){this.getWorkerSource(D,B.type,B.source).abortTile(B,V)}removeTile(D,B,V){this.getWorkerSource(D,B.type,B.source).removeTile(B,V)}removeDEMTile(D,B){this.getDEMWorkerSource(D,B.source).removeTile(B)}removeSource(D,B,V){if(!this.workerSources[D]||!this.workerSources[D][B.type]||!this.workerSources[D][B.type][B.source])return;const H=this.workerSources[D][B.type][B.source];delete this.workerSources[D][B.type][B.source],H.removeSource!==void 0?H.removeSource(B,V):V()}loadWorkerSource(D,B,V){try{this.self.importScripts(B.url),V()}catch(H){V(H.toString())}}syncRTLPluginState(D,B,V){try{o.plugin.setState(B);const H=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&H!=null){this.self.importScripts(H);const Q=o.plugin.isParsed();V(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),Q)}}catch(H){V(H.toString())}}getAvailableImages(D){let B=this.availableImages[D];return B||(B=[]),B}getLayerIndex(D){let B=this.layerIndexes[D];return B||(B=this.layerIndexes[D]=new L),B}getWorkerSource(D,B,V){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][B]||(this.workerSources[D][B]={}),!this.workerSources[D][B][V]){const H={send:(Q,at,et)=>{this.actor.send(Q,at,et,D)}};this.workerSources[D][B][V]=new this.workerSourceTypes[B](H,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][B][V]}getDEMWorkerSource(D,B){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][B]||(this.demWorkerSources[D][B]=new ft),this.demWorkerSources[D][B]}}return o.isWorker()&&(self.worker=new Zr(self)),Zr}),T(["./shared"],function(o){var L="3.3.0";class k{static testProp(e){if(!k.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in k.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(e,s){e.style[k.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static mousePos(e,s){const l=e.getBoundingClientRect();return new o.Point(s.clientX-l.left-e.clientLeft,s.clientY-l.top-e.clientTop)}static touchPos(e,s){const l=e.getBoundingClientRect(),u=[];for(let m=0;m<s.length;m++)u.push(new o.Point(s[m].clientX-l.left-e.clientLeft,s[m].clientY-l.top-e.clientTop));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const Y={supported:!1,testSupport:function(d){!mt&&ot&&(ft?Mt(d):N=d)}};let N,ot,mt=!1,ft=!1;function Mt(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,ot),d.isContextLost())return;Y.supported=!0}catch{}d.deleteTexture(e),mt=!0}var Tt,Dt;typeof document<"u"&&(ot=document.createElement("img"),ot.onload=function(){N&&Mt(N),N=null,ft=!0},ot.onerror=function(){mt=!0,N=null},ot.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,s,l,u;d.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},d.addThrottleControl=S=>{const A=l++;return u[A]=S,A},d.removeThrottleControl=S=>{delete u[S],b()},d.getImage=(S,A,P=!0)=>{Y.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*");const F={requestParameters:S,supportImageRefresh:P,callback:A,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),s--),b())}};return e.push(F),b(),F};const m=S=>{const{requestParameters:A,supportImageRefresh:P,callback:F}=S;return o.extend(A,{type:"image"}),(P!==!1||o.isWorker()||o.getProtocolAction(A.url)||A.headers&&!Object.keys(A.headers).reduce((G,q)=>G&&q==="accept",!0)?o.makeRequest:M)(A,(G,q,j,$)=>{v(S,F,G,q,j,$)})},v=(S,A,P,F,G,q)=>{P?A(P):F instanceof HTMLImageElement||o.isImageBitmap(F)?A(null,F):F&&((j,$)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(j,$):o.arrayBufferToImage(j,$)})(F,(j,$)=>{j!=null?A(j):$!=null&&A(null,$,{cacheControl:G,expires:q})}),S.cancelled||(S.completed=!0,s--,b())},b=()=>{const S=(()=>{const A=Object.keys(u);let P=!1;if(A.length>0){for(const F of A)if(P=u[F](),P)break}return P})()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=s;A<S&&e.length>0;A++){const P=e.shift();if(P.cancelled){A--;continue}const F=m(P);s++,P.innerRequest=F}},M=(S,A)=>{const P=new Image,F=S.url;let G=!1;const q=S.credentials;return q&&q==="include"?P.crossOrigin="use-credentials":(q&&q==="same-origin"||!o.sameOrigin(F))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{A(null,P),P.onerror=P.onload=null},P.onerror=()=>{G||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=F,{cancel:()=>{G=!0,P.src=""}}}}(Tt||(Tt={})),Tt.resetRequestQueue(),function(d){d.Glyphs="Glyphs",d.Image="Image",d.Source="Source",d.SpriteImage="SpriteImage",d.SpriteJSON="SpriteJSON",d.Style="Style",d.Tile="Tile",d.Unknown="Unknown"}(Dt||(Dt={}));class $t{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}normalizeSpriteURL(e,s,l){const u=function(m){const v=m.match(Pt);if(!v)throw new Error(`Unable to parse URL "${m}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(e);return u.path+=`${s}${l}`,function(m){const v=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${v}`}(u)}setTransformRequest(e){this._transformRequestFn=e}}const Pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(d){var e=new o.ARRAY_TYPE(3);return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}var de,ve=function(d,e,s){return d[0]=e[0]-s[0],d[1]=e[1]-s[1],d[2]=e[2]-s[2],d};de=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0);var Se=function(d){var e=d[0],s=d[1];return e*e+s*s};function xe(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const s=[];for(const{id:l,url:u}of d){const m=`${l}${u}`;s.indexOf(m)===-1&&(s.push(m),e.push({id:l,url:u}))}}return e}function Ce(d,e,s,l,u){if(l)return void d(l);if(u!==Object.values(e).length||u!==Object.values(s).length)return;const m={};for(const v in e){m[v]={};const b=o.browser.getImageCanvasContext(s[v]),M=e[v];for(const S in M){const{width:A,height:P,x:F,y:G,sdf:q,pixelRatio:j,stretchX:$,stretchY:rt,content:ct}=M[S];m[v][S]={data:null,pixelRatio:j,sdf:q,stretchX:$,stretchY:rt,content:ct,spriteData:{width:A,height:P,x:F,y:G,context:b}}}}d(null,m)}(function(){var d=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(d[0]=0,d[1]=0)})();class oe{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:m}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===m||l),{context:b}=this,{gl:M}=b;if(this.useMipmap=!!(s&&s.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.isImageBitmap(e)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,u,m,0,this.format,M.UNSIGNED_BYTE,e.data);else{const{x:S,y:A}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.isImageBitmap(e)?M.texSubImage2D(M.TEXTURE_2D,0,S,A,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,S,A,u,m,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function zi(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class mi extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,callback:l}of this.requestors)this._notify(s,l);this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new o.RGBAImage({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,m=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||m<e[1]||e[2]<0||u<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,s){let l=!0;if(!this.isLoaded())for(const u of e)this.images[u]||(l=!1);this.isLoaded()||l?this._notify(e,s):this.requestors.push({ids:e,callback:s})}_notify(e,s){const l={};for(const u of e){let m=this.getImage(u);m||(this.fire(new o.Event("styleimagemissing",{id:u})),m=this.getImage(u)),m?l[u]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:o.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,l)}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new o.ImagePosition(u,l);this.patterns[e]={bin:u,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new oe(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:s,h:l}=o.potpack(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const m in this.patterns){const{bin:v}=this.patterns[m],b=v.x+1,M=v.y+1,S=this.getImage(m).data,A=S.width,P=S.height;o.RGBAImage.copy(S,u,{x:0,y:0},{x:b,y:M},{width:A,height:P}),o.RGBAImage.copy(S,u,{x:0,y:P-1},{x:b,y:M-1},{width:A,height:1}),o.RGBAImage.copy(S,u,{x:0,y:0},{x:b,y:M+P},{width:A,height:1}),o.RGBAImage.copy(S,u,{x:A-1,y:0},{x:b-1,y:M},{width:1,height:P}),o.RGBAImage.copy(S,u,{x:0,y:0},{x:b+A,y:M},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||o.warnOnce(`Image with ID: "${s}" was not found`),zi(l)&&this.updateImage(s,l)}}}const nr=1e20;function Yr(d,e,s,l,u,m,v,b,M){for(let S=e;S<e+l;S++)Ui(d,s*m+S,m,u,v,b,M);for(let S=s;S<s+u;S++)Ui(d,S*m+e,1,l,v,b,M)}function Ui(d,e,s,l,u,m,v){m[0]=0,v[0]=-nr,v[1]=nr,u[0]=d[e];for(let b=1,M=0,S=0;b<l;b++){u[b]=d[e+b*s];const A=b*b;do{const P=m[M];S=(u[b]-u[P]+A-P*P)/(b-P)/2}while(S<=v[M]&&--M>-1);M++,m[M]=b,v[M]=S,v[M+1]=nr}for(let b=0,M=0;b<l;b++){for(;v[M+1]<b;)M++;const S=m[M],A=b-S;d[e+b*s]=u[S]+A*A}}class Ni{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e,s){const l=[];for(const u in e)for(const m of e[u])l.push({stack:u,id:m});o.asyncAll(l,({stack:u,id:m},v)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{}});let M=b.glyphs[m];if(M!==void 0)return void v(null,{stack:u,id:m,glyph:M});if(M=this._tinySDF(b,u,m),M)return b.glyphs[m]=M,void v(null,{stack:u,id:m,glyph:M});const S=Math.floor(m/256);if(256*S>65535)return void v(new Error("glyphs > 65535 not supported"));if(b.ranges[S])return void v(null,{stack:u,id:m,glyph:M});if(!this.url)return void v(new Error("glyphsUrl is not set"));let A=b.requests[S];A||(A=b.requests[S]=[],Ni.loadGlyphRange(u,S,this.url,this.requestManager,(P,F)=>{if(F){for(const G in F)this._doesCharSupportLocalGlyph(+G)||(b.glyphs[+G]=F[+G]);b.ranges[S]=!0}for(const G of A)G(P,F);delete b.requests[S]})),A.push((P,F)=>{P?v(P):F&&v(null,{stack:u,id:m,glyph:F[m]||null})})},(u,m)=>{if(u)s(u);else if(m){const v={};for(const{stack:b,id:M,glyph:S}of m)(v[b]||(v[b]={}))[M]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};s(null,v)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](e)||o.unicodeBlockLookup["Hangul Syllables"](e)||o.unicodeBlockLookup.Hiragana(e)||o.unicodeBlockLookup.Katakana(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let b="400";/bold/i.test(s)?b="900":/medium/i.test(s)?b="500":/light/i.test(s)&&(b="200"),m=e.tinySDF=new Ni.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:b})}const v=m.draw(String.fromCharCode(l));return{id:l,bitmap:new o.AlphaImage({width:v.width||30,height:v.height||30},v.data),metrics:{width:v.glyphWidth||24,height:v.glyphHeight||24,left:v.glyphLeft||0,top:v.glyphTop-27||-8,advance:v.glyphAdvance||24}}}}Ni.loadGlyphRange=function(d,e,s,l,u){const m=256*e,v=m+255,b=l.transformRequest(s.replace("{fontstack}",d).replace("{range}",`${m}-${v}`),Dt.Glyphs);o.getArrayBuffer(b,(M,S)=>{if(M)u(M);else if(S){const A={};for(const P of o.parseGlyphPbf(S))A[P.id]=P;u(null,A)}})},Ni.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const b=this.size=d+4*e,M=this._createCanvas(b),S=this.ctx=M.getContext("2d",{willReadFrequently:!0});S.font=`${v} ${m} ${d}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(d),v=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),M=Math.min(this.size-this.buffer,v+Math.ceil(l)),S=b+2*this.buffer,A=M+2*this.buffer,P=Math.max(S*A,0),F=new Uint8ClampedArray(P),G={data:F,width:S,height:A,glyphWidth:b,glyphHeight:M,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(b===0||M===0)return G;const{ctx:q,buffer:j,gridInner:$,gridOuter:rt}=this;q.clearRect(j,j,b,M),q.fillText(d,j,j+v);const ct=q.getImageData(j,j,b,M);rt.fill(nr,0,P),$.fill(0,0,P);for(let K=0;K<M;K++)for(let st=0;st<b;st++){const dt=ct.data[4*(K*b+st)+3]/255;if(dt===0)continue;const pt=(K+j)*S+st+j;if(dt===1)rt[pt]=0,$[pt]=nr;else{const _t=.5-dt;rt[pt]=_t>0?_t*_t:0,$[pt]=_t<0?_t*_t:0}}Yr(rt,0,0,S,A,S,this.f,this.v,this.z),Yr($,j,j,b,M,S,this.f,this.v,this.z);for(let K=0;K<P;K++){const st=Math.sqrt(rt[K])-Math.sqrt($[K]);F[K]=Math.round(255-255*(st/this.radius+this.cutoff))}return G}};class Jr{constructor(){this.specification=o.v8Spec.light.position}possiblyEvaluate(e,s){return o.sphericalToCartesian(e.expression.evaluate(s))}interpolate(e,s,l){return{x:o.interpolate.number(e.x,s.x,l),y:o.interpolate.number(e.y,s.y,l),z:o.interpolate.number(e.z,s.z,l)}}}let gi,xs;class ha extends o.Evented{constructor(e){super(),gi=gi||new o.Properties({anchor:new o.DataConstantProperty(o.v8Spec.light.anchor),position:new Jr,color:new o.DataConstantProperty(o.v8Spec.light.color),intensity:new o.DataConstantProperty(o.v8Spec.light.intensity)}),this._transitionable=new o.Transitionable(gi),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(o.validateLight,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&o.emitValidationErrors(this,e.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.v8Spec})))}}class Cr{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let m=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,b=!0;u.push({left:m,right:v,isDash:b,zeroLength:e[0]===0});let M=e[0];for(let S=1;S<e.length;S++){b=!b;const A=e[S];m=M*l,M+=A,v=M*l,u.push({left:m,right:v,isDash:b,zeroLength:A===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let m=-l;m<=l;m++){const v=this.width*(this.nextRow+l+m);let b=0,M=e[b];for(let S=0;S<this.width;S++){S/M.right>1&&(M=e[++b]);const A=Math.abs(S-M.left),P=Math.abs(S-M.right),F=Math.min(A,P);let G;const q=m/l*(u+1);if(M.isDash){const j=u-Math.abs(q);G=Math.sqrt(F*F+j*j)}else G=u-Math.sqrt(F*F+q*q);this.data[v+S]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const M=e[b],S=e[b+1];M.zeroLength?e.splice(b,1):S&&S.isDash===M.isDash&&(S.left=M.left,e.splice(b,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let m=0,v=e[m];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++m]);const M=Math.abs(b-v.left),S=Math.abs(b-v.right),A=Math.min(M,S);this.data[u+b]=Math.max(0,Math.min(255,(v.isDash?A:-A)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return o.warnOnce("LineAtlas out of space"),null;let m=0;for(let b=0;b<e.length;b++)m+=e[b];if(m!==0){const b=this.width/m,M=this.getDashRanges(e,this.width,b);s?this.addRoundDash(M,b,l):this.addRegularDash(M)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class Ai{constructor(e,s,l){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=l;const u=this.workerPool.acquire(l);for(let m=0;m<u.length;m++){const v=new Ai.Actor(u[m],s,l);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s,l){o.asyncAll(this.actors,(u,m)=>{u.send(e,s,m)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}}function Vi(d,e,s){const l=function(u,m){if(u)return s(u);if(m){const v=o.pick(o.extend(m,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);m.vector_layers&&(v.vectorLayers=m.vector_layers,v.vectorLayerIds=v.vectorLayers.map(b=>b.id)),s(null,v)}};return d.url?o.getJSON(e.transformRequest(d.url,Dt.Source),l):o.browser.frame(()=>l(null,d))}Ai.Actor=o.Actor;class ke{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.LngLat?new o.LngLat(e.lng,e.lat):o.LngLat.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.LngLat?new o.LngLat(e.lng,e.lat):o.LngLat.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,m;if(e instanceof o.LngLat)u=e,m=e;else{if(!(e instanceof ke))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ke.convert(e)):this.extend(o.LngLat.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.LngLat.convert(e)):this;if(u=e._sw,m=e._ne,!u||!m)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new o.LngLat(u.lng,u.lat),this._ne=new o.LngLat(m.lng,m.lat)),this}getCenter(){return new o.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new o.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=o.LngLat.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof ke?e:e&&new ke(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new ke(new o.LngLat(e.lng-u,e.lat-l),new o.LngLat(e.lng+u,e.lat+l))}}class Pr{constructor(e,s,l){this.bounds=ke.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),u=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),m=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),v=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return e.x>=l&&e.x<m&&e.y>=u&&e.y<v}}class Qr extends o.Evented{constructor(e,s,l,u){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),m?this.fire(new o.ErrorEvent(m)):v&&(o.extend(this,v),v.bounds&&(this.tileBounds=new Pr(v.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.extend({},this._options),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(s,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(e,s){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(l,Dt.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(v,b){return delete e.request,e.aborted?s(null):v&&v.status!==404?s(v):(b&&b.resourceTiming&&(e.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&e.setExpiryData(b),e.loadVectorData(b,this.map.painter),s(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=s:e.request=e.actor.send("reloadTile",u,m.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",u,m.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class zr extends o.Evented{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new o.ErrorEvent(e)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new Pr(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,s){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=Tt.getImage(this.map._requestManager.transformRequest(l,Dt.Tile),(u,m,v)=>{if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(u)e.state="errored",s(u);else if(m){this.map._refreshExpiredTiles&&v&&e.setExpiryData(v);const b=this.map.painter.context,M=b.gl;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new oe(b,m,M.RGBA,{useMipmap:!0}),e.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),b.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax)),e.state="loaded",s(null)}},this.map._refreshExpiredTiles)}abortTile(e,s){e.request&&(e.request.cancel(),delete e.request),s()}unloadTile(e,s){e.texture&&this.map.painter.saveTileTexture(e.texture),s()}hasTransition(){return!1}}class ts extends zr{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(e,s){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(m,v){m&&(e.state="errored",s(m)),v&&(e.dem=v,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",s(null))}e.request=Tt.getImage(this.map._requestManager.transformRequest(l,Dt.Tile),(function(m,v){if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(m)e.state="errored",s(m);else if(v){this.map._refreshExpiredTiles&&e.setExpiryData(v),delete v.cacheControl,delete v.expires;const b=o.isImageBitmap(v)&&(xs==null&&(xs=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xs)?v:o.browser.getImageData(v,1),M={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:b,encoding:this.encoding};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",M,u.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),e.neighboringTiles=this._getNeighboringTiles(e.tileID)}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,m=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,b=s.x+1===l?e.wrap+1:e.wrap,M={};return M[new o.OverscaledTileID(e.overscaledZ,m,s.z,u,s.y).key]={backfilled:!1},M[new o.OverscaledTileID(e.overscaledZ,b,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(M[new o.OverscaledTileID(e.overscaledZ,m,s.z,u,s.y-1).key]={backfilled:!1},M[new o.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},M[new o.OverscaledTileID(e.overscaledZ,b,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(M[new o.OverscaledTileID(e.overscaledZ,m,s.z,u,s.y+1).key]={backfilled:!1},M[new o.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},M[new o.OverscaledTileID(e.overscaledZ,b,s.z,v,s.y+1).key]={backfilled:!1}),M}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class kr extends o.Evented{constructor(e,s,l,u){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.extend({},this._options,{type:this.type,data:this._data}),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=o.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*m,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.EXTENT,radius:(s.clusterRadius||50)*m,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},s),this}getClusterChildren(e,s){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},s),this}getClusterLeaves(e,s,l,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:s,offset:l},u),this}_updateWorkerData(e){const s=o.extend({},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(o.browser.resolveURL(this._data),Dt.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(l,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let m=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(m=u.resourceTiming[this.id].slice(0)),l)return void this.fire(new o.ErrorEvent(l));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&o.extend(v,{resourceTiming:m}),this.fire(new o.Event("data",{...v,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...v,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(e,s){const l=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(l,u,(m,v)=>(delete e.request,e.unloadVectorData(),e.aborted?s(null):m?s(m):(e.loadVectorData(v,this.map.painter,l==="reloadTile"),s(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var $i=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class or extends o.Evented{constructor(e,s,l,u){super(),this.load=(m,v)=>{this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Tt.getImage(this.map._requestManager.transformRequest(this.url,Dt.Image),(b,M)=>{this._request=null,this._loaded=!0,b?this.fire(new o.ErrorEvent(b)):M&&(this.image=M,m&&(this.coordinates=m),v&&v(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const m=this.map.painter.context,v=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,$i.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new oe(m,this.image,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let b=!1;for(const M in this.tiles){const S=this.tiles[M];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,b=!0)}b&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(u){let m=1/0,v=1/0,b=-1/0,M=-1/0;for(const F of u)m=Math.min(m,F.x),v=Math.min(v,F.y),b=Math.max(b,F.x),M=Math.max(M,F.y);const S=Math.max(b-m,M-v),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),P=Math.pow(2,A);return new o.CanonicalTileID(A,Math.floor((m+b)/2*P),Math.floor((v+M)/2*P))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(l[2].x,l[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}hasTransition(){return!1}}class Dr extends or{constructor(e,s,l,u){super(e,s,l,u),this.load=()=>{this._loaded=!1;const m=this.options;this.urls=[];for(const v of m.urls)this.urls.push(this.map._requestManager.transformRequest(v,Dt.Source).url);o.getVideo(this.urls,(v,b)=>{this._loaded=!0,v?this.fire(new o.ErrorEvent(v)):b&&(this.video=b,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,v=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,$i.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.texSubImage2D(v.TEXTURE_2D,0,0,0,v.RGBA,v.UNSIGNED_BYTE,this.video)):(this.texture=new oe(m,this.video,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let b=!1;for(const M in this.tiles){const S=this.tiles[M];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,b=!0)}b&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=s}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class gt extends or{constructor(e,s,l,u){super(e,s,l,u),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const v=this.map.painter.context,b=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,$i.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new oe(v,this.canvas,b.RGBA,{premultiply:!0});let M=!1;for(const S in this.tiles){const A=this.tiles[S];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,M=!0)}M&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(v=>typeof v!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const es={},ca=d=>{switch(d){case"geojson":return kr;case"image":return or;case"raster":return zr;case"raster-dem":return ts;case"vector":return Qr;case"video":return Dr;case"canvas":return gt}return es[d]};function De(d,e){const s=o.create();return o.translate(s,s,[1,1,0]),o.scale(s,s,[.5*d.width,.5*d.height,1]),o.multiply(s,s,d.calculatePosMatrix(e.toUnwrapped()))}function Ie(d,e,s,l,u,m){const v=function(P,F,G){if(P)for(const q of P){const j=F[q];if(j&&j.source===G&&j.type==="fill-extrusion")return!0}else for(const q in F){const j=F[q];if(j.source===G&&j.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,d.id),b=m.maxPitchScaleFactor(),M=d.tilesIn(l,b,v);M.sort(Ns);const S=[];for(const P of M)S.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(e,s,d._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,u,m,b,De(d.transform,P.tileID))});const A=function(P){const F={},G={};for(const q of P){const j=q.queryResults,$=q.wrappedTileID,rt=G[$]=G[$]||{};for(const ct in j){const K=j[ct],st=rt[ct]=rt[ct]||{},dt=F[ct]=F[ct]||[];for(const pt of K)st[pt.featureIndex]||(st[pt.featureIndex]=!0,dt.push(pt))}}return F}(S);for(const P in A)A[P].forEach(F=>{const G=F.feature,q=d.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=q});return A}function Ns(d,e){const s=d.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}class Vs{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,m){const v={};if(!m)return v;for(const b of u){const M=b.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(M.length!==0){b.layers=M,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>M.filter(A=>A.id===S)[0]));for(const S of M)v[S.id]=b}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const m=this.buckets[u];if(m instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const m=this.buckets[u];if(m instanceof o.SymbolBucket&&m.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const m=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new oe(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new oe(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,m,v,b,M,S,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:m,scale:v,tileSize:this.tileSize,pixelPosMatrix:A,transform:M,params:b,queryPadding:this.queryPadding*S},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),m=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[m];if(!v)return;const b=o.createFilter(s&&s.filter),{z:M,x:S,y:A}=this.tileID.canonical,P={z:M,x:S,y:A};for(let F=0;F<v.length;F++){const G=v.feature(F);if(b.needGeometry){const $=o.toEvaluationFeature(G,!0);if(!b.filter(new o.EvaluationParameters(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!b.filter(new o.EvaluationParameters(this.tileID.overscaledZ),G))continue;const q=l.getId(G,m),j=new o.GeoJSONFeature(G,M,S,A,q);j.tile=P,e.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=o.parseCacheControl(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const m=this.expirationTime-s;m?this.expirationTime=l+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const m=this.buckets[u],v=m.layers[0].sourceLayer||"_geojsonTileLayer",b=l[v],M=e[v];if(!b||!M||Object.keys(M).length===0)continue;m.update(M,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=s&&s.style&&s.style.getLayer(u);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=o.browser.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const m of s)if(u[m])return!0}}return!1}}class fn{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const m={value:s,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),m=this.data[l][u];return this.data[l].splice(u,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class mn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},o.extend(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==u&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const m in this.state[e][u])l[m]||(this.deletedStates[e][u][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][m]===null&&delete this.deletedStates[e][u][m]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=o.extend({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][s];if(m===null)return{};for(const v in m)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const m={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),o.extend(this.state[u][v],this.stateChanges[u][v]),m[v]=this.state[u][v];l[u]=m}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const m={};if(this.deletedStates[u]===null)for(const v in this.state[u])m[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const b of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][b];m[v]=this.state[u][v]}l[u]=l[u]||{},o.extend(l[u],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class Xe extends o.Evented{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,m,v,b)=>{const M=new(ca(m.type))(u,m,v,b);if(M.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${M.id}`);return M})(e,s,l,this),this._tiles={},this._cache=new fn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new mn,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s){return this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new o.Event("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Fa).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const m=l.tileID,v=u.tileID,b=new o.Point(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),M=new o.Point(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||M.y-b.y||M.x-b.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Fa).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,e,s)))}_tileLoaded(e,s,l,u){if(u)return e.state="errored",void(u.status!==404?this._source.fire(new o.ErrorEvent(u,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=o.browser.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const m=s[u];if(e.neighboringTiles&&e.neighboringTiles[m]){const v=this.getTileByID(m);l(e,v),l(v,e)}}function l(u,m){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=m.tileID.canonical.x-u.tileID.canonical.x;const b=m.tileID.canonical.y-u.tileID.canonical.y,M=Math.pow(2,u.tileID.canonical.z),S=m.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+M)===1?v+=M:Math.abs(v-M)===1&&(v-=M)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,v,b),u.neighboringTiles&&u.neighboringTiles[S]&&(u.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const m in this._tiles){let v=this._tiles[m];if(u[m]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const S=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[S.key],v&&v.hasData()&&(b=S)}let M=b;for(;M.overscaledZ>s;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]){u[b.key]=b;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),m=this._getLoadedTile(u);if(m)return m}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?o.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(m)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),l[m.tileID.key]=m}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(e,s){if(this.transform=e,this.terrain=s,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new o.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(A=>this._source.hasTile(A)))):l=[];const u=e.coveringZoomLevel(this._source),m=Math.max(u-Xe.maxOverzooming,this._source.minzoom),v=Math.max(u+Xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const P of l)if(P.canonical.z>this._source.minzoom){const F=P.scaledTo(P.canonical.z-1);A[F.key]=F;const G=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));A[G.key]=G}l=l.concat(Object.values(A))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new o.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(l,u);if(ua(this._source.type)){const A={},P={},F=Object.keys(M),G=o.browser.now();for(const q of F){const j=M[q],$=this._tiles[q];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=G)continue;const rt=this.findLoadedParent(j,m);rt&&(this._addTile(rt.tileID),A[rt.tileID.key]=rt.tileID),P[q]=j}this._retainLoadedChildren(P,u,v,M);for(const q in A)M[q]||(this._coveredTiles[q]=!0,M[q]=A[q]);if(s){const q={},j={};for(const $ of l)this._tiles[$.key].hasData()?q[$.key]=$:j[$.key]=$;for(const $ in j){const rt=j[$].children(this._source.maxzoom);this._tiles[rt[0].key]&&this._tiles[rt[1].key]&&this._tiles[rt[2].key]&&this._tiles[rt[3].key]&&(q[rt[0].key]=M[rt[0].key]=rt[0],q[rt[1].key]=M[rt[1].key]=rt[1],q[rt[2].key]=M[rt[2].key]=rt[2],q[rt[3].key]=M[rt[3].key]=rt[3],delete j[$])}for(const $ in j){const rt=this.findLoadedParent(j[$],this._source.minzoom);if(rt){q[rt.tileID.key]=M[rt.tileID.key]=rt.tileID;for(const ct in q)q[ct].isChildOf(rt.tileID)&&delete q[ct]}}for(const $ in this._tiles)q[$]||(this._coveredTiles[$]=!0)}}for(const A in M)this._tiles[A].clearFadeHold();const S=o.keysDifference(this._tiles,M);for(const A of S){const P=this._tiles[A];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){const l={},u={},m=Math.max(s-Xe.maxOverzooming,this._source.minzoom),v=Math.max(s+Xe.maxUnderzooming,this._source.minzoom),b={};for(const M of e){const S=this._addTile(M);l[M.key]=M,S.hasData()||s<this._source.maxzoom&&(b[M.key]=M)}this._retainLoadedChildren(b,s,v,l);for(const M of e){let S=this._tiles[M.key];if(S.hasData())continue;if(s+1>this._source.maxzoom){const P=M.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){l[P.key]=P;continue}}else{const P=M.children(this._source.maxzoom);if(l[P[0].key]&&l[P[1].key]&&l[P[2].key]&&l[P[3].key])continue}let A=S.wasRequested();for(let P=M.overscaledZ-1;P>=m;--P){const F=M.scaledTo(P);if(u[F.key])break;if(u[F.key]=!0,S=this.getTile(F),!S&&A&&(S=this._addTile(F)),S){const G=S.hasData();if((A||G)&&(l[F.key]=F),A=S.wasRequested(),G)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const m=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;u=m}for(const m of s)this._loadedParentTiles[m]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Vs(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new o.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],m=this.transform;if(!m)return u;const v=l?m.getCameraQueryGeometry(e):e,b=e.map(q=>m.pointCoordinate(q,this.terrain)),M=v.map(q=>m.pointCoordinate(q,this.terrain)),S=this.getIds();let A=1/0,P=1/0,F=-1/0,G=-1/0;for(const q of M)A=Math.min(A,q.x),P=Math.min(P,q.y),F=Math.max(F,q.x),G=Math.max(G,q.y);for(let q=0;q<S.length;q++){const j=this._tiles[S[q]];if(j.holdingForFade())continue;const $=j.tileID,rt=Math.pow(2,m.zoom-j.tileID.overscaledZ),ct=s*j.queryPadding*o.EXTENT/j.tileSize/rt,K=[$.getTilePoint(new o.MercatorCoordinate(A,P)),$.getTilePoint(new o.MercatorCoordinate(F,G))];if(K[0].x-ct<o.EXTENT&&K[0].y-ct<o.EXTENT&&K[1].x+ct>=0&&K[1].y+ct>=0){const st=b.map(pt=>$.getTilePoint(pt)),dt=M.map(pt=>$.getTilePoint(pt));u.push({tile:j,tileID:$,queryGeometry:st,cameraQueryGeometry:dt,scale:rt})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ua(this._source.type)){const e=o.browser.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function Fa(d,e){const s=Math.abs(2*d.wrap)-+(d.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||l-s||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function ua(d){return d==="raster"||d==="image"||d==="video"}Xe.maxOverzooming=10,Xe.maxUnderzooming=3;const Lt="mapboxgl_preloaded_worker_pool";class qi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<qi.workerCount;)this.workers.push(new Worker(o.config.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Lt]}numActive(){return Object.keys(this.active).length}}const Wi=Math.floor(o.browser.hardwareConcurrency/2);let is;function bs(){return is||(is=new qi),is}qi.workerCount=o.isSafari(globalThis)?Math.max(Math.min(Wi,3),1):1;class Rt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.clamp(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const m=s-1,v=this._distances[m],b=l-v,M=b>0?(u-v)/b:0;return this.points[m].mult(1-M).add(this.points[s].mult(M))}}function he(d,e){let s=!0;return d==="always"||d!=="never"&&e!=="never"||(s=!1),s}class ce{constructor(e,s,l){const u=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,m){this._forEachCell(s,l,u,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(m)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,m,v){this.boxCells[m].push(v)}_insertCircleCell(e,s,l,u,m,v){this.circleCells[m].push(v)}_query(e,s,l,u,m,v,b){if(l<0||e>this.width||u<0||s>this.height)return[];const M=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(m)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let S=0;S<this.boxKeys.length;S++)M.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const A=this.circles[3*S],P=this.circles[3*S+1],F=this.circles[3*S+2];M.push({key:this.circleKeys[S],x1:A-F,y1:P-F,x2:A+F,y2:P+F})}}else this._forEachCell(e,s,l,u,this._queryCell,M,{hitTest:m,overlapMode:v,seenUids:{box:{},circle:{}}},b);return M}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,m,v){return this._query(e,s,l,u,!0,m,v).length>0}hitTestCircle(e,s,l,u,m){const v=e-l,b=e+l,M=s-l,S=s+l;if(b<0||v>this.width||S<0||M>this.height)return!1;const A=[];return this._forEachCell(v,M,b,S,this._queryCellCircle,A,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},m),A.length>0}_queryCell(e,s,l,u,m,v,b,M){const{seenUids:S,hitTest:A,overlapMode:P}=b,F=this.boxCells[m];if(F!==null){const q=this.bboxes;for(const j of F)if(!S.box[j]){S.box[j]=!0;const $=4*j,rt=this.boxKeys[j];if(e<=q[$+2]&&s<=q[$+3]&&l>=q[$+0]&&u>=q[$+1]&&(!M||M(rt))&&(!A||!he(P,rt.overlapMode))&&(v.push({key:rt,x1:q[$],y1:q[$+1],x2:q[$+2],y2:q[$+3]}),A))return!0}}const G=this.circleCells[m];if(G!==null){const q=this.circles;for(const j of G)if(!S.circle[j]){S.circle[j]=!0;const $=3*j,rt=this.circleKeys[j];if(this._circleAndRectCollide(q[$],q[$+1],q[$+2],e,s,l,u)&&(!M||M(rt))&&(!A||!he(P,rt.overlapMode))){const ct=q[$],K=q[$+1],st=q[$+2];if(v.push({key:rt,x1:ct-st,y1:K-st,x2:ct+st,y2:K+st}),A)return!0}}}return!1}_queryCellCircle(e,s,l,u,m,v,b,M){const{circle:S,seenUids:A,overlapMode:P}=b,F=this.boxCells[m];if(F!==null){const q=this.bboxes;for(const j of F)if(!A.box[j]){A.box[j]=!0;const $=4*j,rt=this.boxKeys[j];if(this._circleAndRectCollide(S.x,S.y,S.radius,q[$+0],q[$+1],q[$+2],q[$+3])&&(!M||M(rt))&&!he(P,rt.overlapMode))return v.push(!0),!0}}const G=this.circleCells[m];if(G!==null){const q=this.circles;for(const j of G)if(!A.circle[j]){A.circle[j]=!0;const $=3*j,rt=this.circleKeys[j];if(this._circlesCollide(q[$],q[$+1],q[$+2],S.x,S.y,S.radius)&&(!M||M(rt))&&!he(P,rt.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,m,v,b,M){const S=this._convertToXCellCoord(e),A=this._convertToYCellCoord(s),P=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let G=S;G<=P;G++)for(let q=A;q<=F;q++)if(m.call(this,e,s,l,u,this.xCellCount*q+G,v,b,M))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,m,v){const b=u-e,M=m-s,S=l+v;return S*S>b*b+M*M}_circleAndRectCollide(e,s,l,u,m,v,b){const M=(v-u)/2,S=Math.abs(e-(u+M));if(S>M+l)return!1;const A=(b-m)/2,P=Math.abs(s-(m+A));if(P>A+l)return!1;if(S<=M||P<=A)return!0;const F=S-M,G=P-A;return F*F+G*G<=l*l}}function ki(d,e,s,l,u){const m=o.create();return e?(o.scale(m,m,[1/u,1/u,1]),s||o.rotateZ(m,m,l.angle)):o.multiply(m,l.labelPlaneMatrix,d),m}function rs(d,e,s,l,u){if(e){const m=o.clone(d);return o.scale(m,m,[u,u,1]),s||o.rotateZ(m,m,-l.angle),m}return l.glCoordMatrix}function se(d,e,s){let l;s?(l=[d.x,d.y,s(d.x,d.y),1],o.transformMat4(l,l,e)):(l=[d.x,d.y,0,1],H(l,l,e));const u=l[3];return{point:new o.Point(l[0]/u,l[1]/u),signedDistanceFromCamera:u}}function qr(d,e){return .5+d/e*.5}function Gr(d,e){const s=d[0]/d[3],l=d[1]/d[3];return s>=-e[0]&&s<=e[0]&&l>=-e[1]&&l<=e[1]}function ws(d,e,s,l,u,m,v,b,M,S){const A=l?d.textSizeData:d.iconSizeData,P=o.evaluateSizeForZoom(A,s.transform.zoom),F=[256/s.width*2+1,256/s.height*2+1],G=l?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;G.clear();const q=d.lineVertexArray,j=l?d.text.placedSymbolArray:d.icon.placedSymbolArray,$=s.transform.width/s.transform.height;let rt=!1;for(let ct=0;ct<j.length;ct++){const K=j.get(ct);if(K.hidden||K.writingMode===o.WritingMode.vertical&&!rt){V(K.numGlyphs,G);continue}let st;if(rt=!1,S?(st=[K.anchorX,K.anchorY,S(K.anchorX,K.anchorY),1],o.transformMat4(st,st,e)):(st=[K.anchorX,K.anchorY,0,1],H(st,st,e)),!Gr(st,F)){V(K.numGlyphs,G);continue}const dt=qr(s.transform.cameraToCenterDistance,st[3]),pt=o.evaluateSizeForFeature(A,P,K),_t=v?pt/dt:pt*dt,Et=new o.Point(K.anchorX,K.anchorY),xt=se(Et,u,S).point,It={projections:{},offsets:{}},jt=Ci(K,_t,!1,b,e,u,m,d.glyphOffsetArray,q,G,xt,Et,It,$,M,S);rt=jt.useVertical,(jt.notEnoughRoom||rt||jt.needsFlipping&&Ci(K,_t,!0,b,e,u,m,d.glyphOffsetArray,q,G,xt,Et,It,$,M,S).notEnoughRoom)&&V(K.numGlyphs,G)}l?d.text.dynamicLayoutVertexBuffer.updateData(G):d.icon.dynamicLayoutVertexBuffer.updateData(G)}function xr(d,e,s,l,u,m,v,b,M,S,A,P,F){const G=b.glyphStartIndex+b.numGlyphs,q=b.lineStartIndex,j=b.lineStartIndex+b.lineLength,$=e.getoffsetX(b.glyphStartIndex),rt=e.getoffsetX(G-1),ct=D(d*$,s,l,u,m,v,b.segment,q,j,M,S,A,P,F);if(!ct)return null;const K=D(d*rt,s,l,u,m,v,b.segment,q,j,M,S,A,P,F);return K?{first:ct,last:K}:null}function Ms(d,e,s,l){return d===o.WritingMode.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(d===o.WritingMode.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function Ci(d,e,s,l,u,m,v,b,M,S,A,P,F,G,q,j){const $=e/24,rt=d.lineOffsetX*$,ct=d.lineOffsetY*$;let K;if(d.numGlyphs>1){const st=d.glyphStartIndex+d.numGlyphs,dt=d.lineStartIndex,pt=d.lineStartIndex+d.lineLength,_t=xr($,b,rt,ct,s,A,P,d,M,m,F,q,j);if(!_t)return{notEnoughRoom:!0};const Et=se(_t.first.point,v,j).point,xt=se(_t.last.point,v,j).point;if(l&&!s){const It=Ms(d.writingMode,Et,xt,G);if(It)return It}K=[_t.first];for(let It=d.glyphStartIndex+1;It<st-1;It++)K.push(D($*b.getoffsetX(It),rt,ct,s,A,P,d.segment,dt,pt,M,m,F,q,j));K.push(_t.last)}else{if(l&&!s){const dt=se(P,u,j).point,pt=d.lineStartIndex+d.segment+1,_t=new o.Point(M.getx(pt),M.gety(pt)),Et=se(_t,u,j),xt=Et.signedDistanceFromCamera>0?Et.point:Ue(P,_t,dt,1,u,j),It=Ms(d.writingMode,dt,xt,G);if(It)return It}const st=D($*b.getoffsetX(d.glyphStartIndex),rt,ct,s,A,P,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,M,m,F,q,j);if(!st)return{notEnoughRoom:!0};K=[st]}for(const st of K)o.addDynamicAttributes(S,st.point,st.angle);return{}}function Ue(d,e,s,l,u,m){const v=se(d.add(d.sub(e)._unit()),u,m).point,b=s.sub(v);return s.add(b._mult(l/b.mag()))}function Oa(d,e){const{projectionCache:s,lineVertexArray:l,labelPlaneMatrix:u,tileAnchorPoint:m,distanceFromAnchor:v,getElevation:b,previousVertex:M,direction:S,absOffsetX:A}=e;if(s.projections[d])return s.projections[d];const P=new o.Point(l.getx(d),l.gety(d)),F=se(P,u,b);if(F.signedDistanceFromCamera>0)return s.projections[d]=F.point,F.point;const G=d-S;return Ue(v===0?m:new o.Point(l.getx(G),l.gety(G)),P,M,A-v+1,u,b)}function Zr(d,e,s){return d._unit()._perp()._mult(e*s)}function X(d,e,s,l,u,m,v,b){const{projectionCache:M,direction:S}=b;if(M.offsets[d])return M.offsets[d];const A=s.add(e);if(d+S<l||d+S>=u)return M.offsets[d]=A,A;const P=Oa(d+S,b),F=Zr(P.sub(s),v,S),G=s.add(F),q=P.add(F);return M.offsets[d]=o.findLineIntersection(m,A,G,q)||A,M.offsets[d]}function D(d,e,s,l,u,m,v,b,M,S,A,P,F,G){const q=l?d-e:d+e;let j=q>0?1:-1,$=0;l&&(j*=-1,$=Math.PI),j<0&&($+=Math.PI);let rt,ct,K=j>0?b+v:b+v+1,st=u,dt=u,pt=0,_t=0;const Et=Math.abs(q),xt=[];let It;for(;pt+_t<=Et;){if(K+=j,K<b||K>=M)return null;pt+=_t,dt=st,ct=rt;const kt={projectionCache:P,lineVertexArray:S,labelPlaneMatrix:A,tileAnchorPoint:m,distanceFromAnchor:pt,getElevation:G,previousVertex:dt,direction:j,absOffsetX:Et};if(st=Oa(K,kt),s===0)xt.push(dt),It=st.sub(dt);else{let ie;const qt=st.sub(dt);ie=qt.mag()===0?Zr(Oa(K+j,kt).sub(st),s,j):Zr(qt,s,j),ct||(ct=dt.add(ie)),rt=X(K,ie,st,b,M,ct,s,kt),xt.push(ct),It=rt.sub(ct)}_t=It.mag()}const jt=It._mult((Et-pt)/_t)._add(ct||dt),ye=$+Math.atan2(st.y-dt.y,st.x-dt.x);return xt.push(jt),{point:jt,angle:F?ye:0,path:xt}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function V(d,e){for(let s=0;s<d;s++){const l=e.length;e.resize(l+4),e.float32.set(B,3*l)}}function H(d,e,s){const l=e[0],u=e[1];return d[0]=s[0]*l+s[4]*u+s[12],d[1]=s[1]*l+s[5]*u+s[13],d[3]=s[3]*l+s[7]*u+s[15],d}const Q=100;class at{constructor(e,s=new ce(e.width+200,e.height+200,25),l=new ce(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=l,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Q,this.screenBottomBoundary=e.height+Q,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,m,v){const b=this.projectAndGetPerspectiveRatio(u,e.anchorPointX,e.anchorPointY,v),M=l*b.perspectiveRatio,S=e.x1*M+b.point.x,A=e.y1*M+b.point.y,P=e.x2*M+b.point.x,F=e.y2*M+b.point.y;return!this.isInsideGrid(S,A,P,F)||s!=="always"&&this.grid.hitTest(S,A,P,F,s,m)||b.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[S,A,P,F],offscreen:this.isOffscreen(S,A,P,F)}}placeCollisionCircles(e,s,l,u,m,v,b,M,S,A,P,F,G,q){const j=[],$=new o.Point(s.anchorX,s.anchorY),rt=se($,v,q),ct=qr(this.transform.cameraToCenterDistance,rt.signedDistanceFromCamera),K=(A?m/ct:m*ct)/o.ONE_EM,st=se($,b,q).point,dt=xr(K,u,s.lineOffsetX*K,s.lineOffsetY*K,!1,st,$,s,l,b,{projections:{},offsets:{}},!1,q);let pt=!1,_t=!1,Et=!0;if(dt){const xt=.5*F*ct+G,It=new o.Point(-100,-100),jt=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),ye=new Rt,kt=dt.first,ie=dt.last;let qt=[];for(let ue=kt.path.length-1;ue>=1;ue--)qt.push(kt.path[ue]);for(let ue=1;ue<ie.path.length;ue++)qt.push(ie.path[ue]);const Ne=2.5*xt;if(M){const ue=qt.map(re=>se(re,M,q));qt=ue.some(re=>re.signedDistanceFromCamera<=0)?[]:ue.map(re=>re.point)}let me=[];if(qt.length>0){const ue=qt[0].clone(),re=qt[0].clone();for(let Je=1;Je<qt.length;Je++)ue.x=Math.min(ue.x,qt[Je].x),ue.y=Math.min(ue.y,qt[Je].y),re.x=Math.max(re.x,qt[Je].x),re.y=Math.max(re.y,qt[Je].y);me=ue.x>=It.x&&re.x<=jt.x&&ue.y>=It.y&&re.y<=jt.y?[qt]:re.x<It.x||ue.x>jt.x||re.y<It.y||ue.y>jt.y?[]:o.clipLine([qt],It.x,It.y,jt.x,jt.y)}for(const ue of me){ye.reset(ue,.25*xt);let re=0;re=ye.length<=.5*xt?1:Math.ceil(ye.paddedLength/Ne)+1;for(let Je=0;Je<re;Je++){const ze=Je/Math.max(re-1,1),Gi=ye.lerp(ze),wi=Gi.x+Q,oi=Gi.y+Q;j.push(wi,oi,xt,0);const Yi=wi-xt,Rr=oi-xt,ls=wi+xt,hs=oi+xt;if(Et=Et&&this.isOffscreen(Yi,Rr,ls,hs),_t=_t||this.isInsideGrid(Yi,Rr,ls,hs),e!=="always"&&this.grid.hitTestCircle(wi,oi,xt,e,P)&&(pt=!0,!S))return{circles:[],offscreen:!1,collisionDetected:pt}}}}return{circles:!S&&pt||!_t||ct<this.perspectiveRatioCutoff?[]:j,offscreen:Et,collisionDetected:pt}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,m=-1/0,v=-1/0;for(const A of e){const P=new o.Point(A.x+Q,A.y+Q);l=Math.min(l,P.x),u=Math.min(u,P.y),m=Math.max(m,P.x),v=Math.max(v,P.y),s.push(P)}const b=this.grid.query(l,u,m,v).concat(this.ignoredGrid.query(l,u,m,v)),M={},S={};for(const A of b){const P=A.key;if(M[P.bucketInstanceId]===void 0&&(M[P.bucketInstanceId]={}),M[P.bucketInstanceId][P.featureIndex])continue;const F=[new o.Point(A.x1,A.y1),new o.Point(A.x2,A.y1),new o.Point(A.x2,A.y2),new o.Point(A.x1,A.y2)];o.polygonIntersectsPolygon(s,F)&&(M[P.bucketInstanceId][P.featureIndex]=!0,S[P.bucketInstanceId]===void 0&&(S[P.bucketInstanceId]=[]),S[P.bucketInstanceId].push(P.featureIndex))}return S}insertCollisionBox(e,s,l,u,m,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,m,v){const b=l?this.ignoredGrid:this.grid,M={bucketInstanceId:u,featureIndex:m,collisionGroupID:v,overlapMode:s};for(let S=0;S<e.length;S+=4)b.insertCircle(M,e[S],e[S+1],e[S+2])}projectAndGetPerspectiveRatio(e,s,l,u){let m;return u?(m=[s,l,u(s,l),1],o.transformMat4(m,m,e)):(m=[s,l,0,1],H(m,m,e)),{point:new o.Point((m[0]/m[3]+1)/2*this.transform.width+Q,(-m[1]/m[3]+1)/2*this.transform.height+Q),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(e,s,l,u){return l<Q||e>=this.screenRightBoundary||u<Q||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=o.identity([]);return o.translate(e,e,[-100,-100,0]),e}}function et(d,e,s){return e*(o.EXTENT/(d.tileSize*Math.pow(2,s-d.tileID.overscaledZ)))}class tt{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class lt{constructor(e,s,l,u,m){this.text=new tt(e?e.text:null,s,l,m),this.icon=new tt(e?e.icon:null,s,u,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class bt{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class wt{constructor(e,s,l,u,m){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=m}}class te{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function le(d,e,s,l,u){const{horizontalAlign:m,verticalAlign:v}=o.getAnchorAlignment(d);return new o.Point(-(m-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}function Zt(d,e,s,l,u,m){const{x1:v,x2:b,y1:M,y2:S,anchorPointX:A,anchorPointY:P}=d,F=new o.Point(e,s);return l&&F._rotate(u?m:-m),{x1:v+F.x,y1:M+F.y,x2:b+F.x,y2:S+F.y,anchorPointX:A,anchorPointY:P}}class Jt{constructor(e,s,l,u,m){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new at(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new te(u),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,s,l,u){const m=l.getBucket(s),v=l.latestFeatureIndex;if(!m||!v||s.id!==m.layerIds[0])return;const b=l.collisionBoxArray,M=m.layers[0].layout,S=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),A=l.tileSize/o.EXTENT,P=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),F=M.get("text-pitch-alignment")==="map",G=M.get("text-rotation-alignment")==="map",q=et(l,1,this.transform.zoom),j=ki(P,F,G,this.transform,q);let $=null;if(F){const ct=rs(P,F,G,this.transform,q);$=o.multiply([],this.transform.labelPlaneMatrix,ct)}this.retainedQueryData[m.bucketInstanceId]=new wt(m.bucketInstanceId,v,m.sourceLayerIndex,m.index,l.tileID);const rt={bucket:m,layout:M,posMatrix:P,textLabelPlaneMatrix:j,labelToScreenMatrix:$,scale:S,textPixelRatio:A,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(u)for(const ct of m.sortKeyRanges){const{sortKey:K,symbolInstanceStart:st,symbolInstanceEnd:dt}=ct;e.push({sortKey:K,symbolInstanceStart:st,symbolInstanceEnd:dt,parameters:rt})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(e,s,l,u,m,v,b,M,S,A,P,F,G,q,j,$){const rt=o.TextAnchorEnum[e.textAnchor],ct=[e.textOffset0,e.textOffset1],K=le(rt,l,u,ct,m),st=this.collisionIndex.placeCollisionBox(Zt(s,K.x,K.y,v,b,this.transform.angle),P,M,S,A.predicate,$);if((!j||this.collisionIndex.placeCollisionBox(Zt(j,K.x,K.y,v,b,this.transform.angle),P,M,S,A.predicate,$).box.length!==0)&&st.box.length>0){let dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:ct,width:l,height:u,anchor:rt,textBoxScale:m,prevAnchor:dt},this.markUsedJustification(G,rt,F,q),G.allowVerticalPlacement&&(this.markUsedOrientation(G,q,F),this.placedOrientations[F.crossTileID]=q),{shift:K,placedGlyphBoxes:st}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:m,posMatrix:v,textLabelPlaneMatrix:b,labelToScreenMatrix:M,textPixelRatio:S,holdingForFade:A,collisionBoxArray:P,partiallyEvaluatedTextSize:F,collisionGroup:G}=e.parameters,q=m.get("text-optional"),j=m.get("icon-optional"),$=o.getOverlapMode(m,"text-overlap","text-allow-overlap"),rt=$==="always",ct=o.getOverlapMode(m,"icon-overlap","icon-allow-overlap"),K=ct==="always",st=m.get("text-rotation-alignment")==="map",dt=m.get("text-pitch-alignment")==="map",pt=m.get("icon-text-fit")!=="none",_t=m.get("symbol-z-order")==="viewport-y",Et=rt&&(K||!u.hasIconData()||j),xt=K&&(rt||!u.hasTextData()||q);!u.collisionArrays&&P&&u.deserializeCollisionBoxes(P);const It=this.retainedQueryData[u.bucketInstanceId].tileID,jt=this.terrain?(kt,ie)=>this.terrain.getElevation(It,kt,ie):null,ye=(kt,ie)=>{var qt,Ne;if(s[kt.crossTileID])return;if(A)return void(this.placements[kt.crossTileID]=new vt(!1,!1,!1));let me=!1,ue=!1,re=!0,Je=null,ze={box:null,offscreen:null},Gi={box:null,offscreen:null},wi=null,oi=null,Yi=null,Rr=0,ls=0,hs=0;ie.textFeatureIndex?Rr=ie.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Rr=kt.featureIndex),ie.verticalTextFeatureIndex&&(ls=ie.verticalTextFeatureIndex);const Cs=ie.textBox;if(Cs){const Mi=di=>{let Ei=o.WritingMode.horizontal;if(u.allowVerticalPlacement&&!di&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[kt.crossTileID];Ji&&(this.placedOrientations[kt.crossTileID]=Ji,Ei=Ji,this.markUsedOrientation(u,Ei,kt))}return Ei},Qe=(di,Ei)=>{if(u.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&ie.verticalTextBox){for(const Ji of u.writingModes)if(Ji===o.WritingMode.vertical?(ze=Ei(),Gi=ze):ze=di(),ze&&ze.box&&ze.box.length)break}else ze=di()},Ti=kt.textAnchorOffsetStartIndex,Ta=kt.textAnchorOffsetEndIndex;if(Ta===Ti){const di=(Ei,Ji)=>{const Ke=this.collisionIndex.placeCollisionBox(Ei,$,S,v,G.predicate,jt);return Ke&&Ke.box&&Ke.box.length&&(this.markUsedOrientation(u,Ji,kt),this.placedOrientations[kt.crossTileID]=Ji),Ke};Qe(()=>di(Cs,o.WritingMode.horizontal),()=>{const Ei=ie.verticalTextBox;return u.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Ei?di(Ei,o.WritingMode.vertical):{box:null,offscreen:null}}),Mi(ze&&ze.box&&ze.box.length)}else{let di=o.TextAnchorEnum[(Ne=(qt=this.prevPlacement)===null||qt===void 0?void 0:qt.variableOffsets[kt.crossTileID])===null||Ne===void 0?void 0:Ne.anchor];const Ei=(Ke,Ea,cs)=>{const Br=Ke.x2-Ke.x1,zs=Ke.y2-Ke.y1,vh=kt.textBoxScale,ia=pt&&ct==="never"?Ea:null;let Sa={box:[],offscreen:!1},el=$==="never"?1:2,Ye="never";di&&el++;for(let Kn=0;Kn<el;Kn++){for(let Yn=Ti;Yn<Ta;Yn++){const ks=u.textAnchorOffsets.get(Yn);if(di&&ks.textAnchor!==di)continue;const us=this.attemptAnchorPlacement(ks,Ke,Br,zs,vh,st,dt,S,v,G,Ye,kt,u,cs,ia,jt);if(us&&(Sa=us.placedGlyphBoxes,Sa&&Sa.box&&Sa.box.length))return me=!0,Je=us.shift,Sa}di?di=null:Ye=$}return Sa};Qe(()=>Ei(Cs,ie.iconBox,o.WritingMode.horizontal),()=>{const Ke=ie.verticalTextBox;return u.allowVerticalPlacement&&!(ze&&ze.box&&ze.box.length)&&kt.numVerticalGlyphVertices>0&&Ke?Ei(Ke,ie.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),ze&&(me=ze.box,re=ze.offscreen);const Ji=Mi(ze&&ze.box);if(!me&&this.prevPlacement){const Ke=this.prevPlacement.variableOffsets[kt.crossTileID];Ke&&(this.variableOffsets[kt.crossTileID]=Ke,this.markUsedJustification(u,Ke.anchor,kt,Ji))}}}if(wi=ze,me=wi&&wi.box&&wi.box.length>0,re=wi&&wi.offscreen,kt.useRuntimeCollisionCircles){const Mi=u.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),Qe=o.evaluateSizeForFeature(u.textSizeData,F,Mi),Ti=m.get("text-padding");oi=this.collisionIndex.placeCollisionCircles($,Mi,u.lineVertexArray,u.glyphOffsetArray,Qe,v,b,M,l,dt,G.predicate,kt.collisionCircleDiameter,Ti,jt),oi.circles.length&&oi.collisionDetected&&!l&&o.warnOnce("Collisions detected, but collision boxes are not shown"),me=rt||oi.circles.length>0&&!oi.collisionDetected,re=re&&oi.offscreen}if(ie.iconFeatureIndex&&(hs=ie.iconFeatureIndex),ie.iconBox){const Mi=Qe=>{const Ti=pt&&Je?Zt(Qe,Je.x,Je.y,st,dt,this.transform.angle):Qe;return this.collisionIndex.placeCollisionBox(Ti,ct,S,v,G.predicate,jt)};Gi&&Gi.box&&Gi.box.length&&ie.verticalIconBox?(Yi=Mi(ie.verticalIconBox),ue=Yi.box.length>0):(Yi=Mi(ie.iconBox),ue=Yi.box.length>0),re=re&&Yi.offscreen}const ea=q||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,Ps=j||kt.numIconVertices===0;if(ea||Ps?Ps?ea||(ue=ue&&me):me=ue&&me:ue=me=ue&&me,me&&wi&&wi.box&&this.collisionIndex.insertCollisionBox(wi.box,$,m.get("text-ignore-placement"),u.bucketInstanceId,Gi&&Gi.box&&ls?ls:Rr,G.ID),ue&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,ct,m.get("icon-ignore-placement"),u.bucketInstanceId,hs,G.ID),oi&&(me&&this.collisionIndex.insertCollisionCircles(oi.circles,$,m.get("text-ignore-placement"),u.bucketInstanceId,Rr,G.ID),l)){const Mi=u.bucketInstanceId;let Qe=this.collisionCircleArrays[Mi];Qe===void 0&&(Qe=this.collisionCircleArrays[Mi]=new bt);for(let Ti=0;Ti<oi.circles.length;Ti+=4)Qe.circles.push(oi.circles[Ti+0]),Qe.circles.push(oi.circles[Ti+1]),Qe.circles.push(oi.circles[Ti+2]),Qe.circles.push(oi.collisionDetected?1:0)}if(kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new vt(me||Et,ue||xt,re||u.justReloaded),s[kt.crossTileID]=!0};if(_t){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=u.getSortedSymbolIndexes(this.transform.angle);for(let ie=kt.length-1;ie>=0;--ie){const qt=kt[ie];ye(u.symbolInstances.get(qt),u.collisionArrays[qt])}}else for(let kt=e.symbolInstanceStart;kt<e.symbolInstanceEnd;kt++)ye(u.symbolInstances.get(kt),u.collisionArrays[kt]);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[u.bucketInstanceId];o.invert(kt.invProjMatrix,v),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(e,s,l,u){let m;m=u===o.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,m=s===o.WritingMode.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of v)e.text.placedSymbolArray.get(b).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,m=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const M in this.placements){const S=this.placements[M],A=m[M];A?(this.opacities[M]=new lt(A,u,S.text,S.icon),l=l||S.text!==A.text.placed||S.icon!==A.icon.placed):(this.opacities[M]=new lt(null,u,S.text,S.icon,S.skipFade),l=l||S.text||S.icon)}for(const M in m){const S=m[M];if(!this.opacities[M]){const A=new lt(S,u,!1,!1);A.isHidden()||(this.opacities[M]=A,l=l||S.text.placed||S.icon.placed)}}for(const M in v)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=v[M]);for(const M in b)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=b[M]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const m=u.getBucket(e);m&&u.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const u=e.layers[0],m=u.layout,v=new lt(null,0,!1,!1,!0),b=m.get("text-allow-overlap"),M=m.get("icon-allow-overlap"),S=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=m.get("text-rotation-alignment")==="map",P=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",G=new lt(null,0,b&&(M||!e.hasIconData()||m.get("icon-optional")),M&&(b||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const q=(j,$,rt)=>{for(let ct=0;ct<$/4;ct++)j.opacityVertexArray.emplaceBack(rt);j.hasVisibleVertices=j.hasVisibleVertices||rt!==ei};for(let j=0;j<e.symbolInstances.length;j++){const $=e.symbolInstances.get(j),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:ct,crossTileID:K}=$;let st=this.opacities[K];s[K]?st=v:st||(st=G,this.opacities[K]=st),s[K]=!0;const dt=$.numIconVertices>0,pt=this.placedOrientations[$.crossTileID],_t=pt===o.WritingMode.vertical,Et=pt===o.WritingMode.horizontal||pt===o.WritingMode.horizontalOnly;if(rt>0||ct>0){const xt=Pi(st.text);q(e.text,rt,_t?ei:xt),q(e.text,ct,Et?ei:xt);const It=st.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(kt=>{kt>=0&&(e.text.placedSymbolArray.get(kt).hidden=It||_t?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=It||Et?1:0);const jt=this.variableOffsets[$.crossTileID];jt&&this.markUsedJustification(e,jt.anchor,$,pt);const ye=this.placedOrientations[$.crossTileID];ye&&(this.markUsedJustification(e,"left",$,ye),this.markUsedOrientation(e,ye,$))}if(dt){const xt=Pi(st.icon),It=!(F&&$.verticalPlacedIconSymbolIndex&&_t);$.placedIconSymbolIndex>=0&&(q(e.icon,$.numIconVertices,It?xt:ei),e.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=st.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,$.numVerticalIconVertices,It?ei:xt),e.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const xt=e.collisionArrays[j];if(xt){let It=new o.Point(0,0);if(xt.textBox||xt.verticalTextBox){let ye=!0;if(S){const kt=this.variableOffsets[K];kt?(It=le(kt.anchor,kt.width,kt.height,kt.textOffset,kt.textBoxScale),A&&It._rotate(P?this.transform.angle:-this.transform.angle)):ye=!1}xt.textBox&&ne(e.textCollisionBox.collisionVertexArray,st.text.placed,!ye||_t,It.x,It.y),xt.verticalTextBox&&ne(e.textCollisionBox.collisionVertexArray,st.text.placed,!ye||Et,It.x,It.y)}const jt=!!(!Et&&xt.verticalIconBox);xt.iconBox&&ne(e.iconCollisionBox.collisionVertexArray,st.icon.placed,jt,F?It.x:0,F?It.y:0),xt.verticalIconBox&&ne(e.iconCollisionBox.collisionVertexArray,st.icon.placed,!jt,F?It.x:0,F?It.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=j.invProjMatrix,e.placementViewportMatrix=j.viewportMatrix,e.collisionCircleArray=j.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function ne(d,e,s,l,u){d.emplaceBack(e?1:0,s?1:0,l||0,u||0),d.emplaceBack(e?1:0,s?1:0,l||0,u||0),d.emplaceBack(e?1:0,s?1:0,l||0,u||0),d.emplaceBack(e?1:0,s?1:0,l||0,u||0)}const Me=Math.pow(2,25),Le=Math.pow(2,24),ge=Math.pow(2,17),we=Math.pow(2,16),Hi=Math.pow(2,9),ae=Math.pow(2,8),ui=Math.pow(2,1);function Pi(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,s=Math.floor(127*d.opacity);return s*Me+e*Le+s*ge+e*we+s*Hi+e*ae+s*ui+e}const ei=0;class lr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,m){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((b,M)=>b.sortKey-M.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class uc{constructor(e,s,l,u,m,v,b,M){this.placement=new Jt(e,s,v,b,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=o.browser.now(),m=()=>!this._forceFullPlacement&&o.browser.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new lr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Di=512/o.EXTENT/2;class br{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let m=0;m<s.length;m++){const v=s.get(m),b=v.key,M=u.get(b);M?M.push(v):u.set(b,[v])}for(const[m,v]of u){const b={positions:v.map(M=>({x:Math.floor(M.anchorX*Di),y:Math.floor(M.anchorY*Di)})),crossTileIDs:v.map(M=>M.crossTileID)};if(b.positions.length>128){const M=new o.KDBush(b.positions.length,16,Uint16Array);for(const{x:S,y:A}of b.positions)M.add(S,A);M.finish(),delete b.positions,b.index=M}this._symbolsByKey[m]=b}}getScaledCoordinates(e,s){const{x:l,y:u,z:m}=this.tileID.canonical,{x:v,y:b,z:M}=s.canonical,S=Di/Math.pow(2,M-m),A=(b*o.EXTENT+e.anchorY)*S,P=u*o.EXTENT*Di;return{x:Math.floor((v*o.EXTENT+e.anchorX)*S-l*o.EXTENT*Di),y:Math.floor(A-P)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let m=0;m<e.length;m++){const v=e.get(m);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const M=this.getScaledCoordinates(v,s);if(b.index){const S=b.index.range(M.x-u,M.y-u,M.x+u,M.y+u).sort();for(const A of S){const P=b.crossTileIDs[A];if(!l[P]){l[P]=!0,v.crossTileID=P;break}}}else if(b.positions)for(let S=0;S<b.positions.length;S++){const A=b.positions[S],P=b.crossTileIDs[S];if(Math.abs(A.x-M.x)<=u&&Math.abs(A.y-M.y)<=u&&!l[P]){l[P]=!0,v.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ul{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],m={};for(const v in u){const b=u[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),m[b.tileID.key]=b}this.indexes[l]=m}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<s.symbolInstances.length;m++)s.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const v=this.indexes[m];if(Number(m)>e.overscaledZ)for(const b in v){const M=v[b];M.tileID.isChildOf(e)&&M.findMatches(s.symbolInstances,e,u)}else{const b=v[e.scaledTo(Number(m)).key];b&&b.findMatches(s.symbolInstances,e,u)}}for(let m=0;m<s.symbolInstances.length;m++){const v=s.symbolInstances.get(m);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new br(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const m in u)e[u[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[m]),delete u[m],s=!0)}return s}}class ii{constructor(){this.layerIndexes={},this.crossTileIDs=new Ul,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new gn);let m=!1;const v={};u.handleWrapJump(l);for(const b of s){const M=b.getBucket(e);M&&e.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(b.tileID,M,this.crossTileIDs)&&(m=!0),v[M.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(m=!0),m}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Ts=(d,e)=>o.emitValidationErrors(d,e&&e.filter(s=>s.identifier!=="source.canvas")),$s=o.pick(o.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ri=o.pick(o.operations,["setCenter","setZoom","setBearing","setPitch"]),_n=o.emptyStyle();class Li extends o.Evented{constructor(e,s={}){super(),this.map=e,this.dispatcher=new Ai(bs(),this,e._getMapId()),this.imageManager=new mi,this.imageManager.setEventedParent(this),this.glyphManager=new Ni(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Cr(256,512),this.crossTileSymbolIndex=new ii,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const l=this;this._rtlTextPluginCallback=Li.registerForPluginStateChange(u=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(m,v)=>{if(o.triggerPluginCompletionEvent(m),v&&v.every(b=>b))for(const b in l.sourceCaches){const M=l.sourceCaches[b].getSource().type;M!=="vector"&&M!=="geojson"||l.sourceCaches[b].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const m=this.sourceCaches[u.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const b in this._layers){const M=this._layers[b];M.source===v.id&&this._validateLayer(M)}})}loadURL(e,s={},l){this.fire(new o.Event("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,Dt.Style);this._request=o.getJSON(u,(m,v)=>{this._request=null,m?this.fire(new o.ErrorEvent(m)):v&&this._load(v,s,l)})}loadJSON(e,s={},l){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(()=>{this._request=null,s.validate=s.validate!==!1,this._load(e,s,l)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(_n,{validate:!1})}_load(e,s,l){const u=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!Ts(this,o.validateStyle(u))){this._loaded=!0,this.stylesheet=u;for(const m in u.sources)this.addSource(m,u.sources[m],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs),this._createLayers(),this.light=new ha(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}}_createLayers(){const e=o.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=o.createStyleLayer(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,m,v,b){const M=xe(u),S=M.length,A=v>1?"@2x":"",P={},F={},G={};for(const{id:q,url:j}of M){const $=m.transformRequest(m.normalizeSpriteURL(j,A,".json"),Dt.SpriteJSON),rt=`${q}_${$.url}`;P[rt]=o.getJSON($,(st,dt)=>{delete P[rt],F[q]=dt,Ce(b,F,G,st,S)});const ct=m.transformRequest(m.normalizeSpriteURL(j,A,".png"),Dt.SpriteImage),K=`${q}_${ct.url}`;P[K]=Tt.getImage(ct,(st,dt)=>{delete P[K],G[q]=dt,Ce(b,F,G,st,S)})}return{cancel(){for(const q of Object.values(P))q.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),(u,m)=>{if(this._spriteRequest=null,u)this.fire(new o.ErrorEvent(u));else if(m)for(const v in m){this._spritesImagesIds[v]=[];const b=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(M=>!(M in m)):[];for(const M of b)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in m[v]){const S=v==="default"?M:`${v}:${M}`;this._spritesImagesIds[v].push(S),S in this.imageManager.images?this.imageManager.updateImage(S,m[v][M],!1):this.imageManager.addImage(S,m[v][M]),s&&(this._changedImages[S]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){const s=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s);const l=[];for(const u of e)s[u]&&l.push(s[u]);return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(u.length||m.length)&&this._updateWorkerLayers(u,m);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const m=this.sourceCaches[u];l[u]=m.used,m.used=!1}for(const u of this._order){const m=this._layers[u];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const u in l){const m=this.sourceCaches[u];l[u]!==m.used&&m.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.z=e.zoom,s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(e),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){this._checkLoaded();const l=this.serialize();if(e=s.transformStyle?s.transformStyle(l,e):e,Ts(this,o.validateStyle(e)))return!1;(e=o.clone$1(e)).layers=o.derefLayers(e.layers);const u=o.diffStyles(l,e).filter(v=>!(v.command in ri));if(u.length===0)return!1;const m=u.filter(v=>!(v.command in $s));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);for(const v of u)v.command!=="setTransition"&&this[v.command].apply(this,v.args);return this.stylesheet=e,!0}addImage(e,s){if(this.getImage(e))return this.fire(new o.ErrorEvent(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.ErrorEvent(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateStyle.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new Xe(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new o.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new o.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let m;if(e.type==="custom"){if(Ts(this,o.validateCustomStyleLayer(e)))return;m=o.createStyleLayer(e)}else{if(typeof e.source=="object"&&(this.addSource(u,e.source),e=o.clone$1(e),e=o.extend(e,{source:u})),this._validate(o.validateStyle.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;m=o.createStyleLayer(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=m,this._removedLayers[u]&&m.source&&m.type!=="custom"){const b=this._removedLayers[u];delete this._removedLayers[u],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!o.deepEqual(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(o.validateStyle.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=o.clone$1(s),this._updateLayer(u)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const m=this.getLayer(e);m?o.deepEqual(m.getLayoutProperty(s),l)||(m.setLayoutProperty(s,l,u),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const m=this.getLayer(e);m?o.deepEqual(m.getPaintProperty(s),l)||(m.setPaintProperty(s,l,u)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const v=m.getSource().type;v==="geojson"&&u?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),m.setFeatureState(u,e.id,s)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const m=u.getSource().type,v=m==="vector"?e.sourceLayer:void 0;m!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.mapObject(this.sourceCaches,u=>u.serialize()),s=this._serializeByIds(this._order),l=this.stylesheet;return o.filterObject({version:l.version,name:l.name,metadata:l.metadata,light:l.light,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:e,layers:s},u=>u!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b)){l[b]=v;for(const M of e){const S=M[b];if(S)for(const A of S)u.push(A)}}}u.sort((v,b)=>b.intersectionZ-v.intersectionZ);const m=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b))for(let M=u.length-1;M>=0;M--){const S=u[M].feature;if(l[S.layer.id]<v)break;m.push(S),u.pop()}else for(const M of e){const S=M[b];if(S)for(const A of S)m.push(A.feature)}}return m}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const b of s.layers){const M=this._layers[b];if(!M)return this.fire(new o.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];u[M.source]=!0}}const m=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const b in this.sourceCaches)s.layers&&!u[b]||m.push(Ie(this.sourceCaches[b],this._layers,v,e,s,l));return this.placement&&m.push(function(b,M,S,A,P,F,G){const q={},j=F.queryRenderedSymbols(A),$=[];for(const rt of Object.keys(j).map(Number))$.push(G[rt]);$.sort(Ns);for(const rt of $){const ct=rt.featureIndex.lookupSymbolFeatures(j[rt.bucketInstanceId],M,rt.bucketIndex,rt.sourceLayerIndex,P.filter,P.layers,P.availableImages,b);for(const K in ct){const st=q[K]=q[K]||[],dt=ct[K];dt.sort((pt,_t)=>{const Et=rt.featureSortOrder;if(Et){const xt=Et.indexOf(pt.featureIndex);return Et.indexOf(_t.featureIndex)-xt}return _t.featureIndex-pt.featureIndex});for(const pt of dt)st.push(pt)}}for(const rt in q)q[rt].forEach(ct=>{const K=ct.feature,st=S[b[rt].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=st});return q}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,s){s&&s.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,m){const v=u.getRenderableIds().map(S=>u.getTileByID(S)),b=[],M={};for(let S=0;S<v.length;S++){const A=v[S],P=A.tileID.canonical.key;M[P]||(M[P]=!0,A.querySourceFeatures(b,m))}return b}(l,s):[]}addSourceType(e,s,l){return ca(e)?l(new Error(`A source type called "${e}" already exists.`)):(((u,m)=>{es[u]=m})(e,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:s.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!o.deepEqual(e[v],l[v])){u=!0;break}if(!u)return;const m={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(m)}_validate(e,s,l,u,m={}){return(!m||m.validate!==!1)&&Ts(this,e.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:l,styleSpec:o.v8Spec},u)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,m=!1){let v=!1,b=!1;const M={};for(const S of this._order){const A=this._layers[S];if(A.type!=="symbol")continue;if(!M[A.source]){const F=this.sourceCaches[A.source];M[A.source]=F.getRenderableIds(!0).map(G=>F.getTileByID(G)).sort((G,q)=>q.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(q.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(A,M[A.source],e.center.lng);v=v||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),e.zoom))&&(this.pauseablePlacement=new uc(e,this.map.terrain,this._order,m,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const S of this._order){const A=this._layers[S];A.type==="symbol"&&this.placement.updateLayerOpacities(A,M[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s,l){this.imageManager.getImages(s.icons,l),this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];u&&u.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(e,s,l){this.glyphManager.getGlyphs(s.stacks,l);const u=this.sourceCaches[s.source];u&&u.setDependencies(s.tileID.key,s.type,[""])}getResource(e,s,l){return o.makeRequest(s,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(o.validateStyle.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const m=[{id:e,url:s}],v=[...xe(this.stylesheet.sprite),...m];this._validate(o.validateStyle.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(m,!0,u))}removeSprite(e){this._checkLoaded();const s=xe(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return xe(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(o.validateStyle.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}Li.registerForPluginStateChange=o.registerForPluginStateChange;var yn=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),jr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ua={prelude:Pe(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Pe(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Pe(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Pe(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Pe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pe(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Pe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Pe("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Pe(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Pe(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Pe(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Pe(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Pe(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Pe(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Pe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pe(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Pe(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Pe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Pe(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Pe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Pe(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Pe(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Pe(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Pe(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Pe("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",jr),terrainDepth:Pe("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",jr),terrainCoords:Pe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",jr)};function Pe(d,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=m?m.concat(u):u,b={};return{fragmentSource:d=d.replace(s,(M,S,A,P,F)=>(b[F]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${P} ${F};
#else
uniform ${A} ${P} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${P} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(M,S,A,P,F)=>{const G=P==="float"?"vec2":"vec4",q=F.match(/color/)?"color":G;return b[F]?S==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${G} a_${F};
varying ${A} ${P} ${F};
#else
uniform ${A} ${P} u_${F};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${P} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${q}(a_${F}, u_${F}_t);
#else
    ${A} ${P} ${F} = u_${F};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${G} a_${F};
#else
uniform ${A} ${P} u_${F};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${P} ${F} = a_${F};
#else
    ${A} ${P} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${P} ${F} = unpack_mix_${q}(a_${F}, u_${F}_t);
#else
    ${A} ${P} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class vn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,m,v,b,M,S){this.context=e;let A=this.boundPaintVertexBuffers.length!==u.length;for(let P=0;!A&&P<u.length;P++)this.boundPaintVertexBuffers[P]!==u[P]&&(A=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==S?this.freshBind(s,l,u,m,v,b,M,S):(e.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),M&&M.bind(),S&&S.bind())}freshBind(e,s,l,u,m,v,b,M){const S=e.numAttributes,A=this.context,P=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=M,s.enableAttributes(P,e);for(const F of l)F.enableAttributes(P,e);v&&v.enableAttributes(P,e),b&&b.enableAttributes(P,e),M&&M.enableAttributes(P,e),s.bind(),s.setVertexAttribPointers(P,e,m);for(const F of l)F.bind(),F.setVertexAttribPointers(P,e,m);v&&(v.bind(),v.setVertexAttribPointers(P,e,m)),u&&u.bind(),b&&(b.bind(),b.setVertexAttribPointers(P,e,m)),M&&(M.bind(),M.setVertexAttribPointers(P,e,m)),A.currentNumAttributes=S}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function da(d){const e=[];for(let s=0;s<d.length;s++){if(d[s]===null)continue;const l=d[s].split(" ");e.push(l.pop())}return e}class Es{constructor(e,s,l,u,m,v){const b=e.gl;this.program=b.createProgram();const M=da(s.staticAttributes),S=l?l.getBinderAttributes():[],A=M.concat(S),P=Ua.prelude.staticUniforms?da(Ua.prelude.staticUniforms):[],F=s.staticUniforms?da(s.staticUniforms):[],G=l?l.getBinderUniforms():[],q=P.concat(F).concat(G),j=[];for(const pt of q)j.indexOf(pt)<0&&j.push(pt);const $=l?l.defines():[];m&&$.push("#define OVERDRAW_INSPECTOR;"),v&&$.push("#define TERRAIN3D;");const rt=$.concat(Ua.prelude.fragmentSource,s.fragmentSource).join(`
`),ct=$.concat(Ua.prelude.vertexSource,s.vertexSource).join(`
`),K=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(K,rt),b.compileShader(K),b.attachShader(this.program,K);const st=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(st,ct),b.compileShader(st),b.attachShader(this.program,st),this.attributes={};const dt={};this.numAttributes=A.length;for(let pt=0;pt<this.numAttributes;pt++)A[pt]&&(b.bindAttribLocation(this.program,pt,A[pt]),this.attributes[A[pt]]=pt);b.linkProgram(this.program),b.deleteShader(st),b.deleteShader(K);for(let pt=0;pt<j.length;pt++){const _t=j[pt];if(_t&&!dt[_t]){const Et=b.getUniformLocation(this.program,_t);Et&&(dt[_t]=Et)}}this.fixedUniforms=u(e,dt),this.terrainUniforms=((pt,_t)=>({u_depth:new o.Uniform1i(pt,_t.u_depth),u_terrain:new o.Uniform1i(pt,_t.u_terrain),u_terrain_dim:new o.Uniform1f(pt,_t.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(pt,_t.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(pt,_t.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(pt,_t.u_terrain_exaggeration)}))(e,dt),this.binderUniforms=l?l.getUniforms(e,dt):[]}draw(e,s,l,u,m,v,b,M,S,A,P,F,G,q,j,$,rt,ct){const K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(m),e.setCullFace(v),M){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,M.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,M.texture);for(const dt in this.terrainUniforms)this.terrainUniforms[dt].set(M[dt])}for(const dt in this.fixedUniforms)this.fixedUniforms[dt].set(b[dt]);j&&j.setUniforms(e,this.binderUniforms,G,{zoom:q});let st=0;switch(s){case K.LINES:st=2;break;case K.TRIANGLES:st=3;break;case K.LINE_STRIP:st=1}for(const dt of F.get()){const pt=dt.vaos||(dt.vaos={});(pt[S]||(pt[S]=new vn)).bind(e,this,A,j?j.getPaintVertexBuffers():[],P,dt.vertexOffset,$,rt,ct),K.drawElements(s,dt.primitiveLength*st,K.UNSIGNED_SHORT,dt.primitiveOffset*st*2)}}}function xn(d,e,s){const l=1/et(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=m*(s.tileID.canonical.x+s.tileID.wrap*u),b=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Na=(d,e,s,l)=>{const u=e.style.light,m=u.properties.get("position"),v=[m.x,m.y,m.z],b=function(){var S=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[5]=0,S[6]=0,S[7]=0),S[0]=1,S[4]=1,S[8]=1,S}();u.properties.get("anchor")==="viewport"&&function(S,A){var P=Math.sin(A),F=Math.cos(A);S[0]=F,S[1]=P,S[2]=0,S[3]=-P,S[4]=F,S[5]=0,S[6]=0,S[7]=0,S[8]=1}(b,-e.transform.angle),function(S,A,P){var F=A[0],G=A[1],q=A[2];S[0]=F*P[0]+G*P[3]+q*P[6],S[1]=F*P[1]+G*P[4]+q*P[7],S[2]=F*P[2]+G*P[5]+q*P[8]}(v,v,b);const M=u.properties.get("color");return{u_matrix:d,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+s,u_opacity:l}},dc=(d,e,s,l,u,m,v)=>o.extend(Na(d,e,s,l),xn(m,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Nl=d=>({u_matrix:d}),bn=(d,e,s,l)=>o.extend(Nl(d),xn(s,e,l)),pc=(d,e)=>({u_matrix:d,u_world:e}),Vl=(d,e,s,l,u)=>o.extend(bn(d,e,s,l),{u_world:u}),fc=(d,e,s,l)=>{const u=d.transform;let m,v;if(l.paint.get("circle-pitch-alignment")==="map"){const b=et(s,1,u.zoom);m=!0,v=[b,b]}else m=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:v}},$l=(d,e,s)=>{const l=et(s,1,e.zoom),u=Math.pow(2,e.zoom-s.tileID.overscaledZ),m=s.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[e.pixelsToGLUnits[0]/(l*u),e.pixelsToGLUnits[1]/(l*u)],u_overscale_factor:m}},ql=(d,e,s=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:s}),wn=d=>({u_matrix:d}),Gl=(d,e,s,l)=>({u_matrix:d,u_extrude_scale:et(e,1,s),u_intensity:l});function Zl(d,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new o.MercatorCoordinate(0,l/s).toLngLat().lat,new o.MercatorCoordinate(0,(l+1)/s).toLngLat().lat]}const Mn=(d,e,s,l)=>{const u=d.transform;return{u_matrix:Va(d,e,s,l),u_ratio:1/et(e,1,u.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},jl=(d,e,s,l,u)=>o.extend(Mn(d,e,s,u),{u_image:0,u_image_height:l}),qs=(d,e,s,l,u)=>{const m=d.transform,v=hr(e,m);return{u_matrix:Va(d,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/et(e,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Tn=(d,e,s,l,u,m)=>{const v=d.lineAtlas,b=hr(e,d.transform),M=s.layout.get("line-cap")==="round",S=v.getDash(l.from,M),A=v.getDash(l.to,M),P=S.width*u.fromScale,F=A.width*u.toScale;return o.extend(Mn(d,e,s,m),{u_patternscale_a:[b/P,-S.height/2],u_patternscale_b:[b/F,-A.height/2],u_sdfgamma:v.width/(256*Math.min(P,F)*d.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:A.y,u_mix:u.t})};function hr(d,e){return 1/et(d,1,e.tileZoom)}function Va(d,e,s,l){return d.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const En=(d,e,s,l,u)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(m=u.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:$a(u.paint.get("raster-hue-rotate"))};var m,v};function $a(d){d*=Math.PI/180;const e=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const qa=(d,e,s,l,u,m,v,b,M,S)=>{const A=u.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:A.width/A.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+M,u_pitch_with_map:+l,u_texsize:S,u_texture:0}},Ga=(d,e,s,l,u,m,v,b,M,S,A)=>{const P=u.transform;return o.extend(qa(d,e,s,l,u,m,v,b,M,S),{u_gamma_scale:l?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+A})},Za=(d,e,s,l,u,m,v,b,M,S)=>o.extend(Ga(d,e,s,l,u,m,v,b,!0,M,!0),{u_texsize_icon:S,u_texture_icon:1}),Gs=(d,e,s)=>({u_matrix:d,u_opacity:e,u_color:s}),Sn=(d,e,s,l,u,m)=>o.extend(function(v,b,M,S){const A=M.imageManager.getPattern(v.from.toString()),P=M.imageManager.getPattern(v.to.toString()),{width:F,height:G}=M.imageManager.getPixelSize(),q=Math.pow(2,S.tileID.overscaledZ),j=S.tileSize*Math.pow(2,M.transform.tileZoom)/q,$=j*(S.tileID.canonical.x+S.tileID.wrap*q),rt=j*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[F,G],u_mix:b.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/et(S,1,M.transform.tileZoom),u_pixel_coord_upper:[$>>16,rt>>16],u_pixel_coord_lower:[65535&$,65535&rt]}}(l,m,s,u),{u_matrix:d,u_opacity:e}),cr={fillExtrusion:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_lightpos:new o.Uniform3f(d,e.u_lightpos),u_lightintensity:new o.Uniform1f(d,e.u_lightintensity),u_lightcolor:new o.Uniform3f(d,e.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,e.u_vertical_gradient),u_opacity:new o.Uniform1f(d,e.u_opacity)}),fillExtrusionPattern:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_lightpos:new o.Uniform3f(d,e.u_lightpos),u_lightintensity:new o.Uniform1f(d,e.u_lightintensity),u_lightcolor:new o.Uniform3f(d,e.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,e.u_vertical_gradient),u_height_factor:new o.Uniform1f(d,e.u_height_factor),u_image:new o.Uniform1i(d,e.u_image),u_texsize:new o.Uniform2f(d,e.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,e.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,e.u_scale),u_fade:new o.Uniform1f(d,e.u_fade),u_opacity:new o.Uniform1f(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_image:new o.Uniform1i(d,e.u_image),u_texsize:new o.Uniform2f(d,e.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,e.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,e.u_scale),u_fade:new o.Uniform1f(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_world:new o.Uniform2f(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_world:new o.Uniform2f(d,e.u_world),u_image:new o.Uniform1i(d,e.u_image),u_texsize:new o.Uniform2f(d,e.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,e.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,e.u_scale),u_fade:new o.Uniform1f(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new o.Uniform1f(d,e.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(d,e.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(d,e.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(d,e.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(d,e.u_matrix)}),collisionBox:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_camera_to_center_distance:new o.Uniform1f(d,e.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(d,e.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(d,e.u_extrude_scale),u_overscale_factor:new o.Uniform1f(d,e.u_overscale_factor)}),collisionCircle:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_inv_matrix:new o.UniformMatrix4f(d,e.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(d,e.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new o.UniformColor(d,e.u_color),u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_overlay:new o.Uniform1i(d,e.u_overlay),u_overlay_scale:new o.Uniform1f(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new o.Uniform1f(d,e.u_extrude_scale),u_intensity:new o.Uniform1f(d,e.u_intensity),u_matrix:new o.UniformMatrix4f(d,e.u_matrix)}),heatmapTexture:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_world:new o.Uniform2f(d,e.u_world),u_image:new o.Uniform1i(d,e.u_image),u_color_ramp:new o.Uniform1i(d,e.u_color_ramp),u_opacity:new o.Uniform1f(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_image:new o.Uniform1i(d,e.u_image),u_latrange:new o.Uniform2f(d,e.u_latrange),u_light:new o.Uniform2f(d,e.u_light),u_shadow:new o.UniformColor(d,e.u_shadow),u_highlight:new o.UniformColor(d,e.u_highlight),u_accent:new o.UniformColor(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_image:new o.Uniform1i(d,e.u_image),u_dimension:new o.Uniform2f(d,e.u_dimension),u_zoom:new o.Uniform1f(d,e.u_zoom),u_unpack:new o.Uniform4f(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_ratio:new o.Uniform1f(d,e.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_ratio:new o.Uniform1f(d,e.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,e.u_units_to_pixels),u_image:new o.Uniform1i(d,e.u_image),u_image_height:new o.Uniform1f(d,e.u_image_height)}),linePattern:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_texsize:new o.Uniform2f(d,e.u_texsize),u_ratio:new o.Uniform1f(d,e.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_image:new o.Uniform1i(d,e.u_image),u_units_to_pixels:new o.Uniform2f(d,e.u_units_to_pixels),u_scale:new o.Uniform3f(d,e.u_scale),u_fade:new o.Uniform1f(d,e.u_fade)}),lineSDF:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_ratio:new o.Uniform1f(d,e.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,e.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(d,e.u_patternscale_a),u_patternscale_b:new o.Uniform2f(d,e.u_patternscale_b),u_sdfgamma:new o.Uniform1f(d,e.u_sdfgamma),u_image:new o.Uniform1i(d,e.u_image),u_tex_y_a:new o.Uniform1f(d,e.u_tex_y_a),u_tex_y_b:new o.Uniform1f(d,e.u_tex_y_b),u_mix:new o.Uniform1f(d,e.u_mix)}),raster:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_tl_parent:new o.Uniform2f(d,e.u_tl_parent),u_scale_parent:new o.Uniform1f(d,e.u_scale_parent),u_buffer_scale:new o.Uniform1f(d,e.u_buffer_scale),u_fade_t:new o.Uniform1f(d,e.u_fade_t),u_opacity:new o.Uniform1f(d,e.u_opacity),u_image0:new o.Uniform1i(d,e.u_image0),u_image1:new o.Uniform1i(d,e.u_image1),u_brightness_low:new o.Uniform1f(d,e.u_brightness_low),u_brightness_high:new o.Uniform1f(d,e.u_brightness_high),u_saturation_factor:new o.Uniform1f(d,e.u_saturation_factor),u_contrast_factor:new o.Uniform1f(d,e.u_contrast_factor),u_spin_weights:new o.Uniform3f(d,e.u_spin_weights)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new o.Uniform1i(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,e.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,e.u_size_t),u_size:new o.Uniform1f(d,e.u_size),u_camera_to_center_distance:new o.Uniform1f(d,e.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,e.u_pitch),u_rotate_symbol:new o.Uniform1i(d,e.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,e.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,e.u_fade_change),u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,e.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,e.u_coord_matrix),u_is_text:new o.Uniform1i(d,e.u_is_text),u_pitch_with_map:new o.Uniform1i(d,e.u_pitch_with_map),u_texsize:new o.Uniform2f(d,e.u_texsize),u_texture:new o.Uniform1i(d,e.u_texture)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new o.Uniform1i(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,e.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,e.u_size_t),u_size:new o.Uniform1f(d,e.u_size),u_camera_to_center_distance:new o.Uniform1f(d,e.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,e.u_pitch),u_rotate_symbol:new o.Uniform1i(d,e.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,e.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,e.u_fade_change),u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,e.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,e.u_coord_matrix),u_is_text:new o.Uniform1i(d,e.u_is_text),u_pitch_with_map:new o.Uniform1i(d,e.u_pitch_with_map),u_texsize:new o.Uniform2f(d,e.u_texsize),u_texture:new o.Uniform1i(d,e.u_texture),u_gamma_scale:new o.Uniform1f(d,e.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,e.u_is_halo)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new o.Uniform1i(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,e.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,e.u_size_t),u_size:new o.Uniform1f(d,e.u_size),u_camera_to_center_distance:new o.Uniform1f(d,e.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,e.u_pitch),u_rotate_symbol:new o.Uniform1i(d,e.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,e.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,e.u_fade_change),u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,e.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,e.u_coord_matrix),u_is_text:new o.Uniform1i(d,e.u_is_text),u_pitch_with_map:new o.Uniform1i(d,e.u_pitch_with_map),u_texsize:new o.Uniform2f(d,e.u_texsize),u_texsize_icon:new o.Uniform2f(d,e.u_texsize_icon),u_texture:new o.Uniform1i(d,e.u_texture),u_texture_icon:new o.Uniform1i(d,e.u_texture_icon),u_gamma_scale:new o.Uniform1f(d,e.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,e.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,e.u_is_halo)}),background:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_opacity:new o.Uniform1f(d,e.u_opacity),u_color:new o.UniformColor(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_opacity:new o.Uniform1f(d,e.u_opacity),u_image:new o.Uniform1i(d,e.u_image),u_pattern_tl_a:new o.Uniform2f(d,e.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(d,e.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(d,e.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(d,e.u_pattern_br_b),u_texsize:new o.Uniform2f(d,e.u_texsize),u_mix:new o.Uniform1f(d,e.u_mix),u_pattern_size_a:new o.Uniform2f(d,e.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(d,e.u_pattern_size_b),u_scale_a:new o.Uniform1f(d,e.u_scale_a),u_scale_b:new o.Uniform1f(d,e.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_texture:new o.Uniform1i(d,e.u_texture),u_ele_delta:new o.Uniform1f(d,e.u_ele_delta)}),terrainDepth:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_ele_delta:new o.Uniform1f(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_matrix:new o.UniformMatrix4f(d,e.u_matrix),u_texture:new o.Uniform1i(d,e.u_texture),u_terrain_coords_id:new o.Uniform1f(d,e.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(d,e.u_ele_delta)})};class ur{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Mo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class In{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const m=this.attributes[u],v=s.attributes[m.name];v!==void 0&&e.vertexAttribPointer(v,m.components,e[Mo[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pa=new WeakMap;function fa(d){if(pa.has(d))return pa.get(d);{const e=d.getParameter(d.VERSION).startsWith("WebGL 2.0");return pa.set(d,e),e}}class Te{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class An extends Te{getDefault(){return o.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class To extends Te{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Eo extends Te{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Cn extends Te{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Xl extends Te{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Wl extends Te{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ma extends Te{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class mc extends Te{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class gc extends Te{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class _c extends Te{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class yc extends Te{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class vc extends Te{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class xc extends Te{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class So extends Te{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Pn extends Te{getDefault(){return o.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Io extends Te{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ao extends Te{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class ga extends Te{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Hl extends Te{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Kl extends Te{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Co extends Te{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Zs extends Te{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Yl extends Te{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class _a extends Te{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ya extends Te{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Jl extends Te{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Po extends Te{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ae extends Te{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;fa(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class zn extends Te{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class bc extends Te{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ql extends Te{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class js extends Te{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class wc extends js{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Mc extends js{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class th extends js{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Tc{constructor(e,s,l,u,m){this.context=e,this.width=s,this.height=l;const v=e.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new wc(e,b),u)this.depthAttachment=m?new th(e,b):new Mc(e,b);else if(m)throw new Error("Stencil cannot be setted without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class We{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}We.Replace=[1,0],We.disabled=new We(We.Replace,o.Color.transparent,[!1,!1,!1,!1]),We.unblended=new We(We.Replace,o.Color.transparent,[!0,!0,!0,!0]),We.alphaBlended=new We([1,771],o.Color.transparent,[!0,!0,!0,!0]);class kn{constructor(e){var s,l;if(this.gl=e,this.clearColor=new An(this),this.clearDepth=new To(this),this.clearStencil=new Eo(this),this.colorMask=new Cn(this),this.depthMask=new Xl(this),this.stencilMask=new Wl(this),this.stencilFunc=new ma(this),this.stencilOp=new mc(this),this.stencilTest=new gc(this),this.depthRange=new _c(this),this.depthTest=new yc(this),this.depthFunc=new vc(this),this.blend=new xc(this),this.blendFunc=new So(this),this.blendColor=new Pn(this),this.blendEquation=new Io(this),this.cullFace=new Ao(this),this.cullFaceSide=new ga(this),this.frontFace=new Hl(this),this.program=new Kl(this),this.activeTexture=new Co(this),this.viewport=new Zs(this),this.bindFramebuffer=new Yl(this),this.bindRenderbuffer=new _a(this),this.bindTexture=new ya(this),this.bindVertexBuffer=new Jl(this),this.bindElementBuffer=new Po(this),this.bindVertexArray=new Ae(this),this.pixelStoreUnpack=new zn(this),this.pixelStoreUnpackPremultiplyAlpha=new bc(this),this.pixelStoreUnpackFlipY=new Ql(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),fa(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new ur(this,e,s)}createVertexBuffer(e,s,l){return new In(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,m=u.createRenderbuffer();return this.bindRenderbuffer.set(m),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,s,l,u){return new Tc(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let m=0;e&&(m|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(m|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(m|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.deepEqual(e.blendFunction,We.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return fa(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return fa(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class _e{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}_e.ReadOnly=!1,_e.ReadWrite=!0,_e.disabled=new _e(519,_e.ReadOnly,[0,1]);const ja=7680;class Ve{constructor(e,s,l,u,m,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=m,this.pass=v}}Ve.disabled=new Ve({func:519,mask:0},0,0,ja,ja,ja);class $e{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let Xs;function Xa(d,e,s,l,u,m,v){const b=d.context,M=b.gl,S=d.useProgram("collisionBox"),A=[];let P=0,F=0;for(let K=0;K<l.length;K++){const st=l[K],dt=e.getTile(st),pt=dt.getBucket(s);if(!pt)continue;let _t=st.posMatrix;u[0]===0&&u[1]===0||(_t=d.translatePosMatrix(st.posMatrix,dt,u,m));const Et=v?pt.textCollisionBox:pt.iconCollisionBox,xt=pt.collisionCircleArray;if(xt.length>0){const It=o.create(),jt=_t;o.mul(It,pt.placementInvProjMatrix,d.transform.glCoordMatrix),o.mul(It,It,pt.placementViewportMatrix),A.push({circleArray:xt,circleOffset:F,transform:jt,invTransform:It,coord:st}),P+=xt.length/4,F=P}Et&&S.draw(b,M.LINES,_e.disabled,Ve.disabled,d.colorModeForRenderPass(),$e.disabled,$l(_t,d.transform,dt),d.style.map.terrain&&d.style.map.terrain.getTerrainData(st),s.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,d.transform.zoom,null,null,Et.collisionVertexBuffer)}if(!v||!A.length)return;const G=d.useProgram("collisionCircle"),q=new o.CollisionCircleLayoutArray;q.resize(4*P),q._trim();let j=0;for(const K of A)for(let st=0;st<K.circleArray.length/4;st++){const dt=4*st,pt=K.circleArray[dt+0],_t=K.circleArray[dt+1],Et=K.circleArray[dt+2],xt=K.circleArray[dt+3];q.emplace(j++,pt,_t,Et,xt,0),q.emplace(j++,pt,_t,Et,xt,1),q.emplace(j++,pt,_t,Et,xt,2),q.emplace(j++,pt,_t,Et,xt,3)}(!Xs||Xs.length<2*P)&&(Xs=function(K){const st=2*K,dt=new o.QuadTriangleArray;dt.resize(st),dt._trim();for(let pt=0;pt<st;pt++){const _t=6*pt;dt.uint16[_t+0]=4*pt+0,dt.uint16[_t+1]=4*pt+1,dt.uint16[_t+2]=4*pt+2,dt.uint16[_t+3]=4*pt+2,dt.uint16[_t+4]=4*pt+3,dt.uint16[_t+5]=4*pt+0}return dt}(P));const $=b.createIndexBuffer(Xs,!0),rt=b.createVertexBuffer(q,o.collisionCircleLayout.members,!0);for(const K of A){const st={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(ct=d.transform).cameraToCenterDistance,u_viewport_size:[ct.width,ct.height]};G.draw(b,M.TRIANGLES,_e.disabled,Ve.disabled,d.colorModeForRenderPass(),$e.disabled,st,d.style.map.terrain&&d.style.map.terrain.getTerrainData(K.coord),s.id,rt,$,o.SegmentVector.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,d.transform.zoom,null,null,null)}var ct;rt.destroy(),$.destroy()}$e.disabled=new $e(!1,1029,2305),$e.backCCW=new $e(!0,1029,2305);const zo=o.identity(new Float32Array(16));function Ec(d,e,s,l,u,m){const{horizontalAlign:v,verticalAlign:b}=o.getAnchorAlignment(d);return new o.Point((-(v-.5)*e/u+l[0])*m,(-(b-.5)*s/u+l[1])*m)}function ko(d,e,s,l,u,m,v,b,M,S,A){const P=d.text.placedSymbolArray,F=d.text.dynamicLayoutVertexArray,G=d.icon.dynamicLayoutVertexArray,q={};F.clear();for(let j=0;j<P.length;j++){const $=P.get(j),rt=$.hidden||!$.crossTileID||d.allowVerticalPlacement&&!$.placedOrientation?null:l[$.crossTileID];if(rt){const ct=new o.Point($.anchorX,$.anchorY),K=se(ct,s?v:m,A),st=qr(u.cameraToCenterDistance,K.signedDistanceFromCamera);let dt=o.evaluateSizeForFeature(d.textSizeData,M,$)*st/o.ONE_EM;s&&(dt*=d.tilePixelRatio/b);const{width:pt,height:_t,anchor:Et,textOffset:xt,textBoxScale:It}=rt,jt=Ec(Et,pt,_t,xt,It,dt),ye=s?se(ct.add(jt),m,A).point:K.point.add(e?jt.rotate(-u.angle):jt),kt=d.allowVerticalPlacement&&$.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ie=0;ie<$.numGlyphs;ie++)o.addDynamicAttributes(F,ye,kt);S&&$.associatedIconIndex>=0&&(q[$.associatedIconIndex]={shiftedAnchor:ye,angle:kt})}else V($.numGlyphs,F)}if(S){G.clear();const j=d.icon.placedSymbolArray;for(let $=0;$<j.length;$++){const rt=j.get($);if(rt.hidden)V(rt.numGlyphs,G);else{const ct=q[$];if(ct)for(let K=0;K<rt.numGlyphs;K++)o.addDynamicAttributes(G,ct.shiftedAnchor,ct.angle);else V(rt.numGlyphs,G)}}d.icon.dynamicLayoutVertexBuffer.updateData(G)}d.text.dynamicLayoutVertexBuffer.updateData(F)}function Sc(d,e,s){return s.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Do(d,e,s,l,u,m,v,b,M,S,A,P){const F=d.context,G=F.gl,q=d.transform,j=b==="map",$=M==="map",rt=b!=="viewport"&&s.layout.get("symbol-placement")!=="point",ct=j&&!$&&!rt,K=!s.layout.get("symbol-sort-key").isConstant();let st=!1;const dt=d.depthModeForSublayer(0,_e.ReadOnly),pt=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_t=[];for(const Et of l){const xt=e.getTile(Et),It=xt.getBucket(s);if(!It)continue;const jt=u?It.text:It.icon;if(!jt||!jt.segments.get().length||!jt.hasVisibleVertices)continue;const ye=jt.programConfigurations.get(s.id),kt=u||It.sdfIcons,ie=u?It.textSizeData:It.iconSizeData,qt=$||q.pitch!==0,Ne=d.useProgram(Sc(kt,u,It),ye),me=o.evaluateSizeForZoom(ie,q.zoom),ue=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Et);let re,Je,ze,Gi,wi=[0,0],oi=null;if(u)Je=xt.glyphAtlasTexture,ze=G.LINEAR,re=xt.glyphAtlasTexture.size,It.iconsInText&&(wi=xt.imageAtlasTexture.size,oi=xt.imageAtlasTexture,Gi=qt||d.options.rotating||d.options.zooming||ie.kind==="composite"||ie.kind==="camera"?G.LINEAR:G.NEAREST);else{const di=s.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear;Je=xt.imageAtlasTexture,ze=kt||d.options.rotating||d.options.zooming||di||qt?G.LINEAR:G.NEAREST,re=xt.imageAtlasTexture.size}const Yi=et(xt,1,d.transform.zoom),Rr=ki(Et.posMatrix,$,j,d.transform,Yi),ls=rs(Et.posMatrix,$,j,d.transform,Yi),hs=pt&&It.hasTextData(),Cs=s.layout.get("icon-text-fit")!=="none"&&hs&&It.hasIconData();if(rt){const di=d.style.map.terrain?(Ji,Ke)=>d.style.map.terrain.getElevation(Et,Ji,Ke):null,Ei=s.layout.get("text-rotation-alignment")==="map";ws(It,Et.posMatrix,d,u,Rr,ls,$,S,Ei,di)}const ea=d.translatePosMatrix(Et.posMatrix,xt,m,v),Ps=rt||u&&pt||Cs?zo:Rr,Mi=d.translatePosMatrix(ls,xt,m,v,!0),Qe=kt&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ti;Ti=kt?It.iconsInText?Za(ie.kind,me,ct,$,d,ea,Ps,Mi,re,wi):Ga(ie.kind,me,ct,$,d,ea,Ps,Mi,u,re,!0):qa(ie.kind,me,ct,$,d,ea,Ps,Mi,u,re);const Ta={program:Ne,buffers:jt,uniformValues:Ti,atlasTexture:Je,atlasTextureIcon:oi,atlasInterpolation:ze,atlasInterpolationIcon:Gi,isSDF:kt,hasHalo:Qe};if(K&&It.canOverlap){st=!0;const di=jt.segments.get();for(const Ei of di)_t.push({segments:new o.SegmentVector([Ei]),sortKey:Ei.sortKey,state:Ta,terrainData:ue})}else _t.push({segments:jt.segments,sortKey:0,state:Ta,terrainData:ue})}st&&_t.sort((Et,xt)=>Et.sortKey-xt.sortKey);for(const Et of _t){const xt=Et.state;if(F.activeTexture.set(G.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,G.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(F.activeTexture.set(G.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),xt.isSDF){const It=xt.uniformValues;xt.hasHalo&&(It.u_is_halo=1,Wa(xt.buffers,Et.segments,s,d,xt.program,dt,A,P,It,Et.terrainData)),It.u_is_halo=0}Wa(xt.buffers,Et.segments,s,d,xt.program,dt,A,P,xt.uniformValues,Et.terrainData)}}function Wa(d,e,s,l,u,m,v,b,M,S){const A=l.context;u.draw(A,A.gl.TRIANGLES,m,v,b,$e.disabled,M,S,s.id,d.layoutVertexBuffer,d.indexBuffer,e,s.paint,l.transform.zoom,d.programConfigurations.get(s.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Dn(d,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let v=m[s.to.toString()],b=m[s.from.toString()];if(!v||!b){const M=u.getPaintProperty(e);v=m[M],b=m[M]}v&&b&&d.setConstantPatternPositions(v,b)}function Lo(d,e,s,l,u,m,v){const b=d.context.gl,M="fill-pattern",S=s.paint.get(M),A=S&&S.constantOr(1),P=s.getCrossfadeParameters();let F,G,q,j,$;v?(G=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=b.LINES):(G=A?"fillPattern":"fill",F=b.TRIANGLES);const rt=S.constantOr(null);for(const ct of l){const K=e.getTile(ct);if(A&&!K.patternsLoaded())continue;const st=K.getBucket(s);if(!st)continue;const dt=st.programConfigurations.get(s.id),pt=d.useProgram(G,dt),_t=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ct);A&&(d.context.activeTexture.set(b.TEXTURE0),K.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),dt.updatePaintBuffers(P)),Dn(dt,M,rt,K,s);const Et=_t?ct:null,xt=d.translatePosMatrix(Et?Et.posMatrix:ct.posMatrix,K,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){j=st.indexBuffer2,$=st.segments2;const It=[b.drawingBufferWidth,b.drawingBufferHeight];q=G==="fillOutlinePattern"&&A?Vl(xt,d,P,K,It):pc(xt,It)}else j=st.indexBuffer,$=st.segments,q=A?bn(xt,d,P,K):Nl(xt);pt.draw(d.context,F,u,d.stencilModeForClipping(ct),m,$e.disabled,q,_t,s.id,st.layoutVertexBuffer,j,$,s.paint,d.transform.zoom,dt)}}function Ln(d,e,s,l,u,m,v){const b=d.context,M=b.gl,S="fill-extrusion-pattern",A=s.paint.get(S),P=A.constantOr(1),F=s.getCrossfadeParameters(),G=s.paint.get("fill-extrusion-opacity"),q=A.constantOr(null);for(const j of l){const $=e.getTile(j),rt=$.getBucket(s);if(!rt)continue;const ct=d.style.map.terrain&&d.style.map.terrain.getTerrainData(j),K=rt.programConfigurations.get(s.id),st=d.useProgram(P?"fillExtrusionPattern":"fillExtrusion",K);P&&(d.context.activeTexture.set(M.TEXTURE0),$.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),K.updatePaintBuffers(F)),Dn(K,S,q,$,s);const dt=d.translatePosMatrix(j.posMatrix,$,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pt=s.paint.get("fill-extrusion-vertical-gradient"),_t=P?dc(dt,d,pt,G,j,F,$):Na(dt,d,pt,G);st.draw(b,b.gl.TRIANGLES,u,m,v,$e.backCCW,_t,ct,s.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,s.paint,d.transform.zoom,K,d.style.map.terrain&&rt.centroidVertexBuffer)}}function Rn(d,e,s,l,u,m,v){const b=d.context,M=b.gl,S=s.fbo;if(!S)return;const A=d.useProgram("hillshade"),P=d.style.map.terrain&&d.style.map.terrain.getTerrainData(e);b.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,S.colorAttachment.get()),A.draw(b,M.TRIANGLES,u,m,v,$e.disabled,((F,G,q,j)=>{const $=q.paint.get("hillshade-shadow-color"),rt=q.paint.get("hillshade-highlight-color"),ct=q.paint.get("hillshade-accent-color");let K=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=F.transform.angle);const st=!F.options.moving;return{u_matrix:j?j.posMatrix:F.transform.calculatePosMatrix(G.tileID.toUnwrapped(),st),u_image:0,u_latrange:Zl(0,G.tileID),u_light:[q.paint.get("hillshade-exaggeration"),K],u_shadow:$,u_highlight:rt,u_accent:ct}})(d,s,l,P?e:null),P,l.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Ro(d,e,s,l,u,m){const v=d.context,b=v.gl,M=e.dem;if(M&&M.data){const S=M.dim,A=M.stride,P=M.getPixels();if(v.activeTexture.set(b.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(A),e.demTexture){const G=e.demTexture;G.update(P,{premultiply:!1}),G.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else e.demTexture=new oe(v,P,b.RGBA,{premultiply:!1}),e.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);v.activeTexture.set(b.TEXTURE0);let F=e.fbo;if(!F){const G=new oe(v,{width:S,height:S,data:null},b.RGBA);G.bind(b.LINEAR,b.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(S,S,!0,!1),F.colorAttachment.set(G.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,S,S]),d.useProgram("hillshadePrepare").draw(v,b.TRIANGLES,l,u,m,$e.disabled,((G,q)=>{const j=q.stride,$=o.create();return o.ortho($,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate($,$,[0,-o.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[j,j],u_zoom:G.overscaledZ,u_unpack:q.getUnpackVector()}})(e.tileID,M),null,s.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ic(d,e,s,l,u,m){const v=l.paint.get("raster-fade-duration");if(!m&&v>0){const b=o.browser.now(),M=(b-d.timeAdded)/v,S=e?(b-e.timeAdded)/v:-1,A=s.getSource(),P=u.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-P)>Math.abs(d.tileID.overscaledZ-P),G=F&&d.refreshedUponExpiration?1:o.clamp(F?M:1-S,0,1);return d.refreshedUponExpiration&&M>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const eh=new o.Color(1,0,0,1),si=new o.Color(0,1,0,1),Ws=new o.Color(0,0,1,1),wr=new o.Color(1,0,1,1),Bo=new o.Color(0,1,1,1);function Bn(d,e,s,l){ss(d,0,e+s/2,d.transform.width,s,l)}function Fo(d,e,s,l){ss(d,e-s/2,0,s,d.transform.height,l)}function ss(d,e,s,l,u,m){const v=d.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*d.pixelRatio,s*d.pixelRatio,l*d.pixelRatio,u*d.pixelRatio),v.clear({color:m}),b.disable(b.SCISSOR_TEST)}function Ha(d,e,s){const l=d.context,u=l.gl,m=s.posMatrix,v=d.useProgram("debug"),b=_e.disabled,M=Ve.disabled,S=d.colorModeForRenderPass(),A="$debug",P=d.style.map.terrain&&d.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,G=Math.floor((F&&F.byteLength||0)/1024),q=e.getTile(s).tileSize,j=512/Math.min(q,512)*(s.overscaledZ/d.transform.zoom)*.5;let $=s.canonical.toString();s.overscaledZ!==s.canonical.z&&($+=` => ${s.overscaledZ}`),function(rt,ct){rt.initDebugOverlayCanvas();const K=rt.debugOverlayCanvas,st=rt.context.gl,dt=rt.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,K.width,K.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(ct,5,5),dt.strokeText(ct,5,5),rt.debugOverlayTexture.update(K),rt.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(d,`${$} ${G}kB`),v.draw(l,u.TRIANGLES,b,M,We.alphaBlended,$e.disabled,ql(m,o.Color.transparent,j),null,A,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),v.draw(l,u.LINE_STRIP,b,M,S,$e.disabled,ql(m,o.Color.red),P,A,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Fn(d,e,s){const l=d.context,u=l.gl,m=d.colorModeForRenderPass(),v=new _e(u.LEQUAL,_e.ReadWrite,d.depthRangeFor3D),b=d.useProgram("terrain"),M=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,d.width,d.height]);for(const S of s){const A=d.renderToTexture.getTexture(S),P=e.getTerrainData(S.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,A.texture);const F={u_matrix:d.transform.calculatePosMatrix(S.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(d.transform.zoom)};b.draw(l,u.TRIANGLES,v,Ve.disabled,m,$e.backCCW,F,P,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class ih{constructor(e,s){this.context=new kn(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=Xe.maxUnderzooming+Xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ii}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new o.PosArray;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(s,yn.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const l=new o.PosArray;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=e.createVertexBuffer(l,yn.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const u=new o.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(o.EXTENT,0,o.EXTENT,0),u.emplaceBack(0,o.EXTENT,0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(u,$i.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const m=new o.PosArray;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,yn.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.LineStripIndexArray;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const b=new o.TriangleIndexArray;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const M=this.context.gl;this.stencilClearMode=new Ve({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=o.create();o.ortho(l,0,this.width,this.height,0,0,1),o.scale(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,_e.disabled,this.stencilClearMode,We.disabled,$e.disabled,wn(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(We.disabled),l.setDepthMode(_e.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const b=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);m.draw(l,u.TRIANGLES,_e.disabled,new Ve({func:u.ALWAYS,mask:0},b,255,u.KEEP,u.KEEP,u.REPLACE),We.disabled,$e.disabled,wn(v.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Ve({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Ve({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,b)=>b.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,m=l[0].overscaledZ-u+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const v={};for(let b=0;b<m;b++)v[b+u]=new Ve({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=m,[v,l]}return[{[u]:Ve.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new We([e.CONSTANT_COLOR,e.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?We.unblended:We.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return _e.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new _e(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,m={},v={},b={};for(const M in u){const S=u[M];S.used&&S.prepare(this.context),m[M]=S.getVisibleCoordinates(),v[M]=m[M].slice().reverse(),b[M]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<l.length;M++)if(this.style._layers[l[M]].is3D()){this.opaquePassCutoff=M;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const M=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||M.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,A){const P=S.context,F=P.gl,G=We.unblended,q=new _e(F.LEQUAL,_e.ReadWrite,[0,1]),j=A.getTerrainMesh(),$=A.sourceCache.getRenderableTiles(),rt=S.useProgram("terrainDepth");P.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),P.clear({color:o.Color.transparent,depth:1});for(const ct of $){const K=A.getTerrainData(ct.tileID),st={u_matrix:S.transform.calculatePosMatrix(ct.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(S.transform.zoom)};rt.draw(P,F.TRIANGLES,q,Ve.disabled,G,$e.backCCW,st,K,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,A){const P=S.context,F=P.gl,G=We.unblended,q=new _e(F.LEQUAL,_e.ReadWrite,[0,1]),j=A.getTerrainMesh(),$=A.getCoordsTexture(),rt=A.sourceCache.getRenderableTiles(),ct=S.useProgram("terrainCoords");P.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),P.clear({color:o.Color.transparent,depth:1}),A.coordsIndex=[];for(const K of rt){const st=A.getTerrainData(K.tileID);P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,$.texture);const dt={u_matrix:S.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(S.transform.zoom)};ct.draw(P,F.TRIANGLES,q,Ve.disabled,G,$e.backCCW,dt,st,"terrain",j.vertexBuffer,j.indexBuffer,j.segments),A.coordsIndex.push(K.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const M of l){const S=this.style._layers[M];if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const A=v[S.source];(S.type==="custom"||A.length)&&this.renderLayer(this,u[S.source],S,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[l[this.currentLayer]],S=u[M.source],A=m[M.source];this._renderTileClippingMasks(M,A),this.renderLayer(this,S,M,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const M=this.style._layers[l[this.currentLayer]],S=u[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const A=(M.type==="symbol"?b:v)[M.source];this._renderTileClippingMasks(M,m[M.source]),this.renderLayer(this,S,M,A)}if(this.options.showTileBoundaries){const M=function(S,A){let P=null;const F=Object.values(S._layers).flatMap($=>$.source&&!$.isHidden(A)?[S.sourceCaches[$.source]]:[]),G=F.filter($=>$.getSource().type==="vector"),q=F.filter($=>$.getSource().type!=="vector"),j=$=>{(!P||P.getSource().maxzoom<$.getSource().maxzoom)&&(P=$)};return G.forEach($=>j($)),P||q.forEach($=>j($)),P}(this.style,this.transform.zoom);M&&function(S,A,P){for(let F=0;F<P.length;F++)Ha(S,A,P[F])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const S=M.transform.padding;Bn(M,M.transform.height-(S.top||0),3,eh),Bn(M,S.bottom||0,3,si),Fo(M,S.left||0,3,Ws),Fo(M,M.transform.width-(S.right||0),3,wr);const A=M.transform.centerPoint;(function(P,F,G,q){ss(P,F-1,G-10,2,20,q),ss(P,F-10,G-1,20,2,q)})(M,A.x,M.transform.height-A.y,Bo)}(this),this.context.setDefault()}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(m,v,b,M,S){if(m.renderPass!=="translucent")return;const A=Ve.disabled,P=m.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,G,q,j,$,rt,ct){const K=G.transform,st=$==="map",dt=rt==="map";for(const pt of F){const _t=j.getTile(pt),Et=_t.getBucket(q);if(!Et||!Et.text||!Et.text.segments.get().length)continue;const xt=o.evaluateSizeForZoom(Et.textSizeData,K.zoom),It=et(_t,1,G.transform.zoom),jt=ki(pt.posMatrix,dt,st,G.transform,It),ye=q.layout.get("icon-text-fit")!=="none"&&Et.hasIconData();if(xt){const kt=Math.pow(2,K.zoom-_t.tileID.overscaledZ);ko(Et,st,dt,ct,K,jt,pt.posMatrix,kt,xt,ye,G.style.map.terrain?(ie,qt)=>G.style.map.terrain.getElevation(pt,ie,qt):null)}}}(M,m,b,v,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),S),b.paint.get("icon-opacity").constantOr(1)!==0&&Do(m,v,b,M,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),A,P),b.paint.get("text-opacity").constantOr(1)!==0&&Do(m,v,b,M,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),A,P),v.map.showCollisionBoxes&&(Xa(m,v,b,M,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),!0),Xa(m,v,b,M,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(m,v,b,M){if(m.renderPass!=="translucent")return;const S=b.paint.get("circle-opacity"),A=b.paint.get("circle-stroke-width"),P=b.paint.get("circle-stroke-opacity"),F=!b.layout.get("circle-sort-key").isConstant();if(S.constantOr(1)===0&&(A.constantOr(1)===0||P.constantOr(1)===0))return;const G=m.context,q=G.gl,j=m.depthModeForSublayer(0,_e.ReadOnly),$=Ve.disabled,rt=m.colorModeForRenderPass(),ct=[];for(let K=0;K<M.length;K++){const st=M[K],dt=v.getTile(st),pt=dt.getBucket(b);if(!pt)continue;const _t=pt.programConfigurations.get(b.id),Et=m.useProgram("circle",_t),xt=pt.layoutVertexBuffer,It=pt.indexBuffer,jt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(st),ye={programConfiguration:_t,program:Et,layoutVertexBuffer:xt,indexBuffer:It,uniformValues:fc(m,st,dt,b),terrainData:jt};if(F){const kt=pt.segments.get();for(const ie of kt)ct.push({segments:new o.SegmentVector([ie]),sortKey:ie.sortKey,state:ye})}else ct.push({segments:pt.segments,sortKey:0,state:ye})}F&&ct.sort((K,st)=>K.sortKey-st.sortKey);for(const K of ct){const{programConfiguration:st,program:dt,layoutVertexBuffer:pt,indexBuffer:_t,uniformValues:Et,terrainData:xt}=K.state;dt.draw(G,q.TRIANGLES,j,$,rt,$e.disabled,Et,xt,b.id,pt,_t,K.segments,b.paint,m.transform.zoom,st)}})(e,s,l,u);break;case"heatmap":(function(m,v,b,M){if(b.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const S=m.context,A=S.gl,P=Ve.disabled,F=new We([A.ONE,A.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(G,q,j){const $=G.gl;G.activeTexture.set($.TEXTURE1),G.viewport.set([0,0,q.width/4,q.height/4]);let rt=j.heatmapFbo;if(rt)$.bindTexture($.TEXTURE_2D,rt.colorAttachment.get()),G.bindFramebuffer.set(rt.framebuffer);else{const ct=$.createTexture();$.bindTexture($.TEXTURE_2D,ct),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),rt=j.heatmapFbo=G.createFramebuffer(q.width/4,q.height/4,!1,!1),function(K,st,dt,pt){var _t,Et;const xt=K.gl,It=(_t=K.HALF_FLOAT)!==null&&_t!==void 0?_t:xt.UNSIGNED_BYTE,jt=(Et=K.RGBA16F)!==null&&Et!==void 0?Et:xt.RGBA;xt.texImage2D(xt.TEXTURE_2D,0,jt,st.width/4,st.height/4,0,xt.RGBA,It,null),pt.colorAttachment.set(dt)}(G,q,ct,rt)}})(S,m,b),S.clear({color:o.Color.transparent});for(let G=0;G<M.length;G++){const q=M[G];if(v.hasRenderableParent(q))continue;const j=v.getTile(q),$=j.getBucket(b);if(!$)continue;const rt=$.programConfigurations.get(b.id),ct=m.useProgram("heatmap",rt),{zoom:K}=m.transform;ct.draw(S,A.TRIANGLES,_e.disabled,P,F,$e.disabled,Gl(q.posMatrix,j,K,b.paint.get("heatmap-intensity")),null,b.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,b.paint,m.transform.zoom,rt)}S.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(S,A){const P=S.context,F=P.gl,G=A.heatmapFbo;if(!G)return;P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,G.colorAttachment.get()),P.activeTexture.set(F.TEXTURE1);let q=A.colorRampTexture;q||(q=A.colorRampTexture=new oe(P,A.colorRamp,F.RGBA)),q.bind(F.LINEAR,F.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(P,F.TRIANGLES,_e.disabled,Ve.disabled,S.colorModeForRenderPass(),$e.disabled,((j,$,rt,ct)=>{const K=o.create();o.ortho(K,0,j.width,j.height,0,0,1);const st=j.context.gl;return{u_matrix:K,u_world:[st.drawingBufferWidth,st.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}})(S,A),null,A.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,A.paint,S.transform.zoom)}(m,b))})(e,s,l,u);break;case"line":(function(m,v,b,M){if(m.renderPass!=="translucent")return;const S=b.paint.get("line-opacity"),A=b.paint.get("line-width");if(S.constantOr(1)===0||A.constantOr(1)===0)return;const P=m.depthModeForSublayer(0,_e.ReadOnly),F=m.colorModeForRenderPass(),G=b.paint.get("line-dasharray"),q=b.paint.get("line-pattern"),j=q.constantOr(1),$=b.paint.get("line-gradient"),rt=b.getCrossfadeParameters(),ct=j?"linePattern":G?"lineSDF":$?"lineGradient":"line",K=m.context,st=K.gl;let dt=!0;for(const pt of M){const _t=v.getTile(pt);if(j&&!_t.patternsLoaded())continue;const Et=_t.getBucket(b);if(!Et)continue;const xt=Et.programConfigurations.get(b.id),It=m.context.program.get(),jt=m.useProgram(ct,xt),ye=dt||jt.program!==It,kt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pt),ie=q.constantOr(null);if(ie&&_t.imageAtlas){const me=_t.imageAtlas,ue=me.patternPositions[ie.to.toString()],re=me.patternPositions[ie.from.toString()];ue&&re&&xt.setConstantPatternPositions(ue,re)}const qt=kt?pt:null,Ne=j?qs(m,_t,b,rt,qt):G?Tn(m,_t,b,G,rt,qt):$?jl(m,_t,b,Et.lineClipsArray.length,qt):Mn(m,_t,b,qt);if(j)K.activeTexture.set(st.TEXTURE0),_t.imageAtlasTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE),xt.updatePaintBuffers(rt);else if(G&&(ye||m.lineAtlas.dirty))K.activeTexture.set(st.TEXTURE0),m.lineAtlas.bind(K);else if($){const me=Et.gradients[b.id];let ue=me.texture;if(b.gradientVersion!==me.version){let re=256;if(b.stepInterpolant){const Je=v.getSource().maxzoom,ze=pt.canonical.z===Je?Math.ceil(1<<m.transform.maxZoom-pt.canonical.z):1;re=o.clamp(o.nextPowerOfTwo(Et.maxLineLength/o.EXTENT*1024*ze),256,K.maxTextureSize)}me.gradient=o.renderColorRamp({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:re,image:me.gradient||void 0,clips:Et.lineClipsArray}),me.texture?me.texture.update(me.gradient):me.texture=new oe(K,me.gradient,st.RGBA),me.version=b.gradientVersion,ue=me.texture}K.activeTexture.set(st.TEXTURE0),ue.bind(b.stepInterpolant?st.NEAREST:st.LINEAR,st.CLAMP_TO_EDGE)}jt.draw(K,st.TRIANGLES,P,m.stencilModeForClipping(pt),F,$e.disabled,Ne,kt,b.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,b.paint,m.transform.zoom,xt,Et.layoutVertexBuffer2),dt=!1}})(e,s,l,u);break;case"fill":(function(m,v,b,M){const S=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const P=m.colorModeForRenderPass(),F=b.paint.get("fill-pattern"),G=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&S.constantOr(o.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===G){const q=m.depthModeForSublayer(1,m.renderPass==="opaque"?_e.ReadWrite:_e.ReadOnly);Lo(m,v,b,M,q,P,!1)}if(m.renderPass==="translucent"&&b.paint.get("fill-antialias")){const q=m.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,_e.ReadOnly);Lo(m,v,b,M,q,P,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(m,v,b,M){const S=b.paint.get("fill-extrusion-opacity");if(S!==0&&m.renderPass==="translucent"){const A=new _e(m.context.gl.LEQUAL,_e.ReadWrite,m.depthRangeFor3D);if(S!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))Ln(m,v,b,M,A,Ve.disabled,We.disabled),Ln(m,v,b,M,A,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const P=m.colorModeForRenderPass();Ln(m,v,b,M,A,Ve.disabled,P)}}})(e,s,l,u);break;case"hillshade":(function(m,v,b,M){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const S=m.context,A=m.depthModeForSublayer(0,_e.ReadOnly),P=m.colorModeForRenderPass(),[F,G]=m.renderPass==="translucent"?m.stencilConfigForOverlap(M):[{},M];for(const q of G){const j=v.getTile(q);j.needsHillshadePrepare!==void 0&&j.needsHillshadePrepare&&m.renderPass==="offscreen"?Ro(m,j,b,A,Ve.disabled,P):m.renderPass==="translucent"&&Rn(m,q,j,b,A,F[q.overscaledZ],P)}S.viewport.set([0,0,m.width,m.height])})(e,s,l,u);break;case"raster":(function(m,v,b,M){if(m.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!M.length)return;const S=m.context,A=S.gl,P=v.getSource(),F=m.useProgram("raster"),G=m.colorModeForRenderPass(),[q,j]=P instanceof or?[{},M]:m.stencilConfigForOverlap(M),$=j[j.length-1].overscaledZ,rt=!m.options.moving;for(const ct of j){const K=m.depthModeForSublayer(ct.overscaledZ-$,b.paint.get("raster-opacity")===1?_e.ReadWrite:_e.ReadOnly,A.LESS),st=v.getTile(ct);st.registerFadeDuration(b.paint.get("raster-fade-duration"));const dt=v.findLoadedParent(ct,0),pt=Ic(st,dt,v,b,m.transform,m.style.map.terrain);let _t,Et;const xt=b.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;S.activeTexture.set(A.TEXTURE0),st.texture.bind(xt,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(A.TEXTURE1),dt?(dt.texture.bind(xt,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),_t=Math.pow(2,dt.tileID.overscaledZ-st.tileID.overscaledZ),Et=[st.tileID.canonical.x*_t%1,st.tileID.canonical.y*_t%1]):st.texture.bind(xt,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const It=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ct),jt=It?ct:null,ye=jt?jt.posMatrix:m.transform.calculatePosMatrix(ct.toUnwrapped(),rt),kt=En(ye,Et||[0,0],_t||1,pt,b);P instanceof or?F.draw(S,A.TRIANGLES,K,Ve.disabled,G,$e.disabled,kt,It,b.id,P.boundsBuffer,m.quadTriangleIndexBuffer,P.boundsSegments):F.draw(S,A.TRIANGLES,K,q[ct.overscaledZ],G,$e.disabled,kt,It,b.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(m,v,b,M){const S=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const P=m.context,F=P.gl,G=m.transform,q=G.tileSize,j=b.paint.get("background-pattern");if(m.isPatternMissing(j))return;const $=!j&&S.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==$)return;const rt=Ve.disabled,ct=m.depthModeForSublayer(0,$==="opaque"?_e.ReadWrite:_e.ReadOnly),K=m.colorModeForRenderPass(),st=m.useProgram(j?"backgroundPattern":"background"),dt=M||G.coveringTiles({tileSize:q,terrain:m.style.map.terrain});j&&(P.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context));const pt=b.getCrossfadeParameters();for(const _t of dt){const Et=M?_t.posMatrix:m.transform.calculatePosMatrix(_t.toUnwrapped()),xt=j?Sn(Et,A,m,j,{tileID:_t,tileSize:q},pt):Gs(Et,A,S),It=m.style.map.terrain&&m.style.map.terrain.getTerrainData(_t);st.draw(P,F.TRIANGLES,ct,rt,K,$e.disabled,xt,It,b.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(m,v,b){const M=m.context,S=b.implementation;if(m.renderPass==="offscreen"){const A=S.prerender;A&&(m.setCustomLayerDefaults(),M.setColorMode(m.colorModeForRenderPass()),A.call(S,M.gl,m.transform.customLayerMatrix()),M.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),M.setColorMode(m.colorModeForRenderPass()),M.setStencilMode(Ve.disabled);const A=S.renderingMode==="3d"?new _e(m.context.gl.LEQUAL,_e.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,_e.ReadOnly);M.setDepthMode(A),S.render(M.gl,m.transform.customLayerMatrix()),M.setDirty(),m.setBaseState(),M.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,m){if(!l[0]&&!l[1])return e;const v=m?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const S=Math.sin(v),A=Math.cos(v);l=[l[0]*A-l[1]*S,l[0]*S+l[1]*A]}const b=[m?l[0]:et(s,l[0],this.transform.zoom),m?l[1]:et(s,l[1],this.transform.zoom),0],M=new Float32Array(16);return o.translate(M,e,b),M}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Es(this.context,Ua[e],s,cr[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new oe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class On{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const M=1/(b=o.transformMat4([],b,e))[3]/s*u;return o.mul$1(b,b,[M,M,1/b[3],M])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const M=function(F,G){var q=G[0],j=G[1],$=G[2],rt=q*q+j*j+$*$;return rt>0&&(rt=1/Math.sqrt(rt)),F[0]=G[0]*rt,F[1]=G[1]*rt,F[2]=G[2]*rt,F}([],function(F,G,q){var j=G[0],$=G[1],rt=G[2],ct=q[0],K=q[1],st=q[2];return F[0]=$*st-rt*K,F[1]=rt*ct-j*st,F[2]=j*K-$*ct,F}([],ve([],m[b[0]],m[b[1]]),ve([],m[b[2]],m[b[1]]))),S=-((A=M)[0]*(P=m[b[1]])[0]+A[1]*P[1]+A[2]*P[2]);var A,P;return M.concat(S)});return new On(m,v)}}class Ka{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,m){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,m){return l[0]=u[0]+m[0],l[1]=u[1]+m[1],l[2]=u[2]+m[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=Wt(this.min),u=Wt(this.max);for(let m=0;m<s.length;m++)l[m]=s[m]?this.min[m]:this.center[m],u[m]=s[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new Ka(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const m=e.planes[u];let v=0;for(let b=0;b<s.length;b++)o.dot(m,s[b])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let m=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const M=e.points[b][u]-this.min[u];m=Math.min(m,M),v=Math.max(v,M)}if(v<0||m>this.max[u]-this.min[u])return 0}return 1}}class Un{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=o.interpolate.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=o.interpolate.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=o.interpolate.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=o.interpolate.number(e.right,s.right,l)),this}getCenter(e,s){const l=o.clamp((this.left+e-this.right)/2,0,e),u=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.Point(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Un(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Nn{constructor(e,s,l,u,m){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=m===void 0||!!m,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Un,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const e=new Nn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this._minEleveationForCurrentTile=e._minEleveationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-o.wrap(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,m){var v=u[0],b=u[1],M=u[2],S=u[3],A=Math.sin(m),P=Math.cos(m);l[0]=v*P+M*A,l[1]=b*P+S*A,l[2]=v*-A+M*P,l[3]=b*-A+S*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=o.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new o.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new o.Point(0,0)),u=this.pointCoordinate(new o.Point(this.width,0)),m=this.pointCoordinate(new o.Point(this.width,this.height)),v=this.pointCoordinate(new o.Point(0,this.height)),b=Math.floor(Math.min(l.x,u.x,m.x,v.x)),M=Math.floor(Math.max(l.x,u.x,m.x,v.x)),S=1;for(let A=b-S;A<=M+S;A++)A!==0&&s.push(new o.UnwrappedTileID(A,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const m=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),b=o.MercatorCoordinate.fromLngLat(this.center),M=Math.pow(2,u),S=[M*v.x,M*v.y,0],A=[M*b.x,M*b.y,0],P=On.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,q=K=>({aabb:new Ka([K*M,0,0],[(K+1)*M,M,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),j=[],$=[],rt=u,ct=e.reparseOverscaled?m:u;if(this._renderWorldCopies)for(let K=1;K<=3;K++)j.push(q(-K)),j.push(q(K));for(j.push(q(0));j.length>0;){const K=j.pop(),st=K.x,dt=K.y;let pt=K.fullyVisible;if(!pt){const jt=K.aabb.intersects(P);if(jt===0)continue;pt=jt===2}const _t=e.terrain?S:A,Et=K.aabb.distanceX(_t),xt=K.aabb.distanceY(_t),It=Math.max(Math.abs(Et),Math.abs(xt));if(K.zoom===rt||It>G+(1<<rt-K.zoom)-2&&K.zoom>=F){const jt=rt-K.zoom,ye=S[0]-.5-(st<<jt),kt=S[1]-.5-(dt<<jt);$.push({tileID:new o.OverscaledTileID(K.zoom===rt?ct:K.zoom,K.wrap,K.zoom,st,dt),distanceSq:Se([A[0]-.5-st,A[1]-.5-dt]),tileDistanceToCamera:Math.sqrt(ye*ye+kt*kt)})}else for(let jt=0;jt<4;jt++){const ye=(st<<1)+jt%2,kt=(dt<<1)+(jt>>1),ie=K.zoom+1;let qt=K.aabb.quadrant(jt);if(e.terrain){const Ne=new o.OverscaledTileID(ie,K.wrap,ie,ye,kt),me=e.terrain.getMinMaxElevation(Ne),ue=(s=me.minElevation)!==null&&s!==void 0?s:this.elevation,re=(l=me.maxElevation)!==null&&l!==void 0?l:this.elevation;qt=new Ka([qt.min[0],qt.min[1],ue],[qt.max[0],qt.max[1],re])}j.push({aabb:qt,zoom:ie,x:ye,y:kt,wrap:K.wrap,fullyVisible:pt})}}return $.sort((K,st)=>K.distanceSq-st.distanceSq).map(K=>K.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=o.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(e.lng)*this.worldSize,o.mercatorYfromLat(s)*this.worldSize)}unproject(e){return new o.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.pointLocation(this.centerPoint,e),l=e.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-l))return;const u=this.getCameraPosition(),m=o.MercatorCoordinate.fromLngLat(u.lngLat,u.altitude),v=o.MercatorCoordinate.fromLngLat(s,l),b=m.x-v.x,M=m.y-v.y,S=m.z-v.z,A=Math.sqrt(b*b+M*M+S*S),P=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=l,this._center=s,this.zoom=P}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(e),v=new o.MercatorCoordinate(m.x-(l.x-u.x),m.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return o.MercatorCoordinate.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];o.transformMat4(l,l,this.pixelMatrixInverse),o.transformMat4(u,u,this.pixelMatrixInverse);const m=l[3],v=u[3],b=l[1]/m,M=u[1]/v,S=l[2]/m,A=u[2]/v,P=S===A?0:(0-S)/(A-S);return new o.MercatorCoordinate(o.interpolate.number(l[0]/m,u[0]/v,P)/this.worldSize,o.interpolate.number(b,M,P)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return o.transformMat4(u,u,l),new o.Point(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ke().extend(this.pointLocation(new o.Point(0,e))).extend(this.pointLocation(new o.Point(this.width,e))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ke([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const m=e.canonical,v=this.worldSize/this.zoomScale(m.z),b=m.x+Math.pow(2,m.z)*e.wrap,M=o.identity(new Float64Array(16));return o.translate(M,M,[b*v,m.y*v,0]),o.scale(M,M,[v/o.EXTENT,v/o.EXTENT,1]),o.multiply(M,s?this.alignedProjMatrix:this.projMatrix,M),u[l]=new Float32Array(M),u[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,s,l,u,m=-90,v=90,b=-180,M=180;const S=this.size,A=this._unmodified;if(this.latRange){const G=this.latRange;m=o.mercatorYfromLat(G[1])*this.worldSize,v=o.mercatorYfromLat(G[0])*this.worldSize,e=v-m<S.y?S.y/(v-m):0}if(this.lngRange){const G=this.lngRange;b=o.wrap(o.mercatorXfromLng(G[0])*this.worldSize,0,this.worldSize),M=o.wrap(o.mercatorXfromLng(G[1])*this.worldSize,0,this.worldSize),M<b&&(M+=this.worldSize),s=M-b<S.x?S.x/(M-b):0}const P=this.point,F=Math.max(s||0,e||0);if(F)return this.center=this.unproject(new o.Point(s?(M+b)/2:P.x,e?(v+m)/2:P.y)),this.zoom+=this.scaleZoom(F),this._unmodified=A,void(this._constraining=!1);if(this.latRange){const G=P.y,q=S.y/2;G-q<m&&(u=m+q),G+q>v&&(u=v-q)}if(this.lngRange){const G=(b+M)/2,q=o.wrap(P.x,G-this.worldSize/2,G+this.worldSize/2),j=S.x/2;q-j<b&&(l=b+j),q+j>M&&(l=M-j)}l===void 0&&u===void 0||(this.center=this.unproject(new o.Point(l!==void 0?l:P.x,u!==void 0?u:P.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let u=o.identity(new Float64Array(16));o.scale(u,u,[this.width/2,-this.height/2,1]),o.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=o.identity(new Float64Array(16)),o.scale(u,u,[1,-1,1]),o.translate(u,u,[-1,-1,0]),o.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this._minEleveationForCurrentTile),b=m-v*this._pixelPerMeter/Math.cos(this._pitch),M=v<0?b:m,S=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),P=Math.sin(A)*M/Math.sin(o.clamp(Math.PI-S-A,.01,Math.PI-.01)),F=this.getHorizon(),G=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),q=Math.sin(G)*M/Math.sin(o.clamp(Math.PI-S-G,.01,Math.PI-.01)),j=Math.min(P,q),$=1.01*(Math.cos(Math.PI/2-this._pitch)*j+M),rt=this.height/50;u=new Float64Array(16),o.perspective(u,this._fov,this.width/this.height,rt,$),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,o.scale(u,u,[1,-1,1]),o.translate(u,u,[0,0,-this.cameraToCenterDistance]),o.rotateX(u,u,this._pitch),o.rotateZ(u,u,this.angle),o.translate(u,u,[-s,-l,0]),this.mercatorMatrix=o.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),o.scale(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,u),o.translate(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=o.invert([],u),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,u);const ct=this.width%2/2,K=this.height%2/2,st=Math.cos(this.angle),dt=Math.sin(this.angle),pt=s-Math.round(s)+st*ct+dt*K,_t=l-Math.round(l)+st*K+dt*ct,Et=new Float64Array(u);if(o.translate(Et,Et,[pt>.5?pt-1:pt,_t>.5?_t-1:_t,0]),this.alignedProjMatrix=Et,u=o.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new o.Point(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,m=s.x,v=s.y;for(const b of e)l=Math.min(l,b.x),u=Math.min(u,b.y),m=Math.max(m,b.x),v=Math.max(v,b.y);return[new o.Point(l,u),new o.Point(m,u),new o.Point(m,v),new o.Point(l,v),new o.Point(l,u)]}}}class Hs{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=function(s,l){let u=!1,m=null;const v=()=>{m=null,u&&(s(),m=setTimeout(v,300),u=!1)};return()=>(u=!0,m||v(),m)}(this._updateHashUnthrottled),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,u),v=Math.round(s.lng*m)/m,b=Math.round(s.lat*m)/m,M=this._map.getBearing(),S=this._map.getPitch();let A="";if(A+=e?`/${v}/${b}/${l}`:`${l}/${b}/${v}`,(M||S)&&(A+="/"+Math.round(10*M)/10),S&&(A+=`/${Math.round(S)}`),this._hashName){const P=this._hashName;let F=!1;const G=window.location.hash.slice(1).split("&").map(q=>{const j=q.split("=")[0];return j===P?(F=!0,`${j}=${A}`):q}).filter(q=>q);return F||G.push(`${P}=${A}`),`#${G.join("&")}`}return`#${A}`}}const Ya={linearity:.3,easing:o.bezier(0,0,.3,1)},rh=o.extend({deceleration:2500,maxSpeed:1400},Ya),sh=o.extend({deceleration:20,maxSpeed:1400},Ya),ah=o.extend({deceleration:1e3,maxSpeed:360},Ya),nh=o.extend({deceleration:1e3,maxSpeed:90},Ya);class oh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=o.browser.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)s.zoom+=m.zoomDelta||0,s.bearing+=m.bearingDelta||0,s.pitch+=m.pitchDelta||0,m.panDelta&&s.pan._add(m.panDelta),m.around&&(s.around=m.around),m.pinchAround&&(s.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const m=Ja(s.pan.mag(),l,o.extend({},rh,e||{}));u.offset=s.pan.mult(m.amount/s.pan.mag()),u.center=this._map.transform.center,Ss(u,m)}if(s.zoom){const m=Ja(s.zoom,l,sh);u.zoom=this._map.transform.zoom+m.amount,Ss(u,m)}if(s.bearing){const m=Ja(s.bearing,l,ah);u.bearing=this._map.transform.bearing+o.clamp(m.amount,-179,179),Ss(u,m)}if(s.pitch){const m=Ja(s.pitch,l,nh);u.pitch=this._map.transform.pitch+m.amount,Ss(u,m)}if(u.zoom||u.bearing){const m=s.pinchAround===void 0?s.around:s.pinchAround;u.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),o.extend(u,{noMoveStart:!0})}}function Ss(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function Ja(d,e,s){const{maxSpeed:l,linearity:u,deceleration:m}=s,v=o.clamp(d*u/(e/1e3),-l,l),b=Math.abs(v)/(m*u);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class ai extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const m=k.mousePos(s.getCanvasContainer(),l),v=s.unproject(m);super(e,o.extend({point:m,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class Mr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,m=k.touchPos(s.getCanvasContainer(),u),v=m.map(M=>s.unproject(M)),b=m.reduce((M,S,A,P)=>M.add(S.div(P.length)),new o.Point(0,0));super(e,{points:m,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class lh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class as{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new lh(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new ai(e.type,this._map,e))}mouseup(e){this._map.fire(new ai(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new ai(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ai(e.type,this._map,e))}mouseover(e){this._map.fire(new ai(e.type,this._map,e))}mouseout(e){this._map.fire(new ai(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Mr(e.type,this._map,e))}touchmove(e){this._map.fire(new Mr(e.type,this._map,e))}touchend(e){this._map.fire(new Mr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Mr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qa{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ai(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ai(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(o.Point.convert(e),this._map.terrain)}}class Ac{constructor(e,s){this._map=e,this._tr=new tn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(k.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(u.x,l.x),v=Math.max(u.x,l.x),b=Math.min(u.y,l.y),M=Math.max(u.y,l.y);k.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=v-m+"px",this._box.style.height=M-b+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),k.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new o.Event(e,{originalEvent:s}))}}function Oo(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const s={};for(let l=0;l<d.length;l++)s[d[l].identifier]=e[l];return s}class hh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const m=new o.Point(0,0);for(const v of u)m._add(v);return m.div(u.length)}(s),this.touches=Oo(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=Oo(l,s);for(const m in this.touches){const v=u[m];(!v||v.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Ks{constructor(e){this.singleTap=new hh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const m=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(m&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Is{constructor(e){this._tr=new tn(e),this._zoomIn=new Ks({numTouches:1,numTaps:2}),this._zoomOut=new Ks({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),m=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nt{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&k.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ch={0:1,2:2};class Ys{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=k.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=ch[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return k.mouseButton(e)===this._eventButton}}class va{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Vn=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=function(e){e.preventDefault()}},Ot=({enable:d,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Ys({checkCorrectEvent:u=>k.mouseButton(u)===0&&u.ctrlKey||k.mouseButton(u)===2});return new Nt({clickTolerance:e,move:(u,m)=>({bearingDelta:(m.x-u.x)*s}),moveStateManager:l,enable:d,assignEvents:Vn})},$n=({enable:d,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Ys({checkCorrectEvent:u=>k.mouseButton(u)===0&&u.ctrlKey||k.mouseButton(u)===2});return new Nt({clickTolerance:e,move:(u,m)=>({pitchDelta:(m.y-u.y)*s}),moveStateManager:l,enable:d,assignEvents:Vn})};class Cc{constructor(e,s){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,s,l)}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=Oo(l,s),m=new o.Point(0,0),v=new o.Point(0,0);let b=0;for(const S in u){const A=u[S],P=this._touches[S];P&&(m._add(A),v._add(A.sub(P)),b++,u[S]=A)}if(this._touches=u,b<this._minTouches||!v.mag())return;const M=v.div(b);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,m]=this._firstTwoTouches,v=xa(l,s,u),b=xa(l,s,m);if(!v||!b)return;const M=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],M,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,m]=this._firstTwoTouches,v=xa(l,s,u),b=xa(l,s,m);v&&b||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xa(d,e,s){for(let l=0;l<d.length;l++)if(d[l].identifier===s)return e[l]}function No(d,e){return Math.log(d/e)/Math.LN2}class uh extends Uo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(No(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:No(this._distance,l),pinchAround:s}}}function dh(d,e){return 180*d.angleWith(e)/Math.PI}class Pc extends Uo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dh(this._vector,l),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=dh(e,this._startVector);return Math.abs(l)<s}}function en(d){return Math.abs(d.y)>Math.abs(d.x)}class Vo extends Uo{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,en(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,m=s.mag()>=2;if(!u&&!m)return;if(!u||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return en(e)&&en(s)&&v}}const $o={panStep:100,bearingStep:15,pitchStep:10};class qo{constructor(e){this._tr=new tn(e);const s=$o;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,m=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:b=>{const M=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Ki,zoom:s?Math.round(M.zoom)+s*(e.shiftKey?2:1):M.zoom,bearing:M.bearing+l*this._bearingStep,pitch:M.pitch+u*this._pitchStep,offset:[-m*this._panStep,-v*this._panStep],center:M.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ki(d){return d*(2-d)}const ns=4.000244140625;class ph{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new tn(e),this._el=e.getCanvasContainer(),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=o.browser.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%ns==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=k.mousePos(this._el,e),l=this._tr;this._around=o.LngLat.convert(this._aroundCenter?l.center:l.unproject(s)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>ns?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&M!==0&&(M=1/M);const S=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(S*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let m,v=!1;if(this._type==="wheel"&&l&&u){const b=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),M=u(b);m=o.interpolate.number(l,s,M),b<1?this._frameId||(this._frameId=!0):v=!0}else m=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=o.defaultEasing;if(this._prevEase){const l=this._prevEase,u=(o.browser.now()-l.start)/l.duration,m=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=o.bezier(v,b,.25,1)}return this._prevEase={start:o.browser.now(),duration:e,easing:s},s}reset(){this._active=!1}}class Go{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zo{constructor(e){this._tr=new tn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jo{constructor(){this._tap=new Ks({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],m=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;m&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],m=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fh{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Tr{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ge{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Js=d=>d.zoom||d.drag||d.pitch||d.rotate;class Xo extends o.Event{}function qn(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class mh{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,m)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,b={needsRenderFrame:!1},M={},S={},A=u.touches,P=A?this._getMapTouches(A):void 0,F=P?k.touchPos(this._el,P):k.mousePos(this._el,u);for(const{handlerName:j,handler:$,allowed:rt}of this._handlers){if(!$.isEnabled())continue;let ct;this._blockedByActive(S,rt,j)?$.reset():$[m||u.type]&&(ct=$[m||u.type](u,F,P),this.mergeHandlerResult(b,M,ct,j,v),ct&&ct.needsRenderFrame&&this._triggerRenderFrame()),(ct||$.isActive())&&(S[j]=$)}const G={};for(const j in this._previousActiveHandlers)S[j]||(G[j]=v);this._previousActiveHandlers=S,(Object.keys(G).length||qn(b))&&(this._changes.push([b,M,G]),this._triggerRenderFrame()),(Object.keys(S).length||qn(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=b;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new oh(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,m,v]of this._listeners)k.addEventListener(u,m,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)k.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new as(s,e));const u=s.boxZoom=new Ac(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const m=new Is(s),v=new Zo(s);s.doubleClickZoom=new Go(v,m),this._add("tapZoom",m),this._add("clickZoom",v),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const b=new jo;this._add("tapDragZoom",b);const M=s.touchPitch=new Vo(s);this._add("touchPitch",M),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const S=Ot(e),A=$n(e);s.dragRotate=new Tr(e,S,A),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const P=(({enable:rt,clickTolerance:ct})=>{const K=new Ys({checkCorrectEvent:st=>k.mouseButton(st)===0&&!st.ctrlKey});return new Nt({clickTolerance:ct,move:(st,dt)=>({around:dt,panDelta:dt.sub(st)}),activateOnStart:!0,moveStateManager:K,enable:rt,assignEvents:Vn})})(e),F=new Cc(e,s);s.dragPan=new fh(l,P,F),this._add("mousePan",P),this._add("touchPan",F,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const G=new Pc,q=new uh;s.touchZoomRotate=new Ge(l,q,G,b),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const j=s.scrollZoom=new ph(s,()=>this._triggerRenderFrame());this._add("scrollZoom",j,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const $=s.keyboard=new qo(s);this._add("keyboard",$),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Qa(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Js(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,m){if(!l)return;o.extend(e,l);const v={handlerName:u,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,m,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new o.Point(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),o.extend(s,m),o.extend(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,m=u._getTransformForUpdate(),v=u.terrain;if(!(qn(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:b,zoomDelta:M,bearingDelta:S,pitchDelta:A,around:P,pinchAround:F}=e;F!==void 0&&(P=F),u._stop(!0),P=P||u.transform.centerPoint;const G=m.pointLocation(b?P.sub(b):P);S&&(m.bearing+=S),A&&(m.pitch+=A),M&&(m.zoom+=M),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(b)):m.setLocationAtPoint(G,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(G,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,m.recalculateZoom(u.terrain)})):m.setLocationAtPoint(G,P),u._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Js(this._eventsInProgress),m=Js(e),v={};for(const A in e){const{originalEvent:P}=e[A];this._eventsInProgress[A]||(v[`${A}start`]=P),this._eventsInProgress[A]=e[A]}!u&&m&&this._fireEvent("movestart",m.originalEvent);for(const A in v)this._fireEvent(A,v[A]);m&&this._fireEvent("move",m.originalEvent);for(const A in e){const{originalEvent:P}=e[A];this._fireEvent(A,P)}const b={};let M;for(const A in this._eventsInProgress){const{handlerName:P,originalEvent:F}=this._eventsInProgress[A];this._handlersById[P].isActive()||(delete this._eventsInProgress[A],M=s[P]||F,b[`${A}end`]=M)}for(const A in b)this._fireEvent(A,b[A]);const S=Js(this._eventsInProgress);if(l&&(u||m)&&!S){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;A?(P(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:M})):(this._map.fire(new o.Event("moveend",{originalEvent:M})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new o.Event(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Xo("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class gh extends o.Evented{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=o.Point.convert(e).mult(-1),this.panTo(this.transform.center,o.extend({offset:e},s),l)}panTo(e,s,l){return this.easeTo(o.extend({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(o.extend({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(o.extend({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,o.extend({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=ke.convert(e);const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const m={top:0,bottom:0,right:0,left:0};if(typeof(u=o.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const dt=u.padding;u.padding={top:dt,bottom:dt,right:dt,left:dt}}u.padding=o.extend(m,u.padding);const v=this.transform,b=v.padding,M=v.project(o.LngLat.convert(e)),S=v.project(o.LngLat.convert(s)),A=M.rotate(-l*Math.PI/180),P=S.rotate(-l*Math.PI/180),F=new o.Point(Math.max(A.x,P.x),Math.max(A.y,P.y)),G=new o.Point(Math.min(A.x,P.x),Math.min(A.y,P.y)),q=F.sub(G),j=(v.width-(b.left+b.right+u.padding.left+u.padding.right))/q.x,$=(v.height-(b.top+b.bottom+u.padding.top+u.padding.bottom))/q.y;if($<0||j<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const rt=Math.min(v.scaleZoom(v.scale*Math.min(j,$)),u.maxZoom),ct=o.Point.convert(u.offset),K=new o.Point((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(l*Math.PI/180),st=ct.add(K).mult(v.scale/v.zoomScale(rt));return{center:v.unproject(M.add(S).div(2).sub(st)),zoom:rt,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(e)),this.transform.pointLocation(o.Point.convert(s)),l,u),u,m)}_fitInternal(e,s,l){return e?(delete(s=o.extend(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,m=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=o.LngLat.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(m=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),u&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),m&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),v&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const m=o.MercatorCoordinate.fromLngLat(e,s),v=o.MercatorCoordinate.fromLngLat(l,u),b=v.x-m.x,M=v.y-m.y,S=v.z-m.z,A=Math.hypot(b,M,S);if(A===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(b,M),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),G=180*Math.atan2(b,-M)/Math.PI;let q=180*Math.acos(P/A)/Math.PI;return q=S<0?90-q:90+q,{center:v.toLngLat(),zoom:F,pitch:q,bearing:G}}easeTo(e,s){this._stop(!1,e.easeId),((e=o.extend({offset:[0,0],duration:500,easing:o.defaultEasing},e)).animate===!1||!e.essential&&o.browser.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),u=this.getZoom(),m=this.getBearing(),v=this.getPitch(),b=this.getPadding(),M="zoom"in e?+e.zoom:u,S="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:v,P="padding"in e?e.padding:l.padding,F=o.Point.convert(e.offset);let G=l.centerPoint.add(F);const q=l.pointLocation(G),j=o.LngLat.convert(e.center||q);this._normalizeCenter(j);const $=l.project(q),rt=l.project(j).sub($),ct=l.zoomScale(M-u);let K,st;e.around&&(K=o.LngLat.convert(e.around),st=l.locationPoint(K));const dt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==u,this._rotating=this._rotating||m!==S,this._pitching=this._pitching||A!==v,this._padding=!l.isPaddingEqual(P),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,dt),this.terrain&&this._prepareElevation(j),this._ease(pt=>{if(this._zooming&&(l.zoom=o.interpolate.number(u,M,pt)),this._rotating&&(l.bearing=o.interpolate.number(m,S,pt)),this._pitching&&(l.pitch=o.interpolate.number(v,A,pt)),this._padding&&(l.interpolatePadding(b,P,pt),G=l.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(pt),K)l.setLocationAtPoint(K,st);else{const _t=l.zoomScale(l.zoom-u),Et=M>u?Math.min(2,ct):Math.max(.5,ct),xt=Math.pow(Et,1-pt),It=l.unproject($.add(rt.mult(pt*xt)).mult(_t));l.setLocationAtPoint(l.renderWorldCopies?It.wrap():It,G)}this._applyUpdatedTransform(l),this._fireMoveEvents(s)},pt=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,pt)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new o.Event("movestart",e)),this._zooming&&!l.zooming&&this.fire(new o.Event("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new o.Event("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new o.Event("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=o.interpolate.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;const s=e.clone(),{center:l,zoom:u,pitch:m,bearing:v,elevation:b}=this.transformCameraUpdate(s);l&&(s.center=l),u!==void 0&&(s.zoom=u),m!==void 0&&(s.pitch=m),v!==void 0&&(s.bearing=v),b!==void 0&&(s.elevation=b),this.transform.apply(s)}_fireMoveEvents(e){this.fire(new o.Event("move",e)),this._zooming&&this.fire(new o.Event("zoom",e)),this._rotating&&this.fire(new o.Event("rotate",e)),this._pitching&&this.fire(new o.Event("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new o.Event("zoomend",e)),u&&this.fire(new o.Event("rotateend",e)),m&&this.fire(new o.Event("pitchend",e)),this.fire(new o.Event("moveend",e))}flyTo(e,s){if(!e.essential&&o.browser.prefersReducedMotion){const qt=o.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qt,s)}this.stop(),e=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.defaultEasing},e);const l=this._getTransformForUpdate(),u=this.getZoom(),m=this.getBearing(),v=this.getPitch(),b=this.getPadding(),M="zoom"in e?o.clamp(+e.zoom,l.minZoom,l.maxZoom):u,S="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:v,P="padding"in e?e.padding:l.padding,F=l.zoomScale(M-u),G=o.Point.convert(e.offset);let q=l.centerPoint.add(G);const j=l.pointLocation(q),$=o.LngLat.convert(e.center||j);this._normalizeCenter($);const rt=l.project(j),ct=l.project($).sub(rt);let K=e.curve;const st=Math.max(l.width,l.height),dt=st/F,pt=ct.mag();if("minZoom"in e){const qt=o.clamp(Math.min(e.minZoom,u,M),l.minZoom,l.maxZoom),Ne=st/l.zoomScale(qt-u);K=Math.sqrt(Ne/pt*2)}const _t=K*K;function Et(qt){const Ne=(dt*dt-st*st+(qt?-1:1)*_t*_t*pt*pt)/(2*(qt?dt:st)*_t*pt);return Math.log(Math.sqrt(Ne*Ne+1)-Ne)}function xt(qt){return(Math.exp(qt)-Math.exp(-qt))/2}function It(qt){return(Math.exp(qt)+Math.exp(-qt))/2}const jt=Et(!1);let ye=function(qt){return It(jt)/It(jt+K*qt)},kt=function(qt){return st*((It(jt)*(xt(Ne=jt+K*qt)/It(Ne))-xt(jt))/_t)/pt;var Ne},ie=(Et(!0)-jt)/K;if(Math.abs(pt)<1e-6||!isFinite(ie)){if(Math.abs(st-dt)<1e-6)return this.easeTo(e,s);const qt=dt<st?-1:1;ie=Math.abs(Math.log(dt/st))/K,kt=function(){return 0},ye=function(Ne){return Math.exp(qt*K*Ne)}}return e.duration="duration"in e?+e.duration:1e3*ie/("screenSpeed"in e?+e.screenSpeed/K:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==S,this._pitching=A!==v,this._padding=!l.isPaddingEqual(P),this._prepareEase(s,!1),this.terrain&&this._prepareElevation($),this._ease(qt=>{const Ne=qt*ie,me=1/ye(Ne);l.zoom=qt===1?M:u+l.scaleZoom(me),this._rotating&&(l.bearing=o.interpolate.number(m,S,qt)),this._pitching&&(l.pitch=o.interpolate.number(v,A,qt)),this._padding&&(l.interpolatePadding(b,P,qt),q=l.centerPoint.add(G)),this.terrain&&!e.freezeElevation&&this._updateElevation(qt);const ue=qt===1?$:l.unproject(rt.add(ct.mult(kt(Ne))).mult(me));l.setLocationAtPoint(l.renderWorldCopies?ue.wrap():ue,q),this._applyUpdatedTransform(l),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,s)}if(!e){const l=this.handlers;l&&l.stop(!1)}return this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=o.browser.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=o.wrap(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.LngLat.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}class _h{constructor(e={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const m=s[u];if(m.used||m.usedForTerrain){const v=m.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,m)=>u.length-m.length),e=e.filter((u,m)=>{for(let v=m+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Lr{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const s=k.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Kt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var ee=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Zn extends o.Evented{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),o.ortho(u.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[u.key]=new Vs(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16),o.ortho(m.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),s[l]=m}else if(u.canonical.isChildOf(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,b=u.canonical.x-(u.canonical.x>>v<<v),M=u.canonical.y-(u.canonical.y>>v<<v),S=o.EXTENT>>v;o.ortho(m.posMatrix,0,S,0,S,0,1),o.translate(m.posMatrix,m.posMatrix,[-b*S,-M*S,0]),s[l]=m}else if(e.canonical.isChildOf(u.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,b=e.canonical.x-(e.canonical.x>>v<<v),M=e.canonical.y-(e.canonical.y>>v<<v),S=o.EXTENT>>v;o.ortho(m.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(m.posMatrix,m.posMatrix,[b*S,M*S,0]),o.scale(m.posMatrix,m.posMatrix,[1/2**v,1/2**v,0]),s[l]=m}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&s)for(;u>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(u--).key);return m}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class Wo{constructor(e,s,l){this.painter=e,this.sourceCache=new Zn(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=o.EXTENT){var m;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),b=(m=v.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const M=function(q,j,$){var rt=j[0],ct=j[1];return q[0]=$[0]*rt+$[4]*ct+$[12],q[1]=$[1]*rt+$[5]*ct+$[13],q}([],[s/u*o.EXTENT,l/u*o.EXTENT],v.u_terrain_matrix),S=[M[0]*b.dim,M[1]*b.dim],A=Math.floor(S[0]),P=Math.floor(S[1]),F=S[0]-A,G=S[1]-P;return b.get(A,P)*(1-F)*(1-G)+b.get(A+1,P)*F*(1-G)+b.get(A,P+1)*(1-F)*G+b.get(A+1,P+1)*F*G}getElevationForLngLatZoom(e,s){const{tileID:l,mercatorX:u,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%o.EXTENT,m%o.EXTENT,o.EXTENT)}getElevation(e,s,l,u=o.EXTENT){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,m=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new oe(u,m,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new oe(u,new o.RGBAImage({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new oe(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?m=e.canonical.z-u:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>m<<m),b=e.canonical.y-(e.canonical.y>>m<<m),M=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<m),1/(o.EXTENT<<m),0]);o.translate(M,M,[v*o.EXTENT,b*o.EXTENT,0]),this._demMatrixCache[e.key]={matrix:M,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new oe(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new oe(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,v=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)s[v+0]=255&b,s[v+1]=255&m,s[v+2]=b>>8<<4|m>>8,s[v+3]=0;const l=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new oe(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const m=s[0]+(s[2]>>4<<8),v=s[1]+((15&s[2])<<8),b=this.coordsIndex[255-s[3]],M=b&&this.sourceCache.getTileByID(b);if(!M)return null;const S=this._coordsTextureSize,A=(1<<M.tileID.canonical.z)*S;return new o.MercatorCoordinate((M.tileID.canonical.x*S+m)/A,(M.tileID.canonical.y*S+v)/A,this.getElevation(M.tileID,m,v,S))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new o.Pos3dArray,l=new o.TriangleIndexArray,u=this.meshSize,m=o.EXTENT/u,v=u*u;for(let P=0;P<=u;P++)for(let F=0;F<=u;F++)s.emplaceBack(F*m,P*m,0);for(let P=0;P<v;P+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+P,u+F+P+1,u+F+P+2),l.emplaceBack(F+P,u+F+P+2,F+P+1);const b=s.length,M=b+2*(u+1);for(const P of[0,1])for(let F=0;F<=u;F++)for(const G of[0,1])s.emplaceBack(F*m,P*o.EXTENT,G);for(let P=0;P<2*u;P+=2)l.emplaceBack(M+P,M+P+1,M+P+3),l.emplaceBack(M+P,M+P+3,M+P+2),l.emplaceBack(b+P,b+P+3,b+P+1),l.emplaceBack(b+P,b+P+2,b+P+3);const S=s.length,A=S+2*(u+1);for(const P of[0,1])for(let F=0;F<=u;F++)for(const G of[0,1])s.emplaceBack(P*o.EXTENT,F*m,G);for(let P=0;P<2*u;P+=2)l.emplaceBack(S+P,S+P+1,S+P+3),l.emplaceBack(S+P,S+P+3,S+P+2),l.emplaceBack(A+P,A+P+3,A+P+1),l.emplaceBack(A+P,A+P+2,A+P+3);return this._mesh={indexBuffer:e.createIndexBuffer(l),vertexBuffer:e.createVertexBuffer(s,ee.members),segments:o.SegmentVector.simpleSegment(0,0,s.length,l.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*o.earthRadius/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=o.MercatorCoordinate.fromLngLat(e.wrap()),u=(1<<s)*o.EXTENT,m=l.x*u,v=l.y*u,b=Math.floor(m/o.EXTENT),M=Math.floor(v/o.EXTENT);return{tileID:new o.OverscaledTileID(s,0,s,b,M),mercatorX:m,mercatorY:v}}}class Ho{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new oe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const _i={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class yh{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Ho(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const m of u){const v=this.terrain.sourceCache.getTerrainCoords(m);for(const b in v)this._coordsDescendingInv[l][b]||(this._coordsDescendingInv[l][b]=[]),this._coordsDescendingInv[l][b].push(v[b])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],m=u.source;if(_i[u.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const v in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][v]=this._coordsDescendingInv[m][v].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[u][l.tileID.key];m&&m!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(_i[s]&&(this._prevType&&_i[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(_i[this._prevType]||_i[s]&&u){this._prevType=s;const m=this._stacks.length-1,v=this._stacks[m]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(Fn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[m]){const S=this.pool.getObjectForId(b.rtt[m].id);if(S.stamp===b.rtt[m].stamp){this.pool.useObject(S);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),b.rtt[m]={id:M.id,stamp:M.stamp},l.context.bindFramebuffer.set(M.fbo.framebuffer),l.context.clear({color:o.Color.transparent,stencil:0}),l.currentStencilSource=void 0;for(let S=0;S<v.length;S++){const A=l.style._layers[v[S]],P=A.source?this._coordsDescendingInv[A.source][b.tileID.key]:[b.tileID];l.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),l._renderTileClippingMasks(A,P),l.renderLayer(l,l.style.sourceCaches[A.source],A,P),A.source&&(b.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][b.tileID.key])}}return Fn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),_i[s]}return!1}}const Xr=L,zc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ba=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},He={showCompass:!0,showZoom:!0,visualizePitch:!1};class ni{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(o.extend({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),k.mousePos(this.element,v)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,k.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),m=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Ot({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:b,bearingDegreesPerPixelMoved:M=.8})=>{const S=new va;return new Nt({clickTolerance:b,move:(A,P)=>({bearingDelta:(P.x-A.x)*M}),moveStateManager:S,enable:v,assignEvents:ba})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=$n({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:b,pitchDegreesPerPixelMoved:M=-.5})=>{const S=new va;return new Nt({clickTolerance:b,move:(A,P)=>({pitchDelta:(P.y-A.y)*M}),moveStateManager:S,enable:v,assignEvents:ba})})({clickTolerance:m,enable:!0})),k.addEventListener(s,"mousedown",this.mousedown),k.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),k.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),k.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(e,s)||{};m&&l.setPitch(l.getPitch()+m)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(e,s)||{};m&&l.setPitch(l.getPitch()+m)}}off(){const e=this.element;k.removeEventListener(e,"mousedown",this.mousedown),k.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let os;function wa(d,e,s){if(d=new o.LngLat(d.lng,d.lat),e){const l=new o.LngLat(d.lng-360,d.lat),u=new o.LngLat(d.lng+360,d.lat),m=s.locationPoint(d).distSqr(e);s.locationPoint(l).distSqr(e)<m?d=l:s.locationPoint(u).distSqr(e)<m&&(d=u)}for(;Math.abs(d.lng-s.center.lng)>180;){const l=s.locationPoint(d);if(l.x>=0&&l.y>=0&&l.x<=s.width&&l.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const Ma={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jn(d,e,s){const l=d.classList;for(const u in Ma)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class rn extends o.Evented{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=wa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let u="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?u="rotateX(0deg)":this._pitchAlignment==="map"&&(u=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${Ma[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${u} ${l}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=o.Point.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div"),this._element.setAttribute("aria-label","Map marker");const s=k.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const m=k.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const v=k.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=k.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const rt of M){const ct=k.createNS("http://www.w3.org/2000/svg","ellipse");ct.setAttributeNS(null,"opacity","0.04"),ct.setAttributeNS(null,"cx","10.5"),ct.setAttributeNS(null,"cy","5.80029008"),ct.setAttributeNS(null,"rx",rt.rx),ct.setAttributeNS(null,"ry",rt.ry),b.appendChild(ct)}const S=k.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill",this._color);const A=k.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),S.appendChild(A);const P=k.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const F=k.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(F);const G=k.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const q=k.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const j=k.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#000000"),j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962");const $=k.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),q.appendChild(j),q.appendChild($),v.appendChild(b),v.appendChild(S),v.appendChild(P),v.appendChild(G),v.appendChild(q),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=o.Point.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),jn(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(e){return this._offset=o.Point.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ko={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let As=0,Qs=!1;const Yo={maxWidth:100,unit:"metric"};function Xn(d,e,s){const l=s&&s.maxWidth||100,u=d._container.clientHeight/2,m=d.unproject([0,u]),v=d.unproject([l,u]),b=m.distanceTo(v);if(s&&s.unit==="imperial"){const M=3.2808*b;M>5280?ta(e,l,M/5280,d._getUIString("ScaleControl.Miles")):ta(e,l,M,d._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?ta(e,l,b/1852,d._getUIString("ScaleControl.NauticalMiles")):b>=1e3?ta(e,l,b/1e3,d._getUIString("ScaleControl.Kilometers")):ta(e,l,b,d._getUIString("ScaleControl.Meters"))}function ta(d,e,s,l){const u=function(m){const v=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(M){const S=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*S)/S}(b),v*b}(s);d.style.width=e*(u/s)+"px",d.innerHTML=`${u}&nbsp;${l}`}const Jo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Qo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wn(d){if(d){if(typeof d=="number"){const e=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new o.Point(0,0),top:new o.Point(0,d),"top-left":new o.Point(e,e),"top-right":new o.Point(-e,e),bottom:new o.Point(0,-d),"bottom-left":new o.Point(e,-e),"bottom-right":new o.Point(-e,-e),left:new o.Point(d,0),right:new o.Point(-d,0)}}if(d instanceof o.Point||Array.isArray(d)){const e=o.Point.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.Point.convert(d.center||[0,0]),top:o.Point.convert(d.top||[0,0]),"top-left":o.Point.convert(d["top-left"]||[0,0]),"top-right":o.Point.convert(d["top-right"]||[0,0]),bottom:o.Point.convert(d.bottom||[0,0]),"bottom-left":o.Point.convert(d["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(d["bottom-right"]||[0,0]),left:o.Point.convert(d.left||[0,0]),right:o.Point.convert(d.right||[0,0])}}return Wn(new o.Point(0,0))}const tl={extend:(d,...e)=>o.extend(d,...e),run(d){d()},logToElement(d,e=!1,s="log"){const l=window.document.getElementById(s);l&&(e&&(l.innerHTML=""),l.innerHTML+=`<br>${d}`)}},Hn=L;class Ee{static get version(){return Hn}static get workerCount(){return qi.workerCount}static set workerCount(e){qi.workerCount=e}static get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(e){o.config.MAX_PARALLEL_IMAGE_REQUESTS=e}static get workerUrl(){return o.config.WORKER_URL}static set workerUrl(e){o.config.WORKER_URL=e}static addProtocol(e,s){o.config.REGISTERED_PROTOCOLS[e]=s}static removeProtocol(e){delete o.config.REGISTERED_PROTOCOLS[e]}}return Ee.Map=class extends gh{constructor(d){if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(d=o.extend({},zc,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Nn(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._cooperativeGesturesOnWheel=e=>{this._onCooperativeGesture(e,e[this._metaKey],1)},this._contextLost=e=>{e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Gn,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Kt,d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this._imageQueueHandle=Tt.addThrottleControl(()=>this.isMoving()),this._requestManager=new $t(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let e=!1;this._resizeObserver=new ResizeObserver(s=>{e?this._trackResize&&this.resize(s)._update():e=!0}),this._resizeObserver.observe(this._container)}this.handlers=new mh(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new Hs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new _h({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new Lr,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update(e.dataType==="style"),this.fire(new o.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new o.Event(`${e.dataType}dataloading`,e))}),this.on("dataabort",e=>{this.fire(new o.Event("sourcedataabort",e))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,s,l)}resize(d){var e;const s=this._containerDimensions(),l=s[0],u=s[1],m=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,m),this.painter.resize(l,u,m),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const M=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,M),this.painter.resize(l,u,M)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d))),this.fire(new o.Event("resize",d)),v&&this.fire(new o.Event("moveend",d)),this}_getClampedPixelRatio(d,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),m=d*u,v=e*u;return Math.min(m>s?s/m:1,v>l?l/v:1)*u}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(ke.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(d){return this.transform.locationPoint(o.LngLat.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(o.Point.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,s){if(d==="mouseenter"||d==="mouseover"){let l=!1;return{layer:e,listener:s,delegates:{mousemove:m=>{const v=this.getLayer(e)?this.queryRenderedFeatures(m.point,{layers:[e]}):[];v.length?l||(l=!0,s.call(this,new ai(d,this,m.originalEvent,{features:v}))):l=!1},mouseout:()=>{l=!1}}}}if(d==="mouseleave"||d==="mouseout"){let l=!1;return{layer:e,listener:s,delegates:{mousemove:v=>{(this.getLayer(e)?this.queryRenderedFeatures(v.point,{layers:[e]}):[]).length?l=!0:l&&(l=!1,s.call(this,new ai(d,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new ai(d,this,v.originalEvent)))}}}}{const l=u=>{const m=this.getLayer(e)?this.queryRenderedFeatures(u.point,{layers:[e]}):[];m.length&&(u.features=m,s.call(this,u),delete u.features)};return{layer:e,listener:s,delegates:{[d]:l}}}}on(d,e,s){if(s===void 0)return super.on(d,e);const l=this._createDelegatedListener(d,e,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(d,e,s){if(s===void 0)return super.once(d,e);const l=this._createDelegatedListener(d,e,s);for(const u in l.delegates)this.once(u,l.delegates[u]);return this}off(d,e,s){return s===void 0?super.off(d,e):(this._delegatedListeners&&this._delegatedListeners[d]&&(l=>{const u=this._delegatedListeners[d];for(let m=0;m<u.length;m++){const v=u[m];if(v.layer===e&&v.listener===s){for(const b in v.delegates)this.off(b,v.delegates[b]);return u.splice(m,1),this}}})(),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let s;const l=d instanceof o.Point||Array.isArray(d),u=l?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:d)||{},u instanceof o.Point||typeof u[0]=="number")s=[o.Point.convert(u)];else{const m=o.Point.convert(u[0]),v=o.Point.convert(u[1]);s=[m,new o.Point(v.x,m.y),v,new o.Point(m.x,v.y),m]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Li(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,s):this.style.loadJSON(d,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Li(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const s=this._requestManager.transformRequest(d,Dt.Style);o.getJSON(s,(l,u)=>{l?this.fire(new o.ErrorEvent(l)):u&&this._updateDiff(u,e)})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===d.source&&o.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Wo(this.painter,e,d),this.painter.renderToTexture=new yh(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==d.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.Event("terrain",{terrain:d})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const s=d[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(d,e,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,e,s)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:m,stretchY:v,content:b}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.isImageBitmap(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:S,data:A}=e,P=e;return this.style.addImage(d,{data:new o.RGBAImage({width:M,height:S},new Uint8Array(A)),pixelRatio:l,stretchX:m,stretchY:v,content:b,sdf:u,version:0,userImage:P}),P.onAdd&&P.onAdd(this,d),this}}{const{width:M,height:S,data:A}=o.browser.getImageData(e);this.style.addImage(d,{data:new o.RGBAImage({width:M,height:S},A),pixelRatio:l,stretchX:m,stretchY:v,content:b,sdf:u,version:0})}}updateImage(d,e){const s=this.style.getImage(d);if(!s)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||o.isImageBitmap(e)?o.browser.getImageData(e):e,{width:u,height:m,data:v}=l;if(u===void 0||m===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||m!==s.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||o.isImageBitmap(e));return s.data.replace(v,b),this.style.updateImage(d,s),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,e){Tt.getImage(this._requestManager.transformRequest(d,Dt.Image),e)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,e,s){return this.style.setLayerZoomRange(d,e,s),this._update(!0)}setFilter(d,e,s={}){return this.style.setFilter(d,e,s),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,s,l={}){return this.style.setPaintProperty(d,e,s,l),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,s,l={}){return this.style.setLayoutProperty(d,e,s,l),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,s,l=>{l||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,s=>{s||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=k.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=k.create("div","maplibregl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=k.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=k.create("div","maplibregl-cooperative-gesture-screen",this._container);let d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){k.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(d,e,s){this._canvas.width=Math.floor(s*d),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:d},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new ih(s,this.transform),Y.testSupport(s)}_onCooperativeGesture(d,e,s){return!e&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,m=o.browser.now();this.style.zoomHistory.update(u,m);const v=new o.EvaluationParameters(u,{now:m,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=v.crossFadingFactor();b===1&&b===this._crossFadingFactor||(s=!0,this._crossFadingFactor=b),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Tt.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.browser.frame(d=>{o.PerformanceUtils.frame(d),this._frame=null,this._render(d)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return Xr}getCameraTargetElevation(){return this.transform.elevation}},Ee.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=o.extend({},He,d),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ni(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const s=k.create("button",d,this._container);return s.type="button",s.addEventListener("click",e),s}},Ee.GeolocateControl=class extends o.Evented{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new o.LngLat(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),m=o.extend({bearing:u},this.options.fitBoundsOptions),v=ke.fromLngLat(s,l);this._map.fitBounds(v,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new o.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Qs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new rn({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}},this.options=o.extend({},Ko,d)}onAdd(d){return this._map=d,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(e,s=!1){os===void 0||s?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{os=l.state!=="denied",e(os)}).catch(()=>{os=!!window.navigator.geolocation,e(os)}):(os=!!window.navigator.geolocation,e(os)):e(os)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,As=0,Qs=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),s=d.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),s=d.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":As--,Qs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),As++,As>1?(d={maximumAge:6e5,timeout:0},Qs=!0):(d=this.options.positionOptions,Qs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Ee.AttributionControl=_h,Ee.LogoControl=Lr,Ee.ScaleControl=class{constructor(d){this._onMove=()=>{Xn(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Xn(this._map,this._container,this.options)},this.options=o.extend({},Yo,d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Ee.FullscreenControl=class extends o.Evented{constructor(d={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Ee.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=d}onAdd(d){return this._map=d,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Ee.Popup=class extends o.Evented{constructor(d){super(),this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wa(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;const s=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);let l=this.options.anchor;const u=Wn(this.options.offset);if(!l){const v=this._container.offsetWidth,b=this._container.offsetHeight;let M;M=s.y+u.bottom.y<b?["top"]:s.y>this._map.transform.height-b?["bottom"]:[],s.x<v/2?M.push("left"):s.x>this._map.transform.width-v/2&&M.push("right"),l=M.length===0?"bottom":M.join("-")}const m=s.add(u[l]).round();k.setTransform(this._container,`${Ma[l]} translate(${m.x}px,${m.y}px)`),jn(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=o.extend(Object.create(Jo),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=d;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Qo);d&&d.focus()}},Ee.Marker=rn,Ee.Style=Li,Ee.LngLat=o.LngLat,Ee.LngLatBounds=ke,Ee.Point=o.Point,Ee.MercatorCoordinate=o.MercatorCoordinate,Ee.Evented=o.Evented,Ee.AJAXError=o.AJAXError,Ee.config=o.config,Ee.CanvasSource=gt,Ee.GeoJSONSource=kr,Ee.ImageSource=or,Ee.RasterDEMTileSource=ts,Ee.RasterTileSource=zr,Ee.VectorTileSource=Qr,Ee.VideoSource=Dr,Ee.setRTLTextPlugin=o.setRTLTextPlugin,Ee.getRTLTextPluginStatus=o.getRTLTextPluginStatus,Ee.prewarm=function(){bs().acquire(Lt)},Ee.clearPrewarmedResources=function(){const d=is;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Lt),is=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},tl.extend(Ee,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),Ee});var I=x;return I})})($p);var Sg=$p.exports;const Da=Vp(Sg);var Lu={exports:{}};Lu.exports=oc;Lu.exports.default=oc;function oc(a,c,p){p=p||2;var y=c&&c.length,x=y?c[0]*p:a.length,T=Gp(a,0,x,p,!0),I=[];if(!T||T.next===T.prev)return I;var o,L,k,Y,N,ot,mt;if(y&&(T=zg(a,c,T,p)),a.length>80*p){o=k=a[0],L=Y=a[1];for(var ft=p;ft<x;ft+=p)N=a[ft],ot=a[ft+1],N<o&&(o=N),ot<L&&(L=ot),N>k&&(k=N),ot>Y&&(Y=ot);mt=Math.max(k-o,Y-L),mt=mt!==0?32767/mt:0}return Il(T,I,p,o,L,mt,0),I}function Gp(a,c,p,y,x){var T,I;if(x===Su(a,c,p,y)>0)for(T=c;T<p;T+=y)I=yp(T,a[T],a[T+1],I);else for(T=p-y;T>=c;T-=y)I=yp(T,a[T],a[T+1],I);return I&&lc(I,I.next)&&(Cl(I),I=I.next),I}function un(a,c){if(!a)return a;c||(c=a);var p=a,y;do if(y=!1,!p.steiner&&(lc(p,p.next)||ci(p.prev,p,p.next)===0)){if(Cl(p),p=c=p.prev,p===p.next)break;y=!0}else p=p.next;while(y||p!==c);return c}function Il(a,c,p,y,x,T,I){if(a){!I&&T&&Bg(a,y,x,T);for(var o=a,L,k;a.prev!==a.next;){if(L=a.prev,k=a.next,T?Ag(a,y,x,T):Ig(a)){c.push(L.i/p|0),c.push(a.i/p|0),c.push(k.i/p|0),Cl(a),a=k.next,o=k.next;continue}if(a=k,a===o){I?I===1?(a=Cg(un(a),c,p),Il(a,c,p,y,x,T,2)):I===2&&Pg(a,c,p,y,x,T):Il(un(a),c,p,y,x,T,1);break}}}}function Ig(a){var c=a.prev,p=a,y=a.next;if(ci(c,p,y)>=0)return!1;for(var x=c.x,T=p.x,I=y.x,o=c.y,L=p.y,k=y.y,Y=x<T?x<I?x:I:T<I?T:I,N=o<L?o<k?o:k:L<k?L:k,ot=x>T?x>I?x:I:T>I?T:I,mt=o>L?o>k?o:k:L>k?L:k,ft=y.next;ft!==c;){if(ft.x>=Y&&ft.x<=ot&&ft.y>=N&&ft.y<=mt&&co(x,o,T,L,I,k,ft.x,ft.y)&&ci(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0}function Ag(a,c,p,y){var x=a.prev,T=a,I=a.next;if(ci(x,T,I)>=0)return!1;for(var o=x.x,L=T.x,k=I.x,Y=x.y,N=T.y,ot=I.y,mt=o<L?o<k?o:k:L<k?L:k,ft=Y<N?Y<ot?Y:ot:N<ot?N:ot,Mt=o>L?o>k?o:k:L>k?L:k,Tt=Y>N?Y>ot?Y:ot:N>ot?N:ot,Dt=Tu(mt,ft,c,p,y),$t=Tu(Mt,Tt,c,p,y),Pt=a.prevZ,Wt=a.nextZ;Pt&&Pt.z>=Dt&&Wt&&Wt.z<=$t;){if(Pt.x>=mt&&Pt.x<=Mt&&Pt.y>=ft&&Pt.y<=Tt&&Pt!==x&&Pt!==I&&co(o,Y,L,N,k,ot,Pt.x,Pt.y)&&ci(Pt.prev,Pt,Pt.next)>=0||(Pt=Pt.prevZ,Wt.x>=mt&&Wt.x<=Mt&&Wt.y>=ft&&Wt.y<=Tt&&Wt!==x&&Wt!==I&&co(o,Y,L,N,k,ot,Wt.x,Wt.y)&&ci(Wt.prev,Wt,Wt.next)>=0))return!1;Wt=Wt.nextZ}for(;Pt&&Pt.z>=Dt;){if(Pt.x>=mt&&Pt.x<=Mt&&Pt.y>=ft&&Pt.y<=Tt&&Pt!==x&&Pt!==I&&co(o,Y,L,N,k,ot,Pt.x,Pt.y)&&ci(Pt.prev,Pt,Pt.next)>=0)return!1;Pt=Pt.prevZ}for(;Wt&&Wt.z<=$t;){if(Wt.x>=mt&&Wt.x<=Mt&&Wt.y>=ft&&Wt.y<=Tt&&Wt!==x&&Wt!==I&&co(o,Y,L,N,k,ot,Wt.x,Wt.y)&&ci(Wt.prev,Wt,Wt.next)>=0)return!1;Wt=Wt.nextZ}return!0}function Cg(a,c,p){var y=a;do{var x=y.prev,T=y.next.next;!lc(x,T)&&Zp(x,y,y.next,T)&&Al(x,T)&&Al(T,x)&&(c.push(x.i/p|0),c.push(y.i/p|0),c.push(T.i/p|0),Cl(y),Cl(y.next),y=a=T),y=y.next}while(y!==a);return un(y)}function Pg(a,c,p,y,x,T){var I=a;do{for(var o=I.next.next;o!==I.prev;){if(I.i!==o.i&&Ug(I,o)){var L=jp(I,o);I=un(I,I.next),L=un(L,L.next),Il(I,c,p,y,x,T,0),Il(L,c,p,y,x,T,0);return}o=o.next}I=I.next}while(I!==a)}function zg(a,c,p,y){var x=[],T,I,o,L,k;for(T=0,I=c.length;T<I;T++)o=c[T]*y,L=T<I-1?c[T+1]*y:a.length,k=Gp(a,o,L,y,!1),k===k.next&&(k.steiner=!0),x.push(Og(k));for(x.sort(kg),T=0;T<x.length;T++)p=Dg(x[T],p);return p}function kg(a,c){return a.x-c.x}function Dg(a,c){var p=Lg(a,c);if(!p)return c;var y=jp(p,a);return un(y,y.next),un(p,p.next)}function Lg(a,c){var p=c,y=a.x,x=a.y,T=-1/0,I;do{if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){var o=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(o<=y&&o>T&&(T=o,I=p.x<p.next.x?p:p.next,o===y))return I}p=p.next}while(p!==c);if(!I)return null;var L=I,k=I.x,Y=I.y,N=1/0,ot;p=I;do y>=p.x&&p.x>=k&&y!==p.x&&co(x<Y?y:T,x,k,Y,x<Y?T:y,x,p.x,p.y)&&(ot=Math.abs(x-p.y)/(y-p.x),Al(p,a)&&(ot<N||ot===N&&(p.x>I.x||p.x===I.x&&Rg(I,p)))&&(I=p,N=ot)),p=p.next;while(p!==L);return I}function Rg(a,c){return ci(a.prev,a,c.prev)<0&&ci(c.next,a,a.next)<0}function Bg(a,c,p,y){var x=a;do x.z===0&&(x.z=Tu(x.x,x.y,c,p,y)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==a);x.prevZ.nextZ=null,x.prevZ=null,Fg(x)}function Fg(a){var c,p,y,x,T,I,o,L,k=1;do{for(p=a,a=null,T=null,I=0;p;){for(I++,y=p,o=0,c=0;c<k&&(o++,y=y.nextZ,!!y);c++);for(L=k;o>0||L>0&&y;)o!==0&&(L===0||!y||p.z<=y.z)?(x=p,p=p.nextZ,o--):(x=y,y=y.nextZ,L--),T?T.nextZ=x:a=x,x.prevZ=T,T=x;p=y}T.nextZ=null,k*=2}while(I>1);return a}function Tu(a,c,p,y,x){return a=(a-p)*x|0,c=(c-y)*x|0,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,c=(c|c<<8)&16711935,c=(c|c<<4)&252645135,c=(c|c<<2)&858993459,c=(c|c<<1)&1431655765,a|c<<1}function Og(a){var c=a,p=a;do(c.x<p.x||c.x===p.x&&c.y<p.y)&&(p=c),c=c.next;while(c!==a);return p}function co(a,c,p,y,x,T,I,o){return(x-I)*(c-o)>=(a-I)*(T-o)&&(a-I)*(y-o)>=(p-I)*(c-o)&&(p-I)*(T-o)>=(x-I)*(y-o)}function Ug(a,c){return a.next.i!==c.i&&a.prev.i!==c.i&&!Ng(a,c)&&(Al(a,c)&&Al(c,a)&&Vg(a,c)&&(ci(a.prev,a,c.prev)||ci(a,c.prev,c))||lc(a,c)&&ci(a.prev,a,a.next)>0&&ci(c.prev,c,c.next)>0)}function ci(a,c,p){return(c.y-a.y)*(p.x-c.x)-(c.x-a.x)*(p.y-c.y)}function lc(a,c){return a.x===c.x&&a.y===c.y}function Zp(a,c,p,y){var x=$h(ci(a,c,p)),T=$h(ci(a,c,y)),I=$h(ci(p,y,a)),o=$h(ci(p,y,c));return!!(x!==T&&I!==o||x===0&&Vh(a,p,c)||T===0&&Vh(a,y,c)||I===0&&Vh(p,a,y)||o===0&&Vh(p,c,y))}function Vh(a,c,p){return c.x<=Math.max(a.x,p.x)&&c.x>=Math.min(a.x,p.x)&&c.y<=Math.max(a.y,p.y)&&c.y>=Math.min(a.y,p.y)}function $h(a){return a>0?1:a<0?-1:0}function Ng(a,c){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==c.i&&p.next.i!==c.i&&Zp(p,p.next,a,c))return!0;p=p.next}while(p!==a);return!1}function Al(a,c){return ci(a.prev,a,a.next)<0?ci(a,c,a.next)>=0&&ci(a,a.prev,c)>=0:ci(a,c,a.prev)<0||ci(a,a.next,c)<0}function Vg(a,c){var p=a,y=!1,x=(a.x+c.x)/2,T=(a.y+c.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&x<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==a);return y}function jp(a,c){var p=new Eu(a.i,a.x,a.y),y=new Eu(c.i,c.x,c.y),x=a.next,T=c.prev;return a.next=c,c.prev=a,p.next=x,x.prev=p,y.next=p,p.prev=y,T.next=y,y.prev=T,y}function yp(a,c,p,y){var x=new Eu(a,c,p);return y?(x.next=y.next,x.prev=y,y.next.prev=x,y.next=x):(x.prev=x,x.next=x),x}function Cl(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Eu(a,c,p){this.i=a,this.x=c,this.y=p,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}oc.deviation=function(a,c,p,y){var x=c&&c.length,T=x?c[0]*p:a.length,I=Math.abs(Su(a,0,T,p));if(x)for(var o=0,L=c.length;o<L;o++){var k=c[o]*p,Y=o<L-1?c[o+1]*p:a.length;I-=Math.abs(Su(a,k,Y,p))}var N=0;for(o=0;o<y.length;o+=3){var ot=y[o]*p,mt=y[o+1]*p,ft=y[o+2]*p;N+=Math.abs((a[ot]-a[ft])*(a[mt+1]-a[ot+1])-(a[ot]-a[mt])*(a[ft+1]-a[ot+1]))}return I===0&&N===0?0:Math.abs((N-I)/I)};function Su(a,c,p,y){for(var x=0,T=c,I=p-y;T<p;T+=y)x+=(a[I]-a[T])*(a[T+1]+a[I+1]),I=T;return x}oc.flatten=function(a){for(var c=a[0][0].length,p={vertices:[],holes:[],dimensions:c},y=0,x=0;x<a.length;x++){for(var T=0;T<a[x].length;T++)for(var I=0;I<c;I++)p.vertices.push(a[x][T][I]);x>0&&(y+=a[x-1].length,p.holes.push(y))}return p};var $g=Lu.exports;const vp=Vp($g);function qg(a){a("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),a("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),a("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),a.WGS84=a["EPSG:4326"],a["EPSG:3785"]=a["EPSG:3857"],a.GOOGLE=a["EPSG:3857"],a["EPSG:900913"]=a["EPSG:3857"],a["EPSG:102113"]=a["EPSG:3857"]}var dn=1,pn=2,_o=3,Gg=4,Iu=5,xp=6378137,Zg=6356752314e-3,bp=.0066943799901413165,El=484813681109536e-20,Ct=Math.PI/2,jg=.16666666666666666,Xg=.04722222222222222,Wg=.022156084656084655,Gt=1e-10,Xi=.017453292519943295,Fs=57.29577951308232,Fe=Math.PI/4,Pl=Math.PI*2,bi=3.14159265359,Ar={};Ar.greenwich=0;Ar.lisbon=-9.131906111111;Ar.paris=2.337229166667;Ar.bogota=-74.080916666667;Ar.madrid=-3.687938888889;Ar.rome=12.452333333333;Ar.bern=7.439583333333;Ar.jakarta=106.807719444444;Ar.ferro=-17.666666666667;Ar.brussels=4.367975;Ar.stockholm=18.058277777778;Ar.athens=23.7163375;Ar.oslo=10.722916666667;const Hg={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var wp=/[\s_\-\/\(\)]/g;function Ra(a,c){if(a[c])return a[c];for(var p=Object.keys(a),y=c.toLowerCase().replace(wp,""),x=-1,T,I;++x<p.length;)if(T=p[x],I=T.toLowerCase().replace(wp,""),I===y)return a[T]}function Au(a){var c={},p=a.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,L){var k=L.split("=");return k.push(!0),o[k[0].toLowerCase()]=k[1],o},{}),y,x,T,I={proj:"projName",datum:"datumCode",rf:function(o){c.rf=parseFloat(o)},lat_0:function(o){c.lat0=o*Xi},lat_1:function(o){c.lat1=o*Xi},lat_2:function(o){c.lat2=o*Xi},lat_ts:function(o){c.lat_ts=o*Xi},lon_0:function(o){c.long0=o*Xi},lon_1:function(o){c.long1=o*Xi},lon_2:function(o){c.long2=o*Xi},alpha:function(o){c.alpha=parseFloat(o)*Xi},gamma:function(o){c.rectified_grid_angle=parseFloat(o)},lonc:function(o){c.longc=o*Xi},x_0:function(o){c.x0=parseFloat(o)},y_0:function(o){c.y0=parseFloat(o)},k_0:function(o){c.k0=parseFloat(o)},k:function(o){c.k0=parseFloat(o)},a:function(o){c.a=parseFloat(o)},b:function(o){c.b=parseFloat(o)},r_a:function(){c.R_A=!0},zone:function(o){c.zone=parseInt(o,10)},south:function(){c.utmSouth=!0},towgs84:function(o){c.datum_params=o.split(",").map(function(L){return parseFloat(L)})},to_meter:function(o){c.to_meter=parseFloat(o)},units:function(o){c.units=o;var L=Ra(Hg,o);L&&(c.to_meter=L.to_meter)},from_greenwich:function(o){c.from_greenwich=o*Xi},pm:function(o){var L=Ra(Ar,o);c.from_greenwich=(L||parseFloat(o))*Xi},nadgrids:function(o){o==="@null"?c.datumCode="none":c.nadgrids=o},axis:function(o){var L="ewnsud";o.length===3&&L.indexOf(o.substr(0,1))!==-1&&L.indexOf(o.substr(1,1))!==-1&&L.indexOf(o.substr(2,1))!==-1&&(c.axis=o)},approx:function(){c.approx=!0}};for(y in p)x=p[y],y in I?(T=I[y],typeof T=="function"?T(x):c[T]=x):c[y]=x;return typeof c.datumCode=="string"&&c.datumCode!=="WGS84"&&(c.datumCode=c.datumCode.toLowerCase()),c}var zl=1,Xp=2,Wp=3,ec=4,Hp=5,Ru=-1,Kg=/\s/,Yg=/[A-Za-z]/,Jg=/[A-Za-z84_]/,hc=/[,\]]/,Kp=/[\d\.E\-\+]/;function la(a){if(typeof a!="string")throw new Error("not a string");this.text=a.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=zl}la.prototype.readCharicter=function(){var a=this.text[this.place++];if(this.state!==ec)for(;Kg.test(a);){if(this.place>=this.text.length)return;a=this.text[this.place++]}switch(this.state){case zl:return this.neutral(a);case Xp:return this.keyword(a);case ec:return this.quoted(a);case Hp:return this.afterquote(a);case Wp:return this.number(a);case Ru:return}};la.prototype.afterquote=function(a){if(a==='"'){this.word+='"',this.state=ec;return}if(hc.test(a)){this.word=this.word.trim(),this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in afterquote yet, index '+this.place)};la.prototype.afterItem=function(a){if(a===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=zl;return}if(a==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=zl,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Ru);return}};la.prototype.number=function(a){if(Kp.test(a)){this.word+=a;return}if(hc.test(a)){this.word=parseFloat(this.word),this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in number yet, index '+this.place)};la.prototype.quoted=function(a){if(a==='"'){this.state=Hp;return}this.word+=a};la.prototype.keyword=function(a){if(Jg.test(a)){this.word+=a;return}if(a==="["){var c=[];c.push(this.word),this.level++,this.root===null?this.root=c:this.currentObject.push(c),this.stack.push(this.currentObject),this.currentObject=c,this.state=zl;return}if(hc.test(a)){this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in keyword yet, index '+this.place)};la.prototype.neutral=function(a){if(Yg.test(a)){this.word=a,this.state=Xp;return}if(a==='"'){this.word="",this.state=ec;return}if(Kp.test(a)){this.word=a,this.state=Wp;return}if(hc.test(a)){this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in neutral yet, index '+this.place)};la.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Ru)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Qg(a){var c=new la(a);return c.output()}function Mp(a,c,p){Array.isArray(c)&&(p.unshift(c),c=null);var y=c?{}:a,x=p.reduce(function(T,I){return uo(I,T),T},y);c&&(a[c]=x)}function uo(a,c){if(!Array.isArray(a)){c[a]=!0;return}var p=a.shift();if(p==="PARAMETER"&&(p=a.shift()),a.length===1){if(Array.isArray(a[0])){c[p]={},uo(a[0],c[p]);return}c[p]=a[0];return}if(!a.length){c[p]=!0;return}if(p==="TOWGS84"){c[p]=a;return}if(p==="AXIS"){p in c||(c[p]=[]),c[p].push(a);return}Array.isArray(p)||(c[p]={});var y;switch(p){case"UNIT":case"PRIMEM":case"VERT_DATUM":c[p]={name:a[0].toLowerCase(),convert:a[1]},a.length===3&&uo(a[2],c[p]);return;case"SPHEROID":case"ELLIPSOID":c[p]={name:a[0],a:a[1],rf:a[2]},a.length===4&&uo(a[3],c[p]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":a[0]=["name",a[0]],Mp(c,p,a);return;default:for(y=-1;++y<a.length;)if(!Array.isArray(a[y]))return uo(a,c[p]);return Mp(c,p,a)}}var t_=.017453292519943295;function e_(a,c){var p=c[0],y=c[1];!(p in a)&&y in a&&(a[p]=a[y],c.length===3&&(a[p]=c[2](a[p])))}function Rs(a){return a*t_}function i_(a){if(a.type==="GEOGCS"?a.projName="longlat":a.type==="LOCAL_CS"?(a.projName="identity",a.local=!0):typeof a.PROJECTION=="object"?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var c="",p=0,y=a.AXIS.length;p<y;++p){var x=[a.AXIS[p][0].toLowerCase(),a.AXIS[p][1].toLowerCase()];x[0].indexOf("north")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="north"?c+="n":x[0].indexOf("south")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="south"?c+="s":x[0].indexOf("east")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="east"?c+="e":(x[0].indexOf("west")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="west")&&(c+="w")}c.length===2&&(c+="u"),c.length===3&&(a.axis=c)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),a.units==="metre"&&(a.units="meter"),a.UNIT.convert&&(a.type==="GEOGCS"?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert));var T=a.GEOGCS;a.type==="GEOGCS"&&(T=a),T&&(T.DATUM?a.datumCode=T.DATUM.name.toLowerCase():a.datumCode=T.name.toLowerCase(),a.datumCode.slice(0,2)==="d_"&&(a.datumCode=a.datumCode.slice(2)),(a.datumCode==="new_zealand_geodetic_datum_1949"||a.datumCode==="new_zealand_1949")&&(a.datumCode="nzgd49"),(a.datumCode==="wgs_1984"||a.datumCode==="world_geodetic_system_1984")&&(a.PROJECTION==="Mercator_Auxiliary_Sphere"&&(a.sphere=!0),a.datumCode="wgs84"),a.datumCode.slice(-6)==="_ferro"&&(a.datumCode=a.datumCode.slice(0,-6)),a.datumCode.slice(-8)==="_jakarta"&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),T.DATUM&&T.DATUM.SPHEROID&&(a.ellps=T.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),a.ellps.toLowerCase().slice(0,13)==="international"&&(a.ellps="intl"),a.a=T.DATUM.SPHEROID.a,a.rf=parseFloat(T.DATUM.SPHEROID.rf,10)),T.DATUM&&T.DATUM.TOWGS84&&(a.datum_params=T.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),a.datumCode==="ch1903+"&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel")&&(a.datumCode="isr93")),a.b&&!isFinite(a.b)&&(a.b=a.a);function I(k){var Y=a.to_meter||1;return k*Y}var o=function(k){return e_(a,k)},L=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Rs],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Rs],["x0","false_easting",I],["y0","false_northing",I],["long0","central_meridian",Rs],["lat0","latitude_of_origin",Rs],["lat0","standard_parallel_1",Rs],["lat1","standard_parallel_1",Rs],["lat2","standard_parallel_2",Rs],["azimuth","Azimuth"],["alpha","azimuth",Rs],["srsCode","name"]];L.forEach(o),!a.long0&&a.longc&&(a.projName==="Albers_Conic_Equal_Area"||a.projName==="Lambert_Azimuthal_Equal_Area")&&(a.long0=a.longc),!a.lat_ts&&a.lat1&&(a.projName==="Stereographic_South_Pole"||a.projName==="Polar Stereographic (variant B)")?(a.lat0=Rs(a.lat1>0?90:-90),a.lat_ts=a.lat1):!a.lat_ts&&a.lat0&&a.projName==="Polar_Stereographic"&&(a.lat_ts=a.lat0,a.lat0=Rs(a.lat0>0?90:-90))}function Yp(a){var c=Qg(a),p=c.shift(),y=c.shift();c.unshift(["name",y]),c.unshift(["type",p]);var x={};return uo(c,x),i_(x),x}function _r(a){var c=this;if(arguments.length===2){var p=arguments[1];typeof p=="string"?p.charAt(0)==="+"?_r[a]=Au(arguments[1]):_r[a]=Yp(arguments[1]):_r[a]=p}else if(arguments.length===1){if(Array.isArray(a))return a.map(function(y){Array.isArray(y)?_r.apply(c,y):_r(y)});if(typeof a=="string"){if(a in _r)return _r[a]}else"EPSG"in a?_r["EPSG:"+a.EPSG]=a:"ESRI"in a?_r["ESRI:"+a.ESRI]=a:"IAU2000"in a?_r["IAU2000:"+a.IAU2000]=a:console.log(a);return}}qg(_r);function r_(a){return typeof a=="string"}function s_(a){return a in _r}var a_=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function n_(a){return a_.some(function(c){return a.indexOf(c)>-1})}var o_=["3857","900913","3785","102113"];function l_(a){var c=Ra(a,"authority");if(c){var p=Ra(c,"epsg");return p&&o_.indexOf(p)>-1}}function h_(a){var c=Ra(a,"extension");if(c)return Ra(c,"proj4")}function c_(a){return a[0]==="+"}function u_(a){if(r_(a)){if(s_(a))return _r[a];if(n_(a)){var c=Yp(a);if(l_(c))return _r["EPSG:3857"];var p=h_(c);return p?Au(p):c}if(c_(a))return Au(a)}else return a}function Tp(a,c){a=a||{};var p,y;if(!c)return a;for(y in c)p=c[y],p!==void 0&&(a[y]=p);return a}function Us(a,c,p){var y=a*c;return p/Math.sqrt(1-y*y)}function Dl(a){return a<0?-1:1}function Yt(a){return Math.abs(a)<=bi?a:a-Dl(a)*Pl}function vs(a,c,p){var y=a*p,x=.5*a;return y=Math.pow((1-y)/(1+y),x),Math.tan(.5*(Ct-c))/y}function kl(a,c){for(var p=.5*a,y,x,T=Ct-2*Math.atan(c),I=0;I<=15;I++)if(y=a*Math.sin(T),x=Ct-2*Math.atan(c*Math.pow((1-y)/(1+y),p))-T,T+=x,Math.abs(x)<=1e-10)return T;return-9999}function d_(){var a=this.b/this.a;this.es=1-a*a,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Us(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function p_(a){var c=a.x,p=a.y;if(p*Fs>90&&p*Fs<-90&&c*Fs>180&&c*Fs<-180)return null;var y,x;if(Math.abs(Math.abs(p)-Ct)<=Gt)return null;if(this.sphere)y=this.x0+this.a*this.k0*Yt(c-this.long0),x=this.y0+this.a*this.k0*Math.log(Math.tan(Fe+.5*p));else{var T=Math.sin(p),I=vs(this.e,p,T);y=this.x0+this.a*this.k0*Yt(c-this.long0),x=this.y0-this.a*this.k0*Math.log(I)}return a.x=y,a.y=x,a}function f_(a){var c=a.x-this.x0,p=a.y-this.y0,y,x;if(this.sphere)x=Ct-2*Math.atan(Math.exp(-p/(this.a*this.k0)));else{var T=Math.exp(-p/(this.a*this.k0));if(x=kl(this.e,T),x===-9999)return null}return y=Yt(this.long0+c/(this.a*this.k0)),a.x=y,a.y=x,a}var m_=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const g_={init:d_,forward:p_,inverse:f_,names:m_};function __(){}function Ep(a){return a}var y_=["longlat","identity"];const v_={init:__,forward:Ep,inverse:Ep,names:y_};var x_=[g_,v_],Jh={},ic=[];function Jp(a,c){var p=ic.length;return a.names?(ic[p]=a,a.names.forEach(function(y){Jh[y.toLowerCase()]=p}),this):(console.log(c),!0)}function b_(a){if(!a)return!1;var c=a.toLowerCase();if(typeof Jh[c]<"u"&&ic[Jh[c]])return ic[Jh[c]]}function w_(){x_.forEach(Jp)}const M_={start:w_,add:Jp,get:b_};var pe={};pe.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};pe.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};pe.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};pe.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};pe.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};pe.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};pe.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};pe.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};pe.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};pe.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};pe.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};pe.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};pe.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};pe.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};pe.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};pe.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};pe.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};pe.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};pe.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};pe.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};pe.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};pe.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};pe.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};pe.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};pe.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};pe.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};pe.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};pe.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};pe.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};pe.hough={a:6378270,rf:297,ellipseName:"Hough"};pe.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};pe.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};pe.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};pe.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};pe.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};pe.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};pe.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};pe.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};pe.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};pe.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};pe.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};pe.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var T_=pe.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};pe.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function E_(a,c,p,y){var x=a*a,T=c*c,I=(x-T)/x,o=0;y?(a*=1-I*(jg+I*(Xg+I*Wg)),x=a*a,I=0):o=Math.sqrt(I);var L=(x-T)/T;return{es:I,e:o,ep2:L}}function S_(a,c,p,y,x){if(!a){var T=Ra(pe,y);T||(T=T_),a=T.a,c=T.b,p=T.rf}return p&&!c&&(c=(1-1/p)*a),(p===0||Math.abs(a-c)<Gt)&&(x=!0,c=a),{a,b:c,rf:p,sphere:x}}var Ii={};Ii.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Ii.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Ii.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Ii.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Ii.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Ii.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Ii.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Ii.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Ii.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Ii.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Ii.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Ii.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Ii.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Ii.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Ii.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Ii.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Ii.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function I_(a,c,p,y,x,T,I){var o={};return a===void 0||a==="none"?o.datum_type=Iu:o.datum_type=Gg,c&&(o.datum_params=c.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=dn),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=pn,o.datum_params[3]*=El,o.datum_params[4]*=El,o.datum_params[5]*=El,o.datum_params[6]=o.datum_params[6]/1e6+1)),I&&(o.datum_type=_o,o.grids=I),o.a=p,o.b=y,o.es=x,o.ep2=T,o}var Qp={};function A_(a,c){var p=new DataView(c),y=z_(p),x=k_(p,y);x.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var T=D_(p,x,y),I={header:x,subgrids:T};return Qp[a]=I,I}function C_(a){if(a===void 0)return null;var c=a.split(",");return c.map(P_)}function P_(a){if(a.length===0)return null;var c=a[0]==="@";return c&&(a=a.slice(1)),a==="null"?{name:"null",mandatory:!c,grid:null,isNull:!0}:{name:a,mandatory:!c,grid:Qp[a]||null,isNull:!1}}function po(a){return a/3600*Math.PI/180}function z_(a){var c=a.getInt32(8,!1);return c===11?!1:(c=a.getInt32(8,!0),c!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function k_(a,c){return{nFields:a.getInt32(8,c),nSubgridFields:a.getInt32(24,c),nSubgrids:a.getInt32(40,c),shiftType:Cu(a,56,56+8).trim(),fromSemiMajorAxis:a.getFloat64(120,c),fromSemiMinorAxis:a.getFloat64(136,c),toSemiMajorAxis:a.getFloat64(152,c),toSemiMinorAxis:a.getFloat64(168,c)}}function Cu(a,c,p){return String.fromCharCode.apply(null,new Uint8Array(a.buffer.slice(c,p)))}function D_(a,c,p){for(var y=176,x=[],T=0;T<c.nSubgrids;T++){var I=R_(a,y,p),o=B_(a,y,I,p),L=Math.round(1+(I.upperLongitude-I.lowerLongitude)/I.longitudeInterval),k=Math.round(1+(I.upperLatitude-I.lowerLatitude)/I.latitudeInterval);x.push({ll:[po(I.lowerLongitude),po(I.lowerLatitude)],del:[po(I.longitudeInterval),po(I.latitudeInterval)],lim:[L,k],count:I.gridNodeCount,cvs:L_(o)})}return x}function L_(a){return a.map(function(c){return[po(c.longitudeShift),po(c.latitudeShift)]})}function R_(a,c,p){return{name:Cu(a,c+8,c+16).trim(),parent:Cu(a,c+24,c+24+8).trim(),lowerLatitude:a.getFloat64(c+72,p),upperLatitude:a.getFloat64(c+88,p),lowerLongitude:a.getFloat64(c+104,p),upperLongitude:a.getFloat64(c+120,p),latitudeInterval:a.getFloat64(c+136,p),longitudeInterval:a.getFloat64(c+152,p),gridNodeCount:a.getInt32(c+168,p)}}function B_(a,c,p,y){for(var x=c+176,T=16,I=[],o=0;o<p.gridNodeCount;o++){var L={latitudeShift:a.getFloat32(x+o*T,y),longitudeShift:a.getFloat32(x+o*T+4,y),latitudeAccuracy:a.getFloat32(x+o*T+8,y),longitudeAccuracy:a.getFloat32(x+o*T+12,y)};I.push(L)}return I}function Os(a,c){if(!(this instanceof Os))return new Os(a);c=c||function(k){if(k)throw k};var p=u_(a);if(typeof p!="object"){c(a);return}var y=Os.projections.get(p.projName);if(!y){c(a);return}if(p.datumCode&&p.datumCode!=="none"){var x=Ra(Ii,p.datumCode);x&&(p.datum_params=p.datum_params||(x.towgs84?x.towgs84.split(","):null),p.ellps=x.ellipse,p.datumName=x.datumName?x.datumName:p.datumCode)}p.k0=p.k0||1,p.axis=p.axis||"enu",p.ellps=p.ellps||"wgs84",p.lat1=p.lat1||p.lat0;var T=S_(p.a,p.b,p.rf,p.ellps,p.sphere),I=E_(T.a,T.b,T.rf,p.R_A),o=C_(p.nadgrids),L=p.datum||I_(p.datumCode,p.datum_params,T.a,T.b,I.es,I.ep2,o);Tp(this,p),Tp(this,y),this.a=T.a,this.b=T.b,this.rf=T.rf,this.sphere=T.sphere,this.es=I.es,this.e=I.e,this.ep2=I.ep2,this.datum=L,this.init(),c(null,this)}Os.projections=M_;Os.projections.start();function F_(a,c){return a.datum_type!==c.datum_type||a.a!==c.a||Math.abs(a.es-c.es)>5e-11?!1:a.datum_type===dn?a.datum_params[0]===c.datum_params[0]&&a.datum_params[1]===c.datum_params[1]&&a.datum_params[2]===c.datum_params[2]:a.datum_type===pn?a.datum_params[0]===c.datum_params[0]&&a.datum_params[1]===c.datum_params[1]&&a.datum_params[2]===c.datum_params[2]&&a.datum_params[3]===c.datum_params[3]&&a.datum_params[4]===c.datum_params[4]&&a.datum_params[5]===c.datum_params[5]&&a.datum_params[6]===c.datum_params[6]:!0}function tf(a,c,p){var y=a.x,x=a.y,T=a.z?a.z:0,I,o,L,k;if(x<-Ct&&x>-1.001*Ct)x=-Ct;else if(x>Ct&&x<1.001*Ct)x=Ct;else{if(x<-Ct)return{x:-1/0,y:-1/0,z:a.z};if(x>Ct)return{x:1/0,y:1/0,z:a.z}}return y>Math.PI&&(y-=2*Math.PI),o=Math.sin(x),k=Math.cos(x),L=o*o,I=p/Math.sqrt(1-c*L),{x:(I+T)*k*Math.cos(y),y:(I+T)*k*Math.sin(y),z:(I*(1-c)+T)*o}}function ef(a,c,p,y){var x=1e-12,T=x*x,I=30,o,L,k,Y,N,ot,mt,ft,Mt,Tt,Dt,$t,Pt,Wt=a.x,de=a.y,ve=a.z?a.z:0,Se,xe,Ce;if(o=Math.sqrt(Wt*Wt+de*de),L=Math.sqrt(Wt*Wt+de*de+ve*ve),o/p<x){if(Se=0,L/p<x)return xe=Ct,Ce=-y,{x:a.x,y:a.y,z:a.z}}else Se=Math.atan2(de,Wt);k=ve/L,Y=o/L,N=1/Math.sqrt(1-c*(2-c)*Y*Y),ft=Y*(1-c)*N,Mt=k*N,Pt=0;do Pt++,mt=p/Math.sqrt(1-c*Mt*Mt),Ce=o*ft+ve*Mt-mt*(1-c*Mt*Mt),ot=c*mt/(mt+Ce),N=1/Math.sqrt(1-ot*(2-ot)*Y*Y),Tt=Y*(1-ot)*N,Dt=k*N,$t=Dt*ft-Tt*Mt,ft=Tt,Mt=Dt;while($t*$t>T&&Pt<I);return xe=Math.atan(Dt/Math.abs(Tt)),{x:Se,y:xe,z:Ce}}function O_(a,c,p){if(c===dn)return{x:a.x+p[0],y:a.y+p[1],z:a.z+p[2]};if(c===pn){var y=p[0],x=p[1],T=p[2],I=p[3],o=p[4],L=p[5],k=p[6];return{x:k*(a.x-L*a.y+o*a.z)+y,y:k*(L*a.x+a.y-I*a.z)+x,z:k*(-o*a.x+I*a.y+a.z)+T}}}function U_(a,c,p){if(c===dn)return{x:a.x-p[0],y:a.y-p[1],z:a.z-p[2]};if(c===pn){var y=p[0],x=p[1],T=p[2],I=p[3],o=p[4],L=p[5],k=p[6],Y=(a.x-y)/k,N=(a.y-x)/k,ot=(a.z-T)/k;return{x:Y+L*N-o*ot,y:-L*Y+N+I*ot,z:o*Y-I*N+ot}}}function qh(a){return a===dn||a===pn}function N_(a,c,p){if(F_(a,c)||a.datum_type===Iu||c.datum_type===Iu)return p;var y=a.a,x=a.es;if(a.datum_type===_o){var T=Sp(a,!1,p);if(T!==0)return;y=xp,x=bp}var I=c.a,o=c.b,L=c.es;if(c.datum_type===_o&&(I=xp,o=Zg,L=bp),x===L&&y===I&&!qh(a.datum_type)&&!qh(c.datum_type))return p;if(p=tf(p,x,y),qh(a.datum_type)&&(p=O_(p,a.datum_type,a.datum_params)),qh(c.datum_type)&&(p=U_(p,c.datum_type,c.datum_params)),p=ef(p,L,I,o),c.datum_type===_o){var k=Sp(c,!0,p);if(k!==0)return}return p}function Sp(a,c,p){if(a.grids===null||a.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var y={x:-p.x,y:p.y},x={x:Number.NaN,y:Number.NaN},T=[],I=0;I<a.grids.length;I++){var o=a.grids[I];if(T.push(o.name),o.isNull){x=y;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}var L=o.grid.subgrids[0],k=(Math.abs(L.del[1])+Math.abs(L.del[0]))/1e4,Y=L.ll[0]-k,N=L.ll[1]-k,ot=L.ll[0]+(L.lim[0]-1)*L.del[0]+k,mt=L.ll[1]+(L.lim[1]-1)*L.del[1]+k;if(!(N>y.y||Y>y.x||mt<y.y||ot<y.x)&&(x=V_(y,c,L),!isNaN(x.x)))break}return isNaN(x.x)?(console.log("Failed to find a grid shift table for location '"+-y.x*Fs+" "+y.y*Fs+" tried: '"+T+"'"),-1):(p.x=-x.x,p.y=x.y,0)}function V_(a,c,p){var y={x:Number.NaN,y:Number.NaN};if(isNaN(a.x))return y;var x={x:a.x,y:a.y};x.x-=p.ll[0],x.y-=p.ll[1],x.x=Yt(x.x-Math.PI)+Math.PI;var T=Ip(x,p);if(c){if(isNaN(T.x))return y;T.x=x.x-T.x,T.y=x.y-T.y;var I=9,o=1e-12,L,k;do{if(k=Ip(T,p),isNaN(k.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}L={x:x.x-(k.x+T.x),y:x.y-(k.y+T.y)},T.x+=L.x,T.y+=L.y}while(I--&&Math.abs(L.x)>o&&Math.abs(L.y)>o);if(I<0)return console.log("Inverse grid shift iterator failed to converge."),y;y.x=Yt(T.x+p.ll[0]),y.y=T.y+p.ll[1]}else isNaN(T.x)||(y.x=a.x+T.x,y.y=a.y+T.y);return y}function Ip(a,c){var p={x:a.x/c.del[0],y:a.y/c.del[1]},y={x:Math.floor(p.x),y:Math.floor(p.y)},x={x:p.x-1*y.x,y:p.y-1*y.y},T={x:Number.NaN,y:Number.NaN},I;if(y.x<0||y.x>=c.lim[0]||y.y<0||y.y>=c.lim[1])return T;I=y.y*c.lim[0]+y.x;var o={x:c.cvs[I][0],y:c.cvs[I][1]};I++;var L={x:c.cvs[I][0],y:c.cvs[I][1]};I+=c.lim[0];var k={x:c.cvs[I][0],y:c.cvs[I][1]};I--;var Y={x:c.cvs[I][0],y:c.cvs[I][1]},N=x.x*x.y,ot=x.x*(1-x.y),mt=(1-x.x)*(1-x.y),ft=(1-x.x)*x.y;return T.x=mt*o.x+ot*L.x+ft*Y.x+N*k.x,T.y=mt*o.y+ot*L.y+ft*Y.y+N*k.y,T}function Ap(a,c,p){var y=p.x,x=p.y,T=p.z||0,I,o,L,k={};for(L=0;L<3;L++)if(!(c&&L===2&&p.z===void 0))switch(L===0?(I=y,"ew".indexOf(a.axis[L])!==-1?o="x":o="y"):L===1?(I=x,"ns".indexOf(a.axis[L])!==-1?o="y":o="x"):(I=T,o="z"),a.axis[L]){case"e":k[o]=I;break;case"w":k[o]=-I;break;case"n":k[o]=I;break;case"s":k[o]=-I;break;case"u":p[o]!==void 0&&(k.z=I);break;case"d":p[o]!==void 0&&(k.z=-I);break;default:return null}return k}function rf(a){var c={x:a[0],y:a[1]};return a.length>2&&(c.z=a[2]),a.length>3&&(c.m=a[3]),c}function $_(a){Cp(a.x),Cp(a.y)}function Cp(a){if(typeof Number.isFinite=="function"){if(Number.isFinite(a))return;throw new TypeError("coordinates must be finite numbers")}if(typeof a!="number"||a!==a||!isFinite(a))throw new TypeError("coordinates must be finite numbers")}function q_(a,c){return(a.datum.datum_type===dn||a.datum.datum_type===pn||a.datum.datum_type===_o)&&c.datumCode!=="WGS84"||(c.datum.datum_type===dn||c.datum.datum_type===pn||c.datum.datum_type===_o)&&a.datumCode!=="WGS84"}function rc(a,c,p,y){var x;Array.isArray(p)?p=rf(p):p={x:p.x,y:p.y,z:p.z,m:p.m};var T=p.z!==void 0;if($_(p),a.datum&&c.datum&&q_(a,c)&&(x=new Os("WGS84"),p=rc(a,x,p,y),a=x),y&&a.axis!=="enu"&&(p=Ap(a,!1,p)),a.projName==="longlat")p={x:p.x*Xi,y:p.y*Xi,z:p.z||0};else if(a.to_meter&&(p={x:p.x*a.to_meter,y:p.y*a.to_meter,z:p.z||0}),p=a.inverse(p),!p)return;if(a.from_greenwich&&(p.x+=a.from_greenwich),p=N_(a.datum,c.datum,p),!!p)return c.from_greenwich&&(p={x:p.x-c.from_greenwich,y:p.y,z:p.z||0}),c.projName==="longlat"?p={x:p.x*Fs,y:p.y*Fs,z:p.z||0}:(p=c.forward(p),c.to_meter&&(p={x:p.x/c.to_meter,y:p.y/c.to_meter,z:p.z||0})),y&&c.axis!=="enu"?Ap(c,!0,p):(p&&!T&&delete p.z,p)}var Pp=Os("WGS84");function xu(a,c,p,y){var x,T,I;return Array.isArray(p)?(x=rc(a,c,p,y)||{x:NaN,y:NaN},p.length>2?typeof a.name<"u"&&a.name==="geocent"||typeof c.name<"u"&&c.name==="geocent"?typeof x.z=="number"?[x.x,x.y,x.z].concat(p.splice(3)):[x.x,x.y,p[2]].concat(p.splice(3)):[x.x,x.y].concat(p.splice(2)):[x.x,x.y]):(T=rc(a,c,p,y),I=Object.keys(p),I.length===2||I.forEach(function(o){if(typeof a.name<"u"&&a.name==="geocent"||typeof c.name<"u"&&c.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;T[o]=p[o]}),T)}function zp(a){return a instanceof Os?a:a.oProj?a.oProj:Os(a)}function vr(a,c,p){a=zp(a);var y=!1,x;return typeof c>"u"?(c=a,a=Pp,y=!0):(typeof c.x<"u"||Array.isArray(c))&&(p=c,c=a,a=Pp,y=!0),c=zp(c),p?xu(a,c,p):(x={forward:function(T,I){return xu(a,c,T,I)},inverse:function(T,I){return xu(c,a,T,I)}},y&&(x.oProj=c),x)}var kp=6,sf="AJSAJS",af="AFAFAF",fo=65,Ir=73,Kr=79,wl=86,Ml=90;const G_={forward:nf,inverse:Z_,toPoint:of};function nf(a,c){return c=c||5,W_(j_({lat:a[1],lon:a[0]}),c)}function Z_(a){var c=Bu(hf(a.toUpperCase()));return c.lat&&c.lon?[c.lon,c.lat,c.lon,c.lat]:[c.left,c.bottom,c.right,c.top]}function of(a){var c=Bu(hf(a.toUpperCase()));return c.lat&&c.lon?[c.lon,c.lat]:[(c.left+c.right)/2,(c.top+c.bottom)/2]}function bu(a){return a*(Math.PI/180)}function Dp(a){return 180*(a/Math.PI)}function j_(a){var c=a.lat,p=a.lon,y=6378137,x=.00669438,T=.9996,I,o,L,k,Y,N,ot,mt=bu(c),ft=bu(p),Mt,Tt;Tt=Math.floor((p+180)/6)+1,p===180&&(Tt=60),c>=56&&c<64&&p>=3&&p<12&&(Tt=32),c>=72&&c<84&&(p>=0&&p<9?Tt=31:p>=9&&p<21?Tt=33:p>=21&&p<33?Tt=35:p>=33&&p<42&&(Tt=37)),I=(Tt-1)*6-180+3,Mt=bu(I),o=x/(1-x),L=y/Math.sqrt(1-x*Math.sin(mt)*Math.sin(mt)),k=Math.tan(mt)*Math.tan(mt),Y=o*Math.cos(mt)*Math.cos(mt),N=Math.cos(mt)*(ft-Mt),ot=y*((1-x/4-3*x*x/64-5*x*x*x/256)*mt-(3*x/8+3*x*x/32+45*x*x*x/1024)*Math.sin(2*mt)+(15*x*x/256+45*x*x*x/1024)*Math.sin(4*mt)-35*x*x*x/3072*Math.sin(6*mt));var Dt=T*L*(N+(1-k+Y)*N*N*N/6+(5-18*k+k*k+72*Y-58*o)*N*N*N*N*N/120)+5e5,$t=T*(ot+L*Math.tan(mt)*(N*N/2+(5-k+9*Y+4*Y*Y)*N*N*N*N/24+(61-58*k+k*k+600*Y-330*o)*N*N*N*N*N*N/720));return c<0&&($t+=1e7),{northing:Math.round($t),easting:Math.round(Dt),zoneNumber:Tt,zoneLetter:X_(c)}}function Bu(a){var c=a.northing,p=a.easting,y=a.zoneLetter,x=a.zoneNumber;if(x<0||x>60)return null;var T=.9996,I=6378137,o=.00669438,L,k=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),Y,N,ot,mt,ft,Mt,Tt,Dt,$t,Pt=p-5e5,Wt=c;y<"N"&&(Wt-=1e7),Tt=(x-1)*6-180+3,L=o/(1-o),Mt=Wt/T,Dt=Mt/(I*(1-o/4-3*o*o/64-5*o*o*o/256)),$t=Dt+(3*k/2-27*k*k*k/32)*Math.sin(2*Dt)+(21*k*k/16-55*k*k*k*k/32)*Math.sin(4*Dt)+151*k*k*k/96*Math.sin(6*Dt),Y=I/Math.sqrt(1-o*Math.sin($t)*Math.sin($t)),N=Math.tan($t)*Math.tan($t),ot=L*Math.cos($t)*Math.cos($t),mt=I*(1-o)/Math.pow(1-o*Math.sin($t)*Math.sin($t),1.5),ft=Pt/(Y*T);var de=$t-Y*Math.tan($t)/mt*(ft*ft/2-(5+3*N+10*ot-4*ot*ot-9*L)*ft*ft*ft*ft/24+(61+90*N+298*ot+45*N*N-252*L-3*ot*ot)*ft*ft*ft*ft*ft*ft/720);de=Dp(de);var ve=(ft-(1+2*N+ot)*ft*ft*ft/6+(5-2*ot+28*N-3*ot*ot+8*L+24*N*N)*ft*ft*ft*ft*ft/120)/Math.cos($t);ve=Tt+Dp(ve);var Se;if(a.accuracy){var xe=Bu({northing:a.northing+a.accuracy,easting:a.easting+a.accuracy,zoneLetter:a.zoneLetter,zoneNumber:a.zoneNumber});Se={top:xe.lat,right:xe.lon,bottom:de,left:ve}}else Se={lat:de,lon:ve};return Se}function X_(a){var c="Z";return 84>=a&&a>=72?c="X":72>a&&a>=64?c="W":64>a&&a>=56?c="V":56>a&&a>=48?c="U":48>a&&a>=40?c="T":40>a&&a>=32?c="S":32>a&&a>=24?c="R":24>a&&a>=16?c="Q":16>a&&a>=8?c="P":8>a&&a>=0?c="N":0>a&&a>=-8?c="M":-8>a&&a>=-16?c="L":-16>a&&a>=-24?c="K":-24>a&&a>=-32?c="J":-32>a&&a>=-40?c="H":-40>a&&a>=-48?c="G":-48>a&&a>=-56?c="F":-56>a&&a>=-64?c="E":-64>a&&a>=-72?c="D":-72>a&&a>=-80&&(c="C"),c}function W_(a,c){var p="00000"+a.easting,y="00000"+a.northing;return a.zoneNumber+a.zoneLetter+H_(a.easting,a.northing,a.zoneNumber)+p.substr(p.length-5,c)+y.substr(y.length-5,c)}function H_(a,c,p){var y=lf(p),x=Math.floor(a/1e5),T=Math.floor(c/1e5)%20;return K_(x,T,y)}function lf(a){var c=a%kp;return c===0&&(c=kp),c}function K_(a,c,p){var y=p-1,x=sf.charCodeAt(y),T=af.charCodeAt(y),I=x+a-1,o=T+c,L=!1;I>Ml&&(I=I-Ml+fo-1,L=!0),(I===Ir||x<Ir&&I>Ir||(I>Ir||x<Ir)&&L)&&I++,(I===Kr||x<Kr&&I>Kr||(I>Kr||x<Kr)&&L)&&(I++,I===Ir&&I++),I>Ml&&(I=I-Ml+fo-1),o>wl?(o=o-wl+fo-1,L=!0):L=!1,(o===Ir||T<Ir&&o>Ir||(o>Ir||T<Ir)&&L)&&o++,(o===Kr||T<Kr&&o>Kr||(o>Kr||T<Kr)&&L)&&(o++,o===Ir&&o++),o>wl&&(o=o-wl+fo-1);var k=String.fromCharCode(I)+String.fromCharCode(o);return k}function hf(a){if(a&&a.length===0)throw"MGRSPoint coverting from nothing";for(var c=a.length,p=null,y="",x,T=0;!/[A-Z]/.test(x=a.charAt(T));){if(T>=2)throw"MGRSPoint bad conversion from: "+a;y+=x,T++}var I=parseInt(y,10);if(T===0||T+3>c)throw"MGRSPoint bad conversion from: "+a;var o=a.charAt(T++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+a;p=a.substring(T,T+=2);for(var L=lf(I),k=Y_(p.charAt(0),L),Y=J_(p.charAt(1),L);Y<Q_(o);)Y+=2e6;var N=c-T;if(N%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+a;var ot=N/2,mt=0,ft=0,Mt,Tt,Dt,$t,Pt;return ot>0&&(Mt=1e5/Math.pow(10,ot),Tt=a.substring(T,T+ot),mt=parseFloat(Tt)*Mt,Dt=a.substring(T+ot),ft=parseFloat(Dt)*Mt),$t=mt+k,Pt=ft+Y,{easting:$t,northing:Pt,zoneLetter:o,zoneNumber:I,accuracy:Mt}}function Y_(a,c){for(var p=sf.charCodeAt(c-1),y=1e5,x=!1;p!==a.charCodeAt(0);){if(p++,p===Ir&&p++,p===Kr&&p++,p>Ml){if(x)throw"Bad character: "+a;p=fo,x=!0}y+=1e5}return y}function J_(a,c){if(a>"V")throw"MGRSPoint given invalid Northing "+a;for(var p=af.charCodeAt(c-1),y=0,x=!1;p!==a.charCodeAt(0);){if(p++,p===Ir&&p++,p===Kr&&p++,p>wl){if(x)throw"Bad character: "+a;p=fo,x=!0}y+=1e5}return y}function Q_(a){var c;switch(a){case"C":c=11e5;break;case"D":c=2e6;break;case"E":c=28e5;break;case"F":c=37e5;break;case"G":c=46e5;break;case"H":c=55e5;break;case"J":c=64e5;break;case"K":c=73e5;break;case"L":c=82e5;break;case"M":c=91e5;break;case"N":c=0;break;case"P":c=8e5;break;case"Q":c=17e5;break;case"R":c=26e5;break;case"S":c=35e5;break;case"T":c=44e5;break;case"U":c=53e5;break;case"V":c=62e5;break;case"W":c=7e6;break;case"X":c=79e5;break;default:c=-1}if(c>=0)return c;throw"Invalid zone letter: "+a}function xo(a,c,p){if(!(this instanceof xo))return new xo(a,c,p);if(Array.isArray(a))this.x=a[0],this.y=a[1],this.z=a[2]||0;else if(typeof a=="object")this.x=a.x,this.y=a.y,this.z=a.z||0;else if(typeof a=="string"&&typeof c>"u"){var y=a.split(",");this.x=parseFloat(y[0],10),this.y=parseFloat(y[1],10),this.z=parseFloat(y[2],10)||0}else this.x=a,this.y=c,this.z=p||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}xo.fromMGRS=function(a){return new xo(of(a))};xo.prototype.toMGRS=function(a){return nf([this.x,this.y],a)};var ty=1,ey=.25,Lp=.046875,Rp=.01953125,Bp=.01068115234375,iy=.75,ry=.46875,sy=.013020833333333334,ay=.007120768229166667,ny=.3645833333333333,oy=.005696614583333333,ly=.3076171875;function cf(a){var c=[];c[0]=ty-a*(ey+a*(Lp+a*(Rp+a*Bp))),c[1]=a*(iy-a*(Lp+a*(Rp+a*Bp)));var p=a*a;return c[2]=p*(ry-a*(sy+a*ay)),p*=a,c[3]=p*(ny-a*oy),c[4]=p*a*ly,c}function cc(a,c,p,y){return p*=c,c*=c,y[0]*a-p*(y[1]+c*(y[2]+c*(y[3]+c*y[4])))}var hy=20;function uf(a,c,p){for(var y=1/(1-c),x=a,T=hy;T;--T){var I=Math.sin(x),o=1-c*I*I;if(o=(cc(x,I,Math.cos(x),p)-a)*(o*Math.sqrt(o))*y,x-=o,Math.abs(o)<Gt)return x}return x}function cy(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=cf(this.es),this.ml0=cc(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function uy(a){var c=a.x,p=a.y,y=Yt(c-this.long0),x,T,I,o=Math.sin(p),L=Math.cos(p);if(this.es){var Y=L*y,N=Math.pow(Y,2),ot=this.ep2*Math.pow(L,2),mt=Math.pow(ot,2),ft=Math.abs(L)>Gt?Math.tan(p):0,Mt=Math.pow(ft,2),Tt=Math.pow(Mt,2);x=1-this.es*Math.pow(o,2),Y=Y/Math.sqrt(x);var Dt=cc(p,o,L,this.en);T=this.a*(this.k0*Y*(1+N/6*(1-Mt+ot+N/20*(5-18*Mt+Tt+14*ot-58*Mt*ot+N/42*(61+179*Tt-Tt*Mt-479*Mt)))))+this.x0,I=this.a*(this.k0*(Dt-this.ml0+o*y*Y/2*(1+N/12*(5-Mt+9*ot+4*mt+N/30*(61+Tt-58*Mt+270*ot-330*Mt*ot+N/56*(1385+543*Tt-Tt*Mt-3111*Mt))))))+this.y0}else{var k=L*Math.sin(y);if(Math.abs(Math.abs(k)-1)<Gt)return 93;if(T=.5*this.a*this.k0*Math.log((1+k)/(1-k))+this.x0,I=L*Math.cos(y)/Math.sqrt(1-Math.pow(k,2)),k=Math.abs(I),k>=1){if(k-1>Gt)return 93;I=0}else I=Math.acos(I);p<0&&(I=-I),I=this.a*this.k0*(I-this.lat0)+this.y0}return a.x=T,a.y=I,a}function dy(a){var c,p,y,x,T=(a.x-this.x0)*(1/this.a),I=(a.y-this.y0)*(1/this.a);if(this.es)if(c=this.ml0+I/this.k0,p=uf(c,this.es,this.en),Math.abs(p)<Ct){var N=Math.sin(p),ot=Math.cos(p),mt=Math.abs(ot)>Gt?Math.tan(p):0,ft=this.ep2*Math.pow(ot,2),Mt=Math.pow(ft,2),Tt=Math.pow(mt,2),Dt=Math.pow(Tt,2);c=1-this.es*Math.pow(N,2);var $t=T*Math.sqrt(c)/this.k0,Pt=Math.pow($t,2);c=c*mt,y=p-c*Pt/(1-this.es)*.5*(1-Pt/12*(5+3*Tt-9*ft*Tt+ft-4*Mt-Pt/30*(61+90*Tt-252*ft*Tt+45*Dt+46*ft-Pt/56*(1385+3633*Tt+4095*Dt+1574*Dt*Tt)))),x=Yt(this.long0+$t*(1-Pt/6*(1+2*Tt+ft-Pt/20*(5+28*Tt+24*Dt+8*ft*Tt+6*ft-Pt/42*(61+662*Tt+1320*Dt+720*Dt*Tt))))/ot)}else y=Ct*Dl(I),x=0;else{var o=Math.exp(T/this.k0),L=.5*(o-1/o),k=this.lat0+I/this.k0,Y=Math.cos(k);c=Math.sqrt((1-Math.pow(Y,2))/(1+Math.pow(L,2))),y=Math.asin(c),I<0&&(y=-y),L===0&&Y===0?x=0:x=Yt(Math.atan2(L,Y)+this.long0)}return a.x=x,a.y=y,a}var py=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Qh={init:cy,forward:uy,inverse:dy,names:py};function df(a){var c=Math.exp(a);return c=(c-1/c)/2,c}function ys(a,c){a=Math.abs(a),c=Math.abs(c);var p=Math.max(a,c),y=Math.min(a,c)/(p||1);return p*Math.sqrt(1+Math.pow(y,2))}function fy(a){var c=1+a,p=c-1;return p===0?a:a*Math.log(c)/p}function my(a){var c=Math.abs(a);return c=fy(c*(1+c/(ys(1,c)+1))),a<0?-c:c}function Fu(a,c){for(var p=2*Math.cos(2*c),y=a.length-1,x=a[y],T=0,I;--y>=0;)I=-T+p*x+a[y],T=x,x=I;return c+I*Math.sin(2*c)}function gy(a,c){for(var p=2*Math.cos(c),y=a.length-1,x=a[y],T=0,I;--y>=0;)I=-T+p*x+a[y],T=x,x=I;return Math.sin(c)*I}function _y(a){var c=Math.exp(a);return c=(c+1/c)/2,c}function pf(a,c,p){for(var y=Math.sin(c),x=Math.cos(c),T=df(p),I=_y(p),o=2*x*I,L=-2*y*T,k=a.length-1,Y=a[k],N=0,ot=0,mt=0,ft,Mt;--k>=0;)ft=ot,Mt=N,ot=Y,N=mt,Y=-ft+o*ot-L*N+a[k],mt=-Mt+L*ot+o*N;return o=y*I,L=x*T,[o*Y-L*mt,o*mt+L*Y]}function yy(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Qh.init.apply(this),this.forward=Qh.forward,this.inverse=Qh.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var a=this.es/(1+Math.sqrt(1-this.es)),c=a/(2-a),p=c;this.cgb[0]=c*(2+c*(-2/3+c*(-2+c*(116/45+c*(26/45+c*(-2854/675)))))),this.cbg[0]=c*(-2+c*(2/3+c*(4/3+c*(-82/45+c*(32/45+c*(4642/4725)))))),p=p*c,this.cgb[1]=p*(7/3+c*(-8/5+c*(-227/45+c*(2704/315+c*(2323/945))))),this.cbg[1]=p*(5/3+c*(-16/15+c*(-13/9+c*(904/315+c*(-1522/945))))),p=p*c,this.cgb[2]=p*(56/15+c*(-136/35+c*(-1262/105+c*(73814/2835)))),this.cbg[2]=p*(-26/15+c*(34/21+c*(8/5+c*(-12686/2835)))),p=p*c,this.cgb[3]=p*(4279/630+c*(-332/35+c*(-399572/14175))),this.cbg[3]=p*(1237/630+c*(-12/5+c*(-24832/14175))),p=p*c,this.cgb[4]=p*(4174/315+c*(-144838/6237)),this.cbg[4]=p*(-734/315+c*(109598/31185)),p=p*c,this.cgb[5]=p*(601676/22275),this.cbg[5]=p*(444337/155925),p=Math.pow(c,2),this.Qn=this.k0/(1+c)*(1+p*(1/4+p*(1/64+p/256))),this.utg[0]=c*(-.5+c*(2/3+c*(-37/96+c*(1/360+c*(81/512+c*(-96199/604800)))))),this.gtu[0]=c*(.5+c*(-2/3+c*(5/16+c*(41/180+c*(-127/288+c*(7891/37800)))))),this.utg[1]=p*(-1/48+c*(-1/15+c*(437/1440+c*(-46/105+c*(1118711/3870720))))),this.gtu[1]=p*(13/48+c*(-3/5+c*(557/1440+c*(281/630+c*(-1983433/1935360))))),p=p*c,this.utg[2]=p*(-17/480+c*(37/840+c*(209/4480+c*(-5569/90720)))),this.gtu[2]=p*(61/240+c*(-103/140+c*(15061/26880+c*(167603/181440)))),p=p*c,this.utg[3]=p*(-4397/161280+c*(11/504+c*(830251/7257600))),this.gtu[3]=p*(49561/161280+c*(-179/168+c*(6601661/7257600))),p=p*c,this.utg[4]=p*(-4583/161280+c*(108847/3991680)),this.gtu[4]=p*(34729/80640+c*(-3418889/1995840)),p=p*c,this.utg[5]=p*(-20648693/638668800),this.gtu[5]=p*(212378941/319334400);var y=Fu(this.cbg,this.lat0);this.Zb=-this.Qn*(y+gy(this.gtu,2*y))}function vy(a){var c=Yt(a.x-this.long0),p=a.y;p=Fu(this.cbg,p);var y=Math.sin(p),x=Math.cos(p),T=Math.sin(c),I=Math.cos(c);p=Math.atan2(y,I*x),c=Math.atan2(T*x,ys(y,x*I)),c=my(Math.tan(c));var o=pf(this.gtu,2*p,2*c);p=p+o[0],c=c+o[1];var L,k;return Math.abs(c)<=2.623395162778?(L=this.a*(this.Qn*c)+this.x0,k=this.a*(this.Qn*p+this.Zb)+this.y0):(L=1/0,k=1/0),a.x=L,a.y=k,a}function xy(a){var c=(a.x-this.x0)*(1/this.a),p=(a.y-this.y0)*(1/this.a);p=(p-this.Zb)/this.Qn,c=c/this.Qn;var y,x;if(Math.abs(c)<=2.623395162778){var T=pf(this.utg,2*p,2*c);p=p+T[0],c=c+T[1],c=Math.atan(df(c));var I=Math.sin(p),o=Math.cos(p),L=Math.sin(c),k=Math.cos(c);p=Math.atan2(I*k,ys(L,k*o)),c=Math.atan2(L,k*o),y=Yt(c+this.long0),x=Fu(this.cgb,p)}else y=1/0,x=1/0;return a.x=y,a.y=x,a}var by=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const tc={init:yy,forward:vy,inverse:xy,names:by};function wy(a,c){if(a===void 0){if(a=Math.floor((Yt(c)+Math.PI)*30/Math.PI)+1,a<0)return 0;if(a>60)return 60}return a}var My="etmerc";function Ty(){var a=wy(this.zone,this.long0);if(a===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(a)-183)*Xi,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,tc.init.apply(this),this.forward=tc.forward,this.inverse=tc.inverse}var Ey=["Universal Transverse Mercator System","utm"];const Sy={init:Ty,names:Ey,dependsOn:My};function Ou(a,c){return Math.pow((1-a)/(1+a),c)}var Iy=20;function Ay(){var a=Math.sin(this.lat0),c=Math.cos(this.lat0);c*=c,this.rc=Math.sqrt(1-this.es)/(1-this.es*a*a),this.C=Math.sqrt(1+this.es*c*c/(1-this.es)),this.phic0=Math.asin(a/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Fe)/(Math.pow(Math.tan(.5*this.lat0+Fe),this.C)*Ou(this.e*a,this.ratexp))}function Cy(a){var c=a.x,p=a.y;return a.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*p+Fe),this.C)*Ou(this.e*Math.sin(p),this.ratexp))-Ct,a.x=this.C*c,a}function Py(a){for(var c=1e-14,p=a.x/this.C,y=a.y,x=Math.pow(Math.tan(.5*y+Fe)/this.K,1/this.C),T=Iy;T>0&&(y=2*Math.atan(x*Ou(this.e*Math.sin(a.y),-.5*this.e))-Ct,!(Math.abs(y-a.y)<c));--T)a.y=y;return T?(a.x=p,a.y=y,a):null}var zy=["gauss"];const Uu={init:Ay,forward:Cy,inverse:Py,names:zy};function ky(){Uu.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function Dy(a){var c,p,y,x;return a.x=Yt(a.x-this.long0),Uu.forward.apply(this,[a]),c=Math.sin(a.y),p=Math.cos(a.y),y=Math.cos(a.x),x=this.k0*this.R2/(1+this.sinc0*c+this.cosc0*p*y),a.x=x*p*Math.sin(a.x),a.y=x*(this.cosc0*c-this.sinc0*p*y),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a}function Ly(a){var c,p,y,x,T;if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,T=Math.sqrt(a.x*a.x+a.y*a.y)){var I=2*Math.atan2(T,this.R2);c=Math.sin(I),p=Math.cos(I),x=Math.asin(p*this.sinc0+a.y*c*this.cosc0/T),y=Math.atan2(a.x*c,T*this.cosc0*p-a.y*this.sinc0*c)}else x=this.phic0,y=0;return a.x=y,a.y=x,Uu.inverse.apply(this,[a]),a.x=Yt(a.x+this.long0),a}var Ry=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const By={init:ky,forward:Dy,inverse:Ly,names:Ry};function Fy(a,c,p){return c*=p,Math.tan(.5*(Ct+a))*Math.pow((1-c)/(1+c),.5*p)}function Oy(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Gt&&(this.k0=.5*(1+Dl(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Gt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Gt&&Math.abs(Math.cos(this.lat_ts))>Gt&&(this.k0=.5*this.cons*Us(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/vs(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Us(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Ct,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function Uy(a){var c=a.x,p=a.y,y=Math.sin(p),x=Math.cos(p),T,I,o,L,k,Y,N=Yt(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=Gt&&Math.abs(p+this.lat0)<=Gt?(a.x=NaN,a.y=NaN,a):this.sphere?(T=2*this.k0/(1+this.sinlat0*y+this.coslat0*x*Math.cos(N)),a.x=this.a*T*x*Math.sin(N)+this.x0,a.y=this.a*T*(this.coslat0*y-this.sinlat0*x*Math.cos(N))+this.y0,a):(I=2*Math.atan(this.ssfn_(p,y,this.e))-Ct,L=Math.cos(I),o=Math.sin(I),Math.abs(this.coslat0)<=Gt?(k=vs(this.e,p*this.con,this.con*y),Y=2*this.a*this.k0*k/this.cons,a.x=this.x0+Y*Math.sin(c-this.long0),a.y=this.y0-this.con*Y*Math.cos(c-this.long0),a):(Math.abs(this.sinlat0)<Gt?(T=2*this.a*this.k0/(1+L*Math.cos(N)),a.y=T*o):(T=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*L*Math.cos(N))),a.y=T*(this.cosX0*o-this.sinX0*L*Math.cos(N))+this.y0),a.x=T*L*Math.sin(N)+this.x0,a))}function Ny(a){a.x-=this.x0,a.y-=this.y0;var c,p,y,x,T,I=Math.sqrt(a.x*a.x+a.y*a.y);if(this.sphere){var o=2*Math.atan(I/(2*this.a*this.k0));return c=this.long0,p=this.lat0,I<=Gt?(a.x=c,a.y=p,a):(p=Math.asin(Math.cos(o)*this.sinlat0+a.y*Math.sin(o)*this.coslat0/I),Math.abs(this.coslat0)<Gt?this.lat0>0?c=Yt(this.long0+Math.atan2(a.x,-1*a.y)):c=Yt(this.long0+Math.atan2(a.x,a.y)):c=Yt(this.long0+Math.atan2(a.x*Math.sin(o),I*this.coslat0*Math.cos(o)-a.y*this.sinlat0*Math.sin(o))),a.x=c,a.y=p,a)}else if(Math.abs(this.coslat0)<=Gt){if(I<=Gt)return p=this.lat0,c=this.long0,a.x=c,a.y=p,a;a.x*=this.con,a.y*=this.con,y=I*this.cons/(2*this.a*this.k0),p=this.con*kl(this.e,y),c=this.con*Yt(this.con*this.long0+Math.atan2(a.x,-1*a.y))}else x=2*Math.atan(I*this.cosX0/(2*this.a*this.k0*this.ms1)),c=this.long0,I<=Gt?T=this.X0:(T=Math.asin(Math.cos(x)*this.sinX0+a.y*Math.sin(x)*this.cosX0/I),c=Yt(this.long0+Math.atan2(a.x*Math.sin(x),I*this.cosX0*Math.cos(x)-a.y*this.sinX0*Math.sin(x)))),p=-1*kl(this.e,Math.tan(.5*(Ct+T)));return a.x=c,a.y=p,a}var Vy=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const $y={init:Oy,forward:Uy,inverse:Ny,names:Vy,ssfn_:Fy};function qy(){var a=this.lat0;this.lambda0=this.long0;var c=Math.sin(a),p=this.a,y=this.rf,x=1/y,T=2*x-Math.pow(x,2),I=this.e=Math.sqrt(T);this.R=this.k0*p*Math.sqrt(1-T)/(1-T*Math.pow(c,2)),this.alpha=Math.sqrt(1+T/(1-T)*Math.pow(Math.cos(a),4)),this.b0=Math.asin(c/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),L=Math.log(Math.tan(Math.PI/4+a/2)),k=Math.log((1+I*c)/(1-I*c));this.K=o-this.alpha*L+this.alpha*I/2*k}function Gy(a){var c=Math.log(Math.tan(Math.PI/4-a.y/2)),p=this.e/2*Math.log((1+this.e*Math.sin(a.y))/(1-this.e*Math.sin(a.y))),y=-this.alpha*(c+p)+this.K,x=2*(Math.atan(Math.exp(y))-Math.PI/4),T=this.alpha*(a.x-this.lambda0),I=Math.atan(Math.sin(T)/(Math.sin(this.b0)*Math.tan(x)+Math.cos(this.b0)*Math.cos(T))),o=Math.asin(Math.cos(this.b0)*Math.sin(x)-Math.sin(this.b0)*Math.cos(x)*Math.cos(T));return a.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,a.x=this.R*I+this.x0,a}function Zy(a){for(var c=a.x-this.x0,p=a.y-this.y0,y=c/this.R,x=2*(Math.atan(Math.exp(p/this.R))-Math.PI/4),T=Math.asin(Math.cos(this.b0)*Math.sin(x)+Math.sin(this.b0)*Math.cos(x)*Math.cos(y)),I=Math.atan(Math.sin(y)/(Math.cos(this.b0)*Math.cos(y)-Math.sin(this.b0)*Math.tan(x))),o=this.lambda0+I/this.alpha,L=0,k=T,Y=-1e3,N=0;Math.abs(k-Y)>1e-7;){if(++N>20)return;L=1/this.alpha*(Math.log(Math.tan(Math.PI/4+T/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(k))/2)),Y=k,k=2*Math.atan(Math.exp(L))-Math.PI/2}return a.x=o,a.y=k,a}var jy=["somerc"];const Xy={init:qy,forward:Gy,inverse:Zy,names:jy};var ho=1e-7;function Wy(a){var c=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],p=typeof a.PROJECTION=="object"?Object.keys(a.PROJECTION)[0]:a.PROJECTION;return"no_uoff"in a||"no_off"in a||c.indexOf(p)!==-1}function Hy(){var a,c,p,y,x,T,I,o,L,k,Y=0,N,ot=0,mt=0,ft=0,Mt=0,Tt=0,Dt=0;this.no_off=Wy(this),this.no_rot="no_rot"in this;var $t=!1;"alpha"in this&&($t=!0);var Pt=!1;if("rectified_grid_angle"in this&&(Pt=!0),$t&&(Dt=this.alpha),Pt&&(Y=this.rectified_grid_angle*Xi),$t||Pt)ot=this.longc;else if(mt=this.long1,Mt=this.lat1,ft=this.long2,Tt=this.lat2,Math.abs(Mt-Tt)<=ho||(a=Math.abs(Mt))<=ho||Math.abs(a-Ct)<=ho||Math.abs(Math.abs(this.lat0)-Ct)<=ho||Math.abs(Math.abs(Tt)-Ct)<=ho)throw new Error;var Wt=1-this.es;c=Math.sqrt(Wt),Math.abs(this.lat0)>Gt?(o=Math.sin(this.lat0),p=Math.cos(this.lat0),a=1-this.es*o*o,this.B=p*p,this.B=Math.sqrt(1+this.es*this.B*this.B/Wt),this.A=this.B*this.k0*c/a,y=this.B*c/(p*Math.sqrt(a)),x=y*y-1,x<=0?x=0:(x=Math.sqrt(x),this.lat0<0&&(x=-x)),this.E=x+=y,this.E*=Math.pow(vs(this.e,this.lat0,o),this.B)):(this.B=1/c,this.A=this.k0,this.E=y=x=1),$t||Pt?($t?(N=Math.asin(Math.sin(Dt)/y),Pt||(Y=Dt)):(N=Y,Dt=Math.asin(y*Math.sin(N))),this.lam0=ot-Math.asin(.5*(x-1/x)*Math.tan(N))/this.B):(T=Math.pow(vs(this.e,Mt,Math.sin(Mt)),this.B),I=Math.pow(vs(this.e,Tt,Math.sin(Tt)),this.B),x=this.E/T,L=(I-T)/(I+T),k=this.E*this.E,k=(k-I*T)/(k+I*T),a=mt-ft,a<-Math.pi?ft-=Pl:a>Math.pi&&(ft+=Pl),this.lam0=Yt(.5*(mt+ft)-Math.atan(k*Math.tan(.5*this.B*(mt-ft))/L)/this.B),N=Math.atan(2*Math.sin(this.B*Yt(mt-this.lam0))/(x-1/x)),Y=Dt=Math.asin(y*Math.sin(N))),this.singam=Math.sin(N),this.cosgam=Math.cos(N),this.sinrot=Math.sin(Y),this.cosrot=Math.cos(Y),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(y*y-1)/Math.cos(Dt))),this.lat0<0&&(this.u_0=-this.u_0)),x=.5*N,this.v_pole_n=this.ArB*Math.log(Math.tan(Fe-x)),this.v_pole_s=this.ArB*Math.log(Math.tan(Fe+x))}function Ky(a){var c={},p,y,x,T,I,o,L,k;if(a.x=a.x-this.lam0,Math.abs(Math.abs(a.y)-Ct)>Gt){if(I=this.E/Math.pow(vs(this.e,a.y,Math.sin(a.y)),this.B),o=1/I,p=.5*(I-o),y=.5*(I+o),T=Math.sin(this.B*a.x),x=(p*this.singam-T*this.cosgam)/y,Math.abs(Math.abs(x)-1)<Gt)throw new Error;k=.5*this.ArB*Math.log((1-x)/(1+x)),o=Math.cos(this.B*a.x),Math.abs(o)<ho?L=this.A*a.x:L=this.ArB*Math.atan2(p*this.cosgam+T*this.singam,o)}else k=a.y>0?this.v_pole_n:this.v_pole_s,L=this.ArB*a.y;return this.no_rot?(c.x=L,c.y=k):(L-=this.u_0,c.x=k*this.cosrot+L*this.sinrot,c.y=L*this.cosrot-k*this.sinrot),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c}function Yy(a){var c,p,y,x,T,I,o,L={};if(a.x=(a.x-this.x0)*(1/this.a),a.y=(a.y-this.y0)*(1/this.a),this.no_rot?(p=a.y,c=a.x):(p=a.x*this.cosrot-a.y*this.sinrot,c=a.y*this.cosrot+a.x*this.sinrot+this.u_0),y=Math.exp(-this.BrA*p),x=.5*(y-1/y),T=.5*(y+1/y),I=Math.sin(this.BrA*c),o=(I*this.cosgam+x*this.singam)/T,Math.abs(Math.abs(o)-1)<Gt)L.x=0,L.y=o<0?-Ct:Ct;else{if(L.y=this.E/Math.sqrt((1+o)/(1-o)),L.y=kl(this.e,Math.pow(L.y,1/this.B)),L.y===1/0)throw new Error;L.x=-this.rB*Math.atan2(x*this.cosgam-I*this.singam,Math.cos(this.BrA*c))}return L.x+=this.lam0,L}var Jy=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const Qy={init:Hy,forward:Ky,inverse:Yy,names:Jy};function t0(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Gt)){var a=this.b/this.a;this.e=Math.sqrt(1-a*a);var c=Math.sin(this.lat1),p=Math.cos(this.lat1),y=Us(this.e,c,p),x=vs(this.e,this.lat1,c),T=Math.sin(this.lat2),I=Math.cos(this.lat2),o=Us(this.e,T,I),L=vs(this.e,this.lat2,T),k=vs(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Gt?this.ns=Math.log(y/o)/Math.log(x/L):this.ns=c,isNaN(this.ns)&&(this.ns=c),this.f0=y/(this.ns*Math.pow(x,this.ns)),this.rh=this.a*this.f0*Math.pow(k,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function e0(a){var c=a.x,p=a.y;Math.abs(2*Math.abs(p)-Math.PI)<=Gt&&(p=Dl(p)*(Ct-2*Gt));var y=Math.abs(Math.abs(p)-Ct),x,T;if(y>Gt)x=vs(this.e,p,Math.sin(p)),T=this.a*this.f0*Math.pow(x,this.ns);else{if(y=p*this.ns,y<=0)return null;T=0}var I=this.ns*Yt(c-this.long0);return a.x=this.k0*(T*Math.sin(I))+this.x0,a.y=this.k0*(this.rh-T*Math.cos(I))+this.y0,a}function i0(a){var c,p,y,x,T,I=(a.x-this.x0)/this.k0,o=this.rh-(a.y-this.y0)/this.k0;this.ns>0?(c=Math.sqrt(I*I+o*o),p=1):(c=-Math.sqrt(I*I+o*o),p=-1);var L=0;if(c!==0&&(L=Math.atan2(p*I,p*o)),c!==0||this.ns>0){if(p=1/this.ns,y=Math.pow(c/(this.a*this.f0),p),x=kl(this.e,y),x===-9999)return null}else x=-Ct;return T=Yt(L/this.ns+this.long0),a.x=T,a.y=x,a}var r0=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const s0={init:t0,forward:e0,inverse:i0,names:r0};function a0(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function n0(a){var c,p,y,x,T,I,o,L=a.x,k=a.y,Y=Yt(L-this.long0);return c=Math.pow((1+this.e*Math.sin(k))/(1-this.e*Math.sin(k)),this.alfa*this.e/2),p=2*(Math.atan(this.k*Math.pow(Math.tan(k/2+this.s45),this.alfa)/c)-this.s45),y=-Y*this.alfa,x=Math.asin(Math.cos(this.ad)*Math.sin(p)+Math.sin(this.ad)*Math.cos(p)*Math.cos(y)),T=Math.asin(Math.cos(p)*Math.sin(y)/Math.cos(x)),I=this.n*T,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(x/2+this.s45),this.n),a.y=o*Math.cos(I)/1,a.x=o*Math.sin(I)/1,this.czech||(a.y*=-1,a.x*=-1),a}function o0(a){var c,p,y,x,T,I,o,L,k=a.x;a.x=a.y,a.y=k,this.czech||(a.y*=-1,a.x*=-1),I=Math.sqrt(a.x*a.x+a.y*a.y),T=Math.atan2(a.y,a.x),x=T/Math.sin(this.s0),y=2*(Math.atan(Math.pow(this.ro0/I,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),c=Math.asin(Math.cos(this.ad)*Math.sin(y)-Math.sin(this.ad)*Math.cos(y)*Math.cos(x)),p=Math.asin(Math.cos(y)*Math.sin(x)/Math.cos(c)),a.x=this.long0-p/this.alfa,o=c,L=0;var Y=0;do a.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(c/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-a.y)<1e-10&&(L=1),o=a.y,Y+=1;while(L===0&&Y<15);return Y>=15?null:a}var l0=["Krovak","krovak"];const h0={init:a0,forward:n0,inverse:o0,names:l0};function yr(a,c,p,y,x){return a*x-c*Math.sin(2*x)+p*Math.sin(4*x)-y*Math.sin(6*x)}function Ll(a){return 1-.25*a*(1+a/16*(3+1.25*a))}function Rl(a){return .375*a*(1+.25*a*(1+.46875*a))}function Bl(a){return .05859375*a*a*(1+.75*a)}function Fl(a){return a*a*a*(35/3072)}function bo(a,c,p){var y=c*p;return a/Math.sqrt(1-y*y)}function wo(a){return Math.abs(a)<Ct?a:a-Dl(a)*Math.PI}function sc(a,c,p,y,x){var T,I;T=a/c;for(var o=0;o<15;o++)if(I=(a-(c*T-p*Math.sin(2*T)+y*Math.sin(4*T)-x*Math.sin(6*T)))/(c-2*p*Math.cos(2*T)+4*y*Math.cos(4*T)-6*x*Math.cos(6*T)),T+=I,Math.abs(I)<=1e-10)return T;return NaN}function c0(){this.sphere||(this.e0=Ll(this.es),this.e1=Rl(this.es),this.e2=Bl(this.es),this.e3=Fl(this.es),this.ml0=this.a*yr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function u0(a){var c,p,y=a.x,x=a.y;if(y=Yt(y-this.long0),this.sphere)c=this.a*Math.asin(Math.cos(x)*Math.sin(y)),p=this.a*(Math.atan2(Math.tan(x),Math.cos(y))-this.lat0);else{var T=Math.sin(x),I=Math.cos(x),o=bo(this.a,this.e,T),L=Math.tan(x)*Math.tan(x),k=y*Math.cos(x),Y=k*k,N=this.es*I*I/(1-this.es),ot=this.a*yr(this.e0,this.e1,this.e2,this.e3,x);c=o*k*(1-Y*L*(1/6-(8-L+8*N)*Y/120)),p=ot-this.ml0+o*T/I*Y*(.5+(5-L+6*N)*Y/24)}return a.x=c+this.x0,a.y=p+this.y0,a}function d0(a){a.x-=this.x0,a.y-=this.y0;var c=a.x/this.a,p=a.y/this.a,y,x;if(this.sphere){var T=p+this.lat0;y=Math.asin(Math.sin(T)*Math.cos(c)),x=Math.atan2(Math.tan(c),Math.cos(T))}else{var I=this.ml0/this.a+p,o=sc(I,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Ct)<=Gt)return a.x=this.long0,a.y=Ct,p<0&&(a.y*=-1),a;var L=bo(this.a,this.e,Math.sin(o)),k=L*L*L/this.a/this.a*(1-this.es),Y=Math.pow(Math.tan(o),2),N=c*this.a/L,ot=N*N;y=o-L*Math.tan(o)/k*N*N*(.5-(1+3*Y)*N*N/24),x=N*(1-ot*(Y/3+(1+3*Y)*Y*ot/15))/Math.cos(o)}return a.x=Yt(x+this.long0),a.y=wo(y),a}var p0=["Cassini","Cassini_Soldner","cass"];const f0={init:c0,forward:u0,inverse:d0,names:p0};function La(a,c){var p;return a>1e-7?(p=a*c,(1-a*a)*(c/(1-p*p)-.5/a*Math.log((1-p)/(1+p)))):2*c}var m0=1,g0=2,_0=3,y0=4;function v0(){var a=Math.abs(this.lat0);if(Math.abs(a-Ct)<Gt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(a)<Gt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var c;switch(this.qp=La(this.e,1),this.mmf=.5/(1-this.es),this.apa=A0(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),c=Math.sin(this.lat0),this.sinb1=La(this.e,c)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*c*c)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function x0(a){var c,p,y,x,T,I,o,L,k,Y,N=a.x,ot=a.y;if(N=Yt(N-this.long0),this.sphere){if(T=Math.sin(ot),Y=Math.cos(ot),y=Math.cos(N),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(p=this.mode===this.EQUIT?1+Y*y:1+this.sinph0*T+this.cosph0*Y*y,p<=Gt)return null;p=Math.sqrt(2/p),c=p*Y*Math.sin(N),p*=this.mode===this.EQUIT?T:this.cosph0*T-this.sinph0*Y*y}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(y=-y),Math.abs(ot+this.lat0)<Gt)return null;p=Fe-ot*.5,p=2*(this.mode===this.S_POLE?Math.cos(p):Math.sin(p)),c=p*Math.sin(N),p*=y}}else{switch(o=0,L=0,k=0,y=Math.cos(N),x=Math.sin(N),T=Math.sin(ot),I=La(this.e,T),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=I/this.qp,L=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:k=1+this.sinb1*o+this.cosb1*L*y;break;case this.EQUIT:k=1+L*y;break;case this.N_POLE:k=Ct+ot,I=this.qp-I;break;case this.S_POLE:k=ot-Ct,I=this.qp+I;break}if(Math.abs(k)<Gt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:k=Math.sqrt(2/k),this.mode===this.OBLIQ?p=this.ymf*k*(this.cosb1*o-this.sinb1*L*y):p=(k=Math.sqrt(2/(1+L*y)))*o*this.ymf,c=this.xmf*k*L*x;break;case this.N_POLE:case this.S_POLE:I>=0?(c=(k=Math.sqrt(I))*x,p=y*(this.mode===this.S_POLE?k:-k)):c=p=0;break}}return a.x=this.a*c+this.x0,a.y=this.a*p+this.y0,a}function b0(a){a.x-=this.x0,a.y-=this.y0;var c=a.x/this.a,p=a.y/this.a,y,x,T,I,o,L,k;if(this.sphere){var Y=0,N,ot=0;if(N=Math.sqrt(c*c+p*p),x=N*.5,x>1)return null;switch(x=2*Math.asin(x),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(ot=Math.sin(x),Y=Math.cos(x)),this.mode){case this.EQUIT:x=Math.abs(N)<=Gt?0:Math.asin(p*ot/N),c*=ot,p=Y*N;break;case this.OBLIQ:x=Math.abs(N)<=Gt?this.lat0:Math.asin(Y*this.sinph0+p*ot*this.cosph0/N),c*=ot*this.cosph0,p=(Y-Math.sin(x)*this.sinph0)*N;break;case this.N_POLE:p=-p,x=Ct-x;break;case this.S_POLE:x-=Ct;break}y=p===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(c,p)}else{if(k=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,p*=this.dd,L=Math.sqrt(c*c+p*p),L<Gt)return a.x=this.long0,a.y=this.lat0,a;I=2*Math.asin(.5*L/this.rq),T=Math.cos(I),c*=I=Math.sin(I),this.mode===this.OBLIQ?(k=T*this.sinb1+p*I*this.cosb1/L,o=this.qp*k,p=L*this.cosb1*T-p*this.sinb1*I):(k=p*I/L,o=this.qp*k,p=L*T)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),o=c*c+p*p,!o)return a.x=this.long0,a.y=this.lat0,a;k=1-o/this.qp,this.mode===this.S_POLE&&(k=-k)}y=Math.atan2(c,p),x=C0(Math.asin(k),this.apa)}return a.x=Yt(this.long0+y),a.y=x,a}var w0=.3333333333333333,M0=.17222222222222222,T0=.10257936507936508,E0=.06388888888888888,S0=.0664021164021164,I0=.016415012942191543;function A0(a){var c,p=[];return p[0]=a*w0,c=a*a,p[0]+=c*M0,p[1]=c*E0,c*=a,p[0]+=c*T0,p[1]+=c*S0,p[2]=c*I0,p}function C0(a,c){var p=a+a;return a+c[0]*Math.sin(p)+c[1]*Math.sin(p+p)+c[2]*Math.sin(p+p+p)}var P0=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const z0={init:v0,forward:x0,inverse:b0,names:P0,S_POLE:m0,N_POLE:g0,EQUIT:_0,OBLIQ:y0};function Ba(a){return Math.abs(a)>1&&(a=a>1?1:-1),Math.asin(a)}function k0(){Math.abs(this.lat1+this.lat2)<Gt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Us(this.e3,this.sin_po,this.cos_po),this.qs1=La(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Us(this.e3,this.sin_po,this.cos_po),this.qs2=La(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=La(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Gt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function D0(a){var c=a.x,p=a.y;this.sin_phi=Math.sin(p),this.cos_phi=Math.cos(p);var y=La(this.e3,this.sin_phi),x=this.a*Math.sqrt(this.c-this.ns0*y)/this.ns0,T=this.ns0*Yt(c-this.long0),I=x*Math.sin(T)+this.x0,o=this.rh-x*Math.cos(T)+this.y0;return a.x=I,a.y=o,a}function L0(a){var c,p,y,x,T,I;return a.x-=this.x0,a.y=this.rh-a.y+this.y0,this.ns0>=0?(c=Math.sqrt(a.x*a.x+a.y*a.y),y=1):(c=-Math.sqrt(a.x*a.x+a.y*a.y),y=-1),x=0,c!==0&&(x=Math.atan2(y*a.x,y*a.y)),y=c*this.ns0/this.a,this.sphere?I=Math.asin((this.c-y*y)/(2*this.ns0)):(p=(this.c-y*y)/this.ns0,I=this.phi1z(this.e3,p)),T=Yt(x/this.ns0+this.long0),a.x=T,a.y=I,a}function R0(a,c){var p,y,x,T,I,o=Ba(.5*c);if(a<Gt)return o;for(var L=a*a,k=1;k<=25;k++)if(p=Math.sin(o),y=Math.cos(o),x=a*p,T=1-x*x,I=.5*T*T/y*(c/(1-L)-p/T+.5/a*Math.log((1-x)/(1+x))),o=o+I,Math.abs(I)<=1e-7)return o;return null}var B0=["Albers_Conic_Equal_Area","Albers","aea"];const F0={init:k0,forward:D0,inverse:L0,names:B0,phi1z:R0};function O0(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function U0(a){var c,p,y,x,T,I,o,L,k=a.x,Y=a.y;return y=Yt(k-this.long0),c=Math.sin(Y),p=Math.cos(Y),x=Math.cos(y),I=this.sin_p14*c+this.cos_p14*p*x,T=1,I>0||Math.abs(I)<=Gt?(o=this.x0+this.a*T*p*Math.sin(y)/I,L=this.y0+this.a*T*(this.cos_p14*c-this.sin_p14*p*x)/I):(o=this.x0+this.infinity_dist*p*Math.sin(y),L=this.y0+this.infinity_dist*(this.cos_p14*c-this.sin_p14*p*x)),a.x=o,a.y=L,a}function N0(a){var c,p,y,x,T,I;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(c=Math.sqrt(a.x*a.x+a.y*a.y))?(x=Math.atan2(c,this.rc),p=Math.sin(x),y=Math.cos(x),I=Ba(y*this.sin_p14+a.y*p*this.cos_p14/c),T=Math.atan2(a.x*p,c*this.cos_p14*y-a.y*this.sin_p14*p),T=Yt(this.long0+T)):(I=this.phic0,T=0),a.x=T,a.y=I,a}var V0=["gnom"];const $0={init:O0,forward:U0,inverse:N0,names:V0};function q0(a,c){var p=1-(1-a*a)/(2*a)*Math.log((1-a)/(1+a));if(Math.abs(Math.abs(c)-p)<1e-6)return c<0?-1*Ct:Ct;for(var y=Math.asin(.5*c),x,T,I,o,L=0;L<30;L++)if(T=Math.sin(y),I=Math.cos(y),o=a*T,x=Math.pow(1-o*o,2)/(2*I)*(c/(1-a*a)-T/(1-o*o)+.5/a*Math.log((1-o)/(1+o))),y+=x,Math.abs(x)<=1e-10)return y;return NaN}function G0(){this.sphere||(this.k0=Us(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function Z0(a){var c=a.x,p=a.y,y,x,T=Yt(c-this.long0);if(this.sphere)y=this.x0+this.a*T*Math.cos(this.lat_ts),x=this.y0+this.a*Math.sin(p)/Math.cos(this.lat_ts);else{var I=La(this.e,Math.sin(p));y=this.x0+this.a*this.k0*T,x=this.y0+this.a*I*.5/this.k0}return a.x=y,a.y=x,a}function j0(a){a.x-=this.x0,a.y-=this.y0;var c,p;return this.sphere?(c=Yt(this.long0+a.x/this.a/Math.cos(this.lat_ts)),p=Math.asin(a.y/this.a*Math.cos(this.lat_ts))):(p=q0(this.e,2*a.y*this.k0/this.a),c=Yt(this.long0+a.x/(this.a*this.k0))),a.x=c,a.y=p,a}var X0=["cea"];const W0={init:G0,forward:Z0,inverse:j0,names:X0};function H0(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function K0(a){var c=a.x,p=a.y,y=Yt(c-this.long0),x=wo(p-this.lat0);return a.x=this.x0+this.a*y*this.rc,a.y=this.y0+this.a*x,a}function Y0(a){var c=a.x,p=a.y;return a.x=Yt(this.long0+(c-this.x0)/(this.a*this.rc)),a.y=wo(this.lat0+(p-this.y0)/this.a),a}var J0=["Equirectangular","Equidistant_Cylindrical","eqc"];const Q0={init:H0,forward:K0,inverse:Y0,names:J0};var Fp=20;function tv(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ll(this.es),this.e1=Rl(this.es),this.e2=Bl(this.es),this.e3=Fl(this.es),this.ml0=this.a*yr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function ev(a){var c=a.x,p=a.y,y,x,T,I=Yt(c-this.long0);if(T=I*Math.sin(p),this.sphere)Math.abs(p)<=Gt?(y=this.a*I,x=-1*this.a*this.lat0):(y=this.a*Math.sin(T)/Math.tan(p),x=this.a*(wo(p-this.lat0)+(1-Math.cos(T))/Math.tan(p)));else if(Math.abs(p)<=Gt)y=this.a*I,x=-1*this.ml0;else{var o=bo(this.a,this.e,Math.sin(p))/Math.tan(p);y=o*Math.sin(T),x=this.a*yr(this.e0,this.e1,this.e2,this.e3,p)-this.ml0+o*(1-Math.cos(T))}return a.x=y+this.x0,a.y=x+this.y0,a}function iv(a){var c,p,y,x,T,I,o,L,k;if(y=a.x-this.x0,x=a.y-this.y0,this.sphere)if(Math.abs(x+this.a*this.lat0)<=Gt)c=Yt(y/this.a+this.long0),p=0;else{I=this.lat0+x/this.a,o=y*y/this.a/this.a+I*I,L=I;var Y;for(T=Fp;T;--T)if(Y=Math.tan(L),k=-1*(I*(L*Y+1)-L-.5*(L*L+o)*Y)/((L-I)/Y-1),L+=k,Math.abs(k)<=Gt){p=L;break}c=Yt(this.long0+Math.asin(y*Math.tan(L)/this.a)/Math.sin(p))}else if(Math.abs(x+this.ml0)<=Gt)p=0,c=Yt(this.long0+y/this.a);else{I=(this.ml0+x)/this.a,o=y*y/this.a/this.a+I*I,L=I;var N,ot,mt,ft,Mt;for(T=Fp;T;--T)if(Mt=this.e*Math.sin(L),N=Math.sqrt(1-Mt*Mt)*Math.tan(L),ot=this.a*yr(this.e0,this.e1,this.e2,this.e3,L),mt=this.e0-2*this.e1*Math.cos(2*L)+4*this.e2*Math.cos(4*L)-6*this.e3*Math.cos(6*L),ft=ot/this.a,k=(I*(N*ft+1)-ft-.5*N*(ft*ft+o))/(this.es*Math.sin(2*L)*(ft*ft+o-2*I*ft)/(4*N)+(I-ft)*(N*mt-2/Math.sin(2*L))-mt),L-=k,Math.abs(k)<=Gt){p=L;break}N=Math.sqrt(1-this.es*Math.pow(Math.sin(p),2))*Math.tan(p),c=Yt(this.long0+Math.asin(y*N/this.a)/Math.sin(p))}return a.x=c,a.y=p,a}var rv=["Polyconic","poly"];const sv={init:tv,forward:ev,inverse:iv,names:rv};function av(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function nv(a){var c,p=a.x,y=a.y,x=y-this.lat0,T=p-this.long0,I=x/El*1e-5,o=T,L=1,k=0;for(c=1;c<=10;c++)L=L*I,k=k+this.A[c]*L;var Y=k,N=o,ot=1,mt=0,ft,Mt,Tt=0,Dt=0;for(c=1;c<=6;c++)ft=ot*Y-mt*N,Mt=mt*Y+ot*N,ot=ft,mt=Mt,Tt=Tt+this.B_re[c]*ot-this.B_im[c]*mt,Dt=Dt+this.B_im[c]*ot+this.B_re[c]*mt;return a.x=Dt*this.a+this.x0,a.y=Tt*this.a+this.y0,a}function ov(a){var c,p=a.x,y=a.y,x=p-this.x0,T=y-this.y0,I=T/this.a,o=x/this.a,L=1,k=0,Y,N,ot=0,mt=0;for(c=1;c<=6;c++)Y=L*I-k*o,N=k*I+L*o,L=Y,k=N,ot=ot+this.C_re[c]*L-this.C_im[c]*k,mt=mt+this.C_im[c]*L+this.C_re[c]*k;for(var ft=0;ft<this.iterations;ft++){var Mt=ot,Tt=mt,Dt,$t,Pt=I,Wt=o;for(c=2;c<=6;c++)Dt=Mt*ot-Tt*mt,$t=Tt*ot+Mt*mt,Mt=Dt,Tt=$t,Pt=Pt+(c-1)*(this.B_re[c]*Mt-this.B_im[c]*Tt),Wt=Wt+(c-1)*(this.B_im[c]*Mt+this.B_re[c]*Tt);Mt=1,Tt=0;var de=this.B_re[1],ve=this.B_im[1];for(c=2;c<=6;c++)Dt=Mt*ot-Tt*mt,$t=Tt*ot+Mt*mt,Mt=Dt,Tt=$t,de=de+c*(this.B_re[c]*Mt-this.B_im[c]*Tt),ve=ve+c*(this.B_im[c]*Mt+this.B_re[c]*Tt);var Se=de*de+ve*ve;ot=(Pt*de+Wt*ve)/Se,mt=(Wt*de-Pt*ve)/Se}var xe=ot,Ce=mt,oe=1,zi=0;for(c=1;c<=9;c++)oe=oe*xe,zi=zi+this.D[c]*oe;var mi=this.lat0+zi*El*1e5,nr=this.long0+Ce;return a.x=nr,a.y=mi,a}var lv=["New_Zealand_Map_Grid","nzmg"];const hv={init:av,forward:nv,inverse:ov,names:lv};function cv(){}function uv(a){var c=a.x,p=a.y,y=Yt(c-this.long0),x=this.x0+this.a*y,T=this.y0+this.a*Math.log(Math.tan(Math.PI/4+p/2.5))*1.25;return a.x=x,a.y=T,a}function dv(a){a.x-=this.x0,a.y-=this.y0;var c=Yt(this.long0+a.x/this.a),p=2.5*(Math.atan(Math.exp(.8*a.y/this.a))-Math.PI/4);return a.x=c,a.y=p,a}var pv=["Miller_Cylindrical","mill"];const fv={init:cv,forward:uv,inverse:dv,names:pv};var mv=20;function gv(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=cf(this.es)}function _v(a){var c,p,y=a.x,x=a.y;if(y=Yt(y-this.long0),this.sphere){if(!this.m)x=this.n!==1?Math.asin(this.n*Math.sin(x)):x;else for(var T=this.n*Math.sin(x),I=mv;I;--I){var o=(this.m*x+Math.sin(x)-T)/(this.m+Math.cos(x));if(x-=o,Math.abs(o)<Gt)break}c=this.a*this.C_x*y*(this.m+Math.cos(x)),p=this.a*this.C_y*x}else{var L=Math.sin(x),k=Math.cos(x);p=this.a*cc(x,L,k,this.en),c=this.a*y*k/Math.sqrt(1-this.es*L*L)}return a.x=c,a.y=p,a}function yv(a){var c,p,y,x;return a.x-=this.x0,y=a.x/this.a,a.y-=this.y0,c=a.y/this.a,this.sphere?(c/=this.C_y,y=y/(this.C_x*(this.m+Math.cos(c))),this.m?c=Ba((this.m*c+Math.sin(c))/this.n):this.n!==1&&(c=Ba(Math.sin(c)/this.n)),y=Yt(y+this.long0),c=wo(c)):(c=uf(a.y/this.a,this.es,this.en),x=Math.abs(c),x<Ct?(x=Math.sin(c),p=this.long0+a.x*Math.sqrt(1-this.es*x*x)/(this.a*Math.cos(c)),y=Yt(p)):x-Gt<Ct&&(y=this.long0)),a.x=y,a.y=c,a}var vv=["Sinusoidal","sinu"];const xv={init:gv,forward:_v,inverse:yv,names:vv};function bv(){}function wv(a){for(var c=a.x,p=a.y,y=Yt(c-this.long0),x=p,T=Math.PI*Math.sin(p);;){var I=-(x+Math.sin(x)-T)/(1+Math.cos(x));if(x+=I,Math.abs(I)<Gt)break}x/=2,Math.PI/2-Math.abs(p)<Gt&&(y=0);var o=.900316316158*this.a*y*Math.cos(x)+this.x0,L=1.4142135623731*this.a*Math.sin(x)+this.y0;return a.x=o,a.y=L,a}function Mv(a){var c,p;a.x-=this.x0,a.y-=this.y0,p=a.y/(1.4142135623731*this.a),Math.abs(p)>.999999999999&&(p=.999999999999),c=Math.asin(p);var y=Yt(this.long0+a.x/(.900316316158*this.a*Math.cos(c)));y<-Math.PI&&(y=-Math.PI),y>Math.PI&&(y=Math.PI),p=(2*c+Math.sin(2*c))/Math.PI,Math.abs(p)>1&&(p=1);var x=Math.asin(p);return a.x=y,a.y=x,a}var Tv=["Mollweide","moll"];const Ev={init:bv,forward:wv,inverse:Mv,names:Tv};function Sv(){Math.abs(this.lat1+this.lat2)<Gt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ll(this.es),this.e1=Rl(this.es),this.e2=Bl(this.es),this.e3=Fl(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Us(this.e,this.sinphi,this.cosphi),this.ml1=yr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Gt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Us(this.e,this.sinphi,this.cosphi),this.ml2=yr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=yr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Iv(a){var c=a.x,p=a.y,y;if(this.sphere)y=this.a*(this.g-p);else{var x=yr(this.e0,this.e1,this.e2,this.e3,p);y=this.a*(this.g-x)}var T=this.ns*Yt(c-this.long0),I=this.x0+y*Math.sin(T),o=this.y0+this.rh-y*Math.cos(T);return a.x=I,a.y=o,a}function Av(a){a.x-=this.x0,a.y=this.rh-a.y+this.y0;var c,p,y,x;this.ns>=0?(p=Math.sqrt(a.x*a.x+a.y*a.y),c=1):(p=-Math.sqrt(a.x*a.x+a.y*a.y),c=-1);var T=0;if(p!==0&&(T=Math.atan2(c*a.x,c*a.y)),this.sphere)return x=Yt(this.long0+T/this.ns),y=wo(this.g-p/this.a),a.x=x,a.y=y,a;var I=this.g-p/this.a;return y=sc(I,this.e0,this.e1,this.e2,this.e3),x=Yt(this.long0+T/this.ns),a.x=x,a.y=y,a}var Cv=["Equidistant_Conic","eqdc"];const Pv={init:Sv,forward:Iv,inverse:Av,names:Cv};function zv(){this.R=this.a}function kv(a){var c=a.x,p=a.y,y=Yt(c-this.long0),x,T;Math.abs(p)<=Gt&&(x=this.x0+this.R*y,T=this.y0);var I=Ba(2*Math.abs(p/Math.PI));(Math.abs(y)<=Gt||Math.abs(Math.abs(p)-Ct)<=Gt)&&(x=this.x0,p>=0?T=this.y0+Math.PI*this.R*Math.tan(.5*I):T=this.y0+Math.PI*this.R*-Math.tan(.5*I));var o=.5*Math.abs(Math.PI/y-y/Math.PI),L=o*o,k=Math.sin(I),Y=Math.cos(I),N=Y/(k+Y-1),ot=N*N,mt=N*(2/k-1),ft=mt*mt,Mt=Math.PI*this.R*(o*(N-ft)+Math.sqrt(L*(N-ft)*(N-ft)-(ft+L)*(ot-ft)))/(ft+L);y<0&&(Mt=-Mt),x=this.x0+Mt;var Tt=L+N;return Mt=Math.PI*this.R*(mt*Tt-o*Math.sqrt((ft+L)*(L+1)-Tt*Tt))/(ft+L),p>=0?T=this.y0+Mt:T=this.y0-Mt,a.x=x,a.y=T,a}function Dv(a){var c,p,y,x,T,I,o,L,k,Y,N,ot,mt;return a.x-=this.x0,a.y-=this.y0,N=Math.PI*this.R,y=a.x/N,x=a.y/N,T=y*y+x*x,I=-Math.abs(x)*(1+T),o=I-2*x*x+y*y,L=-2*I+1+2*x*x+T*T,mt=x*x/L+(2*o*o*o/L/L/L-9*I*o/L/L)/27,k=(I-o*o/3/L)/L,Y=2*Math.sqrt(-k/3),N=3*mt/k/Y,Math.abs(N)>1&&(N>=0?N=1:N=-1),ot=Math.acos(N)/3,a.y>=0?p=(-Y*Math.cos(ot+Math.PI/3)-o/3/L)*Math.PI:p=-(-Y*Math.cos(ot+Math.PI/3)-o/3/L)*Math.PI,Math.abs(y)<Gt?c=this.long0:c=Yt(this.long0+Math.PI*(T-1+Math.sqrt(1+2*(y*y-x*x)+T*T))/2/y),a.x=c,a.y=p,a}var Lv=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Rv={init:zv,forward:kv,inverse:Dv,names:Lv};function Bv(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Fv(a){var c=a.x,p=a.y,y=Math.sin(a.y),x=Math.cos(a.y),T=Yt(c-this.long0),I,o,L,k,Y,N,ot,mt,ft,Mt,Tt,Dt,$t,Pt,Wt,de,ve,Se,xe,Ce,oe,zi,mi;return this.sphere?Math.abs(this.sin_p12-1)<=Gt?(a.x=this.x0+this.a*(Ct-p)*Math.sin(T),a.y=this.y0-this.a*(Ct-p)*Math.cos(T),a):Math.abs(this.sin_p12+1)<=Gt?(a.x=this.x0+this.a*(Ct+p)*Math.sin(T),a.y=this.y0+this.a*(Ct+p)*Math.cos(T),a):(Se=this.sin_p12*y+this.cos_p12*x*Math.cos(T),de=Math.acos(Se),ve=de?de/Math.sin(de):1,a.x=this.x0+this.a*ve*x*Math.sin(T),a.y=this.y0+this.a*ve*(this.cos_p12*y-this.sin_p12*x*Math.cos(T)),a):(I=Ll(this.es),o=Rl(this.es),L=Bl(this.es),k=Fl(this.es),Math.abs(this.sin_p12-1)<=Gt?(Y=this.a*yr(I,o,L,k,Ct),N=this.a*yr(I,o,L,k,p),a.x=this.x0+(Y-N)*Math.sin(T),a.y=this.y0-(Y-N)*Math.cos(T),a):Math.abs(this.sin_p12+1)<=Gt?(Y=this.a*yr(I,o,L,k,Ct),N=this.a*yr(I,o,L,k,p),a.x=this.x0+(Y+N)*Math.sin(T),a.y=this.y0+(Y+N)*Math.cos(T),a):(ot=y/x,mt=bo(this.a,this.e,this.sin_p12),ft=bo(this.a,this.e,y),Mt=Math.atan((1-this.es)*ot+this.es*mt*this.sin_p12/(ft*x)),Tt=Math.atan2(Math.sin(T),this.cos_p12*Math.tan(Mt)-this.sin_p12*Math.cos(T)),Tt===0?xe=Math.asin(this.cos_p12*Math.sin(Mt)-this.sin_p12*Math.cos(Mt)):Math.abs(Math.abs(Tt)-Math.PI)<=Gt?xe=-Math.asin(this.cos_p12*Math.sin(Mt)-this.sin_p12*Math.cos(Mt)):xe=Math.asin(Math.sin(T)*Math.cos(Mt)/Math.sin(Tt)),Dt=this.e*this.sin_p12/Math.sqrt(1-this.es),$t=this.e*this.cos_p12*Math.cos(Tt)/Math.sqrt(1-this.es),Pt=Dt*$t,Wt=$t*$t,Ce=xe*xe,oe=Ce*xe,zi=oe*xe,mi=zi*xe,de=mt*xe*(1-Ce*Wt*(1-Wt)/6+oe/8*Pt*(1-2*Wt)+zi/120*(Wt*(4-7*Wt)-3*Dt*Dt*(1-7*Wt))-mi/48*Pt),a.x=this.x0+de*Math.sin(Tt),a.y=this.y0+de*Math.cos(Tt),a))}function Ov(a){a.x-=this.x0,a.y-=this.y0;var c,p,y,x,T,I,o,L,k,Y,N,ot,mt,ft,Mt,Tt,Dt,$t,Pt,Wt,de,ve,Se,xe;return this.sphere?(c=Math.sqrt(a.x*a.x+a.y*a.y),c>2*Ct*this.a?void 0:(p=c/this.a,y=Math.sin(p),x=Math.cos(p),T=this.long0,Math.abs(c)<=Gt?I=this.lat0:(I=Ba(x*this.sin_p12+a.y*y*this.cos_p12/c),o=Math.abs(this.lat0)-Ct,Math.abs(o)<=Gt?this.lat0>=0?T=Yt(this.long0+Math.atan2(a.x,-a.y)):T=Yt(this.long0-Math.atan2(-a.x,a.y)):T=Yt(this.long0+Math.atan2(a.x*y,c*this.cos_p12*x-a.y*this.sin_p12*y))),a.x=T,a.y=I,a)):(L=Ll(this.es),k=Rl(this.es),Y=Bl(this.es),N=Fl(this.es),Math.abs(this.sin_p12-1)<=Gt?(ot=this.a*yr(L,k,Y,N,Ct),c=Math.sqrt(a.x*a.x+a.y*a.y),mt=ot-c,I=sc(mt/this.a,L,k,Y,N),T=Yt(this.long0+Math.atan2(a.x,-1*a.y)),a.x=T,a.y=I,a):Math.abs(this.sin_p12+1)<=Gt?(ot=this.a*yr(L,k,Y,N,Ct),c=Math.sqrt(a.x*a.x+a.y*a.y),mt=c-ot,I=sc(mt/this.a,L,k,Y,N),T=Yt(this.long0+Math.atan2(a.x,a.y)),a.x=T,a.y=I,a):(c=Math.sqrt(a.x*a.x+a.y*a.y),Tt=Math.atan2(a.x,a.y),ft=bo(this.a,this.e,this.sin_p12),Dt=Math.cos(Tt),$t=this.e*this.cos_p12*Dt,Pt=-$t*$t/(1-this.es),Wt=3*this.es*(1-Pt)*this.sin_p12*this.cos_p12*Dt/(1-this.es),de=c/ft,ve=de-Pt*(1+Pt)*Math.pow(de,3)/6-Wt*(1+3*Pt)*Math.pow(de,4)/24,Se=1-Pt*ve*ve/2-de*ve*ve*ve/6,Mt=Math.asin(this.sin_p12*Math.cos(ve)+this.cos_p12*Math.sin(ve)*Dt),T=Yt(this.long0+Math.asin(Math.sin(Tt)*Math.sin(ve)/Math.cos(Mt))),xe=Math.sin(Mt),I=Math.atan2((xe-this.es*Se*this.sin_p12)*Math.tan(Mt),xe*(1-this.es)),a.x=T,a.y=I,a))}var Uv=["Azimuthal_Equidistant","aeqd"];const Nv={init:Bv,forward:Fv,inverse:Ov,names:Uv};function Vv(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function $v(a){var c,p,y,x,T,I,o,L,k=a.x,Y=a.y;return y=Yt(k-this.long0),c=Math.sin(Y),p=Math.cos(Y),x=Math.cos(y),I=this.sin_p14*c+this.cos_p14*p*x,T=1,(I>0||Math.abs(I)<=Gt)&&(o=this.a*T*p*Math.sin(y),L=this.y0+this.a*T*(this.cos_p14*c-this.sin_p14*p*x)),a.x=o,a.y=L,a}function qv(a){var c,p,y,x,T,I,o;return a.x-=this.x0,a.y-=this.y0,c=Math.sqrt(a.x*a.x+a.y*a.y),p=Ba(c/this.a),y=Math.sin(p),x=Math.cos(p),I=this.long0,Math.abs(c)<=Gt?(o=this.lat0,a.x=I,a.y=o,a):(o=Ba(x*this.sin_p14+a.y*y*this.cos_p14/c),T=Math.abs(this.lat0)-Ct,Math.abs(T)<=Gt?(this.lat0>=0?I=Yt(this.long0+Math.atan2(a.x,-a.y)):I=Yt(this.long0-Math.atan2(-a.x,a.y)),a.x=I,a.y=o,a):(I=Yt(this.long0+Math.atan2(a.x*y,c*this.cos_p14*x-a.y*this.sin_p14*y)),a.x=I,a.y=o,a))}var Gv=["ortho"];const Zv={init:Vv,forward:$v,inverse:qv,names:Gv};var hi={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Oe={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function jv(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Ct-Fe/2?this.face=hi.TOP:this.lat0<=-(Ct-Fe/2)?this.face=hi.BOTTOM:Math.abs(this.long0)<=Fe?this.face=hi.FRONT:Math.abs(this.long0)<=Ct+Fe?this.face=this.long0>0?hi.RIGHT:hi.LEFT:this.face=hi.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Xv(a){var c={x:0,y:0},p,y,x,T,I,o,L={value:0};if(a.x-=this.long0,this.es!==0?p=Math.atan(this.one_minus_f_squared*Math.tan(a.y)):p=a.y,y=a.x,this.face===hi.TOP)T=Ct-p,y>=Fe&&y<=Ct+Fe?(L.value=Oe.AREA_0,x=y-Ct):y>Ct+Fe||y<=-(Ct+Fe)?(L.value=Oe.AREA_1,x=y>0?y-bi:y+bi):y>-(Ct+Fe)&&y<=-Fe?(L.value=Oe.AREA_2,x=y+Ct):(L.value=Oe.AREA_3,x=y);else if(this.face===hi.BOTTOM)T=Ct+p,y>=Fe&&y<=Ct+Fe?(L.value=Oe.AREA_0,x=-y+Ct):y<Fe&&y>=-Fe?(L.value=Oe.AREA_1,x=-y):y<-Fe&&y>=-(Ct+Fe)?(L.value=Oe.AREA_2,x=-y-Ct):(L.value=Oe.AREA_3,x=y>0?-y+bi:-y-bi);else{var k,Y,N,ot,mt,ft,Mt;this.face===hi.RIGHT?y=yo(y,+Ct):this.face===hi.BACK?y=yo(y,+bi):this.face===hi.LEFT&&(y=yo(y,-Ct)),ot=Math.sin(p),mt=Math.cos(p),ft=Math.sin(y),Mt=Math.cos(y),k=mt*Mt,Y=mt*ft,N=ot,this.face===hi.FRONT?(T=Math.acos(k),x=Gh(T,N,Y,L)):this.face===hi.RIGHT?(T=Math.acos(Y),x=Gh(T,N,-k,L)):this.face===hi.BACK?(T=Math.acos(-k),x=Gh(T,N,-Y,L)):this.face===hi.LEFT?(T=Math.acos(-Y),x=Gh(T,N,k,L)):(T=x=0,L.value=Oe.AREA_0)}return o=Math.atan(12/bi*(x+Math.acos(Math.sin(x)*Math.cos(Fe))-Ct)),I=Math.sqrt((1-Math.cos(T))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(x))))),L.value===Oe.AREA_1?o+=Ct:L.value===Oe.AREA_2?o+=bi:L.value===Oe.AREA_3&&(o+=1.5*bi),c.x=I*Math.cos(o),c.y=I*Math.sin(o),c.x=c.x*this.a+this.x0,c.y=c.y*this.a+this.y0,a.x=c.x,a.y=c.y,a}function Wv(a){var c={lam:0,phi:0},p,y,x,T,I,o,L,k,Y,N={value:0};if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,y=Math.atan(Math.sqrt(a.x*a.x+a.y*a.y)),p=Math.atan2(a.y,a.x),a.x>=0&&a.x>=Math.abs(a.y)?N.value=Oe.AREA_0:a.y>=0&&a.y>=Math.abs(a.x)?(N.value=Oe.AREA_1,p-=Ct):a.x<0&&-a.x>=Math.abs(a.y)?(N.value=Oe.AREA_2,p=p<0?p+bi:p-bi):(N.value=Oe.AREA_3,p+=Ct),Y=bi/12*Math.tan(p),I=Math.sin(Y)/(Math.cos(Y)-1/Math.sqrt(2)),o=Math.atan(I),x=Math.cos(p),T=Math.tan(y),L=1-x*x*T*T*(1-Math.cos(Math.atan(1/Math.cos(o)))),L<-1?L=-1:L>1&&(L=1),this.face===hi.TOP)k=Math.acos(L),c.phi=Ct-k,N.value===Oe.AREA_0?c.lam=o+Ct:N.value===Oe.AREA_1?c.lam=o<0?o+bi:o-bi:N.value===Oe.AREA_2?c.lam=o-Ct:c.lam=o;else if(this.face===hi.BOTTOM)k=Math.acos(L),c.phi=k-Ct,N.value===Oe.AREA_0?c.lam=-o+Ct:N.value===Oe.AREA_1?c.lam=-o:N.value===Oe.AREA_2?c.lam=-o-Ct:c.lam=o<0?-o-bi:-o+bi;else{var ot,mt,ft;ot=L,Y=ot*ot,Y>=1?ft=0:ft=Math.sqrt(1-Y)*Math.sin(o),Y+=ft*ft,Y>=1?mt=0:mt=Math.sqrt(1-Y),N.value===Oe.AREA_1?(Y=mt,mt=-ft,ft=Y):N.value===Oe.AREA_2?(mt=-mt,ft=-ft):N.value===Oe.AREA_3&&(Y=mt,mt=ft,ft=-Y),this.face===hi.RIGHT?(Y=ot,ot=-mt,mt=Y):this.face===hi.BACK?(ot=-ot,mt=-mt):this.face===hi.LEFT&&(Y=ot,ot=mt,mt=-Y),c.phi=Math.acos(-ft)-Ct,c.lam=Math.atan2(mt,ot),this.face===hi.RIGHT?c.lam=yo(c.lam,-Ct):this.face===hi.BACK?c.lam=yo(c.lam,-bi):this.face===hi.LEFT&&(c.lam=yo(c.lam,+Ct))}if(this.es!==0){var Mt,Tt,Dt;Mt=c.phi<0?1:0,Tt=Math.tan(c.phi),Dt=this.b/Math.sqrt(Tt*Tt+this.one_minus_f_squared),c.phi=Math.atan(Math.sqrt(this.a*this.a-Dt*Dt)/(this.one_minus_f*Dt)),Mt&&(c.phi=-c.phi)}return c.lam+=this.long0,a.x=c.lam,a.y=c.phi,a}function Gh(a,c,p,y){var x;return a<Gt?(y.value=Oe.AREA_0,x=0):(x=Math.atan2(c,p),Math.abs(x)<=Fe?y.value=Oe.AREA_0:x>Fe&&x<=Ct+Fe?(y.value=Oe.AREA_1,x-=Ct):x>Ct+Fe||x<=-(Ct+Fe)?(y.value=Oe.AREA_2,x=x>=0?x-bi:x+bi):(y.value=Oe.AREA_3,x+=Ct)),x}function yo(a,c){var p=a+c;return p<-bi?p+=Pl:p>+bi&&(p-=Pl),p}var Hv=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Kv={init:jv,forward:Xv,inverse:Wv,names:Hv};var Pu=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Tl=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],ff=.8487,mf=1.3523,gf=Fs/5,Yv=1/gf,mo=18,ac=function(a,c){return a[0]+c*(a[1]+c*(a[2]+c*a[3]))},Jv=function(a,c){return a[1]+c*(2*a[2]+c*3*a[3])};function Qv(a,c,p,y){for(var x=c;y;--y){var T=a(x);if(x-=T,Math.abs(T)<p)break}return x}function tx(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function ex(a){var c=Yt(a.x-this.long0),p=Math.abs(a.y),y=Math.floor(p*gf);y<0?y=0:y>=mo&&(y=mo-1),p=Fs*(p-Yv*y);var x={x:ac(Pu[y],p)*c,y:ac(Tl[y],p)};return a.y<0&&(x.y=-x.y),x.x=x.x*this.a*ff+this.x0,x.y=x.y*this.a*mf+this.y0,x}function ix(a){var c={x:(a.x-this.x0)/(this.a*ff),y:Math.abs(a.y-this.y0)/(this.a*mf)};if(c.y>=1)c.x/=Pu[mo][0],c.y=a.y<0?-Ct:Ct;else{var p=Math.floor(c.y*mo);for(p<0?p=0:p>=mo&&(p=mo-1);;)if(Tl[p][0]>c.y)--p;else if(Tl[p+1][0]<=c.y)++p;else break;var y=Tl[p],x=5*(c.y-y[0])/(Tl[p+1][0]-y[0]);x=Qv(function(T){return(ac(y,T)-c.y)/Jv(y,T)},x,Gt,100),c.x/=ac(Pu[p],x),c.y=(5*p+x)*Xi,a.y<0&&(c.y=-c.y)}return c.x=Yt(c.x+this.long0),c}var rx=["Robinson","robin"];const sx={init:tx,forward:ex,inverse:ix,names:rx};function ax(){this.name="geocent"}function nx(a){var c=tf(a,this.es,this.a);return c}function ox(a){var c=ef(a,this.es,this.a,this.b);return c}var lx=["Geocentric","geocentric","geocent","Geocent"];const hx={init:ax,forward:nx,inverse:ox,names:lx};var sr={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},vl={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function cx(){if(Object.keys(vl).forEach((function(p){if(typeof this[p]>"u")this[p]=vl[p].def;else{if(vl[p].num&&isNaN(this[p]))throw new Error("Invalid parameter value, must be numeric "+p+" = "+this[p]);vl[p].num&&(this[p]=parseFloat(this[p]))}vl[p].degrees&&(this[p]=this[p]*Xi)}).bind(this)),Math.abs(Math.abs(this.lat0)-Ct)<Gt?this.mode=this.lat0<0?sr.S_POLE:sr.N_POLE:Math.abs(this.lat0)<Gt?this.mode=sr.EQUIT:(this.mode=sr.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var a=this.tilt,c=this.azi;this.cg=Math.cos(c),this.sg=Math.sin(c),this.cw=Math.cos(a),this.sw=Math.sin(a)}function ux(a){a.x-=this.long0;var c=Math.sin(a.y),p=Math.cos(a.y),y=Math.cos(a.x),x,T;switch(this.mode){case sr.OBLIQ:T=this.sinph0*c+this.cosph0*p*y;break;case sr.EQUIT:T=p*y;break;case sr.S_POLE:T=-c;break;case sr.N_POLE:T=c;break}switch(T=this.pn1/(this.p-T),x=T*p*Math.sin(a.x),this.mode){case sr.OBLIQ:T*=this.cosph0*c-this.sinph0*p*y;break;case sr.EQUIT:T*=c;break;case sr.N_POLE:T*=-(p*y);break;case sr.S_POLE:T*=p*y;break}var I,o;return I=T*this.cg+x*this.sg,o=1/(I*this.sw*this.h1+this.cw),x=(x*this.cg-T*this.sg)*this.cw*o,T=I*o,a.x=x*this.a,a.y=T*this.a,a}function dx(a){a.x/=this.a,a.y/=this.a;var c={x:a.x,y:a.y},p,y,x;x=1/(this.pn1-a.y*this.sw),p=this.pn1*a.x*x,y=this.pn1*a.y*this.cw*x,a.x=p*this.cg+y*this.sg,a.y=y*this.cg-p*this.sg;var T=ys(a.x,a.y);if(Math.abs(T)<Gt)c.x=0,c.y=a.y;else{var I,o;switch(o=1-T*T*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/T+T/this.pn1),I=Math.sqrt(1-o*o),this.mode){case sr.OBLIQ:c.y=Math.asin(I*this.sinph0+a.y*o*this.cosph0/T),a.y=(I-this.sinph0*Math.sin(c.y))*T,a.x*=o*this.cosph0;break;case sr.EQUIT:c.y=Math.asin(a.y*o/T),a.y=I*T,a.x*=o;break;case sr.N_POLE:c.y=Math.asin(I),a.y=-a.y;break;case sr.S_POLE:c.y=-Math.asin(I);break}c.x=Math.atan2(a.x,a.y)}return a.x=c.x+this.long0,a.y=c.y,a}var px=["Tilted_Perspective","tpers"];const fx={init:cx,forward:ux,inverse:dx,names:px};function mx(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var a=1-this.es,c=1/a;this.radius_p=Math.sqrt(a),this.radius_p2=a,this.radius_p_inv2=c,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function gx(a){var c=a.x,p=a.y,y,x,T,I;if(c=c-this.long0,this.shape==="ellipse"){p=Math.atan(this.radius_p2*Math.tan(p));var o=this.radius_p/ys(this.radius_p*Math.cos(p),Math.sin(p));if(x=o*Math.cos(c)*Math.cos(p),T=o*Math.sin(c)*Math.cos(p),I=o*Math.sin(p),(this.radius_g-x)*x-T*T-I*I*this.radius_p_inv2<0)return a.x=Number.NaN,a.y=Number.NaN,a;y=this.radius_g-x,this.flip_axis?(a.x=this.radius_g_1*Math.atan(T/ys(I,y)),a.y=this.radius_g_1*Math.atan(I/y)):(a.x=this.radius_g_1*Math.atan(T/y),a.y=this.radius_g_1*Math.atan(I/ys(T,y)))}else this.shape==="sphere"&&(y=Math.cos(p),x=Math.cos(c)*y,T=Math.sin(c)*y,I=Math.sin(p),y=this.radius_g-x,this.flip_axis?(a.x=this.radius_g_1*Math.atan(T/ys(I,y)),a.y=this.radius_g_1*Math.atan(I/y)):(a.x=this.radius_g_1*Math.atan(T/y),a.y=this.radius_g_1*Math.atan(I/ys(T,y))));return a.x=a.x*this.a,a.y=a.y*this.a,a}function _x(a){var c=-1,p=0,y=0,x,T,I,o;if(a.x=a.x/this.a,a.y=a.y/this.a,this.shape==="ellipse"){this.flip_axis?(y=Math.tan(a.y/this.radius_g_1),p=Math.tan(a.x/this.radius_g_1)*ys(1,y)):(p=Math.tan(a.x/this.radius_g_1),y=Math.tan(a.y/this.radius_g_1)*ys(1,p));var L=y/this.radius_p;if(x=p*p+L*L+c*c,T=2*this.radius_g*c,I=T*T-4*x*this.C,I<0)return a.x=Number.NaN,a.y=Number.NaN,a;o=(-T-Math.sqrt(I))/(2*x),c=this.radius_g+o*c,p*=o,y*=o,a.x=Math.atan2(p,c),a.y=Math.atan(y*Math.cos(a.x)/c),a.y=Math.atan(this.radius_p_inv2*Math.tan(a.y))}else if(this.shape==="sphere"){if(this.flip_axis?(y=Math.tan(a.y/this.radius_g_1),p=Math.tan(a.x/this.radius_g_1)*Math.sqrt(1+y*y)):(p=Math.tan(a.x/this.radius_g_1),y=Math.tan(a.y/this.radius_g_1)*Math.sqrt(1+p*p)),x=p*p+y*y+c*c,T=2*this.radius_g*c,I=T*T-4*x*this.C,I<0)return a.x=Number.NaN,a.y=Number.NaN,a;o=(-T-Math.sqrt(I))/(2*x),c=this.radius_g+o*c,p*=o,y*=o,a.x=Math.atan2(p,c),a.y=Math.atan(y*Math.cos(a.x)/c)}return a.x=a.x+this.long0,a}var yx=["Geostationary Satellite View","Geostationary_Satellite","geos"];const vx={init:mx,forward:gx,inverse:_x,names:yx};function xx(a){a.Proj.projections.add(Qh),a.Proj.projections.add(tc),a.Proj.projections.add(Sy),a.Proj.projections.add(By),a.Proj.projections.add($y),a.Proj.projections.add(Xy),a.Proj.projections.add(Qy),a.Proj.projections.add(s0),a.Proj.projections.add(h0),a.Proj.projections.add(f0),a.Proj.projections.add(z0),a.Proj.projections.add(F0),a.Proj.projections.add($0),a.Proj.projections.add(W0),a.Proj.projections.add(Q0),a.Proj.projections.add(sv),a.Proj.projections.add(hv),a.Proj.projections.add(fv),a.Proj.projections.add(xv),a.Proj.projections.add(Ev),a.Proj.projections.add(Pv),a.Proj.projections.add(Rv),a.Proj.projections.add(Nv),a.Proj.projections.add(Zv),a.Proj.projections.add(Kv),a.Proj.projections.add(sx),a.Proj.projections.add(hx),a.Proj.projections.add(fx),a.Proj.projections.add(vx)}vr.defaultDatum="WGS84";vr.Proj=Os;vr.WGS84=new vr.Proj("WGS84");vr.Point=xo;vr.toPoint=rf;vr.defs=_r;vr.nadgrid=A_;vr.transform=rc;vr.mgrs=G_;vr.version="__VERSION__";xx(vr);class on{constructor(c,p,y,x){this.opts=x||{},this.id=p,this.map=c,this.fromLayers=y,this.type="custom",this.keys=[],this.positions=[],this.glDrawType="TRIANGLES",this.matrix;const T=`#version 300 es
    
            uniform mat4 u_matrix;
            in vec2 a_pos;
            void main() {
                gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);
            }`,I=`#version 300 es
    
            out highp vec4 fragColor;
            void main() {
                fragColor = vec4(1.0, 0.0, 0.0, 1.0);
            }`;this.positionLength=0,this.fragmentSource=this.opts.fragmentSource||I,this.vertexSource=this.opts.vertexSource||T,this.animate=this.opts.animate||null,this.onRenderCallback=this.opts.onRenderCallback||null,this.pointOptions=this.opts.pointOptions||{anchor:"center",width:100,height:100},this.addedBufferNames=this.opts.addedBufferNames||[],this.texcoordAttributeLocation={},this.normCoordAttributeLocation={},this.texture={},this.addedBuffers={},this.attrPositions={},this.program,this.context,this.imagePath=this.opts.imagePath||null,this.normalImagePath=this.opts.normalImagePath||null,this.uniforms=this.opts.uniforms||[]}onAdd(c,p){this.context=p;const y=p.createShader(p.VERTEX_SHADER);p.shaderSource(y,this.vertexSource),p.compileShader(y),console.log(p.getShaderInfoLog(y));const x=p.createShader(p.FRAGMENT_SHADER);if(p.shaderSource(x,this.fragmentSource),p.compileShader(x),console.log(p.getShaderInfoLog(x)),this.program=p.createProgram(),p.attachShader(this.program,y),p.attachShader(this.program,x),p.linkProgram(this.program),p.useProgram(this.program),this.uniforms&&this.uniforms.length>0)for(let T=0;T<this.uniforms.length;T++)this.setUniform(this.uniforms[T]);if(this.aPos=p.getAttribLocation(this.program,"a_pos"),this.texcoordAttributeLocation=p.getAttribLocation(this.program,"a_texcoord"),this.normCoordAttributeLocation=p.getAttribLocation(this.program,"a_normcoord"),this.buffer=p.createBuffer(),this.addedBufferNames.length>0&&this.addBuffers(),this.calculateVertices(p),this.animate&&this.animate(this),this.imagePath){this.image=new Image,this.image.src=this.imagePath;const T=this;this.image.addEventListener("load",function(){T.map.triggerRepaint&&T.map.triggerRepaint()})}this.normalImagePath&&(this.normalImage=new Image,this.normalImage.src=this.normalImagePath,this.normalImage.addEventListener("load",function(){self.map.triggerRepaint&&self.map.triggerRepaint()}))}addBuffers(){const c=this.context;this.addedBufferNames.forEach(p=>{this.attrPositions[p]=c.getAttribLocation(this.program,p),this.addedBuffers[p]=c.createBuffer()})}setBuffer(c,p,y,x,T,I,o){const L=this.context;this.attrPositions[c]>-1&&(L.bindBuffer(L.ARRAY_BUFFER,this.addedBuffers[c]),L.bufferData(L.ARRAY_BUFFER,new Float32Array(p),L.STATIC_DRAW),L.enableVertexAttribArray(this.attrPositions[c]),L.vertexAttribPointer(this.attrPositions[c],y,x,T,I,o),L.bindBuffer(L.ARRAY_BUFFER,this.addedBuffers[c]))}render(c,p){this.matrix=p,this.calculateVertices(c),c.useProgram(this.program),this.updateResolution(),this.updateMapBBox(),this.onRenderCallback&&this.onRenderCallback(this.map,c,this.program),c.uniformMatrix4fv(c.getUniformLocation(this.program,"u_matrix"),!1,p),c.bindBuffer(c.ARRAY_BUFFER,this.buffer),c.enableVertexAttribArray(this.aPos),c.vertexAttribPointer(this.aPos,2,c.FLOAT,!1,0,0),this.image&&this.establishTexture(c,this.image,"texcoordAttributeLocation",0),this.normalImage&&this.establishTexture(c,this.normalImage,"normCoordAttributeLocation",1),c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);var y=c.getUniformLocation(this.program,"u_texture");c.uniform1i(y,0);var x=c.getUniformLocation(this.program,"u_normal");c.uniform1i(x,1),c.drawArrays(c[this.glDrawType],0,this.positionLength/2)}createHash(c){var p=0,y,x;if(c.length===0)return p;for(y=0;y<c.length;y++)x=c.charCodeAt(y),p=(p<<5)-p+x,p|=0;return p}getFeatureHash(c){return this.createHash(`${c.id}${c._vectorTileFeature._x}${c._vectorTileFeature._y}${c._vectorTileFeature._z}`)}polyCoordsToPositions(c){for(var p=vp.flatten(c),y=vp(p.vertices,p.holes,2),x=0;x<y.length;x++)if(typeof p.vertices[y[x]*2]=="number"&&typeof p.vertices[y[x]*2+1]=="number"){const T=Da.MercatorCoordinate.fromLngLat({lng:p.vertices[y[x]*2],lat:p.vertices[y[x]*2+1]});this.positions.push(T.x,T.y)}else console.error("Error in coordinatesToPositions",p.vertices[y[x]*2],p.vertices[y[x]*2+1])}lineCoordsToPositions(c){for(var p=0;p<c.length;p++){const y=Da.MercatorCoordinate.fromLngLat({lng:c[p][0],lat:c[p][1]});this.positions.push(y.x,y.y)}}pointCoordsToPositions(c){const p=this.map.getContainer().offsetWidth/this.map.getContainer().offsetHeight,y=this.pointOptions.width*p*window.devicePixelRatio/this.map.getContainer().offsetWidth,x=this.pointOptions.height*p/this.map.getContainer().offsetWidth*window.devicePixelRatio;for(var T=0;T<c.length;T++){const I=Da.MercatorCoordinate.fromLngLat({lng:c[0]-y/2,lat:c[1]-x/2}),o=Da.MercatorCoordinate.fromLngLat({lng:c[0]-y/2,lat:c[1]+x/2}),L=Da.MercatorCoordinate.fromLngLat({lng:c[0]+y/2,lat:c[1]+x/2}),k=Da.MercatorCoordinate.fromLngLat({lng:c[0]+y/2,lat:c[1]-x/2});this.positions.push(I.x,I.y),this.positions.push(o.x,o.y),this.positions.push(L.x,L.y),this.positions.push(L.x,L.y),this.positions.push(k.x,k.y),this.positions.push(I.x,I.y)}}calculateVertices(c){this.positions=[],this.keys=[],this.features=this.map.queryRenderedFeatures({layers:this.fromLayers});const p=this.features.map(T=>this.getFeatureHash(T)),y=this.features.filter(T=>T.geometry.type==="Polygon"||T.geometry.type==="MultiPolygon"||T.geometry.type==="Point"||T.geometry.type==="MultiPoint"||T.geometry.type==="LineString");for(var x=0;x<y.length;x++)switch(p[x],y[x].geometry.type){case"Polygon":this.polyCoordsToPositions(y[x].geometry.coordinates);break;case"MultiPolygon":y[x].geometry.coordinates.forEach((o,L)=>{this.polyCoordsToPositions(o)});break;case"Point":this.pointCoordsToPositions(y[x].geometry.coordinates);break;case"MultiPoint":y[x].geometry.coordinates.forEach((o,L)=>{this.pointCoordsToPositions(o)});break;case"LineString":this.glDrawType="LINES",this.lineCoordsToPositions(y[x].geometry.coordinates);break;default:console.warn(y[x].geometry.type," not supported");break}this.positionLength=this.positions.length,c.bindBuffer(c.ARRAY_BUFFER,this.buffer),c.bufferData(c.ARRAY_BUFFER,new Float32Array(this.positions),c.STATIC_DRAW,0)}updateMapBBox(){const c=this.context,p=this.program;c.useProgram(p);const y=c.getUniformLocation(p,"u_bbox"),x=this.map,T=x.unproject([0,x.getContainer().offsetHeight]),I=x.unproject([x.getContainer().offsetWidth,0]),o=vr("EPSG:4326","EPSG:3857",[T.lng,T.lat]),L=vr("EPSG:4326","EPSG:3857",[I.lng,I.lat]);c.uniform4fv(y,[o[0],o[1],L[0],L[1]])}setUniform(c){let p=this.context;p.useProgram(this.program);const y=p.getUniformLocation(this.program,c.name);switch(c.type){case"int":p.uniform1i(y,c.value);break;case"float":p.uniform1f(y,c.value);break;case"vec2":p.uniform2fv(y,c.value);break;case"vec3":p.uniform3fv(y,c.value);break;case"vec4":p.uniform4fv(y,c.value);break}}updateResolution(){const c=this.context,p=this.program;c.useProgram(p);let y=c.getUniformLocation(p,"u_resolution");const x=[this.map.getContainer().offsetWidth,this.map.getContainer().offsetHeight];c.uniform2fv(y,x);let T=c.getUniformLocation(p,"u_devicePixelRatio");c.uniform1f(T,window.devicePixelRatio),this.map.triggerRepaint()}establishTexture(c,p,y,x){let T=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,T),c.bufferData(c.ARRAY_BUFFER,new Float32Array(this.positions),c.STATIC_DRAW,0),c.enableVertexAttribArray(this[y]);var I=2,o=c.FLOAT,L=!0,k=0,Y=0;c.vertexAttribPointer(this[y],I,o,L,k,Y),this.texture[y]=c.createTexture(),c.activeTexture(c.TEXTURE0+x),c.bindTexture(c.TEXTURE_2D,this.texture[y]),c.bindTexture(c.TEXTURE_2D,this.texture[y]),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,p),c.generateMipmap(c.TEXTURE_2D)}}var ln=`#version 300 es

precision highp float;

in vec2 v_texcoord;
in vec2 v_normcoord;

uniform sampler2D u_texture;
uniform sampler2D u_normal;

out highp vec4 fragColor;
uniform float u_zoom;
uniform vec3 u_camera;
uniform highp vec2 u_resolution;
uniform vec3 u_color;

uniform bool u_transpose;

uniform vec4 u_bbox;
uniform float u_devicePixelRatio;

vec2 map(vec2 value, vec2 inMin, vec2 inMax, vec2 outMin, vec2 outMax) {
  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);
}

highp vec2 normalizedFragCoordFromLatLng() {

  highp vec2 uv = gl_FragCoord.xy/u_resolution;

  return map(uv, vec2(0.), vec2(u_devicePixelRatio),u_bbox.xy, u_bbox.zw);

}

    void main(void) {
    
    
    
    
    float _zoom = max(pow(u_zoom*2.,2.),1.);

    vec2 transposedNormCoord = u_transpose ? v_normcoord.yx : v_normcoord.xy;
    vec2 transposedTexCoord = u_transpose ? v_texcoord.yx : v_texcoord.xy;

    vec4 normSample = texture(u_normal, transposedNormCoord*_zoom);
    vec4 textureSample = texture(u_texture, transposedTexCoord*_zoom);

    highp vec2 uv = gl_FragCoord.xy/u_resolution;
    float aspectRatio = u_resolution.x/u_resolution.y;

    vec2 center = vec2(.5*aspectRatio,1.);

    vec3 fakeWorldFragCoordPt = vec3(uv,0.);
    vec3 fakeWorldCameraPt = vec3(center,.5);

    vec3 camToCoordVec = normalize(fakeWorldCameraPt-fakeWorldFragCoordPt);
    camToCoordVec.z *= -.75;

    vec3 camReflection = reflect(camToCoordVec,normSample.xyz);

    float dist=dot(camReflection,vec3(uv,-.1));
    fragColor = textureSample*vec4(u_color,1.)*vec4(vec3(max(.2,min(dist,1.))),1.);
    
      
}`,hn=`#version 300 es
    in vec2 a_pos;

  in vec2 a_texcoord;
  in vec2 a_normcoord;
   uniform mat4 u_matrix;

   out vec2 v_texcoord;
  out vec2 v_normcoord;
    void main(void) {
      gl_Position = u_matrix * vec4(a_pos,0., 1.0);
      v_texcoord = a_texcoord;
      v_normcoord = a_normcoord;
    }`,vo=Math.pow,ar=(a,c,p)=>new Promise((y,x)=>{var T=L=>{try{o(p.next(L))}catch(k){x(k)}},I=L=>{try{o(p.throw(L))}catch(k){x(k)}},o=L=>L.done?y(L.value):Promise.resolve(L.value).then(T,I);o((p=p.apply(a,c)).next())}),$r=Uint8Array,go=Uint16Array,bx=Int32Array,_f=new $r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yf=new $r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wx=new $r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vf=function(a,c){for(var p=new go(31),y=0;y<31;++y)p[y]=c+=1<<a[y-1];for(var x=new bx(p[30]),y=1;y<30;++y)for(var T=p[y];T<p[y+1];++T)x[T]=T-p[y]<<5|y;return{b:p,r:x}},xf=vf(_f,2),bf=xf.b,Mx=xf.r;bf[28]=258,Mx[258]=28;var Tx=vf(yf,0),Ex=Tx.b,zu=new go(32768);for(Be=0;Be<32768;++Be)oa=(Be&43690)>>1|(Be&21845)<<1,oa=(oa&52428)>>2|(oa&13107)<<2,oa=(oa&61680)>>4|(oa&3855)<<4,zu[Be]=((oa&65280)>>8|(oa&255)<<8)>>1;var oa,Be,Sl=function(a,c,p){for(var y=a.length,x=0,T=new go(c);x<y;++x)a[x]&&++T[a[x]-1];var I=new go(c);for(x=1;x<c;++x)I[x]=I[x-1]+T[x-1]<<1;var o;if(p){o=new go(1<<c);var L=15-c;for(x=0;x<y;++x)if(a[x])for(var k=x<<4|a[x],Y=c-a[x],N=I[a[x]-1]++<<Y,ot=N|(1<<Y)-1;N<=ot;++N)o[zu[N]>>L]=k}else for(o=new go(y),x=0;x<y;++x)a[x]&&(o[x]=zu[I[a[x]-1]++]>>15-a[x]);return o},Ol=new $r(288);for(Be=0;Be<144;++Be)Ol[Be]=8;var Be;for(Be=144;Be<256;++Be)Ol[Be]=9;var Be;for(Be=256;Be<280;++Be)Ol[Be]=7;var Be;for(Be=280;Be<288;++Be)Ol[Be]=8;var Be,wf=new $r(32);for(Be=0;Be<32;++Be)wf[Be]=5;var Be,Sx=Sl(Ol,9,1),Ix=Sl(wf,5,1),wu=function(a){for(var c=a[0],p=1;p<a.length;++p)a[p]>c&&(c=a[p]);return c},gs=function(a,c,p){var y=c/8|0;return(a[y]|a[y+1]<<8)>>(c&7)&p},Mu=function(a,c){var p=c/8|0;return(a[p]|a[p+1]<<8|a[p+2]<<16)>>(c&7)},Ax=function(a){return(a+7)/8|0},Cx=function(a,c,p){(c==null||c<0)&&(c=0),(p==null||p>a.length)&&(p=a.length);var y=new $r(p-c);return y.set(a.subarray(c,p)),y},Px=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Vr=function(a,c,p){var y=new Error(c||Px[a]);if(y.code=a,Error.captureStackTrace&&Error.captureStackTrace(y,Vr),!p)throw y;return y},Nu=function(a,c,p,y){var x=a.length,T=y?y.length:0;if(!x||c.f&&!c.l)return p||new $r(0);var I=!p||c.i!=2,o=c.i;p||(p=new $r(x*3));var L=function($i){var or=p.length;if($i>or){var Dr=new $r(Math.max(or*2,$i));Dr.set(p),p=Dr}},k=c.f||0,Y=c.p||0,N=c.b||0,ot=c.l,mt=c.d,ft=c.m,Mt=c.n,Tt=x*8;do{if(!ot){k=gs(a,Y,1);var Dt=gs(a,Y+1,3);if(Y+=3,Dt)if(Dt==1)ot=Sx,mt=Ix,ft=9,Mt=5;else if(Dt==2){var de=gs(a,Y,31)+257,ve=gs(a,Y+10,15)+4,Se=de+gs(a,Y+5,31)+1;Y+=14;for(var xe=new $r(Se),Ce=new $r(19),oe=0;oe<ve;++oe)Ce[wx[oe]]=gs(a,Y+oe*3,7);Y+=ve*3;for(var zi=wu(Ce),mi=(1<<zi)-1,nr=Sl(Ce,zi,1),oe=0;oe<Se;){var Yr=nr[gs(a,Y,mi)];Y+=Yr&15;var $t=Yr>>4;if($t<16)xe[oe++]=$t;else{var Ui=0,Ni=0;for($t==16?(Ni=3+gs(a,Y,3),Y+=2,Ui=xe[oe-1]):$t==17?(Ni=3+gs(a,Y,7),Y+=3):$t==18&&(Ni=11+gs(a,Y,127),Y+=7);Ni--;)xe[oe++]=Ui}}var Jr=xe.subarray(0,de),gi=xe.subarray(de);ft=wu(Jr),Mt=wu(gi),ot=Sl(Jr,ft,1),mt=Sl(gi,Mt,1)}else Vr(1);else{var $t=Ax(Y)+4,Pt=a[$t-4]|a[$t-3]<<8,Wt=$t+Pt;if(Wt>x){o&&Vr(0);break}I&&L(N+Pt),p.set(a.subarray($t,Wt),N),c.b=N+=Pt,c.p=Y=Wt*8,c.f=k;continue}if(Y>Tt){o&&Vr(0);break}}I&&L(N+131072);for(var xs=(1<<ft)-1,ha=(1<<Mt)-1,Cr=Y;;Cr=Y){var Ui=ot[Mu(a,Y)&xs],Ai=Ui>>4;if(Y+=Ui&15,Y>Tt){o&&Vr(0);break}if(Ui||Vr(2),Ai<256)p[N++]=Ai;else if(Ai==256){Cr=Y,ot=null;break}else{var Vi=Ai-254;if(Ai>264){var oe=Ai-257,ke=_f[oe];Vi=gs(a,Y,(1<<ke)-1)+bf[oe],Y+=ke}var Pr=mt[Mu(a,Y)&ha],Qr=Pr>>4;Pr||Vr(3),Y+=Pr&15;var gi=Ex[Qr];if(Qr>3){var ke=yf[Qr];gi+=Mu(a,Y)&(1<<ke)-1,Y+=ke}if(Y>Tt){o&&Vr(0);break}I&&L(N+131072);var zr=N+Vi;if(N<gi){var ts=T-gi,kr=Math.min(gi,zr);for(ts+N<0&&Vr(3);N<kr;++N)p[N]=y[ts+N]}for(;N<zr;N+=4)p[N]=p[N-gi],p[N+1]=p[N+1-gi],p[N+2]=p[N+2-gi],p[N+3]=p[N+3-gi];N=zr}}c.l=ot,c.p=Cr,c.b=N,c.f=k,ot&&(k=1,c.m=ft,c.d=mt,c.n=Mt)}while(!k);return N==p.length?p:Cx(p,0,N)},zx=new $r(0),kx=function(a){(a[0]!=31||a[1]!=139||a[2]!=8)&&Vr(6,"invalid gzip data");var c=a[3],p=10;c&4&&(p+=(a[10]|a[11]<<8)+2);for(var y=(c>>3&1)+(c>>4&1);y>0;y-=!a[p++]);return p+(c&2)},Dx=function(a){var c=a.length;return(a[c-4]|a[c-3]<<8|a[c-2]<<16|a[c-1]<<24)>>>0},Lx=function(a,c){return((a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31)&&Vr(6,"invalid zlib data"),(a[1]>>5&1)==+!c&&Vr(6,"invalid zlib data: "+(a[1]&32?"need":"unexpected")+" dictionary"),(a[1]>>3&4)+2};function Rx(a,c){return Nu(a,{i:2},c&&c.out,c&&c.dictionary)}function Bx(a,c){var p=kx(a);return p+8>a.length&&Vr(6,"invalid gzip data"),Nu(a.subarray(p,-8),{i:2},c&&c.out||new $r(Dx(a)),c&&c.dictionary)}function Fx(a,c){return Nu(a.subarray(Lx(a,c&&c.dictionary),-4),{i:2},c&&c.out,c&&c.dictionary)}function ku(a,c){return a[0]==31&&a[1]==139&&a[2]==8?Bx(a,c):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?Rx(a,c):Fx(a,c)}var Ox=typeof TextDecoder<"u"&&new TextDecoder,Ux=0;try{Ox.decode(zx,{stream:!0}),Ux=1}catch{}var Mf=(a,c)=>a*vo(2,c),xl=(a,c)=>Math.floor(a/vo(2,c)),nc=(a,c)=>Mf(a.getUint16(c+1,!0),8)+a.getUint8(c),Tf=(a,c)=>Mf(a.getUint32(c+2,!0),16)+a.getUint16(c,!0),Nx=(a,c,p,y,x)=>{if(a!==y.getUint8(x))return a-y.getUint8(x);const T=nc(y,x+1);if(c!==T)return c-T;const I=nc(y,x+4);return p!==I?p-I:0},Vx=(a,c,p,y)=>{const x=Ef(a,c|128,p,y);return x?{z:c,x:p,y,offset:x[0],length:x[1],isDir:!0}:null},Op=(a,c,p,y)=>{const x=Ef(a,c,p,y);return x?{z:c,x:p,y,offset:x[0],length:x[1],isDir:!1}:null},Ef=(a,c,p,y)=>{let x=0,T=a.byteLength/17-1;for(;x<=T;){const I=T+x>>1,o=Nx(c,p,y,a,I*17);if(o>0)x=I+1;else if(o<0)T=I-1;else return[Tf(a,I*17+7),a.getUint32(I*17+13,!0)]}return null},$x=(a,c)=>a.isDir&&!c.isDir?1:!a.isDir&&c.isDir?-1:a.z!==c.z?a.z-c.z:a.x!==c.x?a.x-c.x:a.y-c.y,Sf=(a,c)=>{const p=a.getUint8(c*17);return{z:p&127,x:nc(a,c*17+1),y:nc(a,c*17+4),offset:Tf(a,c*17+7),length:a.getUint32(c*17+13,!0),isDir:p>>7===1}},Up=a=>{const c=[],p=new DataView(a);for(let y=0;y<p.byteLength/17;y++)c.push(Sf(p,y));return qx(c)},qx=a=>{a.sort($x);const c=new ArrayBuffer(17*a.length),p=new Uint8Array(c);for(let y=0;y<a.length;y++){const x=a[y];let T=x.z;x.isDir&&(T=T|128),p[y*17]=T,p[y*17+1]=x.x&255,p[y*17+2]=x.x>>8&255,p[y*17+3]=x.x>>16&255,p[y*17+4]=x.y&255,p[y*17+5]=x.y>>8&255,p[y*17+6]=x.y>>16&255,p[y*17+7]=x.offset&255,p[y*17+8]=xl(x.offset,8)&255,p[y*17+9]=xl(x.offset,16)&255,p[y*17+10]=xl(x.offset,24)&255,p[y*17+11]=xl(x.offset,32)&255,p[y*17+12]=xl(x.offset,48)&255,p[y*17+13]=x.length&255,p[y*17+14]=x.length>>8&255,p[y*17+15]=x.length>>16&255,p[y*17+16]=x.length>>24&255}return c},Gx=(a,c)=>{if(a.byteLength<17)return null;const p=a.byteLength/17,y=Sf(a,p-1);if(y.isDir){const x=y.z,T=c.z-x,I=Math.trunc(c.x/(1<<T)),o=Math.trunc(c.y/(1<<T));return{z:x,x:I,y:o}}return null};function Zx(a){return ar(this,null,function*(){const c=yield a.getBytes(0,512e3),p=new DataView(c.data),y=p.getUint32(4,!0),x=p.getUint16(8,!0),T=new TextDecoder("utf-8"),I=JSON.parse(T.decode(new DataView(c.data,10,y)));let o=0;I.compression==="gzip"&&(o=2);let L=0;"minzoom"in I&&(L=+I.minzoom);let k=0;"maxzoom"in I&&(k=+I.maxzoom);let Y=0,N=0,ot=0,mt=-180,ft=-85,Mt=180,Tt=85;if(I.bounds){const $t=I.bounds.split(",");mt=+$t[0],ft=+$t[1],Mt=+$t[2],Tt=+$t[3]}if(I.center){const $t=I.center.split(",");Y=+$t[0],N=+$t[1],ot=+$t[2]}return{specVersion:p.getUint16(2,!0),rootDirectoryOffset:10+y,rootDirectoryLength:x*17,jsonMetadataOffset:10,jsonMetadataLength:y,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:L,maxZoom:k,minLon:mt,minLat:ft,maxLon:Mt,maxLat:Tt,centerZoom:ot,centerLon:Y,centerLat:N,etag:c.etag}})}function jx(a,c,p,y,x,T,I){return ar(this,null,function*(){let o=yield p.getArrayBuffer(c,a.rootDirectoryOffset,a.rootDirectoryLength,a);a.specVersion===1&&(o=Up(o));const L=Op(new DataView(o),y,x,T);if(L){let N=(yield c.getBytes(L.offset,L.length,I)).data;const ot=new DataView(N);return ot.getUint8(0)===31&&ot.getUint8(1)===139&&(N=ku(new Uint8Array(N))),{data:N}}const k=Gx(new DataView(o),{z:y,x,y:T});if(k){const Y=Vx(new DataView(o),k.z,k.x,k.y);if(Y){let N=yield p.getArrayBuffer(c,Y.offset,Y.length,a);a.specVersion===1&&(N=Up(N));const ot=Op(new DataView(N),y,x,T);if(ot){let ft=(yield c.getBytes(ot.offset,ot.length,I)).data;const Mt=new DataView(ft);return Mt.getUint8(0)===31&&Mt.getUint8(1)===139&&(ft=ku(new Uint8Array(ft))),{data:ft}}}}})}var If={getHeader:Zx,getZxy:jx},Xx=a=>(c,p)=>{if(p instanceof AbortController)return a(c,p);const y=new AbortController;return a(c,y).then(x=>p(void 0,x.data,x.cacheControl||"",x.expires||""),x=>p(x)).catch(x=>p(x)),{cancel:()=>y.abort()}},Wx=class{constructor(){this.tilev4=(a,c)=>ar(this,null,function*(){if(a.type==="json"){const N=a.url.substr(10);let ot=this.tiles.get(N);ot||(ot=new Np(N),this.tiles.set(N,ot));const mt=yield ot.getHeader();return{data:{tiles:[`${a.url}/{z}/{x}/{y}`],minzoom:mt.minZoom,maxzoom:mt.maxZoom,bounds:[mt.minLon,mt.minLat,mt.maxLon,mt.maxLat]}}}const p=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),y=a.url.match(p);if(!y)throw new Error("Invalid PMTiles protocol URL");const x=y[1];let T=this.tiles.get(x);T||(T=new Np(x),this.tiles.set(x,T));const I=y[2],o=y[3],L=y[4],k=yield T.getHeader(),Y=yield T==null?void 0:T.getZxy(+I,+o,+L,c.signal);return Y?{data:new Uint8Array(Y.data),cacheControl:Y.cacheControl,expires:Y.expires}:k.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=Xx(this.tilev4),this.tiles=new Map}add(a){this.tiles.set(a.source.getKey(),a)}get(a){return this.tiles.get(a)}};function lo(a,c){return(c>>>0)*4294967296+(a>>>0)}function Hx(a,c){const p=c.buf;let y=p[c.pos++],x=(y&112)>>4;if(y<128||(y=p[c.pos++],x|=(y&127)<<3,y<128)||(y=p[c.pos++],x|=(y&127)<<10,y<128)||(y=p[c.pos++],x|=(y&127)<<17,y<128)||(y=p[c.pos++],x|=(y&127)<<24,y<128)||(y=p[c.pos++],x|=(y&1)<<31,y<128))return lo(a,x);throw new Error("Expected varint not more than 10 bytes")}function bl(a){const c=a.buf;let p=c[a.pos++],y=p&127;return p<128||(p=c[a.pos++],y|=(p&127)<<7,p<128)||(p=c[a.pos++],y|=(p&127)<<14,p<128)||(p=c[a.pos++],y|=(p&127)<<21,p<128)?y:(p=c[a.pos],y|=(p&15)<<28,Hx(y,a))}function Kx(a,c,p,y){if(y===0){p===1&&(c[0]=a-1-c[0],c[1]=a-1-c[1]);const x=c[0];c[0]=c[1],c[1]=x}}var Yx=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Jx(a,c,p){if(a>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(c>vo(2,a)-1||p>vo(2,a)-1)throw Error("tile x/y outside zoom level bounds");const y=Yx[a],x=vo(2,a);let T=0,I=0,o=0;const L=[c,p];let k=x/2;for(;k>0;)T=(L[0]&k)>0?1:0,I=(L[1]&k)>0?1:0,o+=k*k*(3*T^I),Kx(k,L,T,I),k=k/2;return y+o}function Af(a,c){return ar(this,null,function*(){if(c===1||c===0)return a;if(c===2){if(typeof globalThis.DecompressionStream>"u")return ku(new Uint8Array(a));const p=new Response(a).body;if(!p)throw Error("Failed to read response stream");const y=p.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(y).arrayBuffer()}throw Error("Compression method not supported")})}var Qx=127;function t1(a,c){let p=0,y=a.length-1;for(;p<=y;){const x=y+p>>1,T=c-a[x].tileId;if(T>0)p=x+1;else if(T<0)y=x-1;else return a[x]}return y>=0&&(a[y].runLength===0||c-a[y].tileId<a[y].runLength)?a[y]:null}var e1=class{constructor(a,c=new Headers){this.url=a,this.customHeaders=c,this.mustReload=!1}getKey(){return this.url}setHeaders(a){this.customHeaders=a}getBytes(a,c,p,y){return ar(this,null,function*(){let x,T;p?T=p:(x=new AbortController,T=x.signal);const I=new Headers(this.customHeaders);I.set("range",`bytes=${a}-${a+c-1}`);let o;this.mustReload&&(o="reload");let L=yield fetch(this.url,{signal:T,cache:o,headers:I});if(a===0&&L.status===416){const ot=L.headers.get("Content-Range");if(!ot||!ot.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const mt=+ot.substr(8);L=yield fetch(this.url,{signal:T,cache:"reload",headers:{range:`bytes=0-${mt-1}`}})}let k=L.headers.get("Etag");if(k!=null&&k.startsWith("W/")&&(k=null),L.status===416||y&&k&&k!==y)throw this.mustReload=!0,new Du(`Server returned non-matching ETag ${y} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(L.status>=300)throw Error(`Bad response code: ${L.status}`);const Y=L.headers.get("Content-Length");if(L.status===200&&(!Y||+Y>c))throw x&&x.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield L.arrayBuffer(),etag:k||void 0,cacheControl:L.headers.get("Cache-Control")||void 0,expires:L.headers.get("Expires")||void 0}})}};function _s(a,c){const p=a.getUint32(c+4,!0),y=a.getUint32(c+0,!0);return p*vo(2,32)+y}function i1(a,c){const p=new DataView(a),y=p.getUint8(7);if(y>3)throw Error(`Archive is spec version ${y} but this library supports up to spec version 3`);return{specVersion:y,rootDirectoryOffset:_s(p,8),rootDirectoryLength:_s(p,16),jsonMetadataOffset:_s(p,24),jsonMetadataLength:_s(p,32),leafDirectoryOffset:_s(p,40),leafDirectoryLength:_s(p,48),tileDataOffset:_s(p,56),tileDataLength:_s(p,64),numAddressedTiles:_s(p,72),numTileEntries:_s(p,80),numTileContents:_s(p,88),clustered:p.getUint8(96)===1,internalCompression:p.getUint8(97),tileCompression:p.getUint8(98),tileType:p.getUint8(99),minZoom:p.getUint8(100),maxZoom:p.getUint8(101),minLon:p.getInt32(102,!0)/1e7,minLat:p.getInt32(106,!0)/1e7,maxLon:p.getInt32(110,!0)/1e7,maxLat:p.getInt32(114,!0)/1e7,centerZoom:p.getUint8(118),centerLon:p.getInt32(119,!0)/1e7,centerLat:p.getInt32(123,!0)/1e7,etag:c}}function Cf(a){const c={buf:new Uint8Array(a),pos:0},p=bl(c),y=[];let x=0;for(let T=0;T<p;T++){const I=bl(c);y.push({tileId:x+I,offset:0,length:0,runLength:1}),x+=I}for(let T=0;T<p;T++)y[T].runLength=bl(c);for(let T=0;T<p;T++)y[T].length=bl(c);for(let T=0;T<p;T++){const I=bl(c);I===0&&T>0?y[T].offset=y[T-1].offset+y[T-1].length:y[T].offset=I-1}return y}function r1(a){const c=new DataView(a);return c.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):c.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Du=class extends Error{};function s1(a,c){return ar(this,null,function*(){const p=yield a.getBytes(0,16384);if(new DataView(p.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(r1(p.data)<3)return[yield If.getHeader(a)];const x=p.data.slice(0,Qx),T=i1(x,p.etag),I=p.data.slice(T.rootDirectoryOffset,T.rootDirectoryOffset+T.rootDirectoryLength),o=`${a.getKey()}|${T.etag||""}|${T.rootDirectoryOffset}|${T.rootDirectoryLength}`,L=Cf(yield c(I,T.internalCompression));return[T,[o,L.length,L]]})}function a1(a,c,p,y,x){return ar(this,null,function*(){const T=yield a.getBytes(p,y,void 0,x.etag),I=yield c(T.data,x.internalCompression),o=Cf(I);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var n1=class{constructor(a=100,c=!0,p=Af){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=a,this.counter=1,this.decompress=p}getHeader(a){return ar(this,null,function*(){const c=a.getKey(),p=this.cache.get(c);if(p)return p.lastUsed=this.counter++,yield p.data;const y=new Promise((x,T)=>{s1(a,this.decompress).then(I=>{I[1]&&this.cache.set(I[1][0],{lastUsed:this.counter++,data:Promise.resolve(I[1][2])}),x(I[0]),this.prune()}).catch(I=>{T(I)})});return this.cache.set(c,{lastUsed:this.counter++,data:y}),y})}getDirectory(a,c,p,y){return ar(this,null,function*(){const x=`${a.getKey()}|${y.etag||""}|${c}|${p}`,T=this.cache.get(x);if(T)return T.lastUsed=this.counter++,yield T.data;const I=new Promise((o,L)=>{a1(a,this.decompress,c,p,y).then(k=>{o(k),this.prune()}).catch(k=>{L(k)})});return this.cache.set(x,{lastUsed:this.counter++,data:I}),I})}getArrayBuffer(a,c,p,y){return ar(this,null,function*(){const x=`${a.getKey()}|${y.etag||""}|${c}|${p}`,T=this.cache.get(x);if(T)return T.lastUsed=this.counter++,yield T.data;const I=new Promise((o,L)=>{a.getBytes(c,p,void 0,y.etag).then(k=>{o(k.data),this.cache.has(x),this.prune()}).catch(k=>{L(k)})});return this.cache.set(x,{lastUsed:this.counter++,data:I}),I})}prune(){if(this.cache.size>=this.maxCacheEntries){let a=1/0,c;this.cache.forEach((p,y)=>{p.lastUsed<a&&(a=p.lastUsed,c=y)}),c&&this.cache.delete(c)}}invalidate(a){return ar(this,null,function*(){const c=a.getKey();if(this.invalidations.get(c))return yield this.invalidations.get(c);this.cache.delete(a.getKey());const p=new Promise((y,x)=>{this.getHeader(a).then(T=>{y(),this.invalidations.delete(c)}).catch(T=>{x(T)})});this.invalidations.set(c,p)})}},Np=class{constructor(a,c,p){typeof a=="string"?this.source=new e1(a):this.source=a,p?this.decompress=p:this.decompress=Af,c?this.cache=c:this.cache=new n1}getHeader(){return ar(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(a,c,p,y){return ar(this,null,function*(){const x=Jx(a,c,p),T=yield this.cache.getHeader(this.source);if(T.specVersion<3)return If.getZxy(T,this.source,this.cache,a,c,p,y);if(a<T.minZoom||a>T.maxZoom)return;let I=T.rootDirectoryOffset,o=T.rootDirectoryLength;for(let L=0;L<=3;L++){const k=yield this.cache.getDirectory(this.source,I,o,T),Y=t1(k,x);if(Y){if(Y.runLength>0){const N=yield this.source.getBytes(T.tileDataOffset+Y.offset,Y.length,y,T.etag);return{data:yield this.decompress(N.data,T.tileCompression),cacheControl:N.cacheControl,expires:N.expires}}I=T.leafDirectoryOffset+Y.offset,o=Y.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(a,c,p,y){return ar(this,null,function*(){try{return yield this.getZxyAttempt(a,c,p,y)}catch(x){if(x instanceof Du)return this.cache.invalidate(this.source),yield this.getZxyAttempt(a,c,p,y);throw x}})}getMetadataAttempt(){return ar(this,null,function*(){const a=yield this.cache.getHeader(this.source),c=yield this.source.getBytes(a.jsonMetadataOffset,a.jsonMetadataLength,void 0,a.etag),p=yield this.decompress(c.data,a.internalCompression),y=new TextDecoder("utf-8");return JSON.parse(y.decode(p))})}getMetadata(){return ar(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(a){if(a instanceof Du)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw a}})}};const o1=new Wx;Da.addProtocol("pmtiles",o1.tile);const je=new Da.Map({container:"map",style:"./protostyle.json",center:[-71.5593,41.1338],zoom:7,hash:!0});let Zh,jh,Xh,Wh,Hh,Kh,Yh,Bs=[];je.on("click",a=>{je.queryRenderedFeatures(a.point).forEach(p=>console.log(p.layer.id))});je.once("load",()=>{Zh=new on(je,"waterShader",["water"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),jh=new on(je,"earthShader",["earth"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),Xh=new on(je,"parkShader",["landuse_park"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),Wh=new on(je,"urbanGreenShader",["landuse_urban_green"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),Hh=new on(je,"naturalWoodShader",["natural_wood"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),Kh=new on(je,"industrialShader",["landuse_industrial"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),Yh=new on(je,"scrubShader",["natural_scrub"],{fragmentSource:ln,vertexSource:hn,imagePath:"./example/Textures/fabric/Fabric_Knitted_006_basecolor_x512.jpg",normalImagePath:"./example/Textures/fabric/Fabric_Knitted_006_norm_x512.jpg"}),Bs.push(Zh),Bs.push(jh),Bs.push(Xh),Bs.push(Wh),Bs.push(Hh),Bs.push(Kh),Bs.push(Yh),je.addLayer(Zh,"physical_line_stream"),je.addLayer(jh,"landuse_park"),je.addLayer(Xh,"landuse_hospital"),je.addLayer(Wh,"landuse_hospital"),je.addLayer(Hh,"natural_scrub"),je.addLayer(Kh,"natural_scrub"),je.addLayer(Yh,"natural_glacier"),cn(Zh,[0,0,1]),cn(jh,[0,1,.3]),cn(Xh,[0,.6,.1]),cn(Wh,[156/255,211/255,180/255]),cn(Hh,[156/255,211/255,180/255]),cn(Kh,[156/255,130/255,120/255]),cn(Yh,[156/255,211/255,210/255])});function cn(a,c){const p=Math.floor(je.getZoom())/2-2;a.setUniform({name:"u_zoom",type:"float",value:Math.floor(je.getZoom()*p)}),a.setUniform({name:"u_color",type:"vec3",value:c});const y=Math.random()>.5;a.setUniform({name:"u_transpose",type:"bool",value:y}),Pf(a)}function Pf(a){a.setUniform({name:"u_resolution",type:"vec2",value:[je.getContainer().offsetWidth,je.getContainer().offsetHeight]}),a.setUniform({name:"u_devicePixelRatio",type:"float",value:window.devicePixelRatio})}window.multiplier=1;function l1(a){const c=Math.floor(je.getZoom())/2-2;a.setUniform({name:"u_zoom",type:"float",value:Math.floor(je.getZoom()*c)});const p=je.getCenter().lng,y=je.getCenter().lat;a.updateMapBBox();const x=vr("EPSG:4326","EPSG:3857",[p,y]);a.setUniform({name:"u_camera",type:"vec3",value:x})}je.on("move",()=>{for(let a=0;a<Bs.length;a++)l1(Bs[a]),Pf(Bs[a])})});export default h1();
